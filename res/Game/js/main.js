var CoinSprite=cc.Sprite.extend({ctor:function(physicsSpace){this._super("#coin.png");this.physicsSpace=physicsSpace},_initPhysics:function(){var contentSize=this.getContentSize();var body=new cp.Body(1,1);this.physicsSpace.addBody(body);body.p=cp.v(this.x,this.y);body.t=this._torque;body.setVel(this._force);var radius=(contentSize.width+contentSize.height)/4*this.getScale();var shape=new cp.CircleShape(body,radius,cp.v(0,0));shape.setElasticity(.5);shape.setFriction(.8);shape.group=1;this.physicsSpace.addShape(shape);
this.body=body;this.shape=shape},_destroyPhysics:function(){if(this.physicsSpace){this.physicsSpace.removeShape(this.shape);this.physicsSpace.removeBody(this.body);this.shape=null;this.body=null;this.physicsSpace=null}},update:function(){this.setPosition(this.body.p.x,this.body.p.y);this.setRotation(-cc.radiansToDegrees(this.body.a))},onEnter:function(){this._super();this.scheduleUpdate();this._initPhysics()},onExit:function(){this._super();this.unscheduleUpdate();this._destroyPhysics()},startWithDuration:function(duration,
scaleTo){var thiz=this;var fadeOutTime=2+Math.random()*1;var scaleAction=new cc.ScaleTo(duration,scaleTo);var fadeAction=new cc.FadeOut(fadeOutTime);this.runAction(new cc.Sequence(scaleAction,fadeAction,new cc.CallFunc(function(){thiz.removeFromParent(true)})))}});
var JackpotLayer=cc.Node.extend({ctor:function(){this._scaleStart=.5;this._scaleDelta=.1;this._scaleEnd=.7;this._scaleEndDelta=.4;this._rotateStart=-15;this._rotateDelta=30;this._forceStart=900;this._forceDelta=200;this._torqueStart=-8;this._torqueDelta=16;this._timeStart=2;this._timeDelta=1;this._startPosition=cc.p(cc.winSize.width/2,200);this._startPositionDelta=cc.p(40,10);this._super();this._initPhysics();var jackpotSprite=new cc.Sprite("#nohu_fr1.png");jackpotSprite.setPosition(this._startPosition.x,
this._startPosition.y+20);this.addChild(jackpotSprite);this.jackpotSprite=jackpotSprite;var shakeAction=new quyetnd.ActionShake2D(1,cc.p(10,0));var frames=[];frames.push(cc.spriteFrameCache.getSpriteFrame("nohu_fr2.png"));frames.push(cc.spriteFrameCache.getSpriteFrame("nohu_fr3.png"));frames.push(cc.spriteFrameCache.getSpriteFrame("nohu_fr4.png"));var animation=new cc.Animation(frames,.1,1);var animateAction=new cc.Animate(animation);var thiz=this;jackpotSprite.runAction(new cc.Sequence(shakeAction,
new cc.CallFunc(function(){thiz.addAllCoin()}),animateAction,new cc.CallFunc(function(){jackpotSprite.setVisible(false)})))},_initPhysics:function(){this.space=new cp.Space;this.space.gravity=cp.v(0,-1200);this.space.sleepTimeThreshold=.5;var floorShape=new cp.SegmentShape(this.space.staticBody,cp.v(0,0),cp.v(cc.winSize.width*2,0),0);floorShape.setElasticity(1);floorShape.setFriction(1);floorShape.setLayers(~0);this.space.addStaticShape(floorShape)},_addCoin:function(){var startScale=this._scaleStart+
Math.random()*this._scaleDelta;var endScale=this._scaleEnd+Math.random()*this._scaleEndDelta;var force=this._forceStart+Math.random()*this._forceDelta;var rotate=this._rotateStart+Math.random()*this._rotateDelta;var torque=this._torqueStart+Math.random()*this._torqueDelta;var forceVector=cc.pRotateByAngle(cc.p(0,force),cc.p(0,0),cc.degreesToRadians(rotate));var time=this._timeStart+Math.random()*this._timeDelta;var x=this._startPosition.x+(-this._startPositionDelta.x+Math.random()*this._startPositionDelta.x*
2);var y=this._startPosition.y+(-this._startPositionDelta.y+Math.random()*this._startPositionDelta.y*2);var coin=new CoinSprite(this.space);coin.setPosition(x,y);coin.setScale(startScale);coin._force=cp.v(forceVector.x,forceVector.y);coin._torque=torque;this.addChild(coin);coin.startWithDuration(time,endScale)},addAllCoin:function(){var n=50+Math.floor(Math.random()*20);for(var i=0;i<n;i++)this._addCoin();var thiz=this;var maxTime=this._timeStart+this._timeDelta+5;this.runAction(new cc.Sequence(new cc.DelayTime(maxTime),
new cc.CallFunc(function(){thiz.removeFromParent(true)})))},update:function(dt){this.space.step(dt)},onEnter:function(){this._super();this.scheduleUpdate()},onExit:function(){this._super();this.unscheduleUpdate()},show:function(){var runningScene=cc.director.getRunningScene();runningScene.addChild(this,1E3)}});String.prototype.insertAt=function(index,string){return this.substr(0,index)+string+this.substr(index)};var cc=cc||{};cc.Global=cc.Global||{};cc.Global.NumberFormat1=function(number){var pret=Math.abs(number).toString();if(pret.length>3)for(var i=pret.length-3;i>0;i-=3)pret=pret.insertAt(i,",");if(number<0)return"-"+pret;return pret};var Number_Format_Type=["","K","M","B"];
cc.Global.NumberFormat2=function(number){var i=0;while(number>=1E3){number=Math.floor(number/1E3);i++}return number.toString()+Number_Format_Type[i]};cc.Global.NumberFromString=function(str){var numberText=str.replace(/[.,]/g,"");if(numberText&&cc.Global.IsNumber(numberText))return parseInt(numberText);return null};cc.Global.NumberFormatWithPadding=function(number,size){if(size==undefined)size=2;if(number<0)return number.toString();var str=number.toString();while(str.length<size)str="0"+str;return str};
cc.Global.DateToString=function(d){var timeString=cc.Global.NumberFormatWithPadding(d.getDate())+"/"+cc.Global.NumberFormatWithPadding(d.getMonth()+1)+"/"+(1900+d.getYear()).toString()+"\n"+cc.Global.NumberFormatWithPadding(d.getHours())+":"+cc.Global.NumberFormatWithPadding(d.getMinutes())+":"+cc.Global.NumberFormatWithPadding(d.getSeconds());return timeString};cc.res=cc.res||{};cc.res.font=cc.res.font||{};
if(cc.sys.isNative){cc.res.font.Roboto_Condensed="res/fonts/Roboto-Condensed.ttf";cc.res.font.Roboto_CondensedBold="res/fonts/Roboto-BoldCondensed.ttf";cc.res.font.UTM_AvoBold="res/fonts/UTM-AvoBold.ttf"}else{cc.res.font.Roboto_Condensed="Roboto-Condensed";cc.res.font.Roboto_CondensedBold="Roboto-BoldCondensed";cc.res.font.UTM_AvoBold="UTM-AvoBold"}cc.res.font.Roboto_Condensed_40="res/fonts/RobotoCondensed_40.fnt";cc.res.font.Roboto_CondensedBold_40="res/fonts/RobotoBoldCondensed_40.fnt";
cc.res.font.UTM_AvoBold_40="res/fonts/UTMAvoBold_40.fnt";cc.res.font.Roboto_Condensed_30="res/fonts/RobotoCondensed_30.fnt";cc.res.font.Roboto_CondensedBold_30="res/fonts/RobotoBoldCondensed_30.fnt";cc.res.font.UTM_AvoBold_30="res/fonts/UTMAvoBold_30.fnt";cc.res.font.Roboto_Condensed_25="res/fonts/RobotoCondensed_25.fnt";cc.res.font.Roboto_CondensedBold_25="res/fonts/RobotoBoldCondensed_25.fnt";cc.res.font.UTM_AvoBold_25="res/fonts/UTMAvoBold_25.fnt";cc.res.font.Roboto_BoldCondensed_36_Glow="res/fonts/Roboto_BoldCondensed_36_Glow.fnt";
cc.res.font.videoPokerRewardFont="res/fonts/videoPokerRewardFont.fnt";cc.res.font.Roboto_Condensed_14="res/fonts/RobotoCondensed_14.fnt";cc.res.font.Roboto_CondensedBold_14="res/fonts/RobotoBoldCondensed_14.fnt";cc.res.font.Roboto_Condensed_16="res/fonts/RobotoCondensed_16.fnt";cc.res.font.Roboto_CondensedBold_16="res/fonts/RobotoBoldCondensed_16.fnt";cc.res.font.Roboto_Condensed_18="res/fonts/RobotoCondensed_18.fnt";cc.res.font.Roboto_CondensedBold_18="res/fonts/RobotoBoldCondensed_18.fnt";
cc.res.font.Roboto_Condensed_20="res/fonts/RobotoCondensed_20.fnt";cc.res.font.Roboto_CondensedBold_20="res/fonts/RobotoBoldCondensed_20.fnt";var GameType=GameType||{};GameType.GAME_MauBinh=0;GameType.GAME_TienLenMN=1;GameType.GAME_Phom=2;GameType.GAME_Sam=3;GameType.GAME_BaCay=4;GameType.GAME_XocDia=5;GameType.GAME_TaiXiu=6;GameType.GAME_VongQuayMayMan=7;GameType.GAME_TLMN_Solo=8;GameType.GAME_Sam_Solo=9;GameType.GAME_Lieng=10;GameType.GAME_BaCayChuong=11;GameType.MiniGame_ChanLe=12;
GameType.MiniGame_CaoThap=13;GameType.MiniGame_Poker=14;GameType.MiniGame_VideoPoker=15;GameType.GAME_Poker=16;var s_game_available=s_game_available||{};s_game_available[GameType.GAME_MauBinh]=true;s_game_available[GameType.GAME_TienLenMN]=true;s_game_available[GameType.GAME_Phom]=true;s_game_available[GameType.GAME_Sam]=true;s_game_available[GameType.GAME_BaCay]=true;s_game_available[GameType.GAME_XocDia]=true;s_game_available[GameType.GAME_TaiXiu]=true;
s_game_available[GameType.GAME_VongQuayMayMan]=false;s_game_available[GameType.GAME_TLMN_Solo]=true;s_game_available[GameType.GAME_Sam_Solo]=true;s_game_available[GameType.GAME_Lieng]=false;s_game_available[GameType.GAME_BaCayChuong]=false;s_game_available[GameType.MiniGame_ChanLe]=true;s_game_available[GameType.MiniGame_CaoThap]=true;s_game_available[GameType.MiniGame_Poker]=true;s_game_available[GameType.MiniGame_VideoPoker]=true;s_game_available[GameType.GAME_Poker]=true;
var s_game_id=s_game_id||[[GameType.GAME_TLMN_Solo,GameType.GAME_TienLenMN,GameType.MiniGame_CaoThap,GameType.MiniGame_Poker,GameType.GAME_XocDia,GameType.GAME_TaiXiu,GameType.GAME_Sam_Solo,GameType.GAME_Sam,GameType.GAME_Phom,GameType.GAME_BaCay,GameType.GAME_VongQuayMayMan,GameType.MiniGame_VideoPoker,GameType.GAME_MauBinh,GameType.MiniGame_ChanLe,GameType.GAME_Poker],[GameType.GAME_TLMN_Solo,GameType.GAME_TienLenMN,GameType.GAME_Sam_Solo,GameType.GAME_Sam,GameType.GAME_Phom,GameType.GAME_BaCay,
GameType.GAME_MauBinh],[GameType.MiniGame_CaoThap,GameType.MiniGame_Poker,GameType.MiniGame_ChanLe,GameType.MiniGame_VideoPoker],[GameType.GAME_VongQuayMayMan,GameType.GAME_MauBinh],[GameType.GAME_TLMN_Solo,GameType.GAME_TienLenMN,GameType.MiniGame_CaoThap,GameType.MiniGame_Poker]];var s_mini_game_id=[GameType.MiniGame_CaoThap,GameType.MiniGame_Poker,GameType.MiniGame_VideoPoker];var s_games_display_name=s_games_display_name||[];s_games_display_name[GameType.GAME_TLMN_Solo]="TLMN \u0110\u1ebeM L\u00c1 SOLO";
s_games_display_name[GameType.GAME_TienLenMN]="TI\u1ebeN L\u00caN MI\u1ec0N NAM";s_games_display_name[GameType.GAME_Sam]="S\u00c2M L\u1ed0C";s_games_display_name[GameType.GAME_Sam_Solo]="S\u00c2M SOLO";s_games_display_name[GameType.GAME_XocDia]="X\u00d3C \u0110\u0128A";s_games_display_name[GameType.GAME_TaiXiu]="T\u00c0I X\u1ec8U";s_games_display_name[GameType.GAME_MauBinh]="M\u1eacU BINH";s_games_display_name[GameType.GAME_Phom]="PH\u1eceM";s_games_display_name[GameType.GAME_BaCay]="BA C\u00c2Y NH\u1ea4T \u0102N T\u1ea4T";
s_games_display_name[GameType.GAME_Lieng]="LI\u00caNG";s_games_display_name[GameType.GAME_BaCayChuong]="BA C\u00c2Y CH\u01af\u01a0NG";s_games_display_name[GameType.MiniGame_CaoThap]="Cao th\u1ea5p";s_games_display_name[GameType.MiniGame_Poker]="MiniPoker";s_games_display_name[GameType.MiniGame_VideoPoker]="VideoPoker";s_games_display_name[GameType.GAME_Poker]="Poker";var s_games_chanel=s_games_chanel||[];s_games_chanel[GameType.GAME_TLMN_Solo]="tlmn_solo";s_games_chanel[GameType.GAME_TienLenMN]="tlmn_tudo";
s_games_chanel[GameType.GAME_Sam]="sam_tudo";s_games_chanel[GameType.GAME_Sam_Solo]="sam_solo";s_games_chanel[GameType.GAME_XocDia]="ShakeDisk";s_games_chanel[GameType.GAME_TaiXiu]="TaiXiu";s_games_chanel[GameType.GAME_MauBinh]="ChinesePoker";s_games_chanel[GameType.GAME_Phom]="Phom";s_games_chanel[GameType.GAME_BaCay]="ThreeCards";s_games_chanel[GameType.GAME_Lieng]="lieng";s_games_chanel[GameType.GAME_BaCayChuong]="bacaychuong";s_games_chanel[GameType.GAME_Poker]="Poker";
var s_games_chanel_id=s_games_chanel_id||{};(function(){for(var i=0;i<s_games_chanel.length;i++){var gameName=s_games_chanel[i];if(gameName&&gameName!="")s_games_chanel_id[gameName]=i}})();var PlayerMe=PlayerMe||{};PlayerMe.username="quyetnd";PlayerMe.password="1234567";PlayerMe.phoneNumber="0123456789";PlayerMe.gameType="";PlayerMe.gold=1E3;PlayerMe.exp=11E3;PlayerMe.vipExp=1E3;PlayerMe.avatar="";PlayerMe.spin=0;PlayerMe.messageCount=0;PlayerMe.missionCount=0;PlayerMe.SFS=PlayerMe.SFS||{};
var GameConfig=GameConfig||{};GameConfig.email="c567vip@gmail.com";GameConfig.hotline="0903.229.747";GameConfig.fanpage="https://www.facebook.com/C567gamebaidoithuong/";GameConfig.broadcastMessage="";GameConfig.DeviceIDKey="";var LevelData=null;var VipData=null;var StringData=null;cc.Global.getStringRes=function(){if(!StringData)if(cc.sys.isNative)StringData=JSON.parse(jsb.fileUtils.getStringFromFile("res/data/String.json"));else StringData=cc.loader.getRes("res/data/String.json");return StringData};
cc.Global.GetLevel=function(exp){if(!LevelData)if(cc.sys.isNative)LevelData=JSON.parse(jsb.fileUtils.getStringFromFile("res/data/LevelData.json"));else LevelData=cc.loader.getRes("res/data/LevelData.json");var preLevel=LevelData[0];for(var i=1;i<LevelData.length;i++){var obj=LevelData[i];if(exp>=preLevel.exp&&exp<obj.exp){var expPer=100*(exp-preLevel.exp)/(obj.exp-preLevel.exp);return{level:i-1,expPer:expPer,content:preLevel.content}}preLevel=obj}return{level:LevelData.length-1,expPer:100,content:preLevel.content}};
cc.Global.GetVip=function(exp){if(!VipData)if(cc.sys.isNative)VipData=JSON.parse(jsb.fileUtils.getStringFromFile("res/data/VipData.json"));else VipData=cc.loader.getRes("res/data/VipData.json");var preLevel=VipData[0];for(var i=1;i<VipData.length;i++){var obj=VipData[i];if(exp>=preLevel.exp&&exp<obj.exp){var expPer=100*(exp-preLevel.exp)/(obj.exp-preLevel.exp);return{level:i-1,expPer:expPer,content:preLevel.content}}preLevel=obj}return{level:VipData.length-1,expPer:100,content:preLevel.content}};
cc.Global.GetLevelMe=function(){return cc.Global.GetLevel(PlayerMe.exp)};cc.Global.GetVipMe=function(){return cc.Global.GetVip(PlayerMe.vipExp)};cc.Global.GetSetting=function(setting,defaultValue){var value=cc.sys.localStorage.getItem(setting);if(value)try{return JSON.parse(value)}catch(e){return value}return defaultValue};cc.Global.SetSetting=function(setting,value){cc.sys.localStorage.setItem(setting,value)};var ApplicationConfig=ApplicationConfig||{};ApplicationConfig.DISPLAY_TYPE="room";
(function(){if(cc.sys.isNative)if(cc.sys.os===cc.sys.OS_IOS)ApplicationConfig.PLATFORM=1;else if(cc.sys.os===cc.sys.OS_ANDROID)ApplicationConfig.PLATFORM=2;else if(cc.sys.os===cc.sys.OS_WINRT)ApplicationConfig.PLATFORM=3;else if(cc.sys.os===cc.sys.OS_WINDOWS)ApplicationConfig.PLATFORM=3;else ApplicationConfig.PLATFORM=4;else ApplicationConfig.PLATFORM=4})();cc.Global.NodeIsVisible=function(node){while(node){if(!node.visible)return false;node=node.getParent()}return true};
cc.Global.getSaveUsername=function(){return cc.Global.GetSetting("username","")};cc.Global.setSaveUsername=function(userName){cc.Global.SetSetting("username",userName)};cc.Global.getSavePassword=function(){return cc.Global.GetSetting("password","")};cc.Global.setSavePassword=function(passwords){cc.Global.SetSetting("password",passwords)};cc.Global.IsNumber=function(str){var re=new RegExp("^[0-9]+$");return re.test(str)};
if(cc.sys.isNative)ccui.Slider.prototype._ctor=function(barTextureName,normalBallTextureName,resType){this.init();if(barTextureName)this.loadBarTexture(barTextureName,resType);if(normalBallTextureName)this.loadSlidBallTextureNormal(normalBallTextureName,resType)};cc.Global.openURL=function(url){if(cc.sys.isNative)cc.Application.getInstance().openURL(url);else{var win=window.open(url,"_blank");win.focus()}};var quyetnd=quyetnd||{};
quyetnd.ActionShake2D=cc.CustomAction.extend({ctor:function(duration,strength){this._super();this.initWithDuration(duration);this._strength=cc.p(strength);this._originPosition=null;this._target=null},onStop:function(){if(this._target&&this._originPosition)this._target.setPosition(this._originPosition)},onUpdate:function(dt){if(!this._target)return;if(!this._originPosition)this._originPosition=this._target.getPosition();this._target.x=this._originPosition.x+this._strength.x-Math.random()*this._strength.x*
2;this._target.y=this._originPosition.y+this._strength.y-Math.random()*this._strength.y*2},onStartWithTarget:function(target){this._target=target;this._originPosition=target.getPosition()}});
quyetnd.ActionNumber=cc.CustomAction.extend({ctor:function(duration,targetNumber){this._super();this._startNumber=0;this._targetNumber=targetNumber;this.initWithDuration(duration)},onUpdate:function(dt){var number=Math.floor((this._targetNumber-this._startNumber)*dt+this._startNumber);if(this._currentNumber==number)return;this._currentNumber=number;this._target.setString(cc.Global.NumberFormat1(number))},onStartWithTarget:function(target){this._target=target;var str=this._target.getString().replace(/[.]/g,
"");this._startNumber=parseInt(str);this._currentNumber=this._startNumber}});
quyetnd.ActionNumber2=cc.CustomAction.extend({ctor:function(duration,targetNumber){this._super();this._startNumber=0;this._targetNumber=targetNumber;this.initWithDuration(duration)},onUpdate:function(dt){var number=Math.floor((this._targetNumber-this._startNumber)*dt+this._startNumber);if(this._currentNumber==number)return;this._currentNumber=number;this._target.setString(cc.Global.NumberFormat2(number))},onStartWithTarget:function(target){this._target=target;var str=this._target.getString().replace(/[.,]/g,
"");this._startNumber=parseInt(str);this._currentNumber=this._startNumber}});quyetnd.ActionTimeRemaining=cc.CustomAction.extend({ctor:function(duration){this._super();this._fromNumber=duration;this._currentNumber=this._fromNumber;this.initWithDuration(duration)},onUpdate:function(dt){var number=Math.ceil((1-dt)*this._fromNumber);if(number==this._currentNumber)return;this._currentNumber=number;this._target.setString(number.toString())},onStartWithTarget:function(target){this._target=target;this._target.setString(this._fromNumber.toString())}});
quyetnd.ActionTimer=cc.CustomAction.extend({ctor:function(duration,callback){this._super();this.callback=callback;this.initWithDuration(duration)},onUpdate:function(dt){if(this.callback)this.callback(dt)}});var ToggleNodeItem=ccui.Widget.extend({ctor:function(size){this._super();this.setContentSize(size);this.setTouchEnabled(true);this.onSelect=null;this.onUnSelect=null},select:function(isForce,ext){if(this.onSelect)this.onSelect(isForce,ext);this.setTouchEnabled(false)},unSelect:function(isForce,ext){if(this.onUnSelect)this.onUnSelect(isForce,ext);this.setTouchEnabled(true)}});
var ToggleNodeGroup=ccui.Widget.extend({ctor:function(){this._super();this.mItem=[];this.itemClicked=null},addItem:function(item){this.mItem.push(item);this.addChild(item);var thiz=this;item.addClickEventListener(function(item){thiz.onClickedItem(item)})},onClickedItem:function(item){if(this.itemClicked){this.itemClicked.unSelect(false);this.itemClicked=null}this.itemClicked=item;this.itemClicked.select(false)},selectItem:function(index,ext){var item=this.mItem[index];if(this.itemClicked){this.itemClicked.unSelect(true,
ext);this.itemClicked=null}this.itemClicked=item;this.itemClicked.select(true,ext)},onEnter:function(){this._super();this.itemClicked=null;for(var i=0;i<this.mItem.length;i++)this.mItem[i].unSelect(true)}});var newui=newui||{};
newui.ButtonToggle=ccui.Widget.extend({ctor:function(imgOn,imgOff){this._super();var spriteOn=new cc.Sprite(imgOn);var spriteOff=new cc.Sprite(imgOff);this.addChild(spriteOn);this.addChild(spriteOff);this.setContentSize(spriteOn.getContentSize());this.setTouchEnabled(true);spriteOn.setPosition(this.getContentSize().width/2,this.getContentSize().height/2);spriteOff.setPosition(spriteOn.getPosition());this.spriteOn=spriteOn;this.spriteOff=spriteOff;var thiz=this;this.addClickEventListener(function(){if(thiz.selected)thiz.select(false);else thiz.select(true)});
this.select(false)},select:function(selected){this.selected=selected;if(selected){this.spriteOn.visible=true;this.spriteOff.visible=false;if(this.onSelect)this.onSelect(this,true)}else{this.spriteOn.visible=false;this.spriteOff.visible=true;if(this.onSelect)this.onSelect(this,false)}}});var WebSprite=cc.Node.extend({ctor:function(size){this._super();this.setAnchorPoint(cc.p(.5,.5));this._fixSize=false;if(size)this._setFixSize(size)},_setFixSize:function(size){this._fixSize=true;this.setContentSize(size)},_setImageSprite:function(sprite){if(this.imgSprite){this.imgSprite.removeFromParent(true);this.imgSprite=null}if(this._fixSize){var ratioX=this.getContentSize().width/sprite.getContentSize().width;var ratioY=this.getContentSize().height/sprite.getContentSize().height;var ratio=ratioX<
ratioY?ratioX:ratioY;if(ratio<1)sprite.setScale(ratio)}else this.setContentSize(sprite.getContentSize());sprite.setPosition(this.getContentSize().width/2,this.getContentSize().height/2);this.addChild(sprite);this.imgSprite=sprite},loadDefault:function(sprite){if(sprite){var imgSprite=new cc.Sprite(sprite);this._setImageSprite(imgSprite)}},reloadFromURL:function(url){var thiz=this;var textureInCache=cc.textureCache.getTextureForKey(url);if(textureInCache){var imgSprite=new cc.Sprite(textureInCache);
thiz._setImageSprite(imgSprite);return}if(cc.sys.isNative)quyetnd.ResourcesDownloader.loadTexture(url,function(texture){cc.log("loadTexture: 1111");var imgSprite=new cc.Sprite(texture);thiz._setImageSprite(imgSprite)});else cc.loader.loadImg(url,function(err,texture){if(texture){cc.textureCache.cacheImage(url,texture);var imgSprite=new cc.Sprite(texture);thiz._setImageSprite(imgSprite)}})}});var WidgetButton=ccui.Widget.extend({ctor:function(contentSize){this._super();if(contentSize)this.setContentSize(contentSize);this.setTouchEnabled(true)}});if(cc.sys.isNative)var s_lobbyServer=s_lobbyServer||[{host:"42.112.25.164",port:9999}];else var s_lobbyServer=s_lobbyServer||["ws://42.112.25.164:8887/websocket"];
var LobbyClient=function(){var instance=null;var Clazz=cc.Class.extend({lobbySocket:null,ctor:function(){if(instance)throw"Cannot create new instance for Singleton Class";else{var thiz=this;this.allListener={};this.serverIndex=0;this.isKicked=false;this.loginHandler=null;this.isReconnected=false;this.isLogined=false;this.lobbySocket=new socket.LobbyClient(socket.LobbyClient.TCP);this.lobbySocket.onEvent=function(messageName,data){thiz.onEvent(messageName,data)};cc.director.getScheduler().scheduleUpdateForTarget(this,
0,false);this.addListener("LobbyStatus",this._onLobbyStatusHandler,this);this.addListener("error",this._onErrorHandler,this);this.addListener("popupMessage",this._onPopupMessage,this);this.addListener("kicked",this._onKickedHandler,this);this.addListener("login",this._onLoginHandler,this);this.addListener("register",this._onRegisterHandler,this);this.addListener("getGameServer",this._onGetGameServerHandler,this);this.addListener("verifyCode",this._onVerifyCodeHandler,this);this.addListener("verifyCodeBySms",
this._onVerifyCodeBySmsHandler,this);this.addListener("changeAsset",this._onChangeAssetHandler,this);this.addListener("inventory",this._onInventoryHandler,this);this.addListener("updateItem",this._onUpdateItemHandler,this);this.addListener("inboxMessage",this._onInboxMessageHandler,this);this.addListener("news",this._onNewsHandler,this);this.addListener("markReadedMessageInbox",this._onMarkReadedMessageInboxHandler,this);this.addListener("fetchProducts",this._onFetchProductsHandler,this);this.addListener("fetchCashinProductItems",
this._onFetchCashinProductItemsHandler,this);this.addListener("transferGold",this._onTransferGold,this);this.addListener("fetchTransferConfig",this._onFetchTransferConfig,this);this.addListener("updateLandmarkCompleted",this._onUpdateLandmarkCompleted,this);FacebookPlugin.getInstance().onLoginFinished=function(returnCode,userId,accessToken){if(returnCode==0){LoadingDialog.getInstance().show("\u0110ang \u0111\u0103ng nh\u1eadp");thiz.loginFacebook(accessToken)}else{LoadingDialog.getInstance().hide();
if(returnCode>0)MessageNode.getInstance().show("L\u1ed7i \u0111\u0103ng nh\u1eadp facebook")}};if(cc.sys.isNative){SystemPlugin.getInstance().onBuyItemFinishAndroid=function(returnCode,signature,json){thiz.onBuyItemFinishAndroid(returnCode,signature,json)};SystemPlugin.getInstance().onBuyItemFinishIOS=function(returnCode,data){thiz.onBuyItemFinishIOS(returnCode,data)}}}},onBuyItemFinishAndroid:function(returnCode,signature,json){LoadingDialog.getInstance().hide();if(returnCode===0){var request={command:"cashin",
data:json,signature:signature,os:2,type:3};this.send(request)}},onBuyItemFinishIOS:function(returnCode,data){LoadingDialog.getInstance().hide();if(returnCode===0){var request={command:"cashin",data:data,os:1,type:3};this.send(request)}},update:function(dt){if(this.isReconnected)if(this.reconnectTimeout>0)this.reconnectTimeout-=dt;else this.isReconnected=false},send:function(message){if(this.lobbySocket){cc.log(message);this.lobbySocket.send(JSON.stringify(message))}},close:function(){this.isReconnected=
false;if(this.lobbySocket)this.lobbySocket.close()},connect:function(){if(this.lobbySocket){this.isLogined=false;PlayerMe.avatar="";if(this.serverIndex>=s_lobbyServer.length)this.serverIndex=0;this.isKicked=false;if(cc.sys.isNative)this.lobbySocket.connect(s_lobbyServer[this.serverIndex].host,s_lobbyServer[this.serverIndex].port);else this.lobbySocket.connect(s_lobbyServer[this.serverIndex]);this.serverIndex++}},onEvent:function(messageName,data){if(messageName=="socketStatus")this.postEvent("LobbyStatus",
data);else if(messageName=="message"){var messageData=JSON.parse(data);this.postEvent(messageData.command,messageData)}},_onLobbyStatusHandler:function(cmd,event){this.isLogined=false;if(event==="Connected"){this.isReconnected=false;if(this.loginHandler)this.loginHandler()}else if(event==="ConnectFailure")if(this.isReconnected)this.connect();else{LoadingDialog.getInstance().hide();SceneNavigator.toHome("M\u1ea5t k\u1ebft n\u1ed1i m\u00e1y ch\u1ee7")}else if(event==="LostConnection")if(!this.isKicked)this.reconnect()},
_onErrorHandler:function(cmd,event){var errMsg=event["errorMessage"];if(errMsg&&errMsg!=""){LoadingDialog.getInstance().hide();MessageNode.getInstance().show(errMsg)}else LobbyClient.ErrorHandle(event.errorCode)},_onPopupMessage:function(cmd,event){var data=event.data;var title=data.title;if(!title||title=="")title="Th\u00f4ng b\u00e1o";var msg=data["message"];var dialog=new MessageDialog;dialog.setTitle(title);dialog.setMessage(msg);dialog.showWithAnimationScale()},_onKickedHandler:function(cmd,
event){this.isKicked=true;var runningScene=cc.director.getRunningScene();LoadingDialog.getInstance().hide();var message="B\u1ea1n b\u1ecb s\u00fat kh\u1ecfi m\u00e1y ch\u1ee7";if(event.code==1)message="T\u00e0i kho\u1ea3n \u0111\u0103ng nh\u1eadp t\u1ea1i thi\u1ebft b\u1ecb kh\u00e1c";else if(event.code==2)message="B\u1ea1n b\u1ecb kicked b\u1edfi admin";else if(event.code==5)message="T\u00e0i kho\u1ea3n \u0111\u00e3 b\u1ecb kh\u00f3a";SceneNavigator.toHome(message)},_onLoginHandler:function(cmd,
event){if(event.status==0){this.isLogined=true;if(this.lastRequestLogin)cc.Global.SetSetting("lastLoginType",this.lastRequestLogin);this.requestGetTransferGoldConfig();PlayerMe.messageCount=0;var data=event.data;PlayerMe.gold=data.userAssets.gold;PlayerMe.exp=data.userAssets.exp;PlayerMe.vipExp=data.userAssets.vipExp;PlayerMe.spin=data.userAssets.spin;PlayerMe.phoneNumber=data.telephone;PlayerMe.SFS.info=data.info;PlayerMe.SFS.signature=event.signature;var userinfo=JSON.parse(data.info);PlayerMe.username=
userinfo.username;PlayerMe.gameType="";PlayerMe.SFS.betting=0;var serverData=data["server"];if(serverData){this.SFSServerInfo={};for(var i=0;i<serverData.length;i++){var serverInfo=this.createServerInfo(serverData[i]);serverInfo.serverId=serverData[i].serverId;this.SFSServerInfo[serverInfo.serverId]=serverInfo}}var miniGameServer=data["miniGameInfo"];PlayerMe.miniGameInfo=this.createServerInfo(miniGameServer);var lastSessionInfo=data.lastSessionInfo;if(lastSessionInfo.ip&&lastSessionInfo.port)this.reconnectSmartfox(this.createServerInfo(lastSessionInfo));
else{LoadingDialog.getInstance().hide();SceneNavigator.toLobby()}if(this.loginSuccessHandler){this.loginSuccessHandler();this.loginSuccessHandler=null}this.sendRegisterPush()}else{var message=event["statusMessage"];if(!message){var errorHandler=LobbyClient.Error[event.status];if(errorHandler)message=errorHandler.message}if(message)SceneNavigator.toHome(message);else SceneNavigator.toHome()}},_onRegisterHandler:function(cmd,event){if(this.loginSuccessHandler){this.loginSuccessHandler();this.loginSuccessHandler=
null}},_onGetGameServerHandler:function(cmd,event){var data=event.data;if(this.betting==data.betting){PlayerMe.SFS.betting=data.betting;PlayerMe.gameType=data.gameType;if(cc.sys.isNative)var _port=data.port;else var _port=data.webSocketPort;SmartfoxClient.getInstance().findAndJoinRoom(data.host,_port,data.betting,data.gameType)}},_onVerifyCodeHandler:function(cmd,event){PlayerMe.verify=true;PlayerMe.phoneNumber=event.data.telephone},_onVerifyCodeBySmsHandler:function(cmd,event){PlayerMe.verify=true;
PlayerMe.phoneNumber=event.data.telephone},_onChangeAssetHandler:function(cmd,event){PlayerMe.gold=event["data"]["userAssets"]["gold"]},_onInventoryHandler:function(cmd,event){var items=event["data"];for(var i=0;i<items.length;i++)if(items[i].id==1)PlayerMe.avatar=items[i]["avtUrl"]},_onUpdateItemHandler:function(cmd,event){var data=event["data"];if(data&&data["avtUrl"])PlayerMe.avatar=data["avtUrl"]},_onInboxMessageHandler:function(cmd,event){PlayerMe.messageCount=event["data"]["numberMessUnread"]},
_onUpdateLandmarkCompleted:function(cmd,event){PlayerMe.missionCount=event["data"]["count"]},_onNewsHandler:function(cmd,event){var broadcast=event["data"]["broadcast"];if(broadcast)GameConfig.broadcastMessage=broadcast},_onMarkReadedMessageInboxHandler:function(cmd,event){var msgCount=event["data"]["numberMessUnread"];PlayerMe.messageCount=msgCount},_onFetchCashinProductItemsHandler:function(cmd,event){var data=event["data"]["2"];cc.Global.SMSList=[];for(var i=0;i<data.length;i++){var currency=data[i]["currency"];
var smsGateway=data[i]["detail"]["smsGateway"];var vmsContent=data[i]["detail"]["vmsContent"];var vnpContent=data[i]["detail"]["vnpContent"];var vttContent=data[i]["detail"]["vttContent"];var gold=data[i]["gold"];var id=data[i]["id"];var price=data[i]["price"];cc.Global.SMSList.push({currency:currency,smsGateway:smsGateway,vmsContent:vmsContent,vnpContent:vnpContent,vttContent:vttContent,gold:gold,id:id,price:parseInt(price)})}cc.Global.inAppBillingData=event["data"]["3"];if(cc.sys.isNative&&cc.sys.os===
cc.sys.OS_IOS){var itemList=[];for(var i=0;i<cc.Global.inAppBillingData.length;i++)itemList.push(cc.Global.inAppBillingData[i]["id"]);SystemPlugin.getInstance().iOSInitStore(itemList)}},_onFetchProductsHandler:function(cmd,event){cc.Global.thecaoData=event["data"]["1"];cc.Global.tienmatData=event["data"]["2"];cc.Global.dailyData=event["data"]["3"];cc.Global.vatphamData=event["data"]["4"]},_onTransferGold:function(cmd,event){var msg=event["message"];var status=event["status"];if(status===0){var dialog=
new MessageDialog;dialog.setMessage(msg);dialog.showWithAnimationScale()}else{if(!msg)msg="Chuy\u1ec3n v\u00e0ng kh\u00f4ng th\u00e0nh c\u00f4ng";MessageNode.getInstance().show(msg)}},_onFetchTransferConfig:function(cmd,event){var data=event["data"];PlayerMe.transferGoldFee=data["fee"];PlayerMe.transferGoldMinAsset=data["minAsset"];PlayerMe.transferGoldMinValue=data["minValue"];PlayerMe.transferGoldMerchantFee=data["merchantFee"]},prePostEvent:function(command,event){},onLoginEvent:function(event){},
postEvent:function(command,event){var arr=this.allListener[command];if(arr){this.isBlocked=true;for(var i=0;i<arr.length;){var target=arr[i];if(target)target.listener.apply(target.target,[command,event]);else{arr.splice(i,1);continue}i++}this.isBlocked=false}},addListener:function(command,_listener,_target){var arr=this.allListener[command];if(!arr){arr=[];this.allListener[command]=arr}for(var i=0;i<arr.length;i++)if(arr[i]&&arr[i].target===_target)return;arr.push({listener:_listener,target:_target})},
removeListener:function(target){for(var key in this.allListener){if(!this.allListener.hasOwnProperty(key))continue;var arr=this.allListener[key];for(var i=0;i<arr.length;){if(arr[i]&&arr[i].target==target)if(this.isBlocked)arr[i]=null;else{arr.splice(i,1);continue}i++}}},checkIMEI:function(){if(!PlayerMe.IMEI){PlayerMe.IMEI=SystemPlugin.getInstance().getDeviceUUIDWithKey(PlayerMe.DeviceIDKey);if(!PlayerMe.IMEI){MessageNode.getInstance().show("B\u1ea1n ph\u1ea3i \u0111\u0103ng nh\u1eadp t\u00e0i kho\u1ea3n Google");
LoadingDialog.getInstance().hide();return false}}return true},login:function(username,password,redirectFromSignup){var thiz=this;this._username=username;this._password=password;this.loginHandler=function(){var loginRequest={type:"normal",username:thiz._username,password:thiz._password};thiz.sendLoginRequest(loginRequest)};if(redirectFromSignup){LoadingDialog.getInstance().setMessage("\u0110ang \u0111\u0103ng nh\u1eadp");this.loginHandler()}else this.connect()},loginNormal:function(username,password,
isSave){this.lastRequestLogin="normalLogin";if(!this.checkIMEI())return;var thiz=this;this.loginSuccessHandler=function(){if(isSave){cc.Global.setSaveUsername(username);cc.Global.setSavePassword(password)}else{cc.Global.setSaveUsername("");cc.Global.setSavePassword("")}};this.login(username,password)},quickLogin:function(){this.lastRequestLogin="quickLogin";if(!this.checkIMEI())return;this.loginSuccessHandler=null},loginFacebook:function(accessToken){this.lastRequestLogin="facebookLogin";if(!this.checkIMEI())return;
this.loginSuccessHandler=null;var thiz=this;this.loginHandler=function(){var loginRequest={type:"facebook",accessToken:accessToken};thiz.sendLoginRequest(loginRequest)};this.connect()},tokenLogin:function(token){this.lastRequestLogin="tokenLogin";if(!this.checkIMEI())return;this.loginSuccessHandler=null;var thiz=this;this.loginHandler=function(){var loginRequest={command:"login",type:"token",accessToken:token};thiz.sendLoginRequest(loginRequest)};this.connect()},sendLoginRequest:function(loginRequest){loginRequest.command=
"login";loginRequest.platformId=ApplicationConfig.PLATFORM;loginRequest.bundleId=SystemPlugin.getInstance().getPackageName();loginRequest.version=SystemPlugin.getInstance().getVersionName();loginRequest.imei=PlayerMe.IMEI;loginRequest.displayType=ApplicationConfig.DISPLAY_TYPE;cc.log(loginRequest);this.send(loginRequest)},signup:function(username,password,telephone,gender){if(!this.checkIMEI())return;this.loginSuccessHandler=null;var thiz=this;var _username=username;var _password=password;var _telephone=
telephone;var _gender=gender;this.loginHandler=function(){thiz.loginSuccessHandler=function(){thiz.login(username,password,true);if(cc.Global.GetSetting("savePassword",true)){cc.Global.setSavePassword(_password);cc.Global.setSaveUsername(_username)}};var signupRequest={command:"register",platformId:ApplicationConfig.PLATFORM,bundleId:SystemPlugin.getInstance().getPackageName(),version:SystemPlugin.getInstance().getVersionName(),imei:PlayerMe.IMEI,username:_username,password:_password};if(_telephone&&
_telephone!="")signupRequest.telephone=_telephone;signupRequest.gender=_gender?"male":"female";thiz.send(signupRequest)};this.connect()},requestGetTransferGoldConfig:function(){var request={command:"fetchTransferConfig"};this.send(request)},sendRegisterPush:function(){var token=SystemPlugin.getInstance().getPushNotificationToken();if(token&&token!=""){var request={sandbox:true,command:"registerPush",token:token};this.send(request)}},reconnect:function(){var runningScene=cc.director.getRunningScene();
if(runningScene.type=="HomeScene")if(runningScene.homeLocation==1){if(LoadingDialog.getInstance().isShow()){LoadingDialog.getInstance().hide();SceneNavigator.toHome("M\u1ea5t k\u1ebft n\u1ed1i m\u00e1y ch\u1ee7")}return}else LoadingDialog.getInstance().show("\u0110ang k\u1ebft n\u1ed1i l\u1ea1i m\u00e1y ch\u1ee7");else;this.reconnectTimeout=30;this.isReconnected=true;this.connect()},reconnectSmartfox:function(serverInfo){if(SmartfoxClient.getInstance().isConnected())LoadingDialog.getInstance().hide();
else{LoadingDialog.getInstance().show("\u0110ang k\u1ebft n\u1ed1i l\u1ea1i m\u00e1y ch\u1ee7");SmartfoxClient.getInstance().connect(serverInfo)}},subscribe:function(gameId,group){PlayerMe.gameType=s_games_chanel[gameId];var request={command:"subscribeChannel",gameType:PlayerMe.gameType};if(PlayerMe.gameType=="ShakeDisk"||PlayerMe.gameType=="TaiXiu");else{if(group)PlayerMe.lastGroupSelected=group;if(PlayerMe.lastGroupSelected)request.group=PlayerMe.lastGroupSelected}this.send(request)},unSubscribe:function(){var request=
{command:"unsubscribeChannel",gameType:PlayerMe.gameType};this.send(request)},requestGetServer:function(betting){this.betting=betting;var request={command:"getGameServer",gameType:PlayerMe.gameType,betting:betting};this.send(request)},requestGetLastSessionInfo:function(){var request={command:"getLastSessionInfo"};this.send(request)},createServerInfo:function(serverData){var serverInfo={};var host=serverData["host"];if(!host)host=serverData["ip"];if(cc.sys.isNative){var port=serverData.port;serverInfo.host=
host;serverInfo.port=port;serverInfo.serverUrl=host+":"+port}else{var url=serverData["wssPath"];if(!url){var port=serverData["websocketPort"];if(!port)port=serverData["webSocketPort"];if(!port)port=serverData.port;url="ws://"+host+":"+port+"/websocket"}serverInfo.webSocketUrl=url;serverInfo.serverUrl=url}return serverInfo}});Clazz.getInstance=function(){if(!instance)instance=new Clazz;return instance};return Clazz}();LobbyClient.Error={1:{message:"L\u1ed7i kh\u00f4ng x\u00e1c \u0111\u1ecbnh",logout:false},6:{message:"T\u00e0i kho\u1ea3n kh\u00f4ng t\u1ed3n t\u1ea1i",logout:true},7:{message:"Sai m\u1eadt kh\u1ea9u",logout:false},9:{message:"Kh\u00f4ng \u0111\u1ee7 ti\u1ec1n",logout:false},10:{message:"T\u00e0i kho\u1ea3n \u0111\u00e3 t\u1ed3n t\u1ea1i",logout:true},11:{message:"B\u1ea1n ph\u1ea3i c\u1eadp nh\u1eadt phi\u00ean b\u1ea3n",logout:true},12:{message:"\u0110\u0103ng nh\u1eadp ph\u00f2ng ch\u01a1i th\u1ea5t b\u1ea1i",
logout:false},13:{message:"\u0110\u0103ng nh\u1eadp facebook h\u1ebft h\u1ea1n",logout:true},14:{message:"S\u1ed1 \u0111i\u1ec7n tho\u1ea1i kh\u00f4ng h\u1ee3p l\u1ec7",logout:false},15:{message:"B\u1ea1n kh\u00f4ng th\u1ec3 g\u1eedi y\u00eau c\u1ea7u trong 5 ph\u00fat",logout:false},19:{message:"T\u00e0i kho\u1ea3n ch\u01b0a \u0111\u01b0\u1ee3c x\u00e1c th\u1ef1c",logout:false},20:{message:"Sai s\u1ed1 \u0111i\u1ec7n tho\u1ea1i",logout:false},21:{message:"Nh\u1eadp code sai qu\u00e1 5 l\u1ea7n",
logout:false},25:{message:"S\u1ed1 \u0111i\u1ec7n tho\u1ea1i \u0111\u00e3 \u0111\u01b0\u1ee3c s\u1eed d\u1ee5ng",logout:false},27:{message:"B\u1ea1n kh\u00f4ng \u0111\u1ee7 ti\u1ec1n",logout:false},28:{message:"B\u1ea1n nh\u1eadp sai m\u1eadt kh\u1ea9u",logout:true},29:{message:"T\u00e0i kho\u1ea3n kh\u00f4ng \u0111\u01b0\u1ee3c ch\u1ee9a k\u00fd t\u1ef1 \u0111\u1eb7c bi\u1ec7t",logout:true},30:{message:"T\u00e0i kho\u1ea3n ph\u1ea3i d\u00e0i t\u1eeb 6-32 k\u00ed t\u1ef1",logout:true},31:{message:"B\u1ea1n \u0111\u0103ng k\u00fd qu\u00e1 nhi\u1ec1u t\u00e0i kho\u1ea3n",
logout:true},32:{message:"M\u1eadt kh\u1ea9u kh\u00f4ng h\u1ee3p l\u1ec7",logout:true},36:{message:"T\u00ean t\u00e0i kho\u1ea3n v\u00e0 m\u1eadt kh\u1ea9u tr\u00f9ng nhau",logout:true}};LobbyClient.ErrorHandle=function(errorCode){LoadingDialog.getInstance().hide();var errorHandler=LobbyClient.Error[errorCode];if(!errorHandler)errorHandler={message:"C\u00f3 l\u1ed7i x\u1ea3y ra ["+errorCode+"]",logout:true};if(errorHandler.logout)SceneNavigator.toHome(errorHandler.message);else MessageNode.getInstance().show(errorHandler.message)};var SmartfoxUtils=SmartfoxUtils||{};
SmartfoxUtils.getRoomInfo=function(sfsArray){var roomInfo={};roomInfo.roomId=sfsArray[0];roomInfo.roomName=sfsArray[1];roomInfo.groupId=sfsArray[2];roomInfo.isGame=sfsArray[3];roomInfo.isHidden=sfsArray[4];roomInfo.isPasswordProtected=sfsArray[5];roomInfo.userCount=sfsArray[6];roomInfo.maxUsers=sfsArray[7];roomInfo.isMMORoom=sfsArray.length==14;var variableData=sfsArray[8];roomInfo.roomVariable={};for(var i=0;i<variableData.length;i++){var item=SmartfoxUtils.getRoomVariable(variableData[i]);roomInfo.roomVariable[item.name]=
item}if(roomInfo.isGame){roomInfo.spectatorCount=sfsArray[9];roomInfo.maxSpectators=sfsArray[10]}return roomInfo};SmartfoxUtils.getUserInfo=function(sfsArray){var userInfo={};userInfo.userId=sfsArray[0];userInfo.username=sfsArray[1];userInfo.privilegeId=sfsArray[2];userInfo.playerId=sfsArray[3];userInfo.userVariable={};var data=sfsArray[4];for(var i=0;i<data.length;i++){var item=SmartfoxUtils.getUserVariable(data[i]);userInfo.userVariable[item.name]=item}return userInfo};
SmartfoxUtils.getUserVariable=function(data){var userVariable={};userVariable.name=data[0];userVariable.value=data[1];return userVariable};SmartfoxUtils.getRoomVariable=function(data){var roomVariable=SmartfoxUtils.getUserVariable(data);roomVariable.isPrivate=data[3];roomVariable.isPersistent=data[4];return roomVariable};var SmartfoxClient=function(){var instance=null;var Clazz=cc.Class.extend({sfsSocket:null,ctor:function(){if(instance)throw"Cannot create new instance for Singleton Class";else{this.allListener={};this.sfsSocket=new socket.SmartfoxClient;var thiz=this;this.sfsSocket.onEvent=function(eventName){thiz.onEvent(eventName)};this.sfsSocket.onMessage=function(messageType,data){thiz.onMessage(messageType,data)};this.addListener(socket.SmartfoxClient.Handshake,this._onHankShakeHandler,this);this.addListener(socket.SmartfoxClient.Login,
this._onLoginHandler,this);this.addListener(socket.SmartfoxClient.JoinRoom,this._onJoinRoomHandler,this);this.addListener(socket.SmartfoxClient.UserExitRoom,this._onUserExitRoomHandler,this);this.addExtensionListener("1",this._onStartGameHandler,this);this.addExtensionListener("13",this._onReconnectHandler,this);this.addExtensionListener("262",this._onReconnectMiniGameHandler,this);this.addExtensionListener("fullRoom",this._onFullRoomHandler,this)}},isConnected:function(){if(this.sfsSocket)return this.sfsSocket.getStatus()==
socket.SmartfoxClient.Connected;return false},sendHandShake:function(){var content={cl:"Mobile",api:"1.6.3",bin:true};if(!cc.sys.isNative)content.cl="web";this.send(socket.SmartfoxClient.Handshake,content)},sendLogin:function(){var content={zn:"GBVCity",un:"",pw:"",p:{info:PlayerMe.SFS.info,signature:PlayerMe.SFS.signature}};this.send(socket.SmartfoxClient.Login,content)},_sendFindAndJoinRoom:function(gameType,betting,roomId){var params={};if(gameType)params.gameType=gameType;if(betting)params.betting=
betting;if(roomId)params.roomId=roomId;this.sendExtensionRequest(-1,"findAndJoinGame",params)},sendLogout:function(){this.send(socket.SmartfoxClient.Logout,null)},sendJoinRoom:function(room){var content={};if(room.isString()){if(room!="")content.n=room}else if(room.isNumber())if(room>-1)content.i=room;content.p="";content.rl=0;content.sp=false;this.send(socket.SmartfoxClient.JoinRoom,content)},sendLeaveRoom:function(roomId){var content={r:roomId};this.send(socket.SmartfoxClient.LeaveRoom,content)},
sendExtensionRequest:function(roomId,command,params){if(params==null)params={};var content={r:roomId,c:command,p:params};this.send(socket.SmartfoxClient.CallExtension,content)},sendExtensionRequestCurrentRoom:function(command,params){this.sendExtensionRequest(PlayerMe.SFS.roomId,command,params)},send:function(messageType,message){if(this.sfsSocket)if(message)this.sfsSocket.send(messageType,JSON.stringify(message));else this.sfsSocket.send(messageType,"")},close:function(){if(this.sfsSocket)this.sfsSocket.close()},
findAndJoinRoom:function(serverInfo,gameType,betting,roomId){var thiz=this;this.connect(serverInfo,function(){thiz._sendFindAndJoinRoom(gameType,betting,roomId)})},joinMiniGame:function(serverInfo,joinCommand){var thiz=this;this.connect(serverInfo,function(){thiz.sendExtensionRequest(-1,joinCommand,null)})},connect:function(serverInfo,afterLoginCallback){this.lastRoomInfo=null;this._loginHandler=afterLoginCallback;if(this.sfsSocket){if(this.sfsSocket.getStatus()==socket.SmartfoxClient.Connected)if(this.currentServer==
serverInfo.serverUrl){if(this._loginHandler){this._loginHandler();this._loginHandler=null}return}else this.sfsSocket.close();this.currentServer=serverInfo.serverUrl;if(cc.sys.isNative)this.sfsSocket.connect(serverInfo.host,serverInfo.port);else this.sfsSocket.connect(serverInfo.webSocketUrl)}},onEvent:function(eventName){if(eventName=="Connected")this.sendHandShake();else if(eventName=="ConnectFailure"){LoadingDialog.getInstance().hide();MessageNode.getInstance().show("L\u1ed7i k\u1ebft n\u1ed1i m\u00e1y ch\u1ee7")}else if(eventName==
"LostConnection"){var runningScene=cc.director.getRunningScene();if(runningScene.type!="GameScene"){LoadingDialog.getInstance().hide();MessageNode.getInstance().show("M\u1ea5t k\u1ebft n\u1ed1i m\u00e1y ch\u1ee7")}}this.postEvent(socket.SmartfoxClient.SocketStatus,eventName)},onMessage:function(messageType,data){var content=JSON.parse(data);if(messageType===socket.SmartfoxClient.CallExtension){var cmd="ext_"+content.c;this.postEvent(cmd,content)}this.postEvent(messageType,content)},addListener:function(messageType,
_listener,_target){var arr=this.allListener[messageType];if(!arr){arr=[];this.allListener[messageType]=arr}for(var i=0;i<arr.length;i++)if(arr[i]&&arr[i].target===_target)return;arr.push({listener:_listener,target:_target})},addExtensionListener:function(command,_listener,_target){var msgType="ext_"+command;this.addListener(msgType,_listener,_target)},removeListener:function(target){for(var key in this.allListener){if(!this.allListener.hasOwnProperty(key))continue;var arr=this.allListener[key];for(var i=
0;i<arr.length;){if(arr[i]&&arr[i].target==target)if(this.isBlocked)arr[i]=null;else{arr.splice(i,1);continue}i++}}},postEvent:function(messageType,params){cc.log("messageType : "+messageType);cc.log(params);var arr=this.allListener[messageType];if(arr){this.isBlocked=true;for(var i=0;i<arr.length;){var target=arr[i];if(target)target.listener.apply(target.target,[messageType,params]);else{arr.splice(i,1);continue}i++}this.isBlocked=false}},_createGameSceneWithGameType:function(gameType,betAmount){var retVal=
null;var game=null;if(gameType==s_games_chanel[game=GameType.GAME_TienLenMN])retVal=new TienLen;else if(gameType==s_games_chanel[game=GameType.GAME_Sam])retVal=new Sam;else if(gameType==s_games_chanel[game=GameType.GAME_Phom])retVal=new Phom;else if(gameType==s_games_chanel[game=GameType.GAME_TLMN_Solo])retVal=new TLMNSolo;else if(gameType==s_games_chanel[game=GameType.GAME_Sam_Solo])retVal=new SamSolo;else if(gameType==s_games_chanel[game=GameType.GAME_XocDia])retVal=new XocDiaScene;else if(gameType==
s_games_chanel[game=GameType.GAME_TaiXiu])retVal=new TaiXiuScene;else if(gameType==s_games_chanel[game=GameType.GAME_BaCay])retVal=new BaCay;else if(gameType==s_games_chanel[game=GameType.GAME_MauBinh])retVal=new MauBinh;else if(gameType==s_games_chanel[game=GameType.GAME_Poker])retVal=new Poker;if(retVal){cc.log(game);retVal.showGameInfo(s_games_display_name[game],betAmount)}return retVal},_onHankShakeHandler:function(messageType,contents){if(contents.tk&&contents.tk.length>0)this.sendLogin()},_onLoginHandler:function(messageType,
contents){if(contents.ec){LoadingDialog.getInstance().hide();var scene=cc.director.getRunningScene();if(scene.type=="GameScene");else MessageNode.getInstance().show("L\u1ed7i \u0111\u0103ng nh\u1eadp m\u00e1y ch\u1ee7")}else{PlayerMe.SFS.userId=contents.id;if(this._loginHandler){this._loginHandler();this._loginHandler=null}}},_onJoinRoomHandler:function(messageType,contents){if(contents.ec);else PlayerMe.SFS.roomId=contents.r[0]},_onUserExitRoomHandler:function(messageType,contents){var userId=contents.u;
if(PlayerMe.SFS.userId==userId)PlayerMe.SFS.roomId=-1},_onStartGameHandler:function(cmd,contents){LoadingDialog.getInstance().hide();var gameInfo=contents.p;var gameName=gameInfo["r"];var gameType=gameInfo["g"];var gameBetAmount=gameInfo["8"];PlayerMe.gameType=gameType;var scene=cc.director.getRunningScene();if(scene.type==="GameScene")return false;else{var gameScene=this._createGameSceneWithGameType(gameType,gameBetAmount);if(gameScene)cc.director.replaceScene(gameScene)}},_onReconnectHandler:function(cmd,
contents){LoadingDialog.getInstance().hide();var gameInfo=contents.p["1"];var gameName=gameInfo["r"];var gameType=gameInfo["g"];var gameBetAmount=gameInfo["8"];PlayerMe.gameType=gameType;var scene=cc.director.getRunningScene();if(scene.type==="GameScene")return false;else{var gameScene=this._createGameSceneWithGameType(gameType,gameBetAmount);if(gameScene)cc.director.replaceScene(gameScene)}},_onReconnectMiniGameHandler:function(cmd,contents){LoadingDialog.getInstance().hide();var scene=cc.director.getRunningScene();
if(scene.type=="GameScene")return false;var gameScene;var group=contents.p["group"];if(group=="mini.caothap"){SceneNavigator.toMiniGame(GameType.MiniGame_CaoThap,true);LoadingDialog.getInstance().hide()}else if(group=="mini.videopoker"){SceneNavigator.toMiniGame(GameType.MiniGame_VideoPoker,true);LoadingDialog.getInstance().hide()}else if(group==="mini.taixiu"){SceneNavigator.toMiniGame(GameType.MiniGame_ChanLe,true);LoadingDialog.getInstance().hide()}if(gameScene){gameScene.isReconnect=true;cc.director.replaceScene(gameScene)}},
_onFullRoomHandler:function(cmd,contents){LoadingDialog.getInstance().hide();MessageNode.getInstance().show("Ph\u00f2ng \u0111\u1ea7y")},prePostEvent:function(messageType,contents){cc.log("messageType : "+messageType);cc.log("contents : ",contents);return false}});Clazz.getInstance=function(){if(!instance)instance=new Clazz;return instance};return Clazz}();var UserAvatar=cc.Node.extend({ctor:function(){this._super();this.setAnchorPoint(cc.p(.5,.5));this._setDefaultAvatar()},_setDefaultAvatar:function(){if(this.avatarImg){this.avatarImg.removeFromParent(true);this.avatarImg=0}this.avatarImg=new cc.Sprite("#avatarDefault.png");this.setContentSize(this.avatarImg.getContentSize());this.avatarImg.setPosition(this.getContentSize().width/2,this.getContentSize().height/2);this.addChild(this.avatarImg)},_setAvatarWithTexture:function(texture){if(this.avatarImg){this.avatarImg.removeFromParent(true);
this.avatarImg=0}this.avatarImg=new cc.Sprite(texture);this.avatarImg.setPosition(this.getContentSize().width/2,this.getContentSize().height/2);this.addChild(this.avatarImg);var scaleX=this.getContentSize().width/this.avatarImg.getContentSize().width;var scaleY=this.getContentSize().height/this.avatarImg.getContentSize().height;var scale=scaleX<scaleY?scaleX:scaleY;if(scale<1)this.avatarImg.setScale(scale)},setAvatar:function(url){if(!url||url=="")return;var thiz=this;var textureInCache=cc.textureCache.getTextureForKey(url);
if(textureInCache)thiz._setAvatarWithTexture(textureInCache);else if(cc.sys.isNative)quyetnd.ResourcesDownloader.loadTexture(url,function(texture){if(texture)thiz._setAvatarWithTexture(texture)});else cc.loader.loadImg(url,function(err,texture){if(texture){cc.textureCache.cacheImage(url,texture);thiz._setAvatarWithTexture(texture)}})},setAvatarMe:function(){this.setAvatar(PlayerMe.avatar)}});
var UserAvatarMe=UserAvatar.extend({ctor:function(){this._super();LobbyClient.getInstance().addListener("inventory",this.onChangeRefeshUserInfo,this);LobbyClient.getInstance().addListener("updateItem",this.onChangeRefeshUserInfo,this);this.setAvatarMe()},onEnter:function(){this._super()},onExit:function(){this._super();LobbyClient.getInstance().removeListener(this)},onChangeRefeshUserInfo:function(){this.setAvatarMe()}});UserAvatar.createMe=function(){var avt=new UserAvatarMe;return avt};
UserAvatar.createAvatar=function(){var avt=new UserAvatar;return avt};UserAvatar.createAvatarWithId=function(avatarId){var avt=new UserAvatar;avt.setAvatar(avatarId);return avt};var SoundPlayer=SoundPlayer||{};var s_sound_loop=s_sound_loop||{};SoundPlayer._createURL=function(sound){var soundUrl="res/Sound/"+sound+".mp3";return soundUrl};
SoundPlayer._playSingleSound=function(sound,loop,cb){if(cc.Global.GetSetting("sound",false)==false){if(cb)cb();return}var soundUrl=SoundPlayer._createURL(sound);if(cc.sys.isNative){var audio=jsb.AudioEngine.play2d(soundUrl,loop);if(cb)jsb.AudioEngine.setFinishCallback(audio,function(){cb()})}else var audio=cc.audioEngine.playEffect(soundUrl,loop,cb);return audio};
SoundPlayer._playMultiSound=function(soundList,index){if(index>=soundList.length)return;var audio=SoundPlayer._playSingleSound(soundList[index],false,function(){SoundPlayer._playMultiSound(soundList,index+1)})};
SoundPlayer.playSound=function(sound,loop){if(cc.isArray(sound)){if(sound.length==1)SoundPlayer._playSingleSound(sound[0],false);SoundPlayer._playMultiSound(sound,0)}else{var soundLoop=loop?true:false;var soundID=SoundPlayer._playSingleSound(sound,soundLoop);if(soundLoop)s_sound_loop[sound]=soundID}};
SoundPlayer.stopSound=function(sound){var soundId=s_sound_loop[sound];if(soundId!==null&&soundId!==undefined)if(cc.sys.isNative)jsb.AudioEngine.stop(soundId);else cc.audioEngine.stopEffect(soundId);else if(!cc.sys.isNative){var soundUrl=SoundPlayer._createURL(sound);var ap=cc.audioEngine._audioPool;for(var p in ap){var list=ap[p];for(var i=0;i<list.length;i++){var sound=list[i];if(sound.src.endsWith(soundUrl)){sound.stop();return}}}}s_sound_loop[sound]=null};
SoundPlayer.playSoundLoop=function(sound){cc.log("playSoundLoop");var soundID=SoundPlayer._playSingleSound(sound,true);return soundID};SoundPlayer.stopSoundLoop=function(soundId){if(soundId!==null&&soundId!==undefined)if(cc.sys.isNative){cc.log("stopSoundLoop");jsb.AudioEngine.stop(soundId)}else cc.audioEngine.stopEffect(soundId)};SoundPlayer.stopAllSound=function(){s_sound_loop={};if(cc.sys.isNative)jsb.AudioEngine.stopAll();else cc.audioEngine.stopAllEffects()};var s_Dialog_Create_Button1=function(size,title){var bt=new ccui.Button("dialog-button-1.png","","",ccui.Widget.PLIST_TEXTURE);bt.setScale9Enabled(true);bt.setCapInsets(cc.rect(10,10,4,4));bt.setContentSize(size);if(title){var btTitle=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,title);btTitle.setColor(cc.color("#682e2e"));btTitle.setPosition(size.width/2,size.height/2);bt.getRendererNormal().addChild(btTitle);bt.buttonTitleLabel=btTitle}return bt};
var s_Dialog_Create_Button2=function(size,title){var bt=new ccui.Button("dialog-button-2.png","","",ccui.Widget.PLIST_TEXTURE);bt.setScale9Enabled(true);bt.setCapInsets(cc.rect(10,10,4,4));bt.setContentSize(size);if(title){var btTitle=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,title);btTitle.setColor(cc.color("#40485a"));btTitle.setPosition(size.width/2,size.height/2);bt.getRendererNormal().addChild(btTitle);bt.buttonTitleLabel=btTitle}return bt};
var IDialog=cc.Node.extend({ctor:function(){this._super();this._isShow=false;this.mTouch=cc.rect(0,0,0,0);this.setAnchorPoint(cc.p(.5,.5));this._maxLeft=0;this._maxRight=cc.winSize.width;this._maxBottom=0;this._maxTop=cc.winSize.height},adjustlel:function(){},show:function(rootNode){this._isShow=true;var parentNode=this.getParent();if(parentNode){parentNode.removeFromParent();parentNode=null}if(!rootNode)rootNode=cc.director.getRunningScene();if(rootNode){if(rootNode.popupLayer)parentNode=rootNode.popupLayer;
else parentNode=rootNode;this.setPosition(cc.winSize.width/2,cc.winSize.height/2);if(!this._bgColor)this._bgColor=cc.color(0,0,0,180);var colorLayer=new cc.LayerColor(this._bgColor,cc.winSize.width,cc.winSize.height);colorLayer.addChild(this);parentNode.addChild(colorLayer)}},showWithAnimationScale:function(){Dialog.prototype.show.apply(this,arguments);var scale=this.getScale();this.setScale(0);var scaleAction=new cc.EaseElasticOut(new cc.ScaleTo(.7,scale));this.runAction(scaleAction)},showWithAnimationMove:function(){Dialog.prototype.show.apply(this,
arguments);this.y=cc.winSize.height+this.getContentSize().height/2;var moveAction=new cc.EaseBounceOut(new cc.MoveTo(.7,cc.p(cc.winSize.width/2,cc.winSize.height/2)));this.runAction(moveAction)},hide:function(){this._isShow=false;var parent=this.getParent();if(parent)parent.removeFromParent(true)},isShow:function(){return this._isShow},onTouchDialog:function(){},onExit:function(){this._super();this._isShow=false},onEnter:function(){this._super();this._isShow=true;var thiz=this;cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,
swallowTouches:true,onTouchBegan:function(touch,event){if(thiz._moveEnable){var p=thiz.convertToNodeSpace(touch.getLocation());if(cc.rectContainsPoint(thiz.mTouch,p)){thiz.onTouchDialog();return true}return false}else{var p=thiz.convertToNodeSpace(touch.getLocation());if(cc.rectContainsPoint(thiz.mTouch,p)){thiz._touchInside=true;thiz.adjustlel()}return true}return false},onTouchMoved:function(touch,event){if(thiz._moveEnable)thiz.moveDialog(touch.getDelta())},onTouchEnded:function(touch,event){if(thiz._moveEnable);
else{if(thiz._touchInside){thiz._touchInside=false;return}var p=thiz.convertToNodeSpace(touch.getLocation());if(!cc.rectContainsPoint(thiz.mTouch,p))thiz.hide()}cc.log(thiz._moveEnable)}},this)},moveDialog:function(ds){this.x+=ds.x;this.y+=ds.y;if(this.x<this._maxLeft)this.x=this._maxLeft;if(this.x>this._maxRight)this.x=this._maxRight;if(this.y<this._maxBottom)this.y=this._maxBottom;if(this.y>this._maxTop)this.y=this._maxTop}});
var Dialog=IDialog.extend({ctor:function(){this._super();this._marginLeft=98;this._marginRight=98;this._marginTop=98;this._marginBottom=98;var dialogBg=new ccui.Scale9Sprite("dialog-bg.png",cc.rect(120,186,4,4));dialogBg.setAnchorPoint(cc.p(0,0));this.addChild(dialogBg);var title=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_25,"Title");title.setColor(cc.color("#c5e2ff"));this.addChild(title);var closeButton=new ccui.Button("dialog-button-close.png","","",ccui.Widget.PLIST_TEXTURE);this.addChild(closeButton);
var okButton=s_Dialog_Create_Button1(cc.size(182,60),"OK");this.addChild(okButton);var cancelButton=s_Dialog_Create_Button2(cc.size(182,60),"CANCEL");this.addChild(cancelButton);this.dialogBg=dialogBg;this.title=title;this.closeButton=closeButton;this.okButton=okButton;this.cancelButton=cancelButton;this.okTitle=okButton.buttonTitleLabel;this.cancelTitle=cancelButton.buttonTitleLabel;var thiz=this;closeButton.addClickEventListener(function(){if(thiz.closeButtonHandler)thiz.closeButtonHandler()});
okButton.addClickEventListener(function(){if(thiz.okButtonHandler)thiz.okButtonHandler()});cancelButton.addClickEventListener(function(){if(thiz.cancelButtonHandler)thiz.cancelButtonHandler()})},initWithSize:function(mSize){this.dialogBg.setPreferredSize(cc.size(mSize.width+this._marginLeft+this._marginRight,mSize.height+this._marginTop+this._marginBottom));this.setContentSize(this.dialogBg.getContentSize());this.title.setPosition(this.getContentSize().width/2,this.getContentSize().height-127);this.closeButton.setPosition(this.getContentSize().width-
127,this.title.y);this.okButton.setPosition(this.getContentSize().width/2-this.okButton.getContentSize().width/2-15,156);this.cancelButton.setPosition(this.getContentSize().width/2+this.cancelButton.getContentSize().width/2+15,156);this.mTouch=cc.rect(this._marginLeft,this._marginBottom,mSize.width,mSize.height);this._maxLeft=mSize.width/2+4;this._maxRight=cc.winSize.width-mSize.width/2-4;this._maxBottom=mSize.height/2+4;this._maxTop=cc.winSize.height-mSize.height/2-4},closeButtonHandler:function(){this.hide()}});var MessageDialog=Dialog.extend({ctor:function(){this._super();this.initWithSize(cc.size(700,420));var scrollView=new ccui.ListView;scrollView.setContentSize(cc.size(660,358));scrollView.setPosition(this._marginLeft+20,this._marginBottom);scrollView.setDirection(ccui.ScrollView.DIR_VERTICAL);scrollView.setTouchEnabled(true);scrollView.setScrollBarEnabled(false);scrollView.addTouchEventListener(function(target,event){if(event==ccui.Widget.TOUCH_BEGAN)scrollView.stopAllActions()});scrollView.setBounceEnabled(true);
this.addChild(scrollView);this.scrollView=scrollView;this.okButton.visible=false;this.cancelButton.visible=false;this.title.setString("Th\u00f4ng b\u00e1o")},setTitle:function(title){this.title.setString(title)},setMessage:function(message){this.scrollView.removeAllItems();var messageLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_25,message,cc.TEXT_ALIGNMENT_CENTER,this.scrollView.getContentSize().width-10);var height=messageLabel.getContentSize().height+20;if(height<=this.scrollView.getContentSize().height){height=
this.scrollView.getContentSize().height;this.scrollView.setEnabled(false)}else{this.scrollView.setEnabled(true);this.scrollHeight=height-this.scrollView.getContentSize().height;this.startAutoScroll(4)}var container=new ccui.Widget;container.setContentSize(cc.size(this.scrollView.getContentSize().width-10,height));container.addChild(messageLabel);messageLabel.setPosition(container.getContentSize().width/2,container.getContentSize().height/2);this.scrollView.pushBackCustomItem(container)},startAutoScroll:function(delayTime){var thiz=
this;this.scrollView.stopAllActions();this.scrollView.runAction(new cc.Sequence(new cc.DelayTime(delayTime),new cc.CallFunc(function(){var duration=thiz.scrollHeight/40;thiz.scrollView.scrollToBottom(duration,false)})))}});
var MessageConfirmDialog=Dialog.extend({ctor:function(){this._super();this.initWithSize(cc.size(600,400));this.title.setString("Th\u00f4ng b\u00e1o");this.closeButton.visible=false;this.okTitle.setString("\u0110\u1ed3ng \u00fd");this.cancelTitle.setString("\u0110\u00f3ng");var messageLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_25,"message",cc.TEXT_ALIGNMENT_CENTER,550);messageLabel.setPosition(this.getContentSize().width/2,this.getContentSize().height/2);this.addChild(messageLabel);
this.messageLabel=messageLabel},setMessage:function(message){this.messageLabel.setString(message)},okButtonHandler:function(){},cancelButtonHandler:function(){this.hide()}});var InviteDialog=Dialog.extend({ctor:function(){this._super();this.okButton.visible=false;this.cancelButton.visible=false;this.title.setString("M\u1edcI CH\u01a0I");this.initWithSize(cc.size(718,478));var listItem=new newui.TableView(cc.size(704,417),2);listItem.setScrollBarEnabled(false);listItem.setMargin(20,20,0,0);listItem.setPadding(20);listItem.setPosition(105,98);this.addChild(listItem);this.listItem=listItem;var noPlayerLabel=new cc.LabelBMFont("Hi\u1ec7n t\u1ea1i kh\u00f4ng c\u00f3 ng\u01b0\u1eddi ch\u01a1i trong s\u1ea3nh, vui l\u00f2ng ch\u1edd",
cc.res.font.Roboto_Condensed_30,this.getContentSize().width-100);noPlayerLabel.setVisible(false);noPlayerLabel.setPosition(this.getContentSize().width/2,this.getContentSize().height/2);this.addChild(noPlayerLabel);this.noPlayerLabel=noPlayerLabel},onGetChannelUser:function(command,data){var users=data["users"];this.allUsers=[];for(var i=0;i<users.length;i++){this.addItem(users[i]["avtUrl"],users[i]["username"],users[i]["gold"]);this.allUsers.push(users[i]["username"])}this.noPlayerLabel.setVisible(users.length<=
0)},addItem:function(avt,username,gold){var displayUserName=username;var thiz=this;var container=new ccui.Widget;container.setContentSize(cc.size(322,70));this.listItem.pushItem(container);var bg1=new ccui.Scale9Sprite("dialob-invite-bg1.png",cc.rect(14,14,4,4));bg1.setPreferredSize(container.getContentSize());bg1.setPosition(container.getContentSize().width/2,container.getContentSize().height/2);container.addChild(bg1);var avt=UserAvatar.createAvatarWithId(avt);avt.setScale(.8);avt.setPosition(40,
container.getContentSize().height/2);container.addChild(avt);if(displayUserName.length>3&&displayUserName!=PlayerMe.username)displayUserName=displayUserName.substring(0,displayUserName.length-3)+"***";var userLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_25,displayUserName,cc.TEXT_ALIGNMENT_LEFT);userLabel.setLineBreakWithoutSpace(true);userLabel.setDimensions(200,userLabel.getLineHeight());userLabel.setAnchorPoint(cc.p(0,.5));userLabel.setPosition(80,container.getContentSize().height/
2+14);container.addChild(userLabel);var goldLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_20,cc.Global.NumberFormat1(gold)+" V");goldLabel.setColor(cc.color("#ffde00"));goldLabel.setAnchorPoint(cc.p(0,.5));goldLabel.setPosition(userLabel.x,container.getContentSize().height/2-14);container.addChild(goldLabel);var inviteBt=s_Dialog_Create_Button1(cc.size(58,40),"M\u1edcI");inviteBt.setPosition(279,avt.y);container.addChild(inviteBt);inviteBt.addClickEventListener(function(){thiz._requestInvite([username]);
thiz.listItem.removeItem(container)})},_requestInvite:function(users){if(users.length>0)LobbyClient.getInstance().send({command:"inviteUser",users:users})},onEnter:function(){this._super();LobbyClient.getInstance().addListener("getChannelUsers",this.onGetChannelUser,this);LobbyClient.getInstance().send({command:"getChannelUsers"})},onExit:function(){this._super();LobbyClient.getInstance().removeListener(this)}});
var RecvInviteDialog=function(){var instance=null;var RecvInviteClass=Dialog.extend({ctor:function(){this._super();var thiz=this;this.okButton.visible=false;this.cancelButton.visible=false;this.initWithSize(cc.size(599,278));this.title.setString("M\u1edcI CH\u01a0I");var ignoreBt=s_Dialog_Create_Button2(cc.size(180,50),"T\u1eea CH\u1ed0I T\u1ea4T C\u1ea2");ignoreBt.setPosition(this.getContentSize().width/2-200,150);ignoreBt.setZoomScale(.02);this.addChild(ignoreBt);ignoreBt.addClickEventListener(function(){thiz.ignoreButtonHandler()});
var cancelBt=s_Dialog_Create_Button2(cc.size(180,50),"H\u1ee6Y B\u1ece");cancelBt.setPosition(this.getContentSize().width/2,150);cancelBt.setZoomScale(.02);this.addChild(cancelBt);cancelBt.addClickEventListener(function(){thiz.cancelButtonHandler()});var okButton=s_Dialog_Create_Button1(cc.size(180,50),"\u0110\u1ed2NG \u00dd");okButton.setPosition(this.getContentSize().width/2+200,150);okButton.setZoomScale(.02);this.addChild(okButton);okButton.addClickEventListener(function(){thiz.okButtonHandler()});
var messageNode=new cc.Node;this.addChild(messageNode,10);this.messageNode=messageNode},setInfo:function(username,gameName,betting){this.messageNode.removeAllChildren(true);if(username)this.setInfoWithSender(username,gameName,betting);else this.setInfoWithoutSender(gameName,betting)},setRoomInfo:function(serverInfo){this.serverInfo=serverInfo},setInfoWithSender:function(username,gameName,betting){if(username.length>3&&username!=PlayerMe.username)username=username.substring(0,username.length-3)+"***";
var msgLabel=new ccui.RichText;msgLabel.pushBackElement(new ccui.RichElementText(0,cc.color("#ffffff"),255,username+" ",cc.res.font.Roboto_CondensedBold,18));msgLabel.pushBackElement(new ccui.RichElementText(0,cc.color("#ffffff"),255,"M\u1eddi b\u1ea1n v\u00e0o ch\u01a1i ph\u00f2ng ",cc.res.font.Roboto_Condensed,18));msgLabel.pushBackElement(new ccui.RichElementText(0,cc.color("#ffffff"),255,gameName+" ",cc.res.font.Roboto_Condensed,18));msgLabel.pushBackElement(new ccui.RichElementText(0,cc.color("#ffde00"),
255,cc.Global.NumberFormat1(betting)+" V",cc.res.font.Roboto_Condensed,18));msgLabel.setPosition(this.getContentSize().width/2,248);this.messageNode.addChild(msgLabel)},setInfoWithoutSender:function(gameName,betting){var msgLabel=new ccui.RichText;msgLabel.pushBackElement(new ccui.RichElementText(0,cc.color("#ffffff"),255,"B\u1ea1n nh\u1eadn \u0111\u01b0\u1ee3c l\u1eddi m\u1eddi ch\u01a1i ",cc.res.font.Roboto_Condensed,18));msgLabel.pushBackElement(new ccui.RichElementText(0,cc.color("#ffffff"),255,
gameName+" ",cc.res.font.Roboto_Condensed,18));msgLabel.pushBackElement(new ccui.RichElementText(0,cc.color("#ffde00"),255,cc.Global.NumberFormat1(betting)+" V",cc.res.font.Roboto_Condensed,18));msgLabel.setPosition(this.getContentSize().width/2,248);this.messageNode.addChild(msgLabel)},cancelButtonHandler:function(){this.hide()},okButtonHandler:function(){PlayerMe.SFS.roomId=this.room;SmartfoxClient.getInstance().findAndJoinRoom(this.serverInfo,null,null,this.serverInfo.roomId);LoadingDialog.getInstance().show("\u0110ang t\u00ecm ph\u00f2ng ch\u01a1i");
this.hide()},ignoreButtonHandler:function(){if(this._ignoreHandler)this._ignoreHandler();this.hide()}});RecvInviteClass.getInstance=function(){if(!instance){instance=new RecvInviteClass;instance.retain()}return instance};return RecvInviteClass}();var LoadingDialog=function(){var instance=null;var LoadingDialogClass=cc.Node.extend({ctor:function(){this._super();var colorLayer=new cc.LayerColor(cc.color(0,0,0,180),cc.winSize.width,cc.winSize.height);this.addChild(colorLayer);this.timeOut=30;var loadingSpin=new cc.Sprite("#dialog-loading-spin.png");loadingSpin.setPosition(cc.winSize.width/2,cc.winSize.height/2);this.addChild(loadingSpin);this.loadingSpin=loadingSpin;var loadingMessage=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_30,
"Loading");loadingMessage.setPosition(cc.winSize.width/2,cc.winSize.height/2-100);this.addChild(loadingMessage);this.loadingMessage=loadingMessage},onEnter:function(){this._super();cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:true,onTouchBegan:function(){return true}},this);this.loadingSpin.runAction(new cc.RepeatForever(new cc.RotateBy(1,360)));this.timeOut=30;this.scheduleUpdate()},onExit:function(){this._super();cc.eventManager.removeListeners(this);this.loadingSpin.stopAllActions();
this.unscheduleUpdate()},show:function(){var parent=this.getParent();if(parent)parent.removeChild(this);var mScene=cc.director.getRunningScene();if(mScene.popupLayer)mScene.popupLayer.addChild(this,10);else mScene.addChild(this,10);if(arguments.length==1)this.setMessage(arguments[0])},setMessage:function(message){this.loadingMessage.setString(message)},hide:function(){var parent=this.getParent();if(parent)parent.removeChild(this)},isShow:function(){var parent=this.getParent();if(parent)return true;
return false},update:function(dt){if(this.timeOut<0){this.hide();SceneNavigator.toHome("H\u1ebft th\u1eddi gian k\u1ebft n\u1ed1i m\u00e1y ch\u1ee7")}else this.timeOut-=dt}});LoadingDialogClass.getInstance=function(){if(!instance){instance=new LoadingDialogClass;instance.retain()}return instance};return LoadingDialogClass}();var MessageNode=function(){var instance=null;var MessageNodeClass=cc.Node.extend({ctor:function(){this._super();var bg=new cc.Sprite("#dialog-message-bg.png");bg.setPosition(cc.winSize.width/2,cc.winSize.height/2);this.addChild(bg);var messageLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_30,"Loading");messageLabel.setPosition(cc.winSize.width/2,cc.winSize.height/2);this.addChild(messageLabel);this.messageLabel=messageLabel},onEnter:function(){this._super();var thiz=this;cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,
swallowTouches:true,onTouchBegan:function(){return true},onTouchEnded:function(){thiz.hide()}},this)},onExit:function(){this._super();cc.eventManager.removeListeners(this);this.stopAllActions()},show:function(message,time,mScene){var parent=this.getParent();if(parent)parent.removeChild(this);if(!mScene)mScene=cc.director.getRunningScene();if(mScene.messageLayer)mScene.messageLayer.addChild(this,1);else mScene.addChild(this,1);if(time){this.setMessage(message);this.showWithTime(time)}else{this.setMessage(message);
this.showWithTime(3)}},showWithParent:function(message,parent){var _parent=this.getParent();if(_parent==parent){this.setMessage(message);this.showWithTime(3);return}if(_parent)_parent.removeChild(this);this.setMessage(message);this.showWithTime(3);parent.addChild(this,1)},showWithTime:function(time){var thiz=this;this.stopAllActions();this.runAction(new cc.Sequence(new cc.DelayTime(time),new cc.CallFunc(function(){thiz.hide()})))},setMessage:function(message){this.messageLabel.setString(message)},
hide:function(){var parent=this.getParent();if(parent)parent.removeChild(this)},isShow:function(){var parent=this.getParent();if(parent)return true;return false}});MessageNodeClass.getInstance=function(){if(!instance){instance=new MessageNodeClass;instance.retain()}return instance};return MessageNodeClass}();var ResultDialog=Dialog.extend({ctor:function(size){this._super();this.okButton.visible=false;this.cancelButton.visible=false;this.title.setString("K\u1ebft qu\u1ea3");var n=size;if(n<3)n=3;this.componentHeight=80;this.componentPadding=10;var height=80+this.componentHeight*n+this.componentPadding*(n+1);this.initWithSize(cc.size(600,height));this.initComponent(size)},initComponent:function(size){var padding=this.componentPadding;var top=this.dialogBg.getContentSize().height-178-padding;var h=this.componentHeight;
var w=this.dialogBg.getContentSize().width-240;var x=this.dialogBg.getContentSize().width/2;var y=top-h/2;var userLabel=[];var contentLabel=[];var goldLabel=[];var cardList=[];for(var i=0;i<size;i++){var bg=cc.Scale9Sprite.createWithSpriteFrameName("dialog-cardList-bg.png",cc.rect(8,8,4,4));bg.setPreferredSize(cc.size(w,h));bg.setPosition(x,y);this.dialogBg.addChild(bg);var label1=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_25,"username");label1.setAnchorPoint(cc.p(0,.5));label1.setPosition(130,
y+h/2-15);this.dialogBg.addChild(label1,1);userLabel.push(label1);var label2=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_25,"Th\u1eafng tr\u1eafng");label2.setAnchorPoint(cc.p(0,.5));label2.setPosition(420,y+h/2-15);this.dialogBg.addChild(label2,1);contentLabel.push(label2);var label3=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_25,"+8.888.888");label3.setAnchorPoint(cc.p(0,.5));label3.setPosition(label1.x,y-15);this.dialogBg.addChild(label3,1);goldLabel.push(label3);var cards=
new CardList(cc.size(400,40));cards.setTouchEnable(false);cards.setAnchorPoint(cc.p(.5,.5));cards.setPosition(x+70,y-15);this.dialogBg.addChild(cards,2);cardList.push(cards);y-=h+padding}this.userLabel=userLabel;this.contentLabel=contentLabel;this.goldLabel=goldLabel;this.cardList=cardList}});_arrPosHisoty=[174,300,425,530,637,760,874];
var HistoryChanLe=IDialog.extend({ctor:function(){this._super();var board_bg=new ccui.Scale9Sprite("board_bg.png",cc.rect(105,105,147,147));board_bg.setAnchorPoint(cc.p(0,0));this.addChild(board_bg);this.board_bg=board_bg;this.initWithSize(cc.size(1060,700));var title=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_30,"L\u1ecaCH S\u1eec \u0110\u1eb6T C\u01af\u1ee2C");title.setPosition(this.getContentSize().width/2,this.getContentSize().height-138);title.setColor(cc.color("#ffde00"));this.addChild(title);
this._createHistory()},_createHistory:function(){var mSize=cc.size(900,370);var dx=0;var thiz=this;this.arrHis=[];var arrTitle=["Phi\u00ean","Th\u1eddi gian","C\u1eeda","C\u01b0\u1ee3c","K\u1ebft qu\u1ea3","Tr\u1ea3 l\u1ea1i","Th\u1eafng"];for(var i=0;i<arrTitle.length;i++){var lblTitle=new cc.LabelTTF(arrTitle[i],cc.res.font.Roboto_Condensed,23);lblTitle.setColor(cc.color(196,225,255,255));lblTitle.setPosition(_arrPosHisoty[i],492);this.addChild(lblTitle)}var listTai=new newui.ListViewWithAdaptor(mSize);
listTai.setPosition(dx+50,100);this.addChild(listTai);listTai.setCreateItemCallback(function(){return thiz._createCell()});listTai.setSizeCallback(function(){return thiz.arrHis.length});listTai.setItemAdaptor(function(idx,view){thiz._setData(view,thiz.arrHis[idx])});this.listHis=listTai},_setData:function(view,data){view.phienLabel.setString(data["phien"]);view.timeLabel.setString(data["time"]);if(data["idCua"]==TX_CUA_TAI){view.cuaLabel.setString("T\u00e0i");view.cuaLabel.setColor(cc.color("#77cbee"))}else{view.cuaLabel.setString("X\u1ec9u");
view.cuaLabel.setColor(cc.color("#ffde00"))}view.bettingLabel.setString(cc.Global.NumberFormat1(data["betting"]));if(data["ketqua"]==TX_CUA_TAI){view.resuftabel.setString("T\u00e0i");view.resuftabel.setColor(cc.color("#77cbee"))}else{view.resuftabel.setString("X\u1ec9u");view.resuftabel.setColor(cc.color("#ffde00"))}view.returnLabel.setString(cc.Global.NumberFormat1(data["tra"]));view.receiewLabel.setString(cc.Global.NumberFormat1(data["nhan"]))},_createCell:function(){var _arrPos=_arrPosHisoty;var container=
new ccui.Widget;container.setContentSize(cc.size(1E3,67));var phienLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_20,"time",cc.TEXT_ALIGNMENT_CENTER,100);phienLabel.setPosition(_arrPos[0],33);container.addChild(phienLabel);var timeLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_20,"time",cc.TEXT_ALIGNMENT_CENTER,100);timeLabel.setPosition(_arrPos[1],30);container.addChild(timeLabel);var cuaLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_20,"time");cuaLabel.setPosition(_arrPos[2],
timeLabel.y);container.addChild(cuaLabel);var bettingLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_20,"time");bettingLabel.setPosition(_arrPos[3],timeLabel.y);container.addChild(bettingLabel);var resuftabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_20,"time");resuftabel.setPosition(_arrPos[4],timeLabel.y);container.addChild(resuftabel);var returnLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_20,"time");returnLabel.setPosition(_arrPos[5],timeLabel.y);container.addChild(returnLabel);
var receiewLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_20,"time");receiewLabel.setPosition(_arrPos[6],timeLabel.y);container.addChild(receiewLabel);container.phienLabel=phienLabel;container.timeLabel=timeLabel;container.cuaLabel=cuaLabel;container.bettingLabel=bettingLabel;container.resuftabel=resuftabel;container.returnLabel=returnLabel;container.receiewLabel=receiewLabel;return container},onSFSExtension:function(messageType,content){if(content.c==703){var items=content.p["1"];for(var i=
0;i<items.length;i++){var arrPhien=items[i]["3"]["1"];var phien=items[i]["2"];var ketqua=items[i]["3"]["2"]["1"];for(var j=0;j<arrPhien.length;j++){var idCua=parseInt(arrPhien[j]["2"]);var betting=parseInt(arrPhien[j]["5"]);var nhan=parseInt(arrPhien[j]["4"]);var tra=parseInt(arrPhien[j]["6"]);var time=arrPhien[j]["7"];var obj={ketqua:ketqua,phien:phien,time:cc.Global.DateToString(new Date(time)),nhan:nhan,tra:tra,betting:betting,idCua:idCua};this.arrHis.push(obj)}}this.listHis.refreshView()}},onEnter:function(){this._super();
SmartfoxClient.getInstance().addListener(socket.SmartfoxClient.CallExtension,this.onSFSExtension,this);SmartfoxClient.getInstance().sendExtensionRequest(-1,"703",null)},onExit:function(){this._super();SmartfoxClient.getInstance().removeListener(this)},initWithSize:function(mSize){this.board_bg.setPreferredSize(cc.size(mSize.width,mSize.height));this.setContentSize(this.board_bg.getContentSize())}});var ThongKeChanLe=IDialog.extend({ctor:function(){this._super();var historyNode=new cc.Node;this.addChild(historyNode,3);this.historyNode=historyNode;var board_bg=new ccui.Scale9Sprite("board_bg.png",cc.rect(105,105,147,147));board_bg.setAnchorPoint(cc.p(0,0));this.addChild(board_bg);this.board_bg=board_bg;this.initWithSize(cc.size(1080,590));var title=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_30,"TH\u1ed0NG K\u00ca");title.setPosition(this.getContentSize().width/2,this.getContentSize().height-
138);title.setColor(cc.color("#ffde00"));this.addChild(title);var bg=new ccui.Scale9Sprite("lobby_xocdia_bg_1.png",cc.rect(4,4,4,4));bg.setPreferredSize(cc.size(840,220));bg.setPosition(this.getContentSize().width/2,this.getContentSize().height/2-50);this.bg=bg;this.addChild(bg);this._initHistory();var lblXiu=new cc.LabelTTF("X\u1ec8U 0",cc.res.font.Roboto_CondensedBold,30);lblXiu.setColor(cc.color(255,222,0,255));lblXiu.setPosition(this.getContentSize().width/2-237,400);this.addChild(lblXiu);this.lblXiu=
lblXiu;var lblTai=new cc.LabelTTF("T\u00c0I 0",cc.res.font.Roboto_CondensedBold,30);lblTai.setPosition(this.getContentSize().width/2+237,400);lblTai.setColor(cc.color(119,203,238,255));this.addChild(lblTai);this.lblTai=lblTai},onSFSExtension:function(messageType,content){var pad=-35;if(content.c==704){var arrHis=content.p["1"];if(arrHis){var itemSize=cc.size(48,188);var countTai=0;var countXiu=0;var from=0;if(arrHis.length>15)from=arrHis.length-15;for(var i=from;i<arrHis.length;i++){var idCua=arrHis[i]["1"];
if(idCua==TX_CUA_TAI)countTai++;else countXiu++;var total=arrHis[i]["2"];var arrXucXac=arrHis[i]["4"];cc.log("\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d"+countTai);var x=45+(itemSize.width+2)*(i-from);var sumBg=new cc.Sprite("#lobby_taixiu_history_bg_1.png");sumBg.setPosition(x,109+pad);this.bg.addChild(sumBg,0);for(var j=0;j<arrXucXac.length;j++){var sprite=new cc.Sprite("#lobby_taixiu_dice_"+arrXucXac[j]+".png");sprite.setPosition(x,153+28*j+pad);this.bg.addChild(sprite,0)}if(total>10){var label=
new cc.LabelBMFont("T\u00c0I",cc.res.font.Roboto_Condensed_25);label.setColor(cc.color("#00ccff"))}else{var label=new cc.LabelBMFont("X\u1ec8U",cc.res.font.Roboto_Condensed_25);label.setColor(cc.color("#ffde00"))}label.setScale(18/25);label.setPosition(x,72+pad);this.bg.addChild(label,1);var sumLabel=new cc.LabelBMFont(total.toString(),cc.res.font.Roboto_Condensed_25);sumLabel.setScale(20/25);sumLabel.setPosition(sumBg.getPosition());this.bg.addChild(sumLabel,1)}this.lblTai.setString("T\u00c0I "+
countTai);this.lblXiu.setString("X\u1ec8U "+countXiu)}}},onEnter:function(){this._super();SmartfoxClient.getInstance().addListener(socket.SmartfoxClient.CallExtension,this.onSFSExtension,this);SmartfoxClient.getInstance().sendExtensionRequest(-1,"704",null)},onExit:function(){this._super();SmartfoxClient.getInstance().removeListener(this)},_initHistory:function(){var itemSize=cc.size(48,45);var itemSize=cc.size(48,188);for(var i=0;i<16;i++){var bg=new ccui.Scale9Sprite("lobby_xocdia_bg_2.png",cc.rect(4,
4,4,4));bg.setPreferredSize(itemSize);bg.setPosition(45+(itemSize.width+2)*i,145-35);this.bg.addChild(bg)}this._historyData=[]},initWithSize:function(mSize){this.board_bg.setPreferredSize(cc.size(mSize.width,mSize.height));this.setContentSize(this.board_bg.getContentSize())},_refreshHistory:function(){var itemSize=cc.size(48,188);this.historyNode.removeAllChildren(true);for(var i=0;i<this._historyData.length;i++){var x=165+(itemSize.width+2)*i;var data=this._historyData[i];var sumBg=new cc.Sprite("#lobby_taixiu_history_bg_1.png");
sumBg.setPosition(x,109);this.historyNode.addChild(sumBg,0);var sum=0;for(var j=0;j<data.length;j++){var sprite=new cc.Sprite("#lobby_taixiu_dice_"+data[j]+".png");sprite.setPosition(x,153+28*j);this.historyNode.addChild(sprite,0);sum+=data[j]}if(sum>10){var label=new cc.LabelBMFont("T\u00c0I",cc.res.font.Roboto_Condensed_25);label.setColor(cc.color("#00ccff"))}else{var label=new cc.LabelBMFont("X\u1ec8U",cc.res.font.Roboto_Condensed_25);label.setColor(cc.color("#ffde00"))}label.setScale(18/25);label.setPosition(x,
72);this.historyNode.addChild(label,1);var sumLabel=new cc.LabelBMFont(sum.toString(),cc.res.font.Roboto_Condensed_25);sumLabel.setScale(20/25);sumLabel.setPosition(sumBg.getPosition());this.historyNode.addChild(sumLabel,1)}}});var HistoryPhien=Dialog.extend({ctor:function(data){this._super();cc.log(data);this.sessionId=data["idVan"];var thiz=this;this.okButton.visible=false;this.cancelButton.visible=false;this.title.setString("L\u1ecbch s\u1eed phi\u00ean "+this.sessionId);this.initWithSize(cc.size(1035,597));var lblDate=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_20,"");lblDate.setColor(cc.color("#c4e1ff"));lblDate.setPosition(this.getContentSize().width/2,596);this.addChild(lblDate);this.lblDate=lblDate;var typeStr=
data["type"]==1?"T\u00c0I":"X\u1ec8U";var lblCua=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_30,typeStr+" "+data["number"]);lblCua.setColor(cc.color("#77cbee"));lblCua.setPosition(this.getContentSize().width/2,561);this.addChild(lblCua);var dice=[];for(var i=-1;i<2;i++){var xucxac=new cc.Sprite("#taixiu_dice_1.png");xucxac.setPosition(this.getContentSize().width/2+120*i,498);thiz.addChild(xucxac);dice.push(xucxac);xucxac.setVisible(false)}this.dice=dice;var line_ngang=new ccui.Scale9Sprite("lobby_bg_white.png",
cc.rect(12,12,4,4));line_ngang.setPreferredSize(cc.size(this.getContentSize().width-200,2));line_ngang.setPosition(this.getContentSize().width/2,448);line_ngang.setOpacity(30);this.addChild(line_ngang);var line_ngang1=new ccui.Scale9Sprite("lobby_bg_white.png",cc.rect(12,12,4,4));line_ngang1.setPreferredSize(cc.size(this.getContentSize().width-200,2));line_ngang1.setPosition(this.getContentSize().width/2,395);line_ngang1.setOpacity(30);this.addChild(line_ngang1);var line_doc=new ccui.Scale9Sprite("lobby_bg_white.png",
cc.rect(12,12,4,4));line_doc.setPreferredSize(cc.size(2,348));line_doc.setAnchorPoint(.5,0);line_doc.setPosition(this.getContentSize().width/2,100);line_doc.setOpacity(30);this.addChild(line_doc);var lblTai=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_30,"T\u00c0I");lblTai.setColor(cc.color("#77cbee"));lblTai.setPosition(this.getContentSize().width/2+247,420);this.addChild(lblTai);var lblXiu=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_30,"X\u1ec8U");lblXiu.setColor(cc.color("#ffde00"));
lblXiu.setPosition(this.getContentSize().width/2-247,420);this.addChild(lblXiu);this._createTai();this._createXiu()},_createTai:function(){var mSize=cc.size(492,255);var dx=0;var thiz=this;this.arrTai=[];var timeLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_20,"Th\u1eddi gian");timeLabel.setColor(cc.color("#c4e1ff"));timeLabel.setPosition(dx+167,375);this.addChild(timeLabel);var nameLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_20,"Ng\u01b0\u1eddi ch\u01a1i");nameLabel.setColor(cc.color("#c4e1ff"));
nameLabel.setPosition(dx+293,timeLabel.y);this.addChild(nameLabel);var bettingLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_20,"C\u01b0\u1ee3c");bettingLabel.setColor(cc.color("#c4e1ff"));bettingLabel.setPosition(dx+415,timeLabel.y);this.addChild(bettingLabel);var returnLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_20,"Tr\u1ea3 l\u1ea1i");returnLabel.setColor(cc.color("#c4e1ff"));returnLabel.setPosition(dx+543,timeLabel.y);this.addChild(returnLabel);var listTai=new newui.ListViewWithAdaptor(mSize);
listTai.setPosition(dx+109,98);this.addChild(listTai);listTai.setCreateItemCallback(function(){return thiz._createCell()});listTai.setSizeCallback(function(){return thiz.arrTai.length});listTai.setItemAdaptor(function(idx,view){thiz._setData(view,thiz.arrTai[idx])});this.listTai=listTai},_createXiu:function(){var mSize=cc.size(492,255);var dx=this.getContentSize().width/2-98;var thiz=this;this.arrXiu=[];var timeLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_20,"Th\u1eddi gian");timeLabel.setColor(cc.color("#c4e1ff"));
timeLabel.setPosition(dx+167,375);this.addChild(timeLabel);var nameLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_20,"Ng\u01b0\u1eddi ch\u01a1i");nameLabel.setColor(cc.color("#c4e1ff"));nameLabel.setPosition(dx+293,timeLabel.y);this.addChild(nameLabel);var bettingLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_20,"C\u01b0\u1ee3c");bettingLabel.setColor(cc.color("#c4e1ff"));bettingLabel.setPosition(dx+415,timeLabel.y);this.addChild(bettingLabel);var returnLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_20,
"Tr\u1ea3 l\u1ea1i");returnLabel.setColor(cc.color("#c4e1ff"));returnLabel.setPosition(dx+543,timeLabel.y);this.addChild(returnLabel);var listXiu=new newui.ListViewWithAdaptor(mSize);listXiu.setPosition(dx+109,98);this.addChild(listXiu);listXiu.setCreateItemCallback(function(){return thiz._createCell()});listXiu.setSizeCallback(function(){return thiz.arrXiu.length});listXiu.setItemAdaptor(function(idx,view){thiz._setData(view,thiz.arrXiu[idx])});this.listXiu=listXiu},_createCell:function(){var container=
new ccui.Widget;container.setContentSize(cc.size(484,60));var timeLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_20,"time",cc.TEXT_ALIGNMENT_CENTER,100);timeLabel.setPosition(54,30);container.addChild(timeLabel);var nameLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_20,"time");nameLabel.setPosition(180,timeLabel.y);container.addChild(nameLabel);var bettingLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_20,"time");bettingLabel.setPosition(302,timeLabel.y);container.addChild(bettingLabel);
var returnLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_20,"time");returnLabel.setPosition(430,timeLabel.y);container.addChild(returnLabel);container.timeLabel=timeLabel;container.nameLabel=nameLabel;container.bettingLabel=bettingLabel;container.returnLabel=returnLabel;return container},_setData:function(view,data){view.timeLabel.setString(data["time"]);view.nameLabel.setString(data["name"]);view.bettingLabel.setString(data["betting"]);view.returnLabel.setString(data["retValue"])},
_recvData:function(cmd,data){cc.log(data);this.lblDate.setString(data["p"]["1"]["3"]["5"]);var dice=data["p"]["1"]["3"]["4"];for(var i=0;i<dice.length;i++){this.dice[i].setVisible(true);this.dice[i].setSpriteFrame("taixiu_dice_"+dice[i]+".png")}var items=data["p"]["1"]["2"];for(var i=0;i<items.length;i++){var name=items[i]["1"];if(name.length>15)name=name.substring(0,15);if(name.length>3&&name!=PlayerMe.username)name=name.substring(0,name.length-3)+"***";var type=items[i]["2"]["2"];var betting=parseInt(items[i]["2"]["5"]);
var retValue=parseInt(items[i]["2"]["6"]);var time=items[i]["2"]["7"];var obj={time:cc.Global.DateToString(new Date(time)),name:name,betting:cc.Global.NumberFormat1(betting),retValue:cc.Global.NumberFormat1(retValue)};if(type===1)this.arrTai.push(obj);else this.arrXiu.push(obj)}this.listTai.refreshView();this.listXiu.refreshView()},onEnter:function(){this._super();SmartfoxClient.getInstance().addExtensionListener("707",this._recvData,this);SmartfoxClient.getInstance().sendExtensionRequest(-1,"707",
{1:this.sessionId})},onExit:function(){this._super();SmartfoxClient.getInstance().removeListener(this)}});_arrPosHisotyMB=[80,340,670];
var HistoryNoHu=IDialog.extend({ctor:function(isMauBinh){this._super();var board_bg=new ccui.Scale9Sprite("board_bg.png",cc.rect(105,105,147,147));board_bg.setAnchorPoint(cc.p(0,0));this.addChild(board_bg);this.board_bg=board_bg;this.initWithSize(cc.size(881,650));var title="L\u1ecaCH S\u1eec N\u1ed4 H\u0168 M\u1eacU BINH";var detail="S\u1ea3nh r\u1ed3ng t\u1eeb 2 \u0111\u1ebfn \u00c1t, c\u00f3 \u00c1t r\u00f4";if(!isMauBinh){title="L\u1ecaCH S\u1eec N\u1ed4 H\u0168 BA C\u00c2Y";detail="S\u00e1p \u00c1t c\u00f3 \u00c1t r\u00f4"}var titleLBL=
cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_30,title);titleLBL.setPosition(this.getContentSize().width/2,this.getContentSize().height-138);titleLBL.setColor(cc.color("#ffde00"));this.addChild(titleLBL);var detailLbl=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_30,detail);detailLbl.setPosition(this.getContentSize().width/2,460);detailLbl.setColor(cc.color("#ffde00"));this.addChild(detailLbl);var listItem=new newui.TableView(cc.size(681,340),1);listItem.setPosition(cc.p(100,
100));this.addChild(listItem);this.listItem=listItem},addItem:function(timeCreate,userName,gold){var container=new ccui.Widget;container.setContentSize(cc.size(680,80));this.listItem.pushItem(container);var bg=new ccui.Scale9Sprite("activity_cell_bg.png",cc.rect(10,10,4,4));bg.setPreferredSize(cc.size(680,70));bg.setPosition(container.getContentSize().width/2,container.getContentSize().height/2);var timeLaybel=new cc.LabelTTF(timeCreate,cc.res.font.Roboto_Condensed,24);timeLaybel.setDimensions(150,
0);timeLaybel.setPosition(_arrPosHisotyMB[0],35);bg.addChild(timeLaybel);var nameLabel=new cc.LabelTTF(userName,cc.res.font.Roboto_Condensed,24);nameLabel.setPosition(_arrPosHisotyMB[1],35);bg.addChild(nameLabel);var goldLabel=new cc.LabelTTF(gold,cc.res.font.Roboto_Condensed,24);goldLabel.setAnchorPoint(1,.5);goldLabel.setColor(cc.color(255,194,0,255));goldLabel.setPosition(_arrPosHisotyMB[2],35);bg.addChild(goldLabel);container.addChild(bg)},onSFSExtension:function(messageType,content){if(content.c==
100001){var items=content.p["data"]["1"];for(var i=0;i<items.length;i++){var time=items[i]["1"];var name=items[i]["3"];if(name.length>15)name=name.substring(0,15);if(name.length>3&&name!=PlayerMe.username)name=name.substring(0,name.length-3)+"***";var money=cc.Global.NumberFormat1(parseInt(items[i]["4"]));this.addItem(time,name,money)}}},onEnter:function(){this._super();SmartfoxClient.getInstance().addListener(socket.SmartfoxClient.CallExtension,this.onSFSExtension,this);SmartfoxClient.getInstance().sendExtensionRequestCurrentRoom("20",
null)},onExit:function(){this._super();SmartfoxClient.getInstance().removeListener(this)},initWithSize:function(mSize){this.board_bg.setPreferredSize(cc.size(mSize.width,mSize.height));this.setContentSize(this.board_bg.getContentSize())}});var SettingDialog=Dialog.extend({ctor:function(){this._super();var thiz=this;this.initWithSize(cc.size(518,318));this.title.setString("C\u00e0i \u0111\u1eb7t");this.okButton.visible=false;this.cancelButton.visible=false;var soundLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_14,"\u00c2M THANH");soundLabel.setPosition(this.getContentSize().width/2-130,207);soundLabel.setColor(cc.color("#a6bde0"));this.addChild(soundLabel,1);var vibratorLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_14,
"RUNG");vibratorLabel.setPosition(this.getContentSize().width/2,soundLabel.y);vibratorLabel.setColor(cc.color("#a6bde0"));this.addChild(vibratorLabel,1);var inviteLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_14,"NH\u1eacN L\u1edcI M\u1edcI");inviteLabel.setPosition(this.getContentSize().width/2+130,vibratorLabel.y);inviteLabel.setColor(cc.color("#a6bde0"));this.addChild(inviteLabel,1);var emailIcon=new cc.Sprite("#setting-email-icon.png");emailIcon.setPosition(580,125);this.addChild(emailIcon);
var emailLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,GameConfig.email);emailLabel.setAnchorPoint(cc.p(1,.5));emailLabel.setPosition(emailIcon.x-20,emailIcon.y);emailLabel.setColor(cc.color("#4d5f7b"));this.addChild(emailLabel,1);var versionLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,"Ver "+SystemPlugin.getInstance().getVersionName());versionLabel.setAnchorPoint(cc.p(0,.5));versionLabel.setPosition(122,emailLabel.y);versionLabel.setColor(cc.color("#4d5f7b"));
this.addChild(versionLabel,1);var soundOnOff=new newui.ButtonToggle("#setting-sound-icon-2.png","#setting-sound-icon.png");soundOnOff.setPosition(soundLabel.x,260);soundOnOff.onSelect=function(target,selected){thiz._setSoundEnable(selected);if(!selected)SoundPlayer.stopAllSound()};this.addChild(soundOnOff);var vibratorOnOff=new newui.ButtonToggle("#setting-vibrator-icon-2.png","#setting-vibrator-icon.png");vibratorOnOff.setPosition(vibratorLabel.x,soundOnOff.y);vibratorOnOff.onSelect=function(target,
selected){thiz._setVibratorEnable(selected)};this.addChild(vibratorOnOff);var inviteOnOff=new newui.ButtonToggle("#setting-invite-icon-2.png","#setting-invite-icon.png");inviteOnOff.setPosition(inviteLabel.x,soundOnOff.y);inviteOnOff.onSelect=function(target,selected){thiz._setInviteEnable(selected)};this.addChild(inviteOnOff);this.soundOnOff=soundOnOff;this.vibratorOnOff=vibratorOnOff;this.inviteOnOff=inviteOnOff;this.soundLabel=soundLabel;this.vibratorLabel=vibratorLabel;this.inviteLabel=inviteLabel},
_setSoundEnable:function(enable,force){cc.Global.SetSetting("sound",enable);this.soundLabel.setColor(cc.color(enable?"#ffde00":"#435878"));if(force)this.soundOnOff.select(enable)},_setVibratorEnable:function(enable,force){cc.Global.SetSetting("vibrator",enable);this.vibratorLabel.setColor(cc.color(enable?"#ffde00":"#435878"));if(force)this.vibratorOnOff.select(enable);if(cc.sys.isNative)if(!this._isInitView&&enable)cc.Device.vibrate(.1)},_setInviteEnable:function(enable,force){cc.Global.SetSetting("invite",
enable);this.inviteLabel.setColor(cc.color(enable?"#ffde00":"#435878"));if(force)this.inviteOnOff.select(enable)},onEnter:function(){this._super();this._isInitView=true;this._setSoundEnable(cc.Global.GetSetting("sound",true),true);this._setVibratorEnable(cc.Global.GetSetting("vibrator",true),true);this._setInviteEnable(cc.Global.GetSetting("invite",true),true);this._isInitView=false}});var UserDialog=Dialog.extend({ctor:function(){this._super();this.okButton.visible=false;this.cancelButton.visible=false;this.title.setString("Th\u00f4ng tin ng\u01b0\u1eddi ch\u01a1i");this.initWithSize(cc.size(600,400));var avt=UserAvatar.createAvatar();avt.setPosition(cc.p(this.getContentSize().width/2,320));this.addChild(avt);this.avt=avt;var userLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_30,"username",cc.TEXT_ALIGNMENT_CENTER);userLabel.setDimensions(580,userLabel.getLineHeight());
userLabel.setPosition(cc.p(this.getContentSize().width/2,250));this.addChild(userLabel);var goldLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_25,"1.000.000 V");goldLabel.setColor(cc.color("#ffde00"));goldLabel.setPosition(cc.p(this.getContentSize().width/2,215));this.addChild(goldLabel);this.userLabel=userLabel;this.goldLabel=goldLabel},setUsername:function(username){this.userLabel.setString(username)},setGold:function(gold){this.goldLabel.setString(cc.Global.NumberFormat1(gold)+
" V")},setAvatar:function(avt){this.avt.setAvatar(avt)}});var UserInfoChangeLayer=cc.Node.extend({ctor:function(){this._super();var thiz=this;LobbyClient.getInstance().addListener("getProfile",this.onGetProfile,this);LobbyClient.getInstance().addListener("updateProfile",this.onUpdateProfile,this);var bg1=new ccui.Scale9Sprite("dialog-textinput-bg.png",cc.rect(10,10,4,4));bg1.setPreferredSize(cc.size(280,44));bg1.setPosition(769,477);this.addChild(bg1);var bg2=new ccui.Scale9Sprite("dialog-textinput-bg.png",cc.rect(10,10,4,4));bg2.setPreferredSize(cc.size(280,
44));bg2.setPosition(bg1.x,407);this.addChild(bg2);var bg3=new ccui.Scale9Sprite("dialog-textinput-bg.png",cc.rect(10,10,4,4));bg3.setPreferredSize(cc.size(280,44));bg3.setPosition(bg1.x,337);this.addChild(bg3);var bg4=new ccui.Scale9Sprite("dialog-textinput-bg.png",cc.rect(10,10,4,4));bg4.setPreferredSize(cc.size(280,44));bg4.setPosition(bg1.x,267);this.addChild(bg4);var okButton=new ccui.Button("dialog-button-1.png","","",ccui.Widget.PLIST_TEXTURE);okButton.setScale9Enabled(true);okButton.setZoomScale(.03);
okButton.setCapInsets(cc.rect(10,10,4,4));okButton.setContentSize(280,44);okButton.setPosition(bg1.x,180);okButton.addClickEventListener(function(){thiz.requestSetUserinfo()});this.addChild(okButton);var okTitle=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,"L\u01afU");okTitle.setColor(cc.color("#682e2e"));okTitle.setPosition(okButton.getContentSize().width/2,okButton.getContentSize().height/2);okButton.getRendererNormal().addChild(okTitle);var textSize=cc.size(bg1.getContentSize().width-
4,bg1.getContentSize().height-4);var addressText=new newui.TextField(textSize,cc.res.font.Roboto_Condensed_18);addressText.setPlaceHolder("\u0110\u1ecba ch\u1ec9");addressText.setPlaceHolderColor(cc.color("#787878"));addressText.setPosition(bg1.getPosition());this.addChild(addressText);var idText=new newui.TextField(textSize,cc.res.font.Roboto_Condensed_18);idText.setPlaceHolder("S\u1ed1 CMND");idText.setPlaceHolderColor(cc.color("#787878"));idText.setPosition(bg2.getPosition());this.addChild(idText);
var emailText=new newui.TextField(textSize,cc.res.font.Roboto_Condensed_18);emailText.setPlaceHolder("Email");emailText.setPlaceHolderColor(cc.color("#787878"));emailText.setPosition(bg3.getPosition());this.addChild(emailText);var merchantText=new newui.TextField(textSize,cc.res.font.Roboto_Condensed_18);merchantText.setPlaceHolder("M\u00e3 \u0111\u1ea1i l\u00fd");merchantText.setPlaceHolderColor(cc.color("#787878"));merchantText.setPosition(bg4.getPosition());this.addChild(merchantText);this.addressText=
addressText;this.idText=idText;this.emailText=emailText;this.merchantText=merchantText},onGetProfile:function(cmd,data){var info=data["data"]["info"];this.addressText.setText(info["add"]);this.idText.setText(info["cmnd"]);this.emailText.setText(info["email"]);this.merchantText.setText(info["merchantId"])},onUpdateProfile:function(cmd,data){var status=data["status"];if(status==0)MessageNode.getInstance().show("C\u1eadp nh\u1eadt th\u00f4ng tin th\u00e0nh c\u00f4ng")},requestSetUserinfo:function(){var address=
this.addressText.getText();var id=this.idText.getText();var email=this.emailText.getText();var merchantId=this.merchantText.getText();var request={command:"updateProfile",id:id,email:email,add:address,merchantId:merchantId};LobbyClient.getInstance().send(request)},onEnter:function(){this._super();LobbyClient.getInstance().send({command:"getProfile"})},onExit:function(){this._super();LobbyClient.getInstance().removeListener(this)}});
var UserinfoPasswordLayer=cc.Node.extend({ctor:function(){this._super();LobbyClient.getInstance().addListener("changePassword",this.onRecvChangePassword,this);var bg1=new ccui.Scale9Sprite("dialog-textinput-bg.png",cc.rect(10,10,4,4));bg1.setPreferredSize(cc.size(280,44));bg1.setPosition(769,447);this.addChild(bg1);var bg2=new ccui.Scale9Sprite("dialog-textinput-bg.png",cc.rect(10,10,4,4));bg2.setPreferredSize(cc.size(280,44));bg2.setPosition(bg1.x,377);this.addChild(bg2);var bg3=new ccui.Scale9Sprite("dialog-textinput-bg.png",
cc.rect(10,10,4,4));bg3.setPreferredSize(cc.size(280,44));bg3.setPosition(bg1.x,307);this.addChild(bg3);var okButton=new ccui.Button("dialog-button-1.png","","",ccui.Widget.PLIST_TEXTURE);okButton.setScale9Enabled(true);okButton.setZoomScale(.03);okButton.setCapInsets(cc.rect(10,10,4,4));okButton.setContentSize(280,44);okButton.setPosition(bg1.x,220);this.addChild(okButton);var okTitle=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,"\u0110\u1ed5i m\u1eadt kh\u1ea9u");okTitle.setColor(cc.color("#682e2e"));
okTitle.setPosition(okButton.getContentSize().width/2,okButton.getContentSize().height/2);okButton.getRendererNormal().addChild(okTitle);var textSize=cc.size(bg1.getContentSize().width-4,bg1.getContentSize().height-4);var passwordText=new newui.TextField(textSize,cc.res.font.Roboto_Condensed_18);passwordText.setPlaceHolder("M\u1eadt kh\u1ea9u c\u0169");passwordText.setPlaceHolderColor(cc.color("#787878"));passwordText.setPasswordEnable(true);passwordText.setPosition(bg1.getPosition());this.addChild(passwordText);
this.passwordText=passwordText;var passwordText1=new newui.TextField(textSize,cc.res.font.Roboto_Condensed_18);passwordText1.setPlaceHolder("M\u1eadt kh\u1ea9u m\u1edbi");passwordText1.setPlaceHolderColor(cc.color("#787878"));passwordText1.setPasswordEnable(true);passwordText1.setPosition(bg2.getPosition());this.addChild(passwordText1);this.passwordText1=passwordText1;var passwordText2=new newui.TextField(textSize,cc.res.font.Roboto_Condensed_18);passwordText2.setPlaceHolder("Nh\u1eadp l\u1ea1i m\u1eadt kh\u1ea9u");
passwordText2.setPlaceHolderColor(cc.color("#787878"));passwordText2.setPasswordEnable(true);passwordText2.setPosition(bg3.getPosition());this.addChild(passwordText2);this.passwordText2=passwordText2;okButton.addClickEventListener(function(){var password=passwordText.getText();if(password===""){MessageNode.getInstance().show("B\u1ea1n ph\u1ea3i m\u1eadt kh\u1ea9u");return}var newPassword1=passwordText1.getText();if(newPassword1===""){MessageNode.getInstance().show("B\u1ea1n ph\u1ea3i m\u1eadt kh\u1ea9u m\u1edbi");
return}var newPassword2=passwordText2.getText();if(newPassword2===""){MessageNode.getInstance().show("B\u1ea1n ph\u1ea3i l\u1ea1i m\u1eadt kh\u1ea9u m\u1edbi");return}if(newPassword1!=newPassword2){MessageNode.getInstance().show("M\u1eadt kh\u1ea9u kh\u00f4ng tr\u00f9ng nhau");return}var request={command:"changePassword",password:password,newPassword:newPassword1};LobbyClient.getInstance().send(request);LoadingDialog.getInstance().show("\u0110ang \u0111\u1ed5i m\u1eadt kh\u1ea9u")})},onExit:function(){this._super();
LobbyClient.getInstance().removeListener(this)},onRecvChangePassword:function(messageName,data){LoadingDialog.getInstance().hide();if(data.status===0){MessageNode.getInstance().show("\u0110\u1ed5i m\u1eadt kh\u1ea9u th\u00e0nh c\u00f4ng");var newPassword=this.passwordText1.getText();LobbyClient.getInstance()._password=newPassword;if(cc.Global.getSavePassword()!="")cc.Global.setSavePassword(newPassword);this.passwordText.setText("");this.passwordText1.setText("");this.passwordText2.setText("")}else MessageNode.getInstance().show("\u0110\u1ed5i m\u1eadt kh\u1ea9u th\u1ea5t b\u1ea1i")}});
var VerifyPhoneLayer=cc.Node.extend({ctor:function(){this._super();var label1=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_25,"S\u1ed1 \u0111i\u1ec7n tho\u1ea1i x\u00e1c nh\u1eadn t\u00e0i kho\u1ea3n");label1.setPosition(777,410);this.addChild(label1);var phoneLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_30,"0123456789");phoneLabel.setColor(cc.color("#009cff"));phoneLabel.setPosition(label1.x,365);this.addChild(phoneLabel);this.phoneLabel=phoneLabel},refreshView:function(){var phone=
PlayerMe.phoneNumber.substring(0,PlayerMe.phoneNumber.length-3)+"***";this.phoneLabel.setString(phone)},setVisible:function(visible){this._super(visible);if(visible)this.refreshView()}});var s_Verify_SMS_Provider=s_Verify_SMS_Provider||["VIETTEL","VINA","MOBI"];
var VerifySendSMSLayer=cc.Node.extend({ctor:function(){this._super();var mToggle=new ToggleNodeGroup;this.mToggle=mToggle;this.addChild(mToggle);var left=600;var right=1E3;var dx=(right-left)/s_Verify_SMS_Provider.length;var x=left+dx/2;var y=450;this.smsLabel=[];var thiz=this;for(var i=0;i<s_Verify_SMS_Provider.length;i++)(function(){var idx=i;var label=new cc.LabelBMFont(s_Verify_SMS_Provider[i],cc.res.font.Roboto_Condensed_16);label.setColor(cc.color("#72acd6"));label.setPosition(x-10,y);thiz.addChild(label,
1);var bg1=new cc.Sprite("#dialog-checkBox-2.png");bg1.setPosition(label.x-label.getContentSize().width/2-20,y);thiz.addChild(bg1);var bg2=new cc.Sprite("#dialog-checkBoxCross-2.png");bg2.setPosition(bg1.getPosition());thiz.addChild(bg2);var smsContent=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,"sms",cc.TEXT_ALIGNMENT_CENTER,1E3);smsContent.setPosition((right+left)/2-30,350);thiz.addChild(smsContent,1);thiz.smsLabel.push(smsContent);var toggleItem=new ToggleNodeItem(cc.size(dx,bg1.getContentSize().height));
toggleItem.setPosition((bg1.x+label.x)/2,bg1.y);toggleItem.onSelect=function(){bg2.setVisible(true);smsContent.setVisible(true);thiz.idx=idx};toggleItem.onUnSelect=function(){bg2.setVisible(false);smsContent.setVisible(false)};mToggle.addItem(toggleItem);x+=dx})();if(cc.sys.isNative){var okButton=s_Dialog_Create_Button1(cc.size(280,44),"X\u00e1c nh\u1eadn");okButton.setPosition((right+left)/2-30,230);this.addChild(okButton);this.okButton=okButton;okButton.addClickEventListener(function(){SystemPlugin.getInstance().showSMS(thiz.smsGateway,
thiz.smsContent[thiz.idx])})}},setVisible:function(visible){this._super(visible);if(visible){this.mToggle.selectItem(0);if(this.okButton)this.okButton.setVisible(false);var request={command:"getVerifyAccountMessage"};LobbyClient.getInstance().send(request)}},onEnter:function(){this._super();LobbyClient.getInstance().addListener("getVerifyAccountMessage",this.onRecvSMSContent,this)},onExit:function(){this._super();LobbyClient.getInstance().removeListener(this)},onRecvSMSContent:function(messageName,
data){this.smsGateway=data["data"]["numberTo"];this.smsContent=[data["data"]["vettel"],data["data"]["vnp"],data["data"]["vms"]];if(this.okButton)this.okButton.visible=true;for(var i=0;i<this.smsLabel.length;i++){var text="So\u1ea1n tin nh\u1eafn\n\n"+this.smsContent[i]+"\n\nG\u1eedi \u0111\u1ebfn "+this.smsGateway;this.smsLabel[i].setString(text)}}});
var UserinfoVerifyLayer=cc.Node.extend({ctor:function(){this._super();LobbyClient.getInstance().addListener("verifyCode",this.onRecvVerifyCode,this);this.phoneLayer=new VerifyPhoneLayer;this.addChild(this.phoneLayer);this.sendSMSLayer=new VerifySendSMSLayer;this.addChild(this.sendSMSLayer);this.refreshView()},onExit:function(){this._super();LobbyClient.getInstance().removeListener(this)},onRecvVerifyAccount:function(messageName,data){},onRecvVerifyCode:function(messageName,data){if(data.status==0)this.refreshView();
else MessageNode.getInstance().show("Kh\u00f4ng th\u1ec3 x\u00e1c nh\u1eadn \u0111\u01b0\u1ee3c t\u00e0i kho\u1ea3n ["+data.status+"]");LoadingDialog.getInstance().hide()},setVisible:function(visible){this._super(visible);if(visible)this.refreshView()},refreshView:function(){if(PlayerMe.phoneNumber===""){this.phoneLayer.setVisible(false);this.sendSMSLayer.setVisible(true)}else{this.phoneLayer.setVisible(true);this.sendSMSLayer.setVisible(false)}}});
var UserinfoDialog=Dialog.extend({ctor:function(){this._super();LobbyClient.getInstance().addListener("verifyCode",this.onRecvVerifyCode,this);LobbyClient.getInstance().addListener("verifyCodeBySms",this.onRecvVerifyCode,this);var thiz=this;this.initWithSize(cc.size(918,538));this.title.setString("Th\u00f4ng tin c\u00e1 nh\u00e2n");this.okButton.visible=false;this.cancelButton.visible=false;var avatar=UserAvatar.createMe();avatar.setPosition(190,500);this.addChild(avatar,2);var avatarBt=new ccui.Widget;
avatarBt.setContentSize(avatar.getContentSize());avatarBt.setPosition(avatar.getPosition());avatarBt.setTouchEnabled(true);avatarBt.addClickEventListener(function(){var dialog=new AvatarDialog;dialog.show()});this.addChild(avatarBt);var displayName=PlayerMe.username;if(displayName.length>15)displayName=displayName.substring(0,15);var userLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_18,displayName);userLabel.setColor(cc.color("#63b0f1"));userLabel.setAnchorPoint(cc.p(0,.5));userLabel.setPosition(233,
avatar.y+12);this.addChild(userLabel,1);this.userLabel=userLabel;var goldLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,"100.000V");goldLabel.setColor(cc.color("#ffde00"));goldLabel.setAnchorPoint(cc.p(0,.5));goldLabel.setPosition(userLabel.x,avatar.y-12);this.addChild(goldLabel,1);this.goldLabel=goldLabel;var levelLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,"99");levelLabel.setColor(cc.color("#009cff"));levelLabel.setPosition(433,avatar.y);this.addChild(levelLabel,
1);this.levelLabel=levelLabel;var levelLabelBg=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_14,"Level");levelLabelBg.setColor(cc.color("#6a8fcc"));levelLabelBg.setPosition(levelLabel.x,levelLabel.y-34);this.addChild(levelLabelBg,1);var vipLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,"99");vipLabel.setColor(cc.color("#ffde00"));vipLabel.setPosition(493,avatar.y);this.addChild(vipLabel,1);this.vipLabel=vipLabel;var vipLabelBg=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_14,
"V.I.P");vipLabelBg.setColor(cc.color("#6a8fcc"));vipLabelBg.setPosition(vipLabel.x,vipLabel.y-34);this.addChild(vipLabelBg,1);var levelBar=new cc.ProgressTimer(new cc.Sprite("#userinfo-level-bar.png"));levelBar.setType(cc.ProgressTimer.TYPE_RADIAL);levelBar.setReverseDirection(true);levelBar._alwaysRefreshVertext=true;levelBar.setPosition(levelLabel.getPosition());levelBar.setPercentage(50);this.addChild(levelBar);this.levelBar=levelBar;var levelBarBg=new cc.Sprite("#userinfo-level-bg.png");levelBarBg.setPosition(levelBar.getContentSize().width/
2,levelBar.getContentSize().height/2);levelBar.addChild(levelBarBg,-1);var vipBar=new cc.ProgressTimer(new cc.Sprite("#userinfo-vip-bar.png"));vipBar.setType(cc.ProgressTimer.TYPE_RADIAL);vipBar.setReverseDirection(true);vipBar._alwaysRefreshVertext=true;vipBar.setPosition(vipLabel.getPosition());vipBar.setPercentage(50);this.addChild(vipBar);this.vipBar=vipBar;var vipBarBg=new cc.Sprite("#userinfo-level-bg.png");vipBarBg.setPosition(vipBar.getContentSize().width/2,vipBar.getContentSize().height/
2);vipBar.addChild(vipBarBg,-1);var logoutBt=new ccui.Button("userinfo-logout.png","","",ccui.Widget.PLIST_TEXTURE);logoutBt.setPosition(203,156);this.addChild(logoutBt);logoutBt.addClickEventListener(function(){SceneNavigator.toHome()});this.initAllLayer();this.refreshView()},initAllLayer:function(){var thiz=this;this.selectTab=0;var infoBg=new ccui.Scale9Sprite("userinfo-bg.png",cc.rect(12,12,4,4));infoBg.setPreferredSize(cc.size(420,400));infoBg.setPosition(769,338);this.addChild(infoBg);var allLayer=
[new UserInfoChangeLayer,new UserinfoPasswordLayer,new UserinfoVerifyLayer];for(var i=0;i<allLayer.length;i++){this.addChild(allLayer[i],1);allLayer[i].setVisible(false)}this.allLayer=allLayer;var img1=["#userinfo-tab1.png","#userinfo-tab2.png","#userinfo-tab3.png"];var img2=["#userinfo-tab4.png","#userinfo-tab5.png","#userinfo-tab6.png"];var x=370;var y=390;var dy=70;var mToggle=new ToggleNodeGroup;this.mToggle=mToggle;this.addChild(mToggle);for(var i=0;i<img1.length;i++)(function(){var icon1=new cc.Sprite(img1[i]);
icon1.setPosition(x,y-dy*i);thiz.addChild(icon1);var icon2=new cc.Sprite(img2[i]);icon2.setPosition(icon1.getPosition());thiz.addChild(icon2);var mNode=allLayer[i];var toggleItem=new ToggleNodeItem(icon1.getContentSize());toggleItem.setPosition(icon1.getPosition());mToggle.addItem(toggleItem);toggleItem.onSelect=function(){icon1.visible=false;icon2.visible=true;mNode.setVisible(true)};toggleItem.onUnSelect=function(){icon1.visible=true;icon2.visible=false;mNode.setVisible(false)}})()},refreshView:function(){this.goldLabel.setString(cc.Global.NumberFormat1(PlayerMe.gold)+
" V");var level=cc.Global.GetLevelMe();this.levelLabel.setString(level.level.toString());this.levelBar.setPercentage(level.expPer);var vip=cc.Global.GetVipMe();this.vipLabel.setString(vip.level.toString());this.vipBar.setPercentage(vip.expPer)},onRecvVerifyCode:function(messageName,data){if(data.status==0)if(PlayerMe.phoneNumber===""){this.subicon1.visible=true;this.subicon2.visible=true}else{this.subicon1.visible=false;this.subicon2.visible=false}},onEnter:function(){this._super();this.mToggle.selectItem(this.selectTab)},
onExit:function(){this._super();LobbyClient.getInstance().removeListener(this)}});var ContactDialog=Dialog.extend({ctor:function(){this._super();this.okButton.visible=false;this.cancelButton.visible=false;this.title.setString("Li\u00ean h\u1ec7");this.initWithSize(cc.size(478,278));this.showContactInfo()},setTitle:function(title){this.title.setString(title)},showContactInfo:function(){var contactDial=new ccui.Button("contactDial.png","","",ccui.Widget.PLIST_TEXTURE);contactDial.setPosition(this.width/2+63,189);this.addChild(contactDial);var contactFacebook=new ccui.Button("contactFacebook.png",
"","",ccui.Widget.PLIST_TEXTURE);contactFacebook.setPosition(this.width/2-63,contactDial.y);this.addChild(contactFacebook);var contactStr="Vui l\u00f2ng g\u1ecdi v\u00e0o hotline ho\u1eb7c nh\u1eafn tin qua fanpage Facebook \u0111\u1ec3 \u0111\u01b0\u1ee3c h\u1ed7 tr\u1ee3 tr\u1ef1c ti\u1ebfp";var contactLabel=new cc.LabelBMFont(contactStr,cc.res.font.Roboto_Condensed_18,440,cc.TEXT_ALIGNMENT_CENTER);contactLabel.setPosition(this.width/2,264);var dialLabel=new cc.LabelBMFont(GameConfig.hotline,cc.res.font.Roboto_Condensed_18);
dialLabel.setPosition(contactDial.x,contactDial.y-53);dialLabel.setColor(cc.color("#ffde00"));this.addChild(dialLabel);var facebookLabel=new cc.LabelBMFont("Nh\u1eafn tin",cc.res.font.Roboto_Condensed_18);facebookLabel.setPosition(contactFacebook.x,dialLabel.y);facebookLabel.setColor(cc.color("#ffde00"));this.addChild(facebookLabel);contactFacebook.addClickEventListener(function(){cc.Global.openURL(GameConfig.fanpage)});contactDial.addClickEventListener(function(){if(cc.sys.isNative)SystemPlugin.getInstance().showCallPhone(GameConfig.hotline)});
if(!cc.sys.isNative)contactDial.setEnabled(false);this.addChild(contactLabel)}});var UserListDialog=Dialog.extend({ctor:function(){this._super();this.okButton.visible=false;this.cancelButton.visible=false;this.title.setString("Danh s\u00e1ch ng\u01b0\u1eddi ch\u01a1i");this.initWithSize(cc.size(680,450));this.userSelected=[];var top=this.getContentSize().height-178;var bottom=98;var listItem=new newui.TableView(cc.size(680,top-bottom),2);listItem.setScrollBarEnabled(false);listItem.setMargin(20,20,0,0);listItem.setPadding(20);listItem.setAnchorPoint(cc.p(.5,.5));listItem.setPosition(this.getContentSize().width/
2,(top+bottom)/2);this.addChild(listItem);this.listItem=listItem;SmartfoxClient.getInstance().addListener(socket.SmartfoxClient.CallExtension,this.onSmartfoxExtension,this)},onSmartfoxExtension:function(event,data){if(this.recvData)return;if(data.c=="18"){var list=data["p"]["1"];for(var i=0;i<list.length;i++)this.addItem(list[i].avtUrl,list[i].u,parseInt(list[i]["1"]))}},onEnter:function(){this._super();var request={};this.recvData=false;SmartfoxClient.getInstance().sendExtensionRequestCurrentRoom("18",
request)},onExit:function(){this._super();SmartfoxClient.getInstance().removeListener(this)},addItem:function(avt,username,gold){var bg1=new ccui.Scale9Sprite("dialob-invite-bg1.png",cc.rect(14,14,4,4));bg1.setPreferredSize(cc.size(286,80));bg1.setPosition(bg1.getContentSize().width/2,bg1.getContentSize().height/2);bg1.visible=true;var container=new ccui.Widget;container.setContentSize(bg1.getContentSize());container.addChild(bg1);var avt=UserAvatar.createAvatarWithId(avt);avt.setScale(.7);avt.setPosition(40,
container.getContentSize().height/2);container.addChild(avt);if(username.length>3&&username!=PlayerMe.username)username=username.substring(0,username.length-3)+"***";var userLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_25,username,cc.TEXT_ALIGNMENT_LEFT);userLabel.setLineBreakWithoutSpace(true);userLabel.setDimensions(200,userLabel.getLineHeight());userLabel.setAnchorPoint(cc.p(0,.5));userLabel.setPosition(80,container.getContentSize().height/2+15);container.addChild(userLabel);
var goldLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_25,cc.Global.NumberFormat1(gold)+" V");goldLabel.setColor(cc.color("#ffde00"));goldLabel.setAnchorPoint(cc.p(0,.5));goldLabel.setPosition(userLabel.x,container.getContentSize().height/2-15);container.addChild(goldLabel);this.listItem.pushItem(container)}});var SMSPayDialog=Dialog.extend({ctor:function(){this._super();this.initWithSize(cc.size(660,360));this.title.setString("Ch\u1ecdn nh\u00e0 m\u1ea1ng");this.okButton.visible=false;this.cancelButton.visible=false;this.selectedTelCo={};this.bundleId=0;this.smsSyntax="";var thiz=this;var viettelBt=new ccui.Button("payment-card-viettel.png","","",ccui.Widget.PLIST_TEXTURE);viettelBt.setPosition(this.getContentSize().width/2-210,330);viettelBt.setZoomScale(.01);viettelBt.select=function(){viettelBt.setOpacity(255)};
viettelBt.deselect=function(){viettelBt.setOpacity(255*.4)};viettelBt.addClickEventListener(function(){thiz.selectTelCo(0)});this.addChild(viettelBt);this.viettelBt=viettelBt;viettelBt.deselect();var mobiBt=new ccui.Button("payment-card-mobi.png","","",ccui.Widget.PLIST_TEXTURE);mobiBt.setPosition(this.getContentSize().width/2,viettelBt.y);mobiBt.setZoomScale(.01);mobiBt.select=function(){mobiBt.setOpacity(255)};mobiBt.deselect=function(){mobiBt.setOpacity(255*.4)};mobiBt.addClickEventListener(function(){thiz.selectTelCo(1)});
this.addChild(mobiBt);mobiBt.deselect();this.mobiBt=mobiBt;var vinaBt=new ccui.Button("payment-card-vina.png","","",ccui.Widget.PLIST_TEXTURE);vinaBt.setPosition(this.getContentSize().width/2+210,viettelBt.y);vinaBt.setZoomScale(.01);vinaBt.select=function(){vinaBt.setOpacity(255)};vinaBt.deselect=function(){vinaBt.setOpacity(255*.4)};vinaBt.addClickEventListener(function(){thiz.selectTelCo(2)});this.addChild(vinaBt);vinaBt.deselect();this.vinaBt=vinaBt;var smsTitle=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,
"G\u1eedi tin nh\u1eafn");smsTitle.setPosition(this.getContentSize().width/2,270);this.addChild(smsTitle);var smsContent=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_20,"SMS Content");smsContent.setColor(cc.color("#ffde00"));smsContent.setPosition(this.getContentSize().width/2,240);this.addChild(smsContent);this.smsContent=smsContent;var smsGateway=cc.Global.SMSList[0].smsGateway;var smsPhoneNumber=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,"\u0110\u1ebfn \u0111\u1ea7u s\u1ed1 "+
smsGateway);smsPhoneNumber.setPosition(this.getContentSize().width/2,210);this.addChild(smsPhoneNumber);this.selectTelCo(0);if(cc.sys.isNative){var okButton=new ccui.Button("sublobby-button.png","","",ccui.Widget.PLIST_TEXTURE);okButton.setScale9Enabled(true);okButton.setCapInsets(cc.rect(10,10,4,4));okButton.setContentSize(cc.size(160,50));okButton.setTitleFontName(cc.res.font.Roboto_Condensed);okButton.setTitleFontSize(18);okButton.setTitleColor(cc.color("#682e2e"));okButton.setTitleText("N\u1ea0P");
okButton.setPosition(this.getContentSize().width/2,150);okButton.addClickEventListener(function(){thiz.okButtonHandler()});this.addChild(okButton)}},selectTelCo:function(telcoIndex){if(this.selectedTelCo instanceof ccui.Button)this.selectedTelCo.deselect();switch(telcoIndex){case 0:this.selectedTelCo=this.viettelBt;break;case 1:this.selectedTelCo=this.mobiBt;break;case 2:this.selectedTelCo=this.vinaBt;break}this.selectedTelCo.select();this.buildSMSSyntax(this.bundleId,telcoIndex)},buildSMSSyntax:function(index,
telco){var syntax="";switch(telco){case 0:syntax=cc.Global.SMSList[index].vttContent.replace("username",PlayerMe.username);break;case 1:syntax=cc.Global.SMSList[index].vmsContent.replace("username",PlayerMe.username);break;case 2:syntax=cc.Global.SMSList[index].vnpContent.replace("username",PlayerMe.username)}this.smsContent.setString(syntax)},okButtonHandler:function(){var smsContent=this.smsContent.getString();var smsGateway=cc.Global.SMSList[0].smsGateway;cc.log("sms: "+smsContent);SystemPlugin.getInstance().showSMS(smsGateway,
smsContent)}});var StatisticBoard=IDialog.extend({ctor:function(gameType){this._super();this.command=[];this.command[GameType.MiniGame_CaoThap]={getTop:"402",getExplosion:"403",getHistory:"401"};this.command[GameType.MiniGame_Poker]={getTop:"353",getExplosion:"354",getHistory:"352"};this.command[GameType.MiniGame_VideoPoker]={getTop:"258",getExplosion:"259",getHistory:"257"};this.gameType=gameType;this.rewards=[];this.caoThapResults=["Th\u1eafng","H\u00f2a","Thua","N\u1ed5 h\u0169"];this.initRewards();var board_bg=
new ccui.Scale9Sprite("board_bg.png",cc.rect(105,105,147,147));board_bg.setAnchorPoint(cc.p(0,0));this.addChild(board_bg);this.board_bg=board_bg;this.initWithSize(cc.size(1080,720));this.initRewardFundTable();this.initTopEarningTable();this.initPlayHistoryTable();this.initNavBar()},initRewards:function(){this.rewards.push("H\u0169 th\u01b0\u1edfng");this.rewards.push("Th\u00f9ng ph\u00e1 s\u1ea3nh");this.rewards.push("T\u1ee9 qu\u00fd");this.rewards.push("C\u00f9 l\u0169");this.rewards.push("Th\u00f9ng");
this.rewards.push("S\u1ea3nh");this.rewards.push("X\u00e1m c\u00f4");this.rewards.push("Hai \u0111\u00f4i");this.rewards.push("\u0110\u00f4i")},initWithSize:function(mSize){this.board_bg.setPreferredSize(cc.size(mSize.width,mSize.height));this.setContentSize(this.board_bg.getContentSize());this.mTouch=cc.rect(98,98,mSize.width-196,mSize.height-196);this.rewardFundTableLayout=this.initClippingTable(mSize,true);this.topEarningTableLayout=this.initClippingTable(mSize,false);this.historyTableLayout=this.initClippingTable(mSize,
false)},onSFSExtension:function(messageType,content){switch(content.c){case "100002":this.addTopPlayersData(content.p.data["1"]);break;case "100001":this.addExplosionHistoryData(content.p.data["1"]);break;case "100003":this.addHistoryData(content.p.data["1"])}},onEnter:function(){this._super();SmartfoxClient.getInstance().addListener(socket.SmartfoxClient.CallExtension,this.onSFSExtension,this);SmartfoxClient.getInstance().sendExtensionRequest(-1,this.command[this.gameType]["getTop"],null);SmartfoxClient.getInstance().sendExtensionRequest(-1,
this.command[this.gameType]["getExplosion"],null);SmartfoxClient.getInstance().sendExtensionRequest(-1,this.command[this.gameType]["getHistory"],null)},onExit:function(){this._super();SmartfoxClient.getInstance().removeListener(this)},addTopPlayersData:function(data){for(var i=0;i<data.length;i++)this.addTopEarningEntry(i+1,data[i]["1"],data[i]["2"])},addExplosionHistoryData:function(data){for(var i=0;i<data.length;i++)this.addRewardFundEntry(data[i]["1"],data[i]["2"],data[i]["3"],data[i]["4"])},
addHistoryData:function(data){for(var i=0;i<data.length;i++)this.addHistoryEntry(data[i]["2"],data[i]["3"],data[i]["4"],data[i]["5"])},initRewardFundTable:function(){var thoigianLabel=this.rewardFundTableLayout.createLabel("Th\u1eddi gian",40,385);this.rewardFundTableLayout.addChild(thoigianLabel);var muccuocLabel=this.rewardFundTableLayout.createLabel("M\u1ee9c c\u01b0\u1ee3c",320,385);this.rewardFundTableLayout.addChild(muccuocLabel);var taikhoanLabel=this.rewardFundTableLayout.createLabel("T\u00e0i kho\u1ea3n",
500,385);this.rewardFundTableLayout.addChild(taikhoanLabel);var tienLabel=this.rewardFundTableLayout.createLabel("Ti\u1ec1n",690,385);this.rewardFundTableLayout.addChild(tienLabel);var statisticList=new newui.TableView(cc.size(800,370),1);statisticList.setDirection(ccui.ScrollView.DIR_VERTICAL);statisticList.setScrollBarEnabled(false);statisticList.setPadding(10);statisticList.setMargin(10,10,0,0);statisticList.setAnchorPoint(0,0);statisticList.setPosition(25,0);this.rewardFundTableLayout.addChild(statisticList);
this.rewardFundTableLayout.statisticList=statisticList},initTopEarningTable:function(){var sttLabel=this.topEarningTableLayout.createLabel("STT",40,385);this.topEarningTableLayout.addChild(sttLabel);var taikhoanLabel=this.topEarningTableLayout.createLabel("T\u00e0i kho\u1ea3n",360,385);this.topEarningTableLayout.addChild(taikhoanLabel);var tienLabel=this.topEarningTableLayout.createLabel("Ti\u1ec1n",610,385);this.topEarningTableLayout.addChild(tienLabel);var statisticList=new newui.TableView(cc.size(800,
370),1);statisticList.setDirection(ccui.ScrollView.DIR_VERTICAL);statisticList.setScrollBarEnabled(false);statisticList.setPadding(10);statisticList.setMargin(10,10,0,0);statisticList.setAnchorPoint(0,0);statisticList.setPosition(25,0);this.topEarningTableLayout.addChild(statisticList);this.topEarningTableLayout.statisticList=statisticList},initPlayHistoryTable:function(){var thoigianLabel=this.historyTableLayout.createLabel("Th\u1eddi gian",40,385);this.historyTableLayout.addChild(thoigianLabel);
var bobaiLabel=this.historyTableLayout.createLabel("B\u1ed9 b\u00e0i",295,385);this.historyTableLayout.addChild(bobaiLabel);var tenbaiLabel=this.historyTableLayout.createLabel("T\u00ean b\u00e0i",510,385);this.historyTableLayout.addChild(tenbaiLabel);var tienanduocLabel=this.historyTableLayout.createLabel("Ti\u1ec1n \u0103n \u0111\u01b0\u1ee3c",695,385);this.historyTableLayout.addChild(tienanduocLabel);var statisticList=new newui.TableView(cc.size(800,370),1);statisticList.setDirection(ccui.ScrollView.DIR_VERTICAL);
statisticList.setScrollBarEnabled(false);statisticList.setPadding(10);statisticList.setMargin(10,10,0,0);statisticList.setAnchorPoint(0,0);statisticList.setPosition(25,0);this.historyTableLayout.addChild(statisticList);this.historyTableLayout.statisticList=statisticList},initNavBar:function(){var thiz=this;var navBorder=new cc.Sprite("#nav_statistic_board.png");navBorder.setAnchorPoint(.5,0);navBorder.setPosition(this.width/2,104);this.addChild(navBorder);this.rewardFundBtn=new ccui.Button("nav_huthuong_active.png",
"","",ccui.Widget.PLIST_TEXTURE);this.rewardFundBtn.setAnchorPoint(.5,0);this.rewardFundBtn.setPosition(this.width/2-230,100);this.rewardFundBtn.navIndex=1;this.rewardFundBtn.selected=function(){this.loadTextureNormal("nav_huthuong_active.png",ccui.Widget.PLIST_TEXTURE);thiz.rewardFundTableLayout.visible=true;this.setPositionY(100)};this.rewardFundBtn.deselected=function(){this.loadTextureNormal("nav_huthuong_inactive.png",ccui.Widget.PLIST_TEXTURE);thiz.rewardFundTableLayout.visible=false;this.setPositionY(129)};
this.topEarningBtn=new ccui.Button("nav_caothu_inactive.png","","",ccui.Widget.PLIST_TEXTURE);this.topEarningBtn.setAnchorPoint(.5,0);this.topEarningBtn.setPosition(this.width/2,129);this.topEarningBtn.navIndex=2;this.topEarningBtn.selected=function(){this.loadTextureNormal("nav_caothu_active.png",ccui.Widget.PLIST_TEXTURE);thiz.topEarningTableLayout.visible=true;this.setPositionY(100)};this.topEarningBtn.deselected=function(){this.loadTextureNormal("nav_caothu_inactive.png",ccui.Widget.PLIST_TEXTURE);
thiz.topEarningTableLayout.visible=false;this.setPositionY(129)};this.historyBtn=new ccui.Button("nav_lichsu_inactive.png","","",ccui.Widget.PLIST_TEXTURE);this.historyBtn.setAnchorPoint(.5,0);this.historyBtn.setPosition(this.width/2+230,129);this.historyBtn.navIndex=3;this.historyBtn.selected=function(){this.loadTextureNormal("nav_lichsu_active.png",ccui.Widget.PLIST_TEXTURE);thiz.historyTableLayout.visible=true;this.setPositionY(100)};this.historyBtn.deselected=function(){this.loadTextureNormal("nav_lichsu_inactive.png",
ccui.Widget.PLIST_TEXTURE);thiz.historyTableLayout.visible=false;this.setPositionY(129)};this.addChild(this.rewardFundBtn);this.addChild(this.topEarningBtn);this.addChild(this.historyBtn);this.navBtnSelected=this.rewardFundBtn;this.rewardFundBtn.addClickEventListener(function(){thiz.selectNav(this)});this.topEarningBtn.addClickEventListener(function(){thiz.selectNav(this)});this.historyBtn.addClickEventListener(function(){thiz.selectNav(this)})},selectNav:function(btnSelect){this.navBtnSelected.deselected();
btnSelect.selected();this.navBtnSelected=btnSelect;this.onNavBtnSelected(btnSelect.navIndex)},onNavBtnSelected:function(navIndex){},initClippingTable:function(mSize,isVisible){var tableLayout=new ccui.Layout;tableLayout.setContentSize(cc.size(this.mTouch.width-20,this.mTouch.height-110));tableLayout.setAnchorPoint(0,0);tableLayout.setPosition(110,200);tableLayout.setClippingEnabled(true);tableLayout.setClippingType(ccui.Layout.CLIPPING_SCISSOR);tableLayout.visible=isVisible;this.addChild(tableLayout);
tableLayout.createLabel=function(str,posX,posY){var returnLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_25,str,cc.TEXT_ALIGNMENT_LEFT);returnLabel.setScale(.7);returnLabel.setColor(cc.color("#8ba1bc"));returnLabel.setAnchorPoint(0,.5);returnLabel.setPosition(posX,posY);return returnLabel};return tableLayout},adjustlel:function(){},addRewardFundEntry:function(time,betAmount,account,reward){var container=new ccui.Widget;container.setContentSize(cc.size(this.rewardFundTableLayout.statisticList.getContentSize().width,
60));this.rewardFundTableLayout.statisticList.pushItem(container);var bg1=new ccui.Scale9Sprite("sublobby-cell-bg.png",cc.rect(10,0,4,78));bg1.setPreferredSize(cc.size(280*cc.winSize.screenScale,60));bg1.setPosition(140*cc.winSize.screenScale,bg1.getContentSize().height/2);container.addChild(bg1);var bg2=new ccui.Scale9Sprite("sublobby-cell-bg.png",cc.rect(10,0,4,78));bg2.setPreferredSize(cc.size(180*cc.winSize.screenScale,60));bg2.setPosition(370*cc.winSize.screenScale,bg1.y);container.addChild(bg2);
var bg3=new ccui.Scale9Sprite("sublobby-cell-bg.png",cc.rect(10,0,4,78));bg3.setPreferredSize(cc.size(180*cc.winSize.screenScale,60));bg3.setPosition(550*cc.winSize.screenScale,bg1.y);container.addChild(bg3);var bg4=new ccui.Scale9Sprite("sublobby-cell-bg.png",cc.rect(10,0,4,78));bg4.setPreferredSize(cc.size(150*cc.winSize.screenScale,60));bg4.setPosition(715*cc.winSize.screenScale,bg1.y);container.addChild(bg4);var timeLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_25,time);timeLabel.setPosition(bg1.getPosition());
container.addChild(timeLabel);var betAmountLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_25,betAmount);betAmountLabel.setPosition(bg2.getPosition());betAmountLabel.setColor(cc.color("#ffde00"));container.addChild(betAmountLabel);if(account.length>3&&account!=PlayerMe.username)account=account.substring(0,account.length-3)+"***";var accountLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_25,account);accountLabel.setPosition(bg3.getPosition());container.addChild(accountLabel);
var rewardLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_25,reward);rewardLabel.setPosition(bg4.getPosition());rewardLabel.setColor(cc.color("#ffde00"));container.addChild(rewardLabel);container.setTouchEnabled(true);container.addClickEventListener(function(){var dialog=new MessageDialog;dialog.title.setString("An tien");dialog.setMessage(reward);dialog.showWithAnimationScale()})},addTopEarningEntry:function(order,account,reward){var container=new ccui.Widget;container.setContentSize(cc.size(this.rewardFundTableLayout.statisticList.getContentSize().width,
60));this.topEarningTableLayout.statisticList.pushItem(container);var bg1=new ccui.Scale9Sprite("sublobby-cell-bg.png",cc.rect(10,0,4,78));bg1.setPreferredSize(cc.size(320*cc.winSize.screenScale,60));bg1.setPosition(160*cc.winSize.screenScale,bg1.getContentSize().height/2);container.addChild(bg1);var bg2=new ccui.Scale9Sprite("sublobby-cell-bg.png",cc.rect(10,0,4,78));bg2.setPreferredSize(cc.size(250*cc.winSize.screenScale,60));bg2.setPosition(445*cc.winSize.screenScale,bg1.y);container.addChild(bg2);
var bg3=new ccui.Scale9Sprite("sublobby-cell-bg.png",cc.rect(10,0,4,78));bg3.setPreferredSize(cc.size(230*cc.winSize.screenScale,60));bg3.setPosition(685*cc.winSize.screenScale,bg1.y);container.addChild(bg3);var orderLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_25,""+order);orderLabel.setPosition(bg1.getPosition());container.addChild(orderLabel);if(account.length>3&&account!=PlayerMe.username)account=account.substring(0,account.length-3)+"***";var accountLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_25,
""+account);accountLabel.setPosition(bg2.getPosition());container.addChild(accountLabel);var rewardLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_25,""+reward);rewardLabel.setPosition(bg3.getPosition());rewardLabel.setColor(cc.color("#ffde00"));container.addChild(rewardLabel);container.setTouchEnabled(true);container.addClickEventListener(function(){var dialog=new MessageDialog;dialog.title.setString("An tien");dialog.setMessage(reward);dialog.showWithAnimationScale()})},addHistoryEntry:function(time,
deck,rewardName,reward){var container=new ccui.Widget;container.setContentSize(cc.size(this.rewardFundTableLayout.statisticList.getContentSize().width,60));this.historyTableLayout.statisticList.pushItem(container);var bg1=new ccui.Scale9Sprite("sublobby-cell-bg.png",cc.rect(10,0,4,78));bg1.setPreferredSize(cc.size(255*cc.winSize.screenScale,60));bg1.setPosition(127.5*cc.winSize.screenScale,bg1.getContentSize().height/2);container.addChild(bg1);var bg2=new ccui.Scale9Sprite("sublobby-cell-bg.png",
cc.rect(10,0,4,78));bg2.setPreferredSize(cc.size(215*cc.winSize.screenScale,60));bg2.setPosition(362.5*cc.winSize.screenScale,bg1.y);container.addChild(bg2);var bg3=new ccui.Scale9Sprite("sublobby-cell-bg.png",cc.rect(10,0,4,78));bg3.setPreferredSize(cc.size(185*cc.winSize.screenScale,60));bg3.setPosition(562.5*cc.winSize.screenScale,bg1.y);container.addChild(bg3);var bg4=new ccui.Scale9Sprite("sublobby-cell-bg.png",cc.rect(10,0,4,78));bg4.setPreferredSize(cc.size(145*cc.winSize.screenScale,60));
bg4.setPosition(727.5*cc.winSize.screenScale,bg1.y);container.addChild(bg4);var timeLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_25,time);timeLabel.setPosition(bg1.getPosition());container.addChild(timeLabel);if(this.gameType==GameType.MiniGame_Poker||this.gameType==GameType.MiniGame_VideoPoker)if(rewardName>=9)rewardName="KH\u00d4NG \u0102N";else rewardName=this.rewards[rewardName];else if(this.gameType==GameType.MiniGame_CaoThap)rewardName=this.caoThapResults[rewardName];var rewardNameLabel=
cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_25,rewardName);rewardNameLabel.setPosition(bg3.getPosition());container.addChild(rewardNameLabel);var rewardLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_25,reward);rewardLabel.setPosition(bg4.getPosition());rewardLabel.setColor(cc.color("#ffde00"));container.addChild(rewardLabel);var suitArray=[2,3,0,1];var baseX=bg2.getPositionX()-80*cc.winSize.screenScale;var baseY=bg2.getPositionY();for(var i=0;i<deck.length;i++){var rank=(deck[i]+
1)%13+1;var suit=suitArray[Math.floor(deck[i]/13)];var cardSprite=new cc.Sprite("#"+rank+s_card_suit[suit]+".png");cardSprite.setScale(.3);cardSprite.setPosition(baseX+i*32*cc.winSize.screenScale,baseY);container.addChild(cardSprite)}container.setTouchEnabled(true);container.addClickEventListener(function(){var dialog=new MessageDialog;dialog.title.setString("An tien");dialog.setMessage(reward);dialog.showWithAnimationScale()})}});var TutorialDialog=IDialog.extend({ctor:function(gameType){this._super();this.bouldingWidth=800;var board_bg=new ccui.Scale9Sprite("board_bg.png",cc.rect(105,105,147,147));board_bg.setAnchorPoint(cc.p(0,0));this.addChild(board_bg);this.board_bg=board_bg;this.initWithSize(cc.size(1080,720));var title=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_30,"H\u01af\u1edaNG D\u1eaaN CH\u01a0I");title.setPosition(this.getContentSize().width/2,this.getContentSize().height-138);title.setColor(cc.color("#ffde00"));
this.addChild(title);var contentTable=new newui.TableView(cc.size(this.bouldingWidth,470),1);contentTable.setDirection(ccui.ScrollView.DIR_VERTICAL);contentTable.setScrollBarEnabled(false);contentTable.setPadding(0);contentTable.setMargin(10,10,0,0);contentTable.setAnchorPoint(cc.p(.5,.5));contentTable.setPosition(this.getContentSize().width/2,this.getContentSize().height/2-25);this.addChild(contentTable);this.contentTable=contentTable;if(cc.sys.isNative)this.HDList=jsb.fileUtils.getValueMapFromFile("res/data/HDList.plist");
else this.HDList=cc.loader.getRes("res/data/HDList.plist");switch(gameType){case GameType.MiniGame_CaoThap:this.initCaoThapTutorial();break;case GameType.MiniGame_Poker:this.initMiniPokerTutorial();break;case GameType.MiniGame_VideoPoker:this.initVideoPokerTutorial();break;case GameType.MiniGame_ChanLe:this.initChanLeTutorial();break}},initWithSize:function(mSize){this.board_bg.setPreferredSize(cc.size(mSize.width,mSize.height));this.setContentSize(this.board_bg.getContentSize())},initCaoThapTutorial:function(){var tutorialLabel=
cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_25,this.HDList["CaoThap"]);tutorialLabel.setBoundingWidth(this.bouldingWidth);this.contentTable.pushItem(tutorialLabel)},initMiniPokerTutorial:function(){this.initPokerTutorial("MiniPoker")},initVideoPokerTutorial:function(){this.initPokerTutorial("VideoPoker")},initChanLeTutorial:function(){var tutorialLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_25,this.HDList["MINITAIXIU"]);var icon1=new cc.Sprite("#mntx_btn_bxh.png");icon1.setScale(.7);
icon1.setPosition(570,83);this.contentTable.addChild(icon1);var icon2=new cc.Sprite("#caothap_historyBt.png");icon2.setScale(.7);icon2.setPosition(620,83);this.contentTable.addChild(icon2);tutorialLabel.setBoundingWidth(this.bouldingWidth);this.contentTable.pushItem(tutorialLabel)},initPokerTutorial:function(dataField){var miniLabel1=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_25,this.HDList[dataField]["text1"],cc.TEXT_ALIGNMENT_LEFT);miniLabel1.setBoundingWidth(this.bouldingWidth);this.contentTable.pushItem(miniLabel1);
for(var i=0;i<this.HDList[dataField]["Result"].length;i++){var container=new ccui.Widget;var contentSize=cc.size(this.contentTable.getContentSize().width,60);container.setContentSize(contentSize);var data=this.HDList[dataField]["Result"][i];var rowBg=new cc.LayerColor(cc.color(74,142,211,i%2?128:255),contentSize.width,contentSize.height);container.addChild(rowBg);var titleLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_25,data["Title"]);titleLabel.setPosition(i==0?contentSize.width/4:
contentSize.width/8,contentSize.height/2);container.addChild(titleLabel,1);if(i!=0){var cardList=new CardList(cc.size(contentSize.width/4,contentSize.height-20));cardList.setPosition(contentSize.width*3/8,contentSize.height/2);var cards=data["cards"];cards=cards.split(",");for(var j=0;j<cards.length;j++){var cardObj=cardList.getCardWithId(parseInt(cards[j]));cardList.addCard(new Card(cardObj.rank,cardObj.suit))}cardList.reOrderWithoutAnimation();container.addChild(cardList)}var rewardLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_25,
data["Reward"]);rewardLabel.setPosition(contentSize.width*3/4,contentSize.height/2);container.addChild(rewardLabel);this.contentTable.pushItem(container)}var miniLabel2=new cc.LabelBMFont(this.HDList[dataField]["text2"],cc.res.font.Roboto_Condensed_25,this.bouldingWidth,cc.TEXT_ALIGNMENT_LEFT);this.contentTable.pushItem(miniLabel2)}});var s_MiniPockerTutorialDialog=null;var s_VideoPockerTutorialDialog=null;var s_CaoThapTutorialDialog=null;var s_ChanLeTutorialDialog=null;
TutorialDialog.getTutorial=function(gameType){switch(gameType){case GameType.MiniGame_CaoThap:if(!s_CaoThapTutorialDialog){s_CaoThapTutorialDialog=new TutorialDialog(gameType);s_CaoThapTutorialDialog.retain()}return s_CaoThapTutorialDialog;break;case GameType.MiniGame_Poker:if(!s_MiniPockerTutorialDialog){s_MiniPockerTutorialDialog=new TutorialDialog(gameType);s_MiniPockerTutorialDialog.retain()}return s_MiniPockerTutorialDialog;break;case GameType.MiniGame_VideoPoker:if(!s_VideoPockerTutorialDialog){s_VideoPockerTutorialDialog=
new TutorialDialog(gameType);s_VideoPockerTutorialDialog.retain()}return s_VideoPockerTutorialDialog;break;case GameType.MiniGame_ChanLe:if(!s_ChanLeTutorialDialog){s_ChanLeTutorialDialog=new TutorialDialog(gameType);s_ChanLeTutorialDialog.retain()}return s_ChanLeTutorialDialog;break}};var AvatarDialog=IDialog.extend({ctor:function(){this._super();this.setContentSize(cc.size(470,460));this.setAnchorPoint(cc.p(.5,.5));this.mTouch=cc.rect(0,0,470,460);this._bgColor=cc.color(0,0,0,0);var bg=new ccui.Scale9Sprite("inventory_AvatarDialog_bg.png",cc.rect(20,20,4,4));bg.setPreferredSize(cc.size(470,460));bg.setAnchorPoint(cc.p(0,0));this.addChild(bg);var listItem=new newui.TableView(cc.size(450,430),4);listItem.setPosition(cc.p(10,15));listItem.setMargin(20,20,0,0);listItem.setPadding(10);
this.addChild(listItem);this.listItem=listItem;for(var i=0;i<30;i++)this.addItem("","")},addItem:function(iconUrl,itemId){var thiz=this;var container=new ccui.Widget;container.setContentSize(cc.size(100,100));this.listItem.pushItem(container);var bg=new ccui.Scale9Sprite("shop_item_bg.png",cc.rect(20,20,4,4));bg.setPreferredSize(container.getContentSize());bg.setPosition(container.getContentSize().width/2,container.getContentSize().height/2);container.addChild(bg);var icon=new InventoryItemIcon;icon.loadFromUrl(iconUrl);
icon.setPosition(bg.getPosition());container.addChild(icon);container.setTouchEnabled(true);container.addClickEventListener(function(){var request={command:"activeAvatar",userItemId:itemId,status:0};LobbyClient.getInstance().send(request);container.setVisible(false)})},onFetchAvatar:function(cmd,data){this.listItem.removeAllItems();var userItems=data["data"]["userItems"];for(var i=0;i<userItems.length;i++){var type=userItems[i]["type"];if(type==2){var idItem=userItems[i]["userItemId"];var avt=userItems[i]["avatar"];
this.addItem(avt,idItem)}}},onEnter:function(){this._super();LobbyClient.getInstance().addListener("fetchAvatar",this.onFetchAvatar,this);var request={command:"fetchAvatar"};LobbyClient.getInstance().send(request)},onExit:function(){this._super();LobbyClient.getInstance().removeListener(this)}});var s_transferGoldToggle=s_transferGoldToggle||["Ng\u01b0\u1eddi g\u1eedi ch\u1ecbu ph\u00ed","Ng\u01b0\u1eddi nh\u1eadn ch\u1ecbu ph\u00ed"];
var TransferGoldTutorial=MessageDialog.extend({setMessage:function(message){this.scrollView.removeAllItems();var messageLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_25,message,cc.TEXT_ALIGNMENT_LEFT,this.scrollView.getContentSize().width-10);var height=messageLabel.getContentSize().height+20;if(height<=this.scrollView.getContentSize().height){height=this.scrollView.getContentSize().height;this.scrollView.setEnabled(false)}else{this.scrollView.setEnabled(true);this.scrollHeight=height-
this.scrollView.getContentSize().height;this.startAutoScroll(4)}var container=new ccui.Widget;container.setContentSize(cc.size(this.scrollView.getContentSize().width-10,height));container.addChild(messageLabel);messageLabel.setPosition(container.getContentSize().width/2,container.getContentSize().height/2);this.scrollView.pushBackCustomItem(container)}});
var TransferGoldDialog=Dialog.extend({ctor:function(){this._super();this.okButton.visible=false;this.cancelButton.visible=false;this.title.setString("Chuy\u1ec3n v\u00e0ng");this.initWithSize(cc.size(578,518));this._initView()},_initView:function(){var thiz=this;var bg1=new ccui.Scale9Sprite("dialog-textinput-bg.png",cc.rect(10,10,4,4));bg1.setPreferredSize(cc.size(280,44));bg1.setPosition(this.getContentSize().width/2,489);this.addChild(bg1);var bg2=new ccui.Scale9Sprite("dialog-textinput-bg.png",
cc.rect(10,10,4,4));bg2.setPreferredSize(cc.size(280,44));bg2.setPosition(this.getContentSize().width/2,419);this.addChild(bg2);var recvUser=new newui.TextField(cc.size(262,44),cc.res.font.Roboto_Condensed_18);recvUser.setPlaceHolder("Ng\u01b0\u1eddi nh\u1eadn");recvUser.setPlaceHolderColor(cc.color("#787878"));recvUser.setTextColor(cc.color("#c4e1ff"));recvUser.setPosition(bg1.getPosition());this.addChild(recvUser,1);this.recvUser=recvUser;var goldTransfer=new newui.TextField(cc.size(262,44),cc.res.font.Roboto_Condensed_18);
goldTransfer.setPlaceHolder("S\u1ed1 ti\u1ec1n chuy\u1ec3n");goldTransfer.setPlaceHolderColor(cc.color("#787878"));goldTransfer.setTextColor(cc.color("#fede01"));goldTransfer.setPosition(bg2.getPosition());this.addChild(goldTransfer,1);this.goldTransfer=goldTransfer;var userCorrectIcon=new cc.Sprite("#dialog_correct.png");userCorrectIcon.setPosition(recvUser.x+120,recvUser.y);this.addChild(userCorrectIcon);userCorrectIcon.visible=false;this.userCorrectIcon=userCorrectIcon;var goldCorrectIcon=new cc.Sprite("#dialog_correct.png");
goldCorrectIcon.setPosition(goldTransfer.x+120,goldTransfer.y);this.addChild(goldCorrectIcon);goldCorrectIcon.visible=false;this.goldCorrectIcon=goldCorrectIcon;var label1=new ccui.RichText;label1.pushBackElement(new ccui.RichElementText(0,cc.color("#ffffff"),255,"C\u00f2n l\u1ea1i ",cc.res.font.Roboto_Condensed,18));label1.pushBackElement(new ccui.RichElementText(1,cc.color("#ffde00"),255,"100,000 V",cc.res.font.Roboto_CondensedBold,18));label1.setPosition(cc.p(bg1.x,360));this.addChild(label1,1);
this.label1=label1;var label2=new ccui.RichText;label2.pushBackElement(new ccui.RichElementText(0,cc.color("#77cbee"),255,"Name ",cc.res.font.Roboto_CondensedBold,18));label2.pushBackElement(new ccui.RichElementText(1,cc.color("#ffffff"),255,"Nh\u1eadn ",cc.res.font.Roboto_Condensed,18));label2.pushBackElement(new ccui.RichElementText(2,cc.color("#ffde00"),255,"100,000 V",cc.res.font.Roboto_CondensedBold,18));label2.setPosition(cc.p(bg1.x,330));this.addChild(label2,1);this.label2=label2;var mToggle=
new ToggleNodeGroup;this.addChild(mToggle);this.mToggle=mToggle;for(var i=0;i<s_transferGoldToggle.length;i++)(function(){var icon1=new cc.Sprite("#dialog_toggle_1.png");icon1.setPosition(219+188*i,291);thiz.addChild(icon1);var icon2=new cc.Sprite("#dialog_toggle_2.png");icon2.setPosition(icon1.getPosition());thiz.addChild(icon2);var label=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,s_transferGoldToggle[i]);label.setColor(cc.color("#72acd6"));label.setAnchorPoint(cc.p(0,.5));label.setPosition(icon1.x+
17,icon1.y);thiz.addChild(label,1);var toggleItem=new ToggleNodeItem(icon1.getContentSize());toggleItem.feeType=i+1;toggleItem.setPosition(icon2.getPosition());mToggle.addItem(toggleItem);toggleItem.onSelect=function(){icon2.visible=true;thiz._updateGold()};toggleItem.onUnSelect=function(){icon2.visible=false}})();var okButton=new ccui.Button("dialog-button-1.png","","",ccui.Widget.PLIST_TEXTURE);okButton.setScale9Enabled(true);okButton.setCapInsets(cc.rect(10,10,4,4));okButton.setContentSize(cc.size(280,
44));okButton.setZoomScale(.01);okButton.setPosition(this.getContentSize().width/2,209);this.addChild(okButton);okButton.addClickEventListener(function(){thiz._onOkButtonHandler()});var okLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,"CHUY\u1ec2N V\u00c0NG");okLabel.setColor(cc.color("#682e2e"));okLabel.setPosition(okButton.getContentSize().width/2,okButton.getContentSize().height/2);okButton.getRendererNormal().addChild(okLabel);var padding=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,
"|");padding.setColor(cc.color("#72acd6"));padding.setPosition(this.getContentSize().width/2,132);this.addChild(padding,1);var historyLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,"L\u1ecaCH S\u1eec");historyLabel.setColor(cc.color("#72acd6"));historyLabel.setPosition(this.getContentSize().width/2-10-historyLabel.getContentSize().width/2,padding.y);this.addChild(historyLabel,1);var tutorialLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,"H\u01af\u1edaNG D\u1eaaN");
tutorialLabel.setColor(cc.color("#72acd6"));tutorialLabel.setPosition(this.getContentSize().width/2+10+tutorialLabel.getContentSize().width/2,padding.y);this.addChild(tutorialLabel,1);var historyBt=new WidgetButton(historyLabel.getContentSize());historyBt.setPosition(historyLabel.getPosition());this.addChild(historyBt);historyBt.addClickEventListener(function(){var dialog=new TransferGoldHistory;dialog.show()});var tutorialBt=new WidgetButton(tutorialLabel.getContentSize());tutorialBt.setPosition(tutorialLabel.getPosition());
this.addChild(tutorialBt);tutorialBt.addClickEventListener(function(){var dialog=new TransferGoldTutorial;dialog.setTitle("H\u01b0\u1edbng d\u1eabn chuy\u1ec3n v\u00e0ng");dialog.setMessage(cc.Global.getStringRes()["TransferGold"]["Tutorial"]);dialog.show()});recvUser.setFocusListener(function(focus){if(focus)userCorrectIcon.visible=false;else thiz._updateName()});goldTransfer.setFocusListener(function(focus){if(focus)goldCorrectIcon.visible=false;else thiz._updateGold()});goldTransfer.setTextChangeListener(function(type,
newString){if(newString==="")goldTransfer.setText(newString);else{var str=newString.replace(/[.,]/g,"");if(cc.Global.IsNumber(str)){var goldInput=parseInt(str);if(goldInput>PlayerMe.gold)goldInput=PlayerMe.gold;goldTransfer.setText(cc.Global.NumberFormat1(goldInput))}}thiz._updateGold();return true})},onCheckUsername:function(cmd,data){var status=data["status"];this.userCorrectIcon.setVisible(true);if(status===0)this.userCorrectIcon.setSpriteFrame("dialog_correct.png");else this.userCorrectIcon.setSpriteFrame("dialog_incorrect.png")},
_updateName:function(){var userName=this.recvUser.getText();this.label2.removeElement(0);this.label2.insertElement(new ccui.RichElementText(0,cc.color("#77cbee"),255,userName+" ",cc.res.font.Roboto_CondensedBold,18),0);if(userName!=""){var request={command:"checkUserExist",username:userName};LobbyClient.getInstance().send(request)}},_updateGold:function(){var goldStr=this.goldTransfer.getText();if(this.mToggle.itemClicked.feeType===1){var sendFeeRate=PlayerMe.transferGoldFee;var recvFeeRate=0}else{var sendFeeRate=
0;var recvFeeRate=PlayerMe.transferGoldFee}var gold=0;this.goldCorrectIcon.setSpriteFrame("dialog_incorrect.png");if(goldStr==="")this.goldCorrectIcon.visible=false;else{this.goldCorrectIcon.visible=true;var goldInput=cc.Global.NumberFromString(goldStr);if(!gold){gold=goldInput;this.goldCorrectIcon.setSpriteFrame("dialog_correct.png")}}var sendFee=Math.round(gold*sendFeeRate);var currentGold=PlayerMe.gold-gold-sendFee;gold-=Math.round(gold*recvFeeRate);if(currentGold<PlayerMe.transferGoldMinAsset)gold=
0;else if(gold<PlayerMe.transferGoldMinValue)gold=0;if(gold===0){this.goldCorrectIcon.setSpriteFrame("dialog_incorrect.png");currentGold=PlayerMe.gold}this.label1.removeElement(1);this.label1.insertElement(new ccui.RichElementText(1,cc.color("#ffde00"),255,cc.Global.NumberFormat1(currentGold)+" V",cc.res.font.Roboto_CondensedBold,18),1);this.label2.removeElement(2);this.label2.insertElement(new ccui.RichElementText(2,cc.color("#ffde00"),255,cc.Global.NumberFormat1(gold)+" V",cc.res.font.Roboto_CondensedBold,
18),2)},_onOkButtonHandler:function(){var recvName=this.recvUser.getText();if(recvName===""){MessageNode.getInstance().show("Vui l\u00f2ng nh\u1eadp t\u00ean ng\u01b0\u1eddi nh\u1eadn");return}var goldStr=this.goldTransfer.getText();if(goldStr===""){MessageNode.getInstance().show("Vui l\u00f2ng nh\u1eadp s\u1ed1 ti\u1ec1n chuy\u1ec3n");return}if(!cc.Global.IsNumber(goldStr)){MessageNode.getInstance().show("S\u1ed1 ti\u1ec1n nh\u1eadp kh\u00f4ng \u0111\u00fang");return}var request={command:"transferGold",
toUsername:recvName,value:parseInt(goldStr),feeOnSender:this.mToggle.itemClicked.feeType===1};LobbyClient.getInstance().send(request)},onTransferGold:function(cmd,data){var status=data["status"];if(status===0)this.hide()},onEnter:function(){this._super();LobbyClient.getInstance().addListener("checkUserExist",this.onCheckUsername,this);LobbyClient.getInstance().addListener("transferGold",this.onTransferGold,this);this.mToggle.selectItem(0);this._updateName();this._updateGold()},onExit:function(){this._super();
LobbyClient.getInstance().removeListener(this)}});var TransferGoldHistory=Dialog.extend({ctor:function(){this._super();this.okButton.visible=false;this.cancelButton.visible=false;this.title.setString("L\u1ecbch s\u1eed chuy\u1ec3n v\u00e0ng");this.initWithSize(cc.size(858,458));this._initView()},_initView:function(){var timeLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,"Th\u1eddi gian");timeLabel.setColor(cc.color("#4d5f7b"));timeLabel.setAnchorPoint(cc.p(0,.5));timeLabel.setPosition(143,453);this.addChild(timeLabel);var typeLabel=
cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,"Lo\u1ea1i");typeLabel.setColor(cc.color("#4d5f7b"));typeLabel.setAnchorPoint(cc.p(0,.5));typeLabel.setPosition(314,timeLabel.y);this.addChild(typeLabel);var recvLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,"Ng\u01b0\u1eddi nh\u1eadn");recvLabel.setColor(cc.color("#4d5f7b"));recvLabel.setAnchorPoint(cc.p(0,.5));recvLabel.setPosition(448,timeLabel.y);this.addChild(recvLabel);this.recvLabel=recvLabel;var goldLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,
"V\u00e0ng");goldLabel.setColor(cc.color("#4d5f7b"));goldLabel.setAnchorPoint(cc.p(0,.5));goldLabel.setPosition(616,timeLabel.y);this.addChild(goldLabel);var contentLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,"N\u1ed9i dung");contentLabel.setColor(cc.color("#4d5f7b"));contentLabel.setAnchorPoint(cc.p(0,.5));contentLabel.setPosition(745,timeLabel.y);this.addChild(contentLabel);var listItem=new newui.TableView(cc.size(800,335),1);listItem.setBounceEnabled(true);listItem.setMargin(30,
30,0,0);listItem.setScrollBarEnabled(false);listItem.setPosition(127,100);this.addChild(listItem);this.listItem=listItem},addItem:function(time,type,recvUser,gold,content){var container=new ccui.Widget;container.setContentSize(this.listItem.getContentSize().width,60);this.listItem.pushItem(container);if(this.listItem.size()%2){var bg=new ccui.Scale9Sprite("dialog_cell_bg.png",cc.rect(10,10,4,4));bg.setPreferredSize(container.getContentSize());bg.setAnchorPoint(cc.p(0,0));container.addChild(bg)}var timeLabel=
cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,time,cc.TEXT_ALIGNMENT_CENTER,200);timeLabel.setAnchorPoint(cc.p(0,.5));timeLabel.setPosition(16,container.getContentSize().height/2);container.addChild(timeLabel);var typeLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,type);typeLabel.setAnchorPoint(cc.p(0,.5));typeLabel.setPosition(187,container.getContentSize().height/2);container.addChild(typeLabel);var recvLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,
recvUser);recvLabel.setAnchorPoint(cc.p(0,.5));recvLabel.setPosition(321,container.getContentSize().height/2);container.addChild(recvLabel);var goldLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,gold);goldLabel.setAnchorPoint(cc.p(0,.5));goldLabel.setColor(cc.color("#ffde00"));goldLabel.setPosition(489,container.getContentSize().height/2);container.addChild(goldLabel);var contentLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,content);contentLabel.setAnchorPoint(cc.p(0,
.5));contentLabel.setPosition(618,container.getContentSize().height/2);container.addChild(contentLabel)},onRecvData:function(cmd,data){var items=data["data"];if(items.length>0)for(var i=0;i<items.length;i++){var time=items[i]["createdTime"];var type=items[i]["transferType"];var recv=items[i]["toUsername"];var gold=items[i]["value"];var content=items[i]["description"];this.addItem(cc.Global.DateToString(new Date(time*1E3)),type,recv,gold,content)}},onEnter:function(){this._super();LobbyClient.getInstance().addListener("fetchTransferLog",
this.onRecvData,this);this.requestGetHistory()},onExit:function(){this._super();LobbyClient.getInstance().removeListener(this)},requestGetHistory:function(){var request={command:"fetchTransferLog"};LobbyClient.getInstance().send(request)}});
var TransferGoldMerchantHistory=TransferGoldHistory.extend({ctor:function(){this._super();this.recvLabel.setString("Th\u00f4ng tin \u0111\u1ea1i l\u00fd")},requestGetHistory:function(){var request={command:"fetchTransferLog",type:3};LobbyClient.getInstance().send(request)},onRecvData:function(cmd,data){var items=data["data"];if(items.length>0)for(var i=0;i<items.length;i++){var time=items[i]["createdTime"];var type=items[i]["transferType"];var recv=items[i]["info"];var gold=items[i]["value"];var content=
items[i]["description"];this.addItem(cc.Global.DateToString(new Date(time*1E3)),type,recv,gold,content)}}});var IScene=cc.Scene.extend({sceneLayer:null,popupLayer:null,winSize:null,screenScale:null,ctor:function(){this._super();this.type="IScene";this.winSize=cc.winSize;this.screenScale=this.winSize.width/1280;this.sceneLayer=new cc.Node;this.addChild(this.sceneLayer,0);this.popupLayer=new cc.Node;this.addChild(this.popupLayer,100);this.messageLayer=new cc.Node;this.addChild(this.messageLayer,101)},onExit:function(){this._super();this.popupLayer.removeAllChildren(true);this.messageLayer.removeAllChildren(true)},
onEnter:function(){this._super();cc.director.setClearColor(cc.color(0,0,0,0))}});var subLayer_icon_img1=["#lobby-clubs-1.png","#lobby-hearts-1.png","#lobby-diamonds-1.png","#lobby-spades-1.png","#lobby-start-1.png"];var subLayer_icon_img2=["#lobby-clubs-2.png","#lobby-hearts-2.png","#lobby-diamonds-2.png","#lobby-spades-2.png","#lobby-start-2.png"];
var LobbySubLayer=cc.Node.extend({ctor:function(titleFrameName){this._super();var topBar=new cc.Node;topBar.setContentSize(cc.size(1280,720));topBar.setPosition(cc.p(0,720));topBar.setAnchorPoint(cc.p(0,1));this.addChild(topBar);topBar.setScale(cc.winSize.screenScale);this.backBt=new ccui.Button("top_bar_backBt.png","","",ccui.Widget.PLIST_TEXTURE);this.backBt.setPosition(54,660);topBar.addChild(this.backBt);this.settingBt=new ccui.Button("top_bar_settingBt.png","","",ccui.Widget.PLIST_TEXTURE);this.settingBt.setPosition(1224,
this.backBt.y);topBar.addChild(this.settingBt);if(titleFrameName){var title=new cc.Sprite(titleFrameName);title.setPosition(640,this.backBt.y);topBar.addChild(title)}},_initTab:function(normalFrame,selectedFrame,allLayer){var thiz=this;var bottomBar=new cc.Node;bottomBar.setPosition(0,30);this.addChild(bottomBar);bottomBar.setScale(cc.winSize.screenScale);var gameNav=new ccui.Scale9Sprite("sublobby-tab-bg.png",cc.rect(20,0,4,49));gameNav.setPreferredSize(cc.size(960,49));gameNav.setPosition(640,gameNav.getContentSize().height/
2);bottomBar.addChild(gameNav);var dx=gameNav.getContentSize().width/normalFrame.length;var x=gameNav.x-gameNav.getContentSize().width/2+dx/2;var selectedSprite=new ccui.Scale9Sprite("home-gameNav-selected.png",cc.rect(4,4,4,4));selectedSprite.setPreferredSize(cc.size(dx,gameNav.getContentSize().height));selectedSprite.setPosition(0,gameNav.y);bottomBar.addChild(selectedSprite,1);var mToggle=new ToggleNodeGroup;bottomBar.addChild(mToggle);for(var i=0;i<normalFrame.length;i++)(function(){var icon1=
new cc.Sprite(subLayer_icon_img1[i]);icon1.setPosition(x+dx*i,gameNav.y);bottomBar.addChild(icon1);var icon2=new cc.Sprite(subLayer_icon_img2[i]);icon2.setPosition(icon1.getPosition());bottomBar.addChild(icon2);var tabName1=new cc.Sprite(normalFrame[i]);tabName1.setPosition(icon1.getPosition());bottomBar.addChild(tabName1);var tabName2=new cc.Sprite(selectedFrame[i]);tabName2.setPosition(icon1.getPosition());bottomBar.addChild(tabName2);var mNode=allLayer[i];var toggleItem=new ToggleNodeItem(icon1.getContentSize());
toggleItem.setPosition(icon1.x,selectedSprite.y);mToggle.addItem(toggleItem);toggleItem.onSelect=function(force){icon1.visible=false;icon2.visible=true;tabName1.visible=false;tabName2.visible=true;mNode.setVisible(false);selectedSprite.stopAllActions();if(force)selectedSprite.x=icon1.x;else selectedSprite.runAction(new cc.MoveTo(.1,cc.p(icon1.x,selectedSprite.y)));thiz._onSelectTabLayer(mNode)};toggleItem.onUnSelect=function(){icon1.visible=true;icon2.visible=false;tabName1.visible=true;tabName2.visible=
false;mNode.setVisible(false)}})();this.mToggle=mToggle;return bottomBar},_onSelectTabLayer:function(layer){layer.setVisible(true)}});var InboxCountNode=cc.Node.extend({ctor:function(){this._super();this._initListener();var bg=new cc.Sprite("#top_bar_news_bg.png");bg.setPosition(cc.p(0,0));this.addChild(bg);this.newsBg=bg;var newLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_20,"9+");newLabel.setPosition(bg.getContentSize().width/2,bg.getContentSize().height/2);newLabel.setColor(cc.color("#682e2e"));bg.addChild(newLabel);this.newLabel=newLabel},_initListener:function(){LobbyClient.getInstance().addListener("inboxMessage",
this._onInboxMessageHandler,this);LobbyClient.getInstance().addListener("markReadedMessageInbox",this._onInboxMessageHandler,this)},refreshView:function(){if(PlayerMe.messageCount<=0)this.newsBg.visible=false;else{this.newsBg.visible=true;if(PlayerMe.messageCount>9)this.newLabel.setString("9+");else this.newLabel.setString(PlayerMe.messageCount.toString())}},_onInboxMessageHandler:function(){this.refreshView()},onEnter:function(){this._super();this.refreshView()},onExit:function(){this._super();LobbyClient.getInstance().removeListener(this)}});
var LobbyTopBar=cc.Node.extend({ctor:function(){this._super();this.setAnchorPoint(0,1);this.setContentSize(1280,720);this.setPosition(0,720);this.setScale(cc.winSize.screenScale);var backBt=new ccui.Button("top_bar_backBt.png","","",ccui.Widget.PLIST_TEXTURE);backBt.setPosition(54,660);this.addChild(backBt);var callBt=new ccui.Button("top_bar_callBt.png","","",ccui.Widget.PLIST_TEXTURE);callBt.setPosition(200,backBt.y);this.addChild(callBt);var transferGoldBt=new ccui.Button("top_bar_goldBt.png",
"","",ccui.Widget.PLIST_TEXTURE);transferGoldBt.setPosition(347,backBt.y);this.addChild(transferGoldBt);var shopBt=new ccui.Button("top_bar_shopBt.png","","",ccui.Widget.PLIST_TEXTURE);shopBt.setPosition(493,backBt.y);this.addChild(shopBt);var activityBt=new ccui.Button("top_bar_activityBt.png","","",ccui.Widget.PLIST_TEXTURE);activityBt.setPosition(639,backBt.y);this.addChild(activityBt);var activityNotif=new ActivityCountNode;activityNotif.setPosition(70,80);activityBt.getRendererNormal().addChild(activityNotif);
var inboxBt=new ccui.Button("top_bar_inboxBt.png","","",ccui.Widget.PLIST_TEXTURE);inboxBt.setPosition(786,backBt.y);this.addChild(inboxBt);var notif=new InboxCountNode;notif.setPosition(70,80);inboxBt.getRendererNormal().addChild(notif);var newsBt=new ccui.Button("top_bar_newsBt.png","","",ccui.Widget.PLIST_TEXTURE);newsBt.setPosition(932,backBt.y);this.addChild(newsBt);var rankBt=new ccui.Button("top_bar_rankBt.png","","",ccui.Widget.PLIST_TEXTURE);rankBt.setPosition(1078,backBt.y);this.addChild(rankBt);
var settingBt=new ccui.Button("top_bar_settingBt.png","","",ccui.Widget.PLIST_TEXTURE);settingBt.setPosition(1224,backBt.y);this.addChild(settingBt);this._initMessageLabel();this.backBt=backBt;this.callBt=callBt;this.transferGoldBt=transferGoldBt;this.shopBt=shopBt;this.activityBt=activityBt;this.inboxBt=inboxBt;this.newsBt=newsBt;this.rankBt=rankBt;this.settingBt=settingBt},_initMessageLabel:function(){var bg=new ccui.Scale9Sprite("top_bar_text_bg.png",cc.rect(4,4,4,4));bg.setPreferredSize(cc.size(1280,
56));bg.setAnchorPoint(cc.p(0,0));bg.setPosition(0,550);this.addChild(bg);var messageBoxLeft=0;var messageBoxRight=1280;var messageBoxWidth=messageBoxRight-messageBoxLeft;var clippingMessage=new ccui.Layout;clippingMessage.setContentSize(messageBoxWidth,56);clippingMessage.setClippingEnabled(true);clippingMessage.setClippingType(ccui.Layout.CLIPPING_SCISSOR);clippingMessage.setPosition(messageBoxLeft,bg.y);this.addChild(clippingMessage);var messageText=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_20,
"message");messageText.setColor(cc.color("#bbc9ff"));messageText.setAnchorPoint(0,.5);messageText.setPosition(0,clippingMessage.getContentSize().height/2);clippingMessage.addChild(messageText);this.messageText=messageText;this.messageBoxWidth=messageBoxWidth;this.setMessage("S\u1ef1 ki\u1ec7n nh\u00e2n \u0111\u00f4i v\u00e0ng, b\u1eaft \u0111\u1ea7u t\u1eeb ng\u00e0y 30/05/2015 - 01/06/2015")},setMessage:function(message){var messageText=this.messageText;var messageBoxWidth=this.messageBoxWidth+10;
messageText.stopAllActions();messageText.setString(message);messageText.x=messageBoxWidth;var moveWidth=messageBoxWidth+messageText.getContentSize().width;var duration=moveWidth/75;var action=new cc.Sequence(new cc.MoveBy(duration,cc.p(-moveWidth,0)),new cc.CallFunc(function(){messageText.x=messageBoxWidth}));this.messageText.runAction(new cc.RepeatForever(action))},refreshView:function(){this.setMessage("Ch\u00e0o m\u1eebng b\u1ea1n \u0111\u1ebfn v\u1edbi game b\u00e0i !!!")},onEnter:function(){this._super();
this.refreshView()}});var LobbyBottomBar=cc.Node.extend({ctor:function(){this._super();this.setAnchorPoint(cc.p(0,0));var barBg=new cc.Sprite("#login_bar_bg.png");barBg.setAnchorPoint(cc.p(0,0));barBg.setPosition(cc.p(0,0));this.addChild(barBg);var barBg1=new cc.Sprite("#login_bar_bg_1.png");barBg1.setAnchorPoint(cc.p(0,0));barBg1.setPosition(cc.p(0,0));this.addChild(barBg1);var barBg2=new cc.Sprite("#login_bar_bg_2.png");barBg2.setAnchorPoint(cc.p(0,0));barBg2.setPosition(cc.p(0,0));this.addChild(barBg2);var logo=new cc.Sprite("#bot_bar_logo.png");
logo.setPosition(640,68);this.addChild(logo);var avt=UserAvatar.createMe();avt.setPosition(49,49);this.addChild(avt,0);this.avatar=avt;var nameLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_18,"Name2221231312313213212312312332132");nameLabel.setAnchorPoint(0,.5);nameLabel.setColor(cc.color("#63b0f1"));nameLabel.setPosition(92,54);this.addChild(nameLabel,1);this.nameLabel=nameLabel;var goldLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,"100,1111V");goldLabel.setAnchorPoint(0,
.5);goldLabel.setColor(cc.color("#ffde00"));goldLabel.setPosition(92,32);this.addChild(goldLabel,1);this.goldLabel=goldLabel;var level=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,"6");level.setPosition(400,41);level.setColor(cc.color("#009cff"));this.addChild(level,1);this.levelLabel=level;var vip=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,"6");vip.setPosition(1280-400,41);vip.setColor(cc.color("#ffde00"));this.addChild(vip,1);this.vipLabel=vip;var _levelText=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_14,
"Level");_levelText.setColor(cc.color("#6a8fcc"));_levelText.setPosition(level.x,9);this.addChild(_levelText,1);var _vipText=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_14,"V.I.P");_vipText.setColor(cc.color("#6a8fcc"));_vipText.setPosition(vip.x,9);this.addChild(_vipText,1);var levelBar=new cc.ProgressTimer(new cc.Sprite("#bot_bar_levelBar_1.png"));levelBar.setType(cc.ProgressTimer.TYPE_RADIAL);levelBar.setReverseDirection(true);levelBar.setPosition(level.getPosition());levelBar.setPercentage(25);
var levelBarBg=new cc.Sprite("#bot_bar_levelBar_bg.png");levelBarBg.setPosition(levelBar.getContentSize().width/2,levelBar.getContentSize().height/2);levelBar.addChild(levelBarBg,-1);this.addChild(levelBar);this.levelBar=levelBar;var vipBar=new cc.ProgressTimer(new cc.Sprite("#bot_bar_levelBar_2.png"));vipBar.setType(cc.ProgressTimer.TYPE_RADIAL);vipBar.setReverseDirection(true);vipBar.setPosition(vip.getPosition());vipBar.setPercentage(75);var vipBarBg=new cc.Sprite("#bot_bar_levelBar_bg.png");vipBarBg.setPosition(vipBar.getContentSize().width/
2,vipBar.getContentSize().height/2);vipBar.addChild(vipBarBg,-1);this.addChild(vipBar);this.vipBar=vipBar;if(!cc.sys.isNative&&cc._renderType===cc.game.RENDER_TYPE_WEBGL){vipBar._alwaysRefreshVertext=true;levelBar._alwaysRefreshVertext=true}var paymentBt=new ccui.Button("bot_bar_paymentBt.png","","",ccui.Widget.PLIST_TEXTURE);paymentBt.setPosition(1140,40);this.addChild(paymentBt);var userinfoBt=new ccui.Widget;userinfoBt.setContentSize(cc.size(200,80));userinfoBt.setAnchorPoint(cc.p(0,0));userinfoBt.setTouchEnabled(true);
userinfoBt.setPosition(0,0);this.addChild(userinfoBt);this.setScale(cc.winSize.screenScale);this.paymentBt=paymentBt;this.userinfoBt=userinfoBt;this.refreshView()},refreshView:function(){var myName=PlayerMe.username;if(myName.length>15)myName=PlayerMe.username.substr(0,15);this.nameLabel.setString(myName);this.goldLabel.setString(cc.Global.NumberFormat1(PlayerMe.gold)+" V");var level=cc.Global.GetLevelMe();this.levelLabel.setString(level.level.toString());this.levelBar.setPercentage(level.expPer);
var vip=cc.Global.GetVipMe();this.vipLabel.setString(vip.level.toString());this.vipBar.setPercentage(vip.expPer)}});var _createDialogFunction=function(obj){obj.show=function(){var runningScene=cc.director.getRunningScene();if(runningScene.popupLayer)var parentNode=runningScene.popupLayer;else var parentNode=runningScene;parentNode.addChild(obj)};obj.hide=function(){obj.removeFromParent(true)}};
var LoginDialog=Dialog.extend({ctor:function(){this._super();var thiz=this;this.okButton.visible=false;this.cancelButton.visible=false;this.title.setString("\u0110\u0102NG NH\u1eacP");this.initWithSize(cc.size(478,448));var userNameBg=new ccui.Scale9Sprite("dialog-textinput-bg.png",cc.rect(10,10,4,4));userNameBg.setPreferredSize(cc.size(280,44));userNameBg.setPosition(cc.p(this.getContentSize().width/2,421));this.addChild(userNameBg);var passwordBg=new ccui.Scale9Sprite("dialog-textinput-bg.png",
cc.rect(10,10,4,4));passwordBg.setPreferredSize(cc.size(280,44));passwordBg.setPosition(cc.p(this.getContentSize().width/2,351));this.addChild(passwordBg);this.userText=new newui.TextField(cc.size(270,44),cc.res.font.Roboto_Condensed_18);this.userText.setPlaceHolder("T\u00e0i kho\u1ea3n");this.userText.setTextColor(cc.color("#c4e1ff"));this.userText.setPlaceHolderColor(cc.color("#909090"));this.userText.setMaxLength(32);this.userText.setPosition(userNameBg.getPosition());this.userText.setReturnCallback(function(){thiz.onLoginButonHandler();
return false});this.addChild(this.userText,1);this.passwordText=new newui.TextField(cc.size(270,44),cc.res.font.Roboto_Condensed_18);this.passwordText.setPasswordEnable(true);this.passwordText.setPlaceHolder("M\u1eadt kh\u1ea9u");this.passwordText.setTextColor(cc.color("#c4e1ff"));this.passwordText.setPlaceHolderColor(cc.color("#909090"));this.passwordText.setMaxLength(30);this.passwordText.setPosition(passwordBg.getPosition());this.passwordText.setReturnCallback(function(){thiz.onLoginButonHandler();
return false});this.addChild(this.passwordText,1);this.userText.nextTextField=this.passwordText;this.passwordText.nextTextField=this.userText;this.userText.setText(cc.Global.getSaveUsername());this.passwordText.setText(cc.Global.getSavePassword());var label1=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,"L\u01b0u m\u1eadt kh\u1ea9u");label1.setAnchorPoint(1,.5);label1.setColor(cc.color("#4a8ed3"));label1.setPosition(this.getContentSize().width/2-15,272);this.addChild(label1,1);this.checkBox=
new ccui.CheckBox;this.checkBox.loadTextureBackGround("dialog-checkBox.png",ccui.Widget.PLIST_TEXTURE);this.checkBox.loadTextureFrontCross("dialog-checkBoxCross.png",ccui.Widget.PLIST_TEXTURE);this.checkBox.setPosition(label1.x-label1.getContentSize().width-30,label1.y);this.addChild(this.checkBox);this.checkBox.setSelected(cc.Global.GetSetting("savePassword",true));this.checkBox.addEventListener(function(target,event){cc.Global.SetSetting("savePassword",event==ccui.CheckBox.EVENT_SELECTED)});var resetPassword=
cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,"Qu\u00ean m\u1eadt kh\u1ea9u?");resetPassword.setAnchorPoint(0,.5);resetPassword.setColor(cc.color("#4a8ed3"));resetPassword.setPosition(this.getContentSize().width/2+15,label1.y);this.addChild(resetPassword,1);var resetPasswordBt=new ccui.Widget;resetPasswordBt.setContentSize(resetPassword.getContentSize());resetPasswordBt.setPosition(resetPassword.x+resetPassword.getContentSize().width/2,resetPassword.y);resetPasswordBt.setTouchEnabled(true);
this.addChild(resetPasswordBt);var loginBt=s_Dialog_Create_Button1(cc.size(284,44),"\u0110\u0102NG NH\u1eacP");loginBt.setPosition(this.getContentSize().width/2,204);loginBt.setZoomScale(.02);this.addChild(loginBt);var regLabel=new cc.LabelBMFont("\u0110\u0102NG K\u00dd",cc.res.font.Roboto_Condensed_18);regLabel.setColor(cc.color("#4c6080"));regLabel.setPosition(this.getContentSize().width/2,134);this.addChild(regLabel,1);var regButton=new ccui.Widget;regButton.setContentSize(regLabel.getContentSize());
regButton.setPosition(regLabel.getPosition());regButton.setTouchEnabled(true);this.addChild(regButton);loginBt.addClickEventListener(function(){thiz.onLoginButonHandler()});regButton.addClickEventListener(function(){SceneNavigator.showSignup();thiz.hide()});resetPasswordBt.addClickEventListener(function(){var dialog=new ContactDialog;dialog.setTitle("Qu\u00ean m\u1eadt kh\u1ea9u");dialog.show();thiz.hide()})},onLoginButonHandler:function(){var username=this.userText.getText();var password=this.passwordText.getText();
if(!username&&username.length==0){MessageNode.getInstance().show("B\u1ea1n ph\u1ea3i nh\u1eadp t\u00ean t\u00e0i kho\u1ea3n");return}if(!password&&password.length==0){MessageNode.getInstance().show("B\u1ea1n ph\u1ea3i nh\u1eadp m\u1eadt kh\u1ea9u");return}LoadingDialog.getInstance().show("\u0110ang \u0111\u0103ng nh\u1eadp");LobbyClient.getInstance().loginNormal(username,password,this.checkBox.isSelected())}});var s_signup_title="Kh\u00f4ng b\u1eaft bu\u1ed9c nh\u1eadp s\u1ed1 \u0111i\u1ec7n tho\u1ea1i.\nD\u00f9ng \u0111\u1ec3 x\u00e1c th\u1ef1c t\u00e0i kho\u1ea3n khi c\u1ea7n h\u1ed7 tr\u1ee3 trong game";
var SignupDialog=Dialog.extend({ctor:function(){this._super();this.okButton.visible=false;this.cancelButton.visible=false;this.title.setString("\u0110\u0102NG K\u00dd");this.initWithSize(cc.size(478,587));var thiz=this;var titleLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,s_signup_title,cc.TEXT_ALIGNMENT_CENTER);titleLabel.setPosition(this.getContentSize().width/2,560);titleLabel.setColor(cc.color("#4d5f7b"));this.addChild(titleLabel,2);var userNameBg=new ccui.Scale9Sprite("dialog-textinput-bg.png",
cc.rect(10,10,4,4));userNameBg.setPreferredSize(cc.size(280,44));userNameBg.setPosition(cc.p(this.getContentSize().width/2,495));this.addChild(userNameBg);var passwordBg=new ccui.Scale9Sprite("dialog-textinput-bg.png",cc.rect(10,10,4,4));passwordBg.setPreferredSize(cc.size(280,44));passwordBg.setPosition(cc.p(this.getContentSize().width/2,425));this.addChild(passwordBg);var phoneBg=new ccui.Scale9Sprite("dialog-textinput-bg.png",cc.rect(10,10,4,4));phoneBg.setPreferredSize(cc.size(280,44));phoneBg.setPosition(cc.p(this.getContentSize().width/
2,355));this.addChild(phoneBg);this.userText=new newui.TextField(cc.size(270,44),cc.res.font.Roboto_Condensed_18);this.userText.setPlaceHolder("T\u00e0i kho\u1ea3n");this.userText.setTextColor(cc.color("#c4e1ff"));this.userText.setPlaceHolderColor(cc.color("#909090"));this.userText.setMaxLength(32);this.userText.setPosition(userNameBg.getPosition());this.addChild(this.userText,1);this.passwordText=new newui.TextField(cc.size(270,44),cc.res.font.Roboto_Condensed_18);this.passwordText.setPasswordEnable(true);
this.passwordText.setPlaceHolder("M\u1eadt kh\u1ea9u");this.passwordText.setTextColor(cc.color("#c4e1ff"));this.passwordText.setPlaceHolderColor(cc.color("#909090"));this.passwordText.setMaxLength(30);this.passwordText.setPosition(passwordBg.getPosition());this.addChild(this.passwordText,1);this.phoneText=new newui.TextField(cc.size(270,44),cc.res.font.Roboto_Condensed_18);this.phoneText.setPlaceHolder("S\u1ed1 \u0111i\u1ec7n tho\u1ea1i");this.phoneText.setTextColor(cc.color("#c4e1ff"));this.phoneText.setPlaceHolderColor(cc.color("#909090"));
this.phoneText.setMaxLength(30);this.phoneText.setPosition(phoneBg.getPosition());this.addChild(this.phoneText,1);this.userText.nextTextField=this.passwordText;this.passwordText.nextTextField=this.phoneText;this.phoneText.nextTextField=this.userText;var signupBt=s_Dialog_Create_Button1(cc.size(284,44),"\u0110\u0102NG K\u00dd");signupBt.setPosition(this.getContentSize().width/2,210);this.addChild(signupBt);var toggleIcon1=new cc.Sprite("#dialog-checkBox-2.png");toggleIcon1.setPosition(this.getContentSize().width/
2-120,280);this.addChild(toggleIcon1);var toggleLabel1=new cc.LabelBMFont("Nam",cc.res.font.Roboto_Condensed_18);toggleLabel1.setAnchorPoint(cc.p(0,.5));toggleLabel1.setColor(cc.color("#72acd6"));toggleLabel1.setPosition(toggleIcon1.x+30,toggleIcon1.y);this.addChild(toggleLabel1,1);var toggleIcon2=new cc.Sprite("#dialog-checkBox-2.png");toggleIcon2.setPosition(this.getContentSize().width/2+30,toggleIcon1.y);this.addChild(toggleIcon2);var toggleLabel2=new cc.LabelBMFont("N\u1eef",cc.res.font.Roboto_Condensed_18);
toggleLabel2.setAnchorPoint(cc.p(0,.5));toggleLabel2.setColor(cc.color("#72acd6"));toggleLabel2.setPosition(toggleIcon2.x+30,toggleIcon2.y);this.addChild(toggleLabel2,1);var toggleSelected=new cc.Sprite("#dialog-checkBoxCross-2.png");toggleSelected.setPosition(toggleIcon1.getPosition());this.addChild(toggleSelected);var toggleIcon=[toggleIcon1,toggleIcon2];var genderToggle=new ToggleNodeGroup;this.genderToggle=genderToggle;this.addChild(genderToggle);for(var i=0;i<toggleIcon.length;i++)(function(){var itemIdx=
i;var toggleItem=new ToggleNodeItem(toggleIcon[i].getContentSize());toggleItem.setPosition(toggleIcon[i].getPosition());toggleItem.onSelect=function(){toggleSelected.setPosition(toggleItem.getPosition());thiz._male=itemIdx==0?true:false};genderToggle.addItem(toggleItem)})();signupBt.addClickEventListener(function(){var username=thiz.userText.getText();var password=thiz.passwordText.getText();if(!username&&username.length==0){MessageNode.getInstance().show("B\u1ea1n ph\u1ea3i nh\u1eadp t\u00ean t\u00e0i kho\u1ea3n");
return}if(!password&&password.length==0){MessageNode.getInstance().show("B\u1ea1n ph\u1ea3i nh\u1eadp m\u1eadt kh\u1ea9u");return}var phoneNumber=thiz.phoneText.getText();LoadingDialog.getInstance().show("\u0110ang \u0111\u0103ng k\u00fd");LobbyClient.getInstance().signup(username,password,phoneNumber,thiz._male)});var loginLabel=new cc.LabelBMFont("\u0110\u0102NG NH\u1eacP",cc.res.font.Roboto_Condensed_18);loginLabel.setColor(cc.color("#4c6080"));loginLabel.setPosition(this.getContentSize().width/
2,140);this.addChild(loginLabel,1);var loginBt=new ccui.Widget;loginBt.setContentSize(loginLabel.getContentSize());loginBt.setPosition(loginLabel.getPosition());loginBt.setTouchEnabled(true);this.addChild(loginBt);loginBt.addClickEventListener(function(){SceneNavigator.showLoginNormal();thiz.hide()})},onEnter:function(){this._super();this.genderToggle.selectItem(0)}});
var HomeLayer=cc.Node.extend({ctor:function(){this._super();this.setScale(cc.winSize.screenScale);var barBg=new cc.Sprite("#login_bar_bg.png");barBg.setAnchorPoint(cc.p(0,0));barBg.setPosition(cc.p(0,0));this.addChild(barBg);var barBg1=new cc.Sprite("#login_bar_bg_1.png");barBg1.setAnchorPoint(cc.p(0,0));barBg1.setPosition(cc.p(0,0));this.addChild(barBg1);var barBg2=new cc.Sprite("#login_bar_bg_2.png");barBg2.setAnchorPoint(cc.p(0,0));barBg2.setPosition(cc.p(0,0));this.addChild(barBg2);var logo=new cc.Sprite("#bot_bar_logo.png");
logo.setPosition(640,98);this.addChild(logo);var fbButton=new ccui.Button("home-bg-bt.png","","",ccui.Widget.PLIST_TEXTURE);fbButton.setPosition(cc.p(640,30));fbButton.setScale(cc.winSize.screenScale);this.addChild(fbButton);var loginBt=new ccui.Button("home-signin.png","","",ccui.Widget.PLIST_TEXTURE);loginBt.setPosition(cc.p(1155,46));this.addChild(loginBt);var signupBt=new ccui.Button("home-signup.png","","",ccui.Widget.PLIST_TEXTURE);signupBt.setPosition(cc.p(122,48));this.addChild(signupBt);
this.fbButton=fbButton;this.loginBt=loginBt;this.signupBt=signupBt;loginBt.addClickEventListener(function(){SceneNavigator.showLoginNormal()});signupBt.addClickEventListener(function(){SceneNavigator.showSignup()})}});var s_homescene_first_run=true;
var HomeScene=IScene.extend({ctor:function(){this._super();this.miniGameLayer=new cc.Node;this.addChild(this.miniGameLayer,1);this.floatButtonLayer=new cc.Node;this.addChild(this.floatButtonLayer,2);this.type="HomeScene";this.homeLocation=0;LobbyClient.getInstance().addListener("login",this.onLoginHandler,this);LobbyClient.getInstance().addListener("LobbyStatus",this.onLobbyStatusHandler,this);LobbyClient.getInstance().addListener("changeAsset",this.onChangeRefeshUserInfo,this);LobbyClient.getInstance().addListener("inboxMessage",
this.onChangeRefeshUserInfo,this);LobbyClient.getInstance().addListener("news",this.onNewsMessage,this);LobbyClient.getInstance().addListener("miniGameReconnect",this.onMiniGameReconnect,this);SmartfoxClient.getInstance().addExtensionListener("0",this.onSFSChangeGold,this);var bg=new cc.Sprite("res/game-bg.jpg");bg.x=cc.winSize.width/2;bg.y=cc.winSize.height/2;this.sceneLayer.addChild(bg);this.mainLayer=new cc.Node;this.sceneLayer.addChild(this.mainLayer);this.topBar=new LobbyTopBar;this.mainLayer.addChild(this.topBar);
this.userInfo=new LobbyBottomBar;this.mainLayer.addChild(this.userInfo);this.homeLayer=new HomeLayer;this.mainLayer.addChild(this.homeLayer,1);this.gameLayer=new GameLayer;this.mainLayer.addChild(this.gameLayer);this.lobbyLayer=new LobbyLayer;this.mainLayer.addChild(this.lobbyLayer);this.miniGame=new MiniGameLayer;this.mainLayer.addChild(this.miniGame);var thiz=this;this.topBar.backBt.addClickEventListener(function(){thiz.backButtonHandler()});this.topBar.newsBt.addClickEventListener(function(){thiz.newsButtonhandler()});
this.topBar.rankBt.addClickEventListener(function(){thiz.rankButtonHandler()});this.topBar.callBt.addClickEventListener(function(){thiz.callButtonHandler()});this.topBar.settingBt.addClickEventListener(function(){thiz.settingButtonHandler()});this.topBar.inboxBt.addClickEventListener(function(){thiz.newsMesasgeButtonHandler()});this.topBar.activityBt.addClickEventListener(function(){thiz.activityButtonHandler()});this.topBar.shopBt.addClickEventListener(function(){thiz.shopButtonHandler()});this.topBar.transferGoldBt.addClickEventListener(function(){thiz.transferGoldButtonHandler()});
this.userInfo.paymentBt.addClickEventListener(function(){thiz.paymentButtonHandler()});this.userInfo.userinfoBt.addClickEventListener(function(){thiz.userInfoButtonHandler()});this.homeLayer.fbButton.addClickEventListener(function(){SceneNavigator.showLoginFacebook()});this.startHome();FloatButton.getInstance().show(this.floatButtonLayer)},onFetchProduct:function(command,data){},onFetchCashin:function(command,data){},onSFSChangeGold:function(messageType,data){if(data.p.reason==1){var goldChange=data["p"]["1"];
if(goldChange<0)MessageNode.getInstance().show("B\u1ea1n v\u1eeba b\u1ecb tr\u1eeb "+Math.abs(goldChange)+" V\u00e0ng v\u00ec tho\u00e1t kh\u1ecfi ph\u00f2ng",null,this)}},_checkLogin:function(){if(this.homeLocation==1){SceneNavigator.showLoginNormal();return false}return true},onChangeRefeshUserInfo:function(command,data){this.userInfo.refreshView()},onNewsMessage:function(command,data){this.topBar.refreshView();var popupMsg=data["data"]["popup"];if(popupMsg&&popupMsg!=""){var messageDialog=new MessageDialog;
messageDialog.setMessage(popupMsg);messageDialog.showWithAnimationScale()}},onLoginHandler:function(command,data){if(data.status==0){this.userInfo.refreshView();this.miniGame.fetchHuThuong();LobbyClient.getInstance().send({command:"subscribeMiniGame",gameType:"Mini_Poker"});LobbyClient.getInstance().send({command:"subscribeMiniGame",gameType:"Mini_Cao_Thap"});LobbyClient.getInstance().send({command:"subscribeMiniGame",gameType:"Video_Poker"})}},onMiniGameReconnect:function(){if(this.homeLocation==
0||this.homeLocation==1)this.startGame()},onLobbyStatusHandler:function(){},startHome:function(){this.popupLayer.removeAllChildren();if(this.subLayer){this.subLayer.removeFromParent(true);this.subLayer=0;this.mainLayer.visible=true}this.homeLayer.setVisible(true);this.gameLayer.setVisible(true);this.lobbyLayer.setVisible(false);this.userInfo.visible=false;if(this.homeLocation==0||this.homeLocation==3)this.gameLayer.startAnimation();if(this.homeLocation==0)this.miniGame.startAnimation();if(this.homeLocation!=
1){this.homeLayer.y=-100;this.homeLayer.stopAllActions();this.homeLayer.runAction(new cc.EaseSineOut(new cc.MoveTo(.3,cc.p(0,0))));this.homeLocation=1}FloatButton.getInstance().setVisible(false)},startGame:function(){PlayerMe.lastGroupSelected=null;this.popupLayer.removeAllChildren();if(this.homeLocation==0||this.homeLocation==1){this.userInfo.y=-100;this.userInfo.stopAllActions();this.userInfo.runAction(new cc.EaseSineOut(new cc.MoveTo(.3,cc.p(0,0))))}this.homeLayer.visible=false;this.gameLayer.visible=
true;this.lobbyLayer.setVisible(false);this.userInfo.visible=true;this.userInfo.refreshView();this.topBar.refreshView();if(this.homeLocation==0||this.homeLocation==3)this.gameLayer.startAnimation();if(this.homeLocation==0)this.miniGame.startAnimation();this.homeLocation=2;FloatButton.getInstance().setVisible(true)},startLobby:function(){this.popupLayer.removeAllChildren();this.homeLayer.visible=false;this.gameLayer.visible=false;this.lobbyLayer.setVisible(true);this.userInfo.visible=true;this.userInfo.refreshView();
if(arguments.length==1){this.lobbyLayer.startGame(arguments[0]);LobbyClient.getInstance().subscribe(arguments[0])}else this.lobbyLayer.startGame(-1);this.homeLocation=3;FloatButton.getInstance().setVisible(true)},onTouchGame:function(gameId){if(this._checkLogin()==false)return;if(!s_game_available[gameId]){MessageNode.getInstance().show("Game ch\u01b0a ra m\u1eaft");return}if(gameId==GameType.GAME_VongQuayMayMan||gameId==GameType.MiniGame_CaoThap||gameId==GameType.MiniGame_ChanLe||gameId==GameType.MiniGame_Poker||
gameId==GameType.MiniGame_VideoPoker)SceneNavigator.toMiniGame(gameId,false);else this.startLobby(gameId)},startGameWithAnimation:function(){this.startGame()},backButtonHandler:function(){var thiz=this;if(LoadingDialog.getInstance().isShow())return;if(this.popupLayer.getChildren().length>0){this.popupLayer.removeAllChildren();return}if(this.subLayer){this.subLayer.removeFromParent(true);this.subLayer=0;this.mainLayer.visible=true;if(this.homeLocation==2){this.miniGame.startAnimation();this.gameLayer.startAnimation()}if(this.homeLocation==
3){this.lobbyLayer.startAnimation();this.miniGame.startAnimation()}return}if(this.homeLocation==1)SystemPlugin.getInstance().exitApp();else if(this.homeLocation==2){var dialog=new MessageConfirmDialog;dialog.setMessage("B\u1ea1n mu\u1ed1n tho\u00e1t game ?");dialog.okButtonHandler=function(){SceneNavigator.toHome()};dialog.cancelButtonHandler=function(){dialog.hide()};dialog.show()}else if(this.homeLocation==3){LobbyClient.getInstance().unSubscribe();this.startGame()}},addSubLayer:function(subLayer){var thiz=
this;subLayer.backBt.addClickEventListener(function(){thiz.backButtonHandler()});subLayer.settingBt.addClickEventListener(function(){thiz.settingButtonHandler()});this.subLayer=subLayer;this.sceneLayer.addChild(subLayer);this.mainLayer.visible=false},newsButtonhandler:function(){if(this._checkLogin()==false)return;this.addSubLayer(new NewsLayer)},rankButtonHandler:function(){if(this._checkLogin()==false)return;this.addSubLayer(new RankLayer)},settingButtonHandler:function(){var dialog=new SettingDialog;
dialog.show()},callButtonHandler:function(){if(cc.sys.isNative)SystemPlugin.getInstance().showCallPhone(GameConfig.hotline);else{var dialog=new ContactDialog;dialog.show()}},newsMesasgeButtonHandler:function(){if(this._checkLogin()==false)return;this.addSubLayer(new InboxLayer)},activityButtonHandler:function(){if(this._checkLogin()==false)return;var dialog=new ActivityDialog;dialog.show()},shopButtonHandler:function(){if(this._checkLogin()==false)return;var dialog=new HomeShopLayer;dialog.show()},
rewardButtonHandler:function(){if(this._checkLogin()==false)return;this.addSubLayer(new RewardLayer)},paymentButtonHandler:function(){if(this._checkLogin()==false)return;this.addSubLayer(new PaymentLayer)},userInfoButtonHandler:function(){if(this._checkLogin()==false)return;var dialog=new UserinfoDialog;dialog.show()},transferGoldButtonHandler:function(){if(this._checkLogin()==false)return;if(PlayerMe.phoneNumber&&PlayerMe.phoneNumber!=""){var dialog=new TransferGoldDialog;dialog.show()}else{var dialog=
new MessageConfirmDialog;dialog.setMessage("B\u1ea1n ph\u1ea3i x\u00e1c th\u1ef1c t\u00e0i kho\u1ea3n \u0111\u1ec3 chuy\u1ec3n v\u00e0ng");dialog.showWithAnimationScale();dialog.okButtonHandler=function(){dialog.hide();SceneNavigator.toAccountActiveView()}}},onEnter:function(){this._super();var thiz=this;cc.eventManager.addListener({event:cc.EventListener.KEYBOARD,onKeyReleased:function(keyCode,event){if(cc.sys.isNative){if(parseKeyCode(keyCode)===cc.KEY.back)thiz.backButtonHandler()}else if(keyCode===
cc.KEY.escape)thiz.backButtonHandler()}},this);if(s_homescene_first_run){s_homescene_first_run=false;cc.director.setDisplayStats(false);if(!cc.sys.isNative){s_homescene_first_run=false;if(ViewNavigatorManager.execute()){this.homeLayer.y=0;this.homeLayer.stopAllActions()}else{var accessToken=cc.Global.GetSetting("accessToken","");if(accessToken!=""){LoadingDialog.getInstance().show("\u0110ang \u0111\u0103ng nh\u1eadp");LobbyClient.getInstance().tokenLogin(accessToken)}}}}},onExit:function(){this._super();
LobbyClient.getInstance().removeListener(this);SmartfoxClient.getInstance().removeListener(this);MiniGameNavigator.hideAll()}});var GameLayer=cc.Node.extend({ctor:function(){this._super();this.allLayer=[];this.initGame();this.setContentSize(cc.size(1280,720));this.setAnchorPoint(cc.p(.5,.5));this.setPosition(cc.winSize.width/2,cc.winSize.height/2);this.setScale(cc.winSize.screenScale)},initGame:function(){var thiz=this;var left=290;var right=1280;var top=550;var bottom=230;var gameNav=new cc.Sprite("#home-gameNav-bg.png");gameNav.setPosition((right+left)/2,168);this.addChild(gameNav);var dx=gameNav.getContentSize().width/
5;var x=gameNav.x-gameNav.getContentSize().width/2+dx/2;var selectSprite=new ccui.Scale9Sprite("home-gameNav-selected.png",cc.rect(4,4,4,4));selectSprite.setPreferredSize(cc.size(dx,gameNav.getContentSize().height));selectSprite.setPosition(0,gameNav.y);this.addChild(selectSprite,1);var mToggle=new ToggleNodeGroup;this.addChild(mToggle);for(var i=0;i<5;i++)(function(){var icon1=new cc.Sprite("#home-game-tab"+(i+1)+".png");icon1.setPosition(x+dx*i,180);thiz.addChild(icon1);var icon2=new cc.Sprite("#home-game-tab"+
(i+1)+"-2.png");icon2.setPosition(icon1.getPosition());thiz.addChild(icon2);var listGame=new newui.TableView(cc.size(right-left,top-bottom),2);listGame.setDirection(ccui.ScrollView.DIR_HORIZONTAL);listGame.setPadding(30);listGame.setBounceEnabled(true);listGame.setMargin(0,0,30,30);listGame.setScrollBarEnabled(false);listGame.setPosition(left,bottom);thiz.addChild(listGame,1);thiz.allLayer.push(listGame);var toggleItem=new ToggleNodeItem(selectSprite.getContentSize());toggleItem.setPosition(icon1.x,
selectSprite.y);toggleItem.onSelect=function(isForce){icon1.visible=false;icon2.visible=true;listGame.visible=true;selectSprite.stopAllActions();if(isForce)selectSprite.x=icon1.x;else selectSprite.runAction(new cc.MoveTo(.1,cc.p(icon1.x,selectSprite.y)))};toggleItem.onUnSelect=function(){icon1.visible=true;icon2.visible=false;listGame.visible=false};mToggle.addItem(toggleItem)})();this.mToggle=mToggle;for(var i=0;i<this.allLayer.length;i++)for(var j=0;j<s_game_id[i].length;j++)this.addGameToList(s_game_id[i][j],
this.allLayer[i])},addGameToList:function(gameId,listGame){var gameButton=new ccui.Widget;gameButton.setContentSize(cc.size(157,131));gameButton.setTouchEnabled(true);listGame.pushItem(gameButton);var gameIcon=new cc.Sprite("#lobby-game"+gameId+".png");gameIcon.setPosition(gameButton.getContentSize().width/2,gameButton.getContentSize().height/2);gameButton.addChild(gameIcon);gameButton.addClickEventListener(function(){var homeScene=cc.director.getRunningScene();homeScene.onTouchGame(gameId)})},onEnter:function(){this._super();
this.mToggle.selectItem(0)},startAnimation:function(){this.mToggle.selectItem(0);this.allLayer[0].runMoveEffect(3E3,.1,0)}});var LobbyRoomCell=ccui.Widget.extend({ctor:function(){this._super();var bg=new cc.Sprite("#lobby-roomBg.png");this.setContentSize(bg.getContentSize());bg.setPosition(this.getContentSize().width/2,this.getContentSize().height/2);this.addChild(bg);this.allSlot=[];this.slot=null;this.initSlot(2);this.initSlot(4);this.initSlot(5);this.initSlot(6);this.initSlot(9);var bettingLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_20,"1000");bettingLabel.setPosition(bg.x,bg.y-2);bettingLabel.setColor(cc.color("#ffde00"));
this.addChild(bettingLabel);this.bettingLabel=bettingLabel},initSlot:function(maxSlot){var slotNode=new cc.Node;this.addChild(slotNode);this.allSlot.push(slotNode);slotNode.maxSlot=maxSlot;slotNode.allSlot=[];for(var i=0;i<maxSlot;i++){var emptySprite=new cc.Sprite("#slot-empty-"+maxSlot+"-"+(i+1)+".png");emptySprite.setPosition(this.getContentSize().width/2,this.getContentSize().height/2);slotNode.addChild(emptySprite)}for(var i=0;i<maxSlot;i++){var activeSprite=new cc.Sprite("#slot-active-"+maxSlot+
"-"+(i+1)+".png");activeSprite.setPosition(emptySprite.getPosition());slotNode.addChild(activeSprite);slotNode.allSlot.push(activeSprite)}},setMaxSlot:function(maxSlot){var _maxSlot=maxSlot;if(_maxSlot>9)_maxSlot=9;this.slot=null;for(var i=0;i<this.allSlot.length;i++)if(this.allSlot[i].maxSlot==_maxSlot){this.slot=this.allSlot[i].allSlot;this.allSlot[i].visible=true}else this.allSlot[i].visible=false;if(this.slot);},addTouchCell:function(listener){this.setTouchEnabled(true);this.addClickEventListener(listener)},
setBetting:function(betting){if(this.bettingLabel)this.bettingLabel.setString(cc.Global.NumberFormat1(betting))},setUserCount:function(userCount){if(userCount>9)if(userCount==30)userCount=9;else userCount=8;if(this.slot)for(var i=0;i<this.slot.length;i++)if(i<userCount)this.slot[i].visible=true;else this.slot[i].visible=false}});LobbyRoomCell.createCell=function(maxSlot){var cell=new LobbyRoomCell;cell.setMaxSlot(maxSlot);return cell};
LobbyXocDiaCell=ccui.Widget.extend({ctor:function(){this._super();var historyNode=new cc.Node;this.addChild(historyNode,3);this.historyNode=historyNode;this._initView();this._initHistory()},_initView:function(){this.setContentSize(cc.size(940,241));var bg=new ccui.Scale9Sprite("lobby_xocdia_bg_1.png",cc.rect(4,4,4,4));bg.setPreferredSize(this.getContentSize());bg.setAnchorPoint(cc.p(0,0));this.addChild(bg);var timer=new cc.ProgressTimer(new cc.Sprite("#lobby_xocdia_timer.png"));timer.setType(cc.ProgressTimer.TYPE_RADIAL);
if(!cc.sys.isNative&&cc._renderType===cc.game.RENDER_TYPE_WEBGL)timer._alwaysRefreshVertext=true;timer.setReverseDirection(true);timer.setPosition(70,159);timer.setPercentage(30);this.addChild(timer);this.timer=timer;var timerBg=new cc.Sprite("#lobby_xocdia_timer_bg.png");timerBg.setPosition(timer.getContentSize().width/2,timer.getContentSize().height/2);timer.addChild(timerBg,-1);var timeLabel=new cc.LabelBMFont("100",cc.res.font.Roboto_CondensedBold_25);timeLabel.setPosition(timer.getPosition());
timeLabel.setColor(cc.color("#ffcf00"));this.addChild(timeLabel,1);this.timeLabel=timeLabel;var userBg=new ccui.Scale9Sprite("lobby_xocdia_bg_3.png",cc.rect(8,8,4,4));userBg.setPreferredSize(cc.size(120,44));userBg.setPosition(timer.x,29);this.addChild(userBg);var userIcon=new cc.Sprite("#lobby_xocdia_userIcon.png");userIcon.setPosition(42,29);this.addChild(userIcon);var userLabel=new cc.LabelBMFont("100",cc.res.font.Roboto_Condensed_25);userLabel.setPosition(66,29);userLabel.setAnchorPoint(cc.p(0,
.5));userLabel.setColor(cc.color("#ffcf00"));this.addChild(userLabel,2);this.userLabel=userLabel;var roomName=new cc.LabelBMFont("PH\u00d2NG 1",cc.res.font.Roboto_CondensedBold_25);roomName.setPosition(timer.x,80);roomName.setColor(cc.color("#9ba5f3"));this.addChild(roomName,1);this.roomName=roomName;var bettingIcon1=new cc.Sprite("#lobby_xocdia_icon_1.png");bettingIcon1.setPosition(165,26);this.addChild(bettingIcon1);var bettingIcon2=new cc.Sprite("#lobby_xocdia_icon_1.png");bettingIcon2.setPosition(443,
bettingIcon1.y);this.addChild(bettingIcon2);var bettingLabel1=new cc.LabelBMFont("Th\u1ea5p nh\u1ea5t",cc.res.font.Roboto_Condensed_25);bettingLabel1.setAnchorPoint(cc.p(0,.5));bettingLabel1.setColor(cc.color("#9ba5f3"));bettingLabel1.setPosition(190,bettingIcon1.y);this.addChild(bettingLabel1,2);var bettingLabel2=new cc.LabelBMFont("Cao nh\u1ea5t",cc.res.font.Roboto_Condensed_25);bettingLabel2.setAnchorPoint(cc.p(0,.5));bettingLabel2.setColor(cc.color("#9ba5f3"));bettingLabel2.setPosition(470,bettingIcon1.y);
this.addChild(bettingLabel2,2);var bettingMin=new cc.LabelBMFont("1000",cc.res.font.Roboto_CondensedBold_25);bettingMin.setAnchorPoint(cc.p(0,.5));bettingMin.setColor(cc.color("#ffde00"));bettingMin.setPosition(295,bettingIcon1.y);this.addChild(bettingMin,1);this.bettingMin=bettingMin;var bettingMax=new cc.LabelBMFont("1000",cc.res.font.Roboto_CondensedBold_25);bettingMax.setAnchorPoint(cc.p(0,.5));bettingMax.setColor(cc.color("#ffde00"));bettingMax.setPosition(562,bettingIcon1.y);this.addChild(bettingMax,
1);this.bettingMax=bettingMax;var joinButton=new ccui.Button("lobby_xocdia_joinBt.png","","",ccui.Widget.PLIST_TEXTURE);joinButton.setZoomScale(0);joinButton.setPosition(840,25);this.addChild(joinButton,0);this.joinButton=joinButton},_initHistory:function(){var itemSize=cc.size(48,45);for(var i=0;i<16;i++)for(var j=0;j<4;j++){var bg=new ccui.Scale9Sprite("lobby_xocdia_bg_2.png",cc.rect(4,4,4,4));bg.setPreferredSize(itemSize);var x=165+(itemSize.width+2)*i;var y=76+(itemSize.height+2)*j;bg.setPosition(x,
y);this.addChild(bg)}this._historyData=[]},_addHistory:function(history){if(this._historyData.length<=0){this._historyData.push(history);return}var row=4;var col=16;var maxItem=row*col;var lastHistory=this._historyData[this._historyData.length-1];if(lastHistory%2!=history%2){var emptyCount=this._historyData.length%row;if(emptyCount>0){emptyCount=row-emptyCount;for(var i=0;i<emptyCount;i++)this._historyData.push(-1)}}this._historyData.push(history);if(this._historyData.length>maxItem)this._historyData.splice(0,
row)},_refreshHistory:function(){var row=4;var itemSize=cc.size(48,45);this.historyNode.removeAllChildren(true);for(var i=0;i<this._historyData.length;i++)if(this._historyData[i]>=0){var label=new cc.LabelBMFont(this._historyData[i].toString(),cc.res.font.Roboto_CondensedBold_25);var x=165+(itemSize.width+2)*Math.floor(i/row);var y=217-(itemSize.height+2)*(i%row);if(this._historyData[i]%2){var historyIcon=new cc.Sprite("#lobby_xocdia_history_1.png");label.setColor(cc.color("#ffffff"))}else{var historyIcon=
new cc.Sprite("#lobby_xocdia_history_2.png");label.setColor(cc.color("#333333"))}historyIcon.setPosition(x,y);this.historyNode.addChild(historyIcon,0);label.setPosition(x,y);this.historyNode.addChild(label,1)}},_setTimeRemaining:function(currentTime,maxTime){this.timer.stopAllActions();this.timeLabel.stopAllActions();if(maxTime<=0){this.timeLabel.setColor(cc.color("#ffcf00"));this.timer.setColor(cc.color("#ffcf00"));this.timeLabel.setString("0");this.timer.setPercentage(0);this.timeLabel.setVisible(false);
this.timer.setVisible(false);return}this.timeLabel.setVisible(true);this.timer.setVisible(true);var timerProgress=100*currentTime/maxTime;this.timer.runAction(new cc.ProgressFromTo(currentTime,timerProgress,0));this.timeLabel.runAction(new quyetnd.ActionTimeRemaining(currentTime));var thiz=this;if(currentTime>5){this.timeLabel.setColor(cc.color("#ffcf00"));this.timer.setColor(cc.color("#ffcf00"));this.timeLabel.runAction(new cc.Sequence(new cc.DelayTime(currentTime-5),new cc.CallFunc(function(){var alertAction=
new cc.Sequence(new cc.TintTo(.2,255,0,0),new cc.TintTo(.2,255,207,0));thiz.timeLabel.runAction(new cc.RepeatForever(alertAction))})));this.timer.runAction(new cc.Sequence(new cc.DelayTime(currentTime-5),new cc.CallFunc(function(){var alertAction=new cc.Sequence(new cc.TintTo(.2,255,0,0),new cc.TintTo(.2,255,207,0));thiz.timer.runAction(new cc.RepeatForever(alertAction))})))}else{var alertAction=new cc.Sequence(new cc.TintTo(.2,255,0,0),new cc.TintTo(.2,255,207,0));this.timeLabel.runAction(new cc.RepeatForever(alertAction.clone()));
this.timer.runAction(new cc.RepeatForever(alertAction))}},setBetting:function(betting){},setUserCount:function(userCount){this.userLabel.setString(userCount.toString())},addTouchCell:function(listener){this.joinButton.addClickEventListener(listener)},setMetadata:function(data){this.setHistory(data["4"]);this.bettingMin.setString(cc.Global.NumberFormat1(data["5"]));this.bettingMax.setString(cc.Global.NumberFormat1(data["6"]));var status=data["1"];if(status==3)this._setTimeRemaining(data["2"]/1E3,data["3"]/
1E3);else this._setTimeRemaining(0,0)},setIndex:function(idx){this.roomName.setString("PH\u00d2NG "+idx.toString())},setHistory:function(history){this._historyData=[];for(var i=0;i<history.length;i++)this._addHistory(history[i]);this._refreshHistory()}});
LobbyTaiXiuCell=LobbyXocDiaCell.extend({ctor:function(){this._super()},_initHistory:function(){var itemSize=cc.size(48,188);for(var i=0;i<16;i++){var bg=new ccui.Scale9Sprite("lobby_xocdia_bg_2.png",cc.rect(4,4,4,4));bg.setPreferredSize(itemSize);bg.setPosition(165+(itemSize.width+2)*i,145);this.addChild(bg)}},_addHistory:function(history){this._historyData.push(history);if(this._historyData.length>16)this._historyData.splice(0,1)},_refreshHistory:function(){var itemSize=cc.size(48,188);this.historyNode.removeAllChildren(true);
for(var i=0;i<this._historyData.length;i++){var x=165+(itemSize.width+2)*i;var data=this._historyData[i];var sumBg=new cc.Sprite("#lobby_taixiu_history_bg_1.png");sumBg.setPosition(x,109);this.historyNode.addChild(sumBg,0);var sum=0;for(var j=0;j<data.length;j++){var sprite=new cc.Sprite("#lobby_taixiu_dice_"+data[j]+".png");sprite.setPosition(x,153+28*j);this.historyNode.addChild(sprite,0);sum+=data[j]}if(sum>10){var label=new cc.LabelBMFont("T\u00c0I",cc.res.font.Roboto_Condensed_25);label.setColor(cc.color("#00ccff"))}else{var label=
new cc.LabelBMFont("X\u1ec8U",cc.res.font.Roboto_Condensed_25);label.setColor(cc.color("#ffde00"))}label.setScale(18/25);label.setPosition(x,72);this.historyNode.addChild(label,1);var sumLabel=new cc.LabelBMFont(sum.toString(),cc.res.font.Roboto_Condensed_25);sumLabel.setScale(20/25);sumLabel.setPosition(sumBg.getPosition());this.historyNode.addChild(sumLabel,1)}}});var s_lobby_group_name=s_lobby_group_name||["tapsu","binhdan","thieugia","daigia","vip"];
var LobbyLayer=cc.Node.extend({ctor:function(){this._super();LobbyClient.getInstance().addListener("updateAll",this.onUpdateAll,this);LobbyClient.getInstance().addListener("updateUserCount",this.onUpdateUserCount,this);LobbyClient.getInstance().addListener("inviteUser",this.onInviteReceived,this);this.initListRoom();this.initListRoomXocDia();this.setContentSize(cc.size(1280,720));this.setAnchorPoint(cc.p(.5,.5));this.setPosition(cc.winSize.width/2,cc.winSize.height/2);this.setScale(cc.winSize.screenScale)},
initListRoomXocDia:function(){var roomXocDiaNode=new cc.Node;this.addChild(roomXocDiaNode);this.roomXocDiaNode=roomXocDiaNode;var left=290;var right=1280;var top=550;var bottom=143;var listGame=new newui.TableView(cc.size(right-left,top-bottom),1);listGame.setPadding(20);listGame.setMargin(10,10,0,0);listGame.setDirection(ccui.ScrollView.DIR_VERTICAL);listGame.setBounceEnabled(true);listGame.setScrollBarEnabled(true);listGame.setPosition(left,bottom);roomXocDiaNode.addChild(listGame,1);this.listRoomXocDia=
listGame},initListRoom:function(){var roomNode=new cc.Node;this.addChild(roomNode);this.roomNode=roomNode;var left=290+6;var right=1280-6;var top=550;var bottom=193;var shadowBg=new cc.Sprite("#bg_chonban.png");shadowBg.setAnchorPoint(cc.p(.5,0));shadowBg.setPosition((right+left)/2,bottom);roomNode.addChild(shadowBg,1);var gameNav=new cc.Sprite("#home-gameNav-bg.png");gameNav.setPosition((right+left)/2,168);roomNode.addChild(gameNav,1);var dx=gameNav.getContentSize().width/5;var x=gameNav.x-gameNav.getContentSize().width/
2+dx/2;var selectSprite=new ccui.Scale9Sprite("home-gameNav-selected.png",cc.rect(4,4,4,4));selectSprite.setPreferredSize(cc.size(dx,gameNav.getContentSize().height));selectSprite.setPosition(0,gameNav.y);roomNode.addChild(selectSprite,2);var thiz=this;var mToggle=new ToggleNodeGroup;roomNode.addChild(mToggle,2);this.mToggle=mToggle;this.listGame=[];for(var i=0;i<s_lobby_group_name.length;i++)(function(){var icon1=new cc.Sprite("#lobby-tab"+(i+1)+".png");icon1.setPosition(x+dx*i,180);roomNode.addChild(icon1,
2);var icon2=new cc.Sprite("#lobby-tabSelected"+(i+1)+".png");icon2.setPosition(icon1.getPosition());roomNode.addChild(icon2,2);var listGame=new newui.TableView(cc.size(right-left,top-bottom),5);listGame.setDirection(ccui.ScrollView.DIR_VERTICAL);listGame.setPadding(25);listGame.setPadding(25);listGame.setBounceEnabled(true);listGame.setMargin(10,10,0,0);listGame.setScrollBarEnabled(true);listGame.setPosition(left,bottom);listGame.groupName=s_lobby_group_name[i];listGame.idx=i;roomNode.addChild(listGame);
thiz.listGame.push(listGame);var toggleItem=new ToggleNodeItem(selectSprite.getContentSize());toggleItem.setPosition(icon1.x,selectSprite.y);toggleItem.onSelect=function(isForce,byUpdateAll){if(byUpdateAll)return;icon1.visible=false;icon2.visible=true;listGame.visible=true;selectSprite.stopAllActions();if(isForce)selectSprite.x=icon1.x;else selectSprite.runAction(new cc.MoveTo(.1,cc.p(icon1.x,selectSprite.y)));if(!isForce){var gameId=s_games_chanel_id[PlayerMe.gameType];LobbyClient.getInstance().subscribe(gameId,
listGame.groupName)}};toggleItem.onUnSelect=function(){icon1.visible=true;icon2.visible=false;listGame.visible=false};mToggle.addItem(toggleItem)})()},addRoomCell:function(roomList,serverId,roomId,betting,minMoney,userCount,metadata,maxUser){if(this.updateRoomCell(roomList,serverId,roomId,userCount,metadata))return null;if(this.gameId==GameType.GAME_XocDia)var roomCell=new LobbyXocDiaCell;else if(this.gameId==GameType.GAME_TaiXiu)var roomCell=new LobbyTaiXiuCell;else var roomCell=LobbyRoomCell.createCell(maxUser);
roomCell.serverId=serverId;roomCell.roomId=roomId;roomCell.setBetting(betting);roomCell.setUserCount(userCount);if(metadata)roomCell.setMetadata(metadata);roomList.pushItem(roomCell);roomCell.addTouchCell(function(){if(PlayerMe.gold<minMoney)MessageNode.getInstance().show("B\u1ea1n kh\u00f4ng \u0111\u1ee7 ti\u1ec1n v\u00e0o ph\u00f2ng");else{var serverInfo=LobbyClient.getInstance().SFSServerInfo[serverId];if(serverInfo){PlayerMe.SFS.roomId=roomId;SmartfoxClient.getInstance().findAndJoinRoom(serverInfo,
null,null,roomId)}else MessageNode.getInstance().show("Kh\u00f4ng c\u00f3 th\u00f4ng tin m\u00e1y ch\u1ee7");LoadingDialog.getInstance().show("\u0110ang v\u00e0o ph\u00f2ng");cc.log("join room")}});return roomCell},updateRoomCell:function(roomList,serverId,roomId,userCount,metadata){for(var i=0;i<roomList.size();i++){var item=roomList.getItem(i);if(item.serverId==serverId&&item.roomId==roomId){item.setUserCount(userCount);if(metadata)item.setMetadata(metadata);return true}}return false},getRoomList:function(groupName){if(this.gameId==
GameType.GAME_XocDia||this.gameId==GameType.GAME_TaiXiu)return this.listRoomXocDia;else for(var i=0;i<this.listGame.length;i++)if(this.listGame[i].groupName==groupName)return this.listGame[i];return null},startGame:function(gameId){this.gameId=gameId;if(gameId==GameType.GAME_TaiXiu||gameId==GameType.GAME_XocDia){this.roomNode.setVisible(false);this.roomXocDiaNode.setVisible(true)}else{this.roomNode.setVisible(true);this.roomXocDiaNode.setVisible(false)}},startAnimation:function(){},onInviteReceived:function(command,
data){var thiz=this;if(!cc.Global.GetSetting("invite"))return;if(this.ignoreAllInvite)return;data=data["data"];if(RecvInviteDialog.getInstance().isShow())return;RecvInviteDialog.getInstance().setInfo(data["userInvite"],s_games_display_name[s_games_chanel_id[data["gameType"]]],data["betting"]);var roomId=data["roomId"];var serverInfo=LobbyClient.getInstance().createServerInfo(data);serverInfo.roomId=roomId;RecvInviteDialog.getInstance().setRoomInfo(serverInfo);RecvInviteDialog.getInstance().showWithAnimationScale();
RecvInviteDialog.getInstance()._ignoreHandler=function(){thiz.ignoreAllInvite=true}},onUpdateAll:function(cmd,event){cc.log(event);var data=event.data;this.maxUsers=data.maxUsers;var gameType=PlayerMe.gameType;if(gameType===data.gameType){var groups=data.groups;for(var i=0;i<groups.length;i++){var groupName=groups[i].group;var roomList=this.getRoomList(groupName);if(roomList){var roomData=groups[i].rooms;var idx=1;for(var j=0;j<roomData.length;j++){var serverId=roomData[j].serverId;var roomId=roomData[j].roomId;
var betting=roomData[j].betting;var minMoney=roomData[j].minMoney;var userCount=roomData[j].userCount;var metadata=roomData[j].metadata;var roomCell=this.addRoomCell(roomList,serverId,roomId,betting,minMoney,userCount,metadata,roomData[j].slots);if(roomCell&&roomCell.setIndex)roomCell.setIndex(idx);idx++}}}var roomList=this.getRoomList(data["group"]);if(roomList.idx!=undefined)this.mToggle.selectItem(roomList.idx);roomList.runMoveEffect(3E3,.1,.1)}},onUpdateUserCount:function(cmd,event){var groups=
event.data.groups;for(var i=0;i<groups.length;i++){var groupName=groups[i].group;var roomList=this.getRoomList(groupName);if(roomList){var roomData=groups[i].rooms;for(var j=0;j<roomData.length;j++)this.updateRoomCell(roomList,roomData[j].serverId,roomData[j].roomId,roomData[j].userCount,roomData[j].metadata)}}},setVisible:function(visible){this._super(visible);if(!visible);else{this.ignoreAllInvite=false;for(var i=0;i<this.listGame.length;i++)this.listGame[i].removeAllItems();this.listRoomXocDia.removeAllItems();
this.mToggle.selectItem(0)}},onEnter:function(){this._super();this.mToggle.selectItem(0);this.ignoreAllInvite=false},onExit:function(){this._super();for(var i=0;i<this.listGame.length;i++)this.listGame[i].removeAllItems();this.listRoomXocDia.removeAllItems();if(this.visible==true)LobbyClient.getInstance().unSubscribe();LobbyClient.getInstance().removeListener(this)}});var MiniGameCell=ccui.Widget.extend({ctor:function(size,gameId,gameName){this._super();this.setContentSize(size);this.miniGameTab=[];this.allMiniLayer=[];var gameIcon=new cc.Sprite("#lobby-minigame"+gameId+".png");gameIcon.setPosition(46,this.getContentSize().height/2);this.addChild(gameIcon);var gameGold=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_25,"0V");gameGold.setAnchorPoint(cc.p(0,.5));gameGold.setPosition(92,this.getContentSize().height/2-18);gameGold.setColor(cc.color(255,
222,0));this.addChild(gameGold);var gameNameLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_25,gameName);gameNameLabel.setAnchorPoint(cc.p(0,.5));gameNameLabel.setPosition(92,this.getContentSize().height/2+18);this.addChild(gameNameLabel);this.gameGold=gameGold;this.gameId=gameId},setGold:function(gold){this.gameGold.setString(cc.Global.NumberFormat1(gold)+" V")}});
var MiniGameLayer=cc.Node.extend({ctor:function(){this._super();LobbyClient.getInstance().addListener("miniGame",this.onSocketMessage,this);this.tabSelectedIndex=0;this.allMiniLayer=[];this.initMiniGame();this.setContentSize(cc.size(1280,720));this.setAnchorPoint(cc.p(.5,.5));this.setPosition(cc.winSize.width/2,cc.winSize.height/2);this.setScale(cc.winSize.screenScale)},initMiniGame:function(){var thiz=this;var top=550;var bottom=193;var left=30;var right=290;var miniGameBar=new cc.Sprite("#home-minigame-bar.png");
miniGameBar.setPosition((right+left)/2,168);this.addChild(miniGameBar);var goldTitle=new cc.Sprite("#home-minigamebar-text1.png");goldTitle.setPosition(miniGameBar.getContentSize().width/2,miniGameBar.getContentSize().height/2);miniGameBar.addChild(goldTitle);this.goldTitle=goldTitle;var leftBt=new ccui.Button("home-minigame-leftBt.png","","",ccui.Widget.PLIST_TEXTURE);leftBt.setPosition(28,34);miniGameBar.addChild(leftBt);var rightBt=new ccui.Button("home-minigame-leftBt.png","","",ccui.Widget.PLIST_TEXTURE);
rightBt.setPosition(miniGameBar.getContentSize().width-leftBt.x,leftBt.y);rightBt.setFlippedX(true);miniGameBar.addChild(rightBt);var bg=new ccui.Scale9Sprite("home-minigame-bg.png",cc.rect(8,0,4,384));bg.setPreferredSize(cc.size(right-left,top-bottom));bg.setAnchorPoint(cc.p(0,0));bg.setPosition(left,bottom);this.addChild(bg);var miniGameLayer=new ccui.PageView;miniGameLayer.setContentSize(cc.size(bg.getContentSize().width-4,bg.getContentSize().height-4));miniGameLayer.setAnchorPoint(cc.p(0,0));
miniGameLayer.setBounceEnabled(true);miniGameLayer.setPosition(left+2,bottom+2);this.addChild(miniGameLayer);this.miniGameLayer=miniGameLayer;for(var i=0;i<3;i++){var listGame=new newui.TableView(miniGameLayer.getContentSize(),1);listGame.setDirection(ccui.ScrollView.DIR_VERTICAL);listGame.setBounceEnabled(true);listGame.setScrollBarEnabled(false);miniGameLayer.addPage(listGame);this.allMiniLayer.push(listGame);for(var j=0;j<s_mini_game_id.length;j++)this.addMiniGame(s_mini_game_id[j],listGame)}miniGameLayer.addEventListener(function(){var i=
miniGameLayer.getCurrentPageIndex();thiz.selectTab(i,false)});leftBt.addClickEventListener(function(){thiz.selectTab(thiz.tabSelectedIndex-1,true)});rightBt.addClickEventListener(function(){thiz.selectTab(thiz.tabSelectedIndex+1,true)})},fetchHuThuong:function(){LobbyClient.getInstance().send({command:53});LobbyClient.getInstance().send({command:262});LobbyClient.getInstance().send({command:716})},onSocketMessage:function(command,data){data=data["data"];switch(data["cmd"]){case 53:var huCaoThapList=
data["511"];for(var i=0;i<3;i++)this.allMiniLayer[i].getItem(0).setGold(huCaoThapList[i]["512"]);break;case 262:var huMiniList=data["515"];for(var i=0;i<3;i++)this.allMiniLayer[i].getItem(1).setGold(huMiniList[i]["514"]);break;case 717:var huVideoList=data["1"];for(var i=0;i<3;i++)this.allMiniLayer[i].getItem(2).setGold(huVideoList[i]["2"]);break}},addMiniGame:function(gameId,listGame){var size=cc.size(280,92);var cell=new MiniGameCell(size,gameId,s_games_display_name[gameId]);listGame.pushItem(cell);
cell.setTouchEnabled(true);cell.addClickEventListener(function(){var homeScene=cc.director.getRunningScene();homeScene.onTouchGame(gameId)})},selectTab:function(index,selectTab){this.tabSelectedIndex=index;if(this.tabSelectedIndex<0)this.tabSelectedIndex=2;else if(this.tabSelectedIndex>2)this.tabSelectedIndex=0;if(selectTab)this.miniGameLayer.scrollToPage(this.tabSelectedIndex);this.goldTitle.setSpriteFrame("home-minigamebar-text"+(this.tabSelectedIndex+1)+".png")},onEnter:function(){this._super();
this.fetchHuThuong();this.selectTab(0,true);LobbyClient.getInstance().send({command:"subscribeMiniGame",gameType:"Mini_Poker"});LobbyClient.getInstance().send({command:"subscribeMiniGame",gameType:"Mini_Cao_Thap"});LobbyClient.getInstance().send({command:"subscribeMiniGame",gameType:"Video_Poker"})},onExit:function(){this._super();LobbyClient.getInstance().send({command:"unSubscribeMiniGame",gameType:"Mini_Poker"});LobbyClient.getInstance().send({command:"unSubscribeMiniGame",gameType:"Mini_Cao_Thap"});
LobbyClient.getInstance().send({command:"unSubscribeMiniGame",gameType:"Video_Poker"});LobbyClient.getInstance().removeListener(this)},startAnimation:function(){this.allMiniLayer[this.tabSelectedIndex].runMoveEffect(-2E3,.1,.1)}});var NewsSubLayer=cc.Node.extend({ctor:function(){this._super();var _top=554;var _bottom=100*cc.winSize.screenScale;var itemList=new newui.TableView(cc.size(cc.winSize.width,_top-_bottom),1);itemList.setDirection(ccui.ScrollView.DIR_VERTICAL);itemList.setScrollBarEnabled(false);itemList.setPadding(10);itemList.setMargin(10,30,0,0);itemList.setPosition(cc.p(0,_bottom));this.addChild(itemList,1);this.itemList=itemList}});
var NewsNotificationLayer=NewsSubLayer.extend({ctor:function(){this._super();this.newsType="event";this.dialogTitle="Th\u00f4ng b\u00e1o";var titleLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_25,"TH\u00d4NG B\u00c1O");titleLabel.setPosition(489*cc.winSize.screenScale,576);var timeLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_25,"TH\u1edcI GIAN");timeLabel.setPosition(1070*cc.winSize.screenScale,576);titleLabel.setOpacity(.2*255);timeLabel.setOpacity(.2*255);this.addChild(titleLabel);
this.addChild(timeLabel);this.titleLabel=titleLabel;this.addMessage("Th\u00f4ng b\u00e1o",Date.now(),"Ch\u00e0o m\u1eebng b\u1ea1n \u0111\u1ebfn v\u1edbi game b\u00e0i")},onExit:function(){this._super();LobbyClient.getInstance().removeListener(this)},addMessage:function(title,time,content){var container=new ccui.Widget;container.setContentSize(cc.size(this.itemList.getContentSize().width,80));this.itemList.pushItem(container);var bg1=new ccui.Scale9Sprite("sublobby-cell-bg.png",cc.rect(10,0,4,78));
bg1.setPreferredSize(cc.size(858*cc.winSize.screenScale,80));bg1.setPosition(489*cc.winSize.screenScale,bg1.getContentSize().height/2);container.addChild(bg1);var bg2=new ccui.Scale9Sprite("sublobby-cell-bg.png",cc.rect(10,0,4,78));bg2.setPreferredSize(cc.size(300*cc.winSize.screenScale,80));bg2.setPosition(1070*cc.winSize.screenScale,bg1.y);container.addChild(bg2);var titleLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_25,title);titleLabel.setPosition(bg1.getPosition());container.addChild(titleLabel);
var d=new Date(time);var timeLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_25,cc.Global.DateToString(d),cc.TEXT_ALIGNMENT_CENTER,1E3);timeLabel.setPosition(bg2.getPosition());container.addChild(timeLabel);container.setTouchEnabled(true);var thiz=this;container.addClickEventListener(function(){var dialog=new MessageDialog;dialog.title.setString(thiz.dialogTitle);dialog.setMessage(content);dialog.showWithAnimationScale()})}});
var NewsLayer=LobbySubLayer.extend({ctor:function(){this._super("#lobby-title-news.png");this.addChild(new NewsNotificationLayer)},onEnter:function(){this._super()}});var s_currency_icon=s_currency_icon||{};s_currency_icon["USD"]="$";
var PaymentInAppLayer=cc.Node.extend({ctor:function(){this._super();var listItem=new newui.TableView(cc.size(cc.winSize.width,450),2);listItem.setDirection(ccui.ScrollView.DIR_HORIZONTAL);listItem.setMargin(0,0,50,50);listItem.setPadding(30);listItem.setScrollBarEnabled(false);listItem.setPosition(0,130);this.addChild(listItem);this.listItem=listItem;this.initItems()},initItems:function(){var data=cc.Global.inAppBillingData;if(data){var thiz=this;for(var i=0;i<data.length;i++)(function(){var gold=
data[i]["gold"];var price=data[i]["price"];var currency=s_currency_icon[data[i]["currency"]];if(!currency)currency=data[i]["currency"];if(!currency)currency="VN\u0110";var inappId=data[i]["id"];var container=thiz.addItem(i%3+1,gold+" V",price+" "+currency);container.addClickEventListener(function(item){thiz._selectInappItem(inappId)})})()}},_selectInappItem:function(inappId){if(!LoadingDialog.getInstance().isShow()){LoadingDialog.getInstance().show("\u0110ang thanh to\u00e1n");SystemPlugin.getInstance().buyIAPItem(inappId)}},
addItem:function(logoId,gold,price){var bg=new cc.Sprite("#payment-inapp-bg.png");var container=new ccui.Widget;container.setContentSize(bg.getContentSize());bg.setPosition(container.getContentSize().width/2,container.getContentSize().height/2);container.addChild(bg);var icon=new cc.Sprite("#payment-inapp-icon-"+logoId+".png");icon.setPosition(bg.getPosition());container.addChild(icon);var goldLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_30,gold);goldLabel.setAnchorPoint(cc.p(0,
.5));goldLabel.setPosition(100,108);goldLabel.setColor(cc.color("#ffde00"));container.addChild(goldLabel);var priceLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_25,price);priceLabel.setAnchorPoint(cc.p(1,.5));priceLabel.setPosition(260,25);container.addChild(priceLabel,1);container.setTouchEnabled(true);this.listItem.pushItem(container);return container}});
var PaymentLayer=LobbySubLayer.extend({ctor:function(){this._super("#lobby-title-payment.png");if(cc.sys.isNative)this.addChild(new PaymentInAppLayer)},onEnter:function(){this._super()},onExit:function(){this._super()}});var RankSubLayer=cc.Node.extend({ctor:function(){this._super();this.initItemList();var _left=cc.winSize.width/2-340;var _padding=2;this.width1=106;this.width2=348;this.width3=220;this.x1=this.width1/2;this.x2=this.x1+this.width1/2+this.width2/2+_padding;this.x3=this.x2+this.width2/2+this.width3/2+_padding;var rankLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,"C\u1ea5p");rankLabel.setPosition(_left+this.x1,576);rankLabel.setColor(cc.color("#576eb0"));this.addChild(rankLabel);this.rankLabel=
rankLabel;var userLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,"Ng\u01b0\u1eddi ch\u01a1i");userLabel.setPosition(_left+this.x2,576);userLabel.setColor(cc.color("#576eb0"));this.addChild(userLabel);this.userLabel=userLabel;var scoreLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,"\u0110i\u1ec3m");scoreLabel.setPosition(_left+this.x3,576);scoreLabel.setColor(cc.color("#576eb0"));this.addChild(scoreLabel);this.scoreLabel=scoreLabel},initItemList:function(){var _top=
554;var _bottom=100*cc.winSize.screenScale;var _left=cc.winSize.width/2-340;var itemList=new newui.TableView(cc.size(680,_top-_bottom),1);itemList.setDirection(ccui.ScrollView.DIR_VERTICAL);itemList.setScrollBarEnabled(false);itemList.setPadding(10);itemList.setMargin(10,30,0,0);itemList.setPosition(cc.p(_left,_bottom));this.addChild(itemList,1);this.itemList=itemList},addItem:function(rank,username,score){var container=new ccui.Widget;container.setContentSize(cc.size(this.itemList.getContentSize().width,
58));this.itemList.pushItem(container);var bg1=new ccui.Scale9Sprite("sublobby-cell-bg.png",cc.rect(10,0,4,78));bg1.setPreferredSize(cc.size(this.width1,container.getContentSize().height));bg1.setPosition(this.x1,container.getContentSize().height/2);container.addChild(bg1);var bg2=new ccui.Scale9Sprite("sublobby-cell-bg.png",cc.rect(10,0,4,78));bg2.setPreferredSize(cc.size(this.width2,container.getContentSize().height));bg2.setPosition(this.x2,container.getContentSize().height/2);container.addChild(bg2);
var bg3=new ccui.Scale9Sprite("sublobby-cell-bg.png",cc.rect(10,0,4,78));bg3.setPreferredSize(cc.size(this.width3,container.getContentSize().height));bg3.setPosition(this.x3,container.getContentSize().height/2);container.addChild(bg3);var rankLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_25,rank);rankLabel.setColor(cc.color("#ffde00"));rankLabel.setPosition(bg1.getPosition());container.addChild(rankLabel);if(username.length>3&&username!=PlayerMe.username)username=username.substring(0,
username.length-3)+"***";var userLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,username,cc.TEXT_ALIGNMENT_CENTER);userLabel.setLineBreakWithoutSpace(true);userLabel.setDimensions(bg2.getContentSize().width-10,userLabel.getLineHeight());userLabel.setPosition(bg2.getPosition());container.addChild(userLabel);var scoreLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_18,score);scoreLabel.setPosition(bg3.getPosition());scoreLabel.setColor(cc.color("#ffde00"));container.addChild(scoreLabel)}});
var RankGoldLayer=RankSubLayer.extend({ctor:function(){this._super();this.scoreLabel.setString("V\u00e0ng");LobbyClient.getInstance().addListener("getTop",this.onGetTop,this);LobbyClient.getInstance().send({command:"getTop",type:2,limit:10})},onGetTop:function(command,data){data=data["data"]["2"];if(this.itemList.length>0||!data)return;for(var i=0;i<data.length;i++)this.addItem(i+1,data[i]["username"],data[i]["value"])},onExit:function(){this._super();LobbyClient.getInstance().removeListener(this)}});
var RankVipLayer=RankSubLayer.extend({ctor:function(){this._super();this.scoreLabel.setString("VIP");LobbyClient.getInstance().addListener("getTop",this.onGetTop,this);LobbyClient.getInstance().send({command:"getTop",type:3,limit:10})},onGetTop:function(command,data){data=data["data"]["3"];if(this.itemList.length>0||!data)return;for(var i=0;i<data.length;i++)this.addItem(i+1,data[i]["username"],data[i]["value"])},onExit:function(){this._super();LobbyClient.getInstance().removeListener(this)}});
var s_game_rank_id=s_game_rank_id||[GameType.GAME_MauBinh,GameType.GAME_TienLenMN,GameType.GAME_TLMN_Solo,GameType.GAME_Sam,GameType.GAME_Sam_Solo,GameType.GAME_Phom,GameType.GAME_BaCay,GameType.GAME_XocDia,GameType.GAME_TaiXiu];
var RankLevelLayer=RankSubLayer.extend({ctor:function(){this._super();LobbyClient.getInstance().addListener("getTop",this.onGetTop,this);var _left=cc.winSize.width/2-340;var _padding=2;this.width1=106;this.width2=242;this.width3=166;this.width4=160;this.x1=this.width1/2;this.x2=this.x1+this.width1/2+this.width2/2+_padding;this.x3=this.x2+this.width2/2+this.width3/2+_padding;this.x4=this.x3+this.width3/2+this.width4/2+_padding;this._left=_left;this.scoreLabel.removeFromParent(true);this.userLabel.setPositionX(_left+
this.x1);this.rankLabel.setPositionX(_left+this.x2);var winLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,"Th\u1eafng");winLabel.setPosition(_left+this.x3,this.rankLabel.y);winLabel.setColor(cc.color("#576eb0"));this.addChild(winLabel);var loseLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,"Thua");loseLabel.setPosition(_left+this.x4,this.rankLabel.y);loseLabel.setColor(cc.color("#576eb0"));this.addChild(loseLabel);var typeToggle=new ToggleNodeGroup;var itemCount=
0;for(var i=0;i<s_game_rank_id.length;i++){var gameId=s_game_rank_id[i];if(s_game_available[gameId])itemCount++}var dy=80;var width=180;var height=dy*itemCount;var x=width/2-18;var y=height-dy/2;typeToggle.setAnchorPoint(cc.p(0,0));typeToggle.setContentSize(cc.size(width,height));typeToggle.setScale(cc.winSize.screenScale);var scrollView=new newui.TableView(cc.size(width*cc.winSize.screenScale,dy*5),1);scrollView.setPosition(cc.winSize.width-width*cc.winSize.screenScale,140);scrollView.pushItem(typeToggle);
this.addChild(scrollView,1);var selectBg=new cc.Sprite("#rank_label_selected_1.png");selectBg.setPosition(x,y);typeToggle.addChild(selectBg);var selectIcon=new cc.Sprite("#rank_label_selected_2.png");selectIcon.setPosition(width-selectIcon.getContentSize().width/2,y);typeToggle.addChild(selectIcon);var thiz=this;for(var i=0;i<s_game_rank_id.length;i++)(function(){var gameId=s_game_rank_id[i];if(s_game_available[gameId]){var icon1=new cc.Sprite("#rank_label_"+gameId+"_1.png");var icon2=new cc.Sprite("#rank_label_"+
gameId+"_2.png");icon1.setPosition(x,y);icon2.setPosition(icon1.getPosition());typeToggle.addChild(icon1);typeToggle.addChild(icon2);var toggleItem=new ToggleNodeItem(icon1.getContentSize());toggleItem.setPosition(icon1.getPosition());typeToggle.addItem(toggleItem);toggleItem.onSelect=function(isForce){icon1.setVisible(false);icon2.setVisible(true);selectBg.y=icon1.y;selectIcon.y=icon1.y;thiz.requestGetTop(gameId)};toggleItem.onUnSelect=function(){icon1.setVisible(true);icon2.setVisible(false)};y-=
dy}})();this.typeToggle=typeToggle},requestGetTop:function(gameId){this.itemList.removeAllItems();LobbyClient.getInstance().send({command:"getTop",type:1,gameType:s_games_chanel[gameId],limit:10})},onEnter:function(){this._super();this.typeToggle.selectItem(0)},onGetTop:function(command,data){cc.log(JSON.stringify(data));data=data["data"]["1"];if(!data)return;this.itemList.removeAllItems();for(var i=0;i<data.length;i++)this.addItem(i+1,data[i]["username"],data[i]["winGold"],data[i]["looseGold"])},
addItem:function(rank,username,win,lose){var container=new ccui.Widget;container.setContentSize(cc.size(this.itemList.getContentSize().width,58));this.itemList.pushItem(container);var bg1=new ccui.Scale9Sprite("sublobby-cell-bg.png",cc.rect(10,0,4,78));bg1.setPreferredSize(cc.size(this.width1,container.getContentSize().height));bg1.setPosition(this.x1,container.getContentSize().height/2);container.addChild(bg1);var bg2=new ccui.Scale9Sprite("sublobby-cell-bg.png",cc.rect(10,0,4,78));bg2.setPreferredSize(cc.size(this.width2,
container.getContentSize().height));bg2.setPosition(this.x2,container.getContentSize().height/2);container.addChild(bg2);var bg3=new ccui.Scale9Sprite("sublobby-cell-bg.png",cc.rect(10,0,4,78));bg3.setPreferredSize(cc.size(this.width3,container.getContentSize().height));bg3.setPosition(this.x3,container.getContentSize().height/2);container.addChild(bg3);var bg4=new ccui.Scale9Sprite("sublobby-cell-bg.png",cc.rect(10,0,4,78));bg4.setPreferredSize(cc.size(this.width4,container.getContentSize().height));
bg4.setPosition(this.x4,container.getContentSize().height/2);container.addChild(bg4);var rankLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_25,rank);rankLabel.setColor(cc.color("#ffde00"));rankLabel.setPosition(bg1.getPosition());container.addChild(rankLabel);if(username.length>3&&username!=PlayerMe.username)username=username.substring(0,username.length-3)+"***";var userLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,username,cc.TEXT_ALIGNMENT_CENTER);userLabel.setLineBreakWithoutSpace(true);
userLabel.setDimensions(bg2.getContentSize().width-10,userLabel.getLineHeight());userLabel.setPosition(bg2.getPosition());container.addChild(userLabel);var winLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,win);winLabel.setColor(cc.color("#ffde00"));winLabel.setPosition(bg3.getPosition());container.addChild(winLabel);var loseLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,lose);loseLabel.setPosition(bg4.getPosition());container.addChild(loseLabel)},onExit:function(){this._super();
LobbyClient.getInstance().removeListener(this)}});var rank_tab_1=rank_tab_1||["#rank-tab-1.png","#rank-tab-2.png","#rank-tab-3.png"];var rank_tab_2=rank_tab_2||["#rank-tab-selected-1.png","#rank-tab-selected-2.png","#rank-tab-selected-3.png"];
var RankLayer=LobbySubLayer.extend({ctor:function(){this._super("#lobby-title-rank.png");var allLayer=[new RankGoldLayer,new RankVipLayer,new RankLevelLayer];for(var i=0;i<allLayer.length;i++)this.addChild(allLayer[i]);this._initTab(rank_tab_1,rank_tab_2,allLayer)},onEnter:function(){this._super();this.mToggle.selectItem(0)}});var s_text_color=s_text_color||cc.color("#ffffff");var s_text_color_readed=s_text_color_readed||cc.color(120,120,120,255);
var InboxLayer=LobbySubLayer.extend({ctor:function(){this._super("#lobby-title-newMessage.png");var timeLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_20,"Th\u1eddi gian");timeLabel.setColor(cc.color("#576eb0"));timeLabel.setPosition(185*cc.winSize.screenScale,576);var senderLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_20,"Ng\u01b0\u1eddi g\u1eedi");senderLabel.setColor(cc.color("#576eb0"));senderLabel.setPosition(437*cc.winSize.screenScale,576);var titleLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_20,
"N\u1ed9i dung");titleLabel.setColor(cc.color("#576eb0"));titleLabel.setPosition(892*cc.winSize.screenScale,576);this.addChild(timeLabel);this.addChild(senderLabel);this.addChild(titleLabel);var _top=554;var _bottom=0;var messageList=new newui.TableView(cc.size(cc.winSize.width,_top-_bottom),1);messageList.setDirection(ccui.ScrollView.DIR_VERTICAL);messageList.setScrollBarEnabled(false);messageList.setPadding(10);messageList.setMargin(10,10,0,0);messageList.setPosition(cc.p(0,_bottom));this.addChild(messageList,
1);this.messageList=messageList;LobbyClient.getInstance().addListener("fetchMultiMessageInbox",this.onRecvMessageInbox,this);LobbyClient.getInstance().addListener("inboxMessage",this.onUpdateMessageCount,this)},addMessage:function(messageId,time,sender,title,content,status){var textColor=s_text_color;if(status==6)textColor=s_text_color_readed;var container=new ccui.Widget;container.messageId=messageId;container.setContentSize(cc.size(this.messageList.getContentSize().width,80));this.messageList.pushItem(container);
var bg1=new ccui.Scale9Sprite("sublobby-cell-bg.png",cc.rect(10,0,4,78));bg1.setPreferredSize(cc.size(250*cc.winSize.screenScale,80));bg1.setPosition(185*cc.winSize.screenScale,bg1.getContentSize().height/2);container.addChild(bg1);var bg2=new ccui.Scale9Sprite("sublobby-cell-bg.png",cc.rect(10,0,4,78));bg2.setPreferredSize(cc.size(250*cc.winSize.screenScale,80));bg2.setPosition(437*cc.winSize.screenScale,bg1.y);container.addChild(bg2);var bg3=new ccui.Scale9Sprite("sublobby-cell-bg.png",cc.rect(10,
0,4,78));bg3.setPreferredSize(cc.size(656*cc.winSize.screenScale,80));bg3.setPosition(892*cc.winSize.screenScale,bg1.y);container.addChild(bg3);var d=new Date(time);var timeString=cc.Global.DateToString(d);var timeLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_20,timeString,cc.TEXT_ALIGNMENT_CENTER,bg1.getContentSize().width);timeLabel.setPosition(bg1.getPosition());timeLabel.setColor(textColor);container.addChild(timeLabel);container.timeLabel=timeLabel;var senderLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_20,
sender);senderLabel.setPosition(bg2.getPosition());senderLabel.setColor(textColor);container.addChild(senderLabel);container.senderLabel=senderLabel;var titleLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_20,title);titleLabel.setPosition(bg3.getPosition());titleLabel.setColor(textColor);container.titleLabel=titleLabel;container.addChild(titleLabel);container.setTouchEnabled(true);container.addClickEventListener(function(){var dialog=new MessageDialog;dialog.title.setString("Tin nh\u1eafn");
dialog.setMessage(content);dialog.showWithAnimationScale();if(status===1){var request={command:"markReadedMessageInbox",messageId:messageId};LobbyClient.getInstance().send(request);timeLabel.setColor(s_text_color_readed);senderLabel.setColor(s_text_color_readed);titleLabel.setColor(s_text_color_readed)}})},onEnter:function(){this._super();this.requestAllMessage()},onExit:function(){this._super();LobbyClient.getInstance().removeListener(this)},requestAllMessage:function(){var msg={command:"fetchMultiMessageInbox"};
LobbyClient.getInstance().send(msg)},onUpdateMessageCount:function(cmd,data){this.requestAllMessage()},onRecvMessageInbox:function(cmd,data){var msg=data["data"]["messages"];if(msg&&msg.length>0){cc.log("onRecvMessageInbox");this.messageList.removeAllItems();for(var i=0;i<msg.length;i++)if(msg[i].type===1)this.addMessage(msg[i].messageId,msg[i].sendTime,msg[i].senderName,msg[i].title,msg[i].content,msg[i].status)}}});var _activity_request_reward=function(itemId){var request={command:"getBonusMission",landmarkId:itemId};LobbyClient.getInstance().send(request)};
var ActivityDiemDanhLayer=cc.Node.extend({ctor:function(){this._super();LobbyClient.getInstance().addListener("fetchAttendanceLandmark",this._onRecvData,this);var mNode=new cc.Node;this.addChild(mNode);this.mNode=mNode;var nameLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_20,"\u0110i\u1ec3m danh");nameLabel.setColor(cc.color("#ffde00"));nameLabel.setAnchorPoint(cc.p(0,.5));nameLabel.setPosition(356,575);mNode.addChild(nameLabel);var contentLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,
cc.Global.getStringRes()["Mission"]["diemdanhContent"],cc.TEXT_ALIGNMENT_LEFT,570);contentLabel.setColor(cc.color("#ffffff"));contentLabel.setAnchorPoint(cc.p(0,1));contentLabel.setPosition(356,550);mNode.addChild(contentLabel);var dateLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_16,"Ng\u00e0y");dateLabel.setColor(cc.color("#4d6181"));dateLabel.setPosition(394,433);mNode.addChild(dateLabel);var rewardLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_16,"Ph\u1ea7n th\u01b0\u1edfng");
rewardLabel.setColor(cc.color("#4d6181"));rewardLabel.setPosition(529,433);mNode.addChild(rewardLabel);var statusLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_16,"Tr\u1ea1ng th\u00e1i");statusLabel.setAnchorPoint(cc.p(0,.5));statusLabel.setColor(cc.color("#4d6181"));statusLabel.setPosition(664,433);mNode.addChild(statusLabel);var listItem=new newui.TableView(cc.size(641,310),1);listItem.setPosition(cc.p(355,98));listItem.setMargin(10,10,0,0);mNode.addChild(listItem);this.listItem=listItem},
onExit:function(){this._super();LobbyClient.getInstance().removeListener(this)},setVisible:function(visible){this._super(visible);if(visible){this.mNode.visible=false;LobbyClient.getInstance().send({command:"fetchAttendanceLandmark"})}},_onRecvData:function(cmd,data){var items=data["data"]["landmarks"];if(items.length>0){this.mNode.visible=true;this.listItem.removeAllItems();for(var i=0;i<items.length;i++){var itemId=items[i]["id"];var name=items[i]["name"];var reward=items[i]["prize"];var status=
items[i]["status"];if(status==2)var result=0;else if(status==3)var result=1;else{var result=items[i]["statusDesc"];if(!result)result="Ch\u01b0a ho\u00e0n th\u00e0nh"}this.addItem(name,reward,result,itemId)}}},addItem:function(date,reward,status,itemId){var container=new ccui.Widget;container.setContentSize(cc.size(this.listItem.getContentSize().width,50));this.listItem.pushItem(container);if(this.listItem.size()%2){var bg=new ccui.Scale9Sprite("activity_cell_bg.png",cc.rect(10,10,4,4));bg.setPreferredSize(container.getContentSize());
bg.setAnchorPoint(cc.p(0,0));container.addChild(bg)}var dateBg=new cc.Sprite("#activity_bg_1.png");dateBg.setPosition(40,container.getContentSize().height/2);container.addChild(dateBg);var dateLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_18,date);dateLabel.setColor(cc.color("#ffde00"));dateLabel.setPosition(dateBg.getPosition());container.addChild(dateLabel);var rewardLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_18,reward);rewardLabel.setColor(cc.color("#ffde00"));
rewardLabel.setPosition(175,dateLabel.y);container.addChild(rewardLabel);if(status===0||status===1){var statusLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,"\u0110\u00e3 nh\u1eadn");statusLabel.setColor(cc.color("#ffde00"));statusLabel.setAnchorPoint(cc.p(0,.5));statusLabel.setPosition(310,dateLabel.y);container.addChild(statusLabel);if(status===1){statusLabel.visible=false;var okButton=new ccui.Button("activity_button_1.png","","",ccui.Widget.PLIST_TEXTURE);okButton.setAnchorPoint(cc.p(0,
.5));okButton.setPosition(310,dateLabel.y);okButton.setZoomScale(.01);container.addChild(okButton);okButton.addClickEventListener(function(){statusLabel.visible=true;okButton.visible=false;_activity_request_reward(itemId)})}}else{var statusLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,status);statusLabel.setColor(cc.color("#95c8e6"));statusLabel.setAnchorPoint(cc.p(0,.5));statusLabel.setPosition(310,dateLabel.y);container.addChild(statusLabel)}}});
var ActivityLoginLayer=cc.Node.extend({ctor:function(){this._super();LobbyClient.getInstance().addListener("fetchLoginAccumulationLandmark",this._onRecvData,this);var mNode=new cc.Node;this.addChild(mNode);this.mNode=mNode;var nameLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_20,"T\u00edch l\u0169y \u0111\u0103ng nh\u1eadp");nameLabel.setColor(cc.color("#ffde00"));nameLabel.setAnchorPoint(cc.p(0,.5));nameLabel.setPosition(356,575);mNode.addChild(nameLabel);var contentLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,
cc.Global.getStringRes()["Mission"]["loginContent"],cc.TEXT_ALIGNMENT_LEFT,570);contentLabel.setColor(cc.color("#ffffff"));contentLabel.setAnchorPoint(cc.p(0,1));contentLabel.setPosition(356,550);mNode.addChild(contentLabel);var dateLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_16,"Ng\u00e0y");dateLabel.setColor(cc.color("#4d6181"));dateLabel.setPosition(394,485);mNode.addChild(dateLabel);var rewardLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_16,"Ph\u1ea7n th\u01b0\u1edfng");
rewardLabel.setColor(cc.color("#4d6181"));rewardLabel.setPosition(529,485);mNode.addChild(rewardLabel);var statusLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_16,"Tr\u1ea1ng th\u00e1i");statusLabel.setAnchorPoint(cc.p(0,.5));statusLabel.setColor(cc.color("#4d6181"));statusLabel.setPosition(664,485);mNode.addChild(statusLabel);var listItem=new newui.TableView(cc.size(641,370),1);listItem.setPosition(cc.p(355,98));listItem.setMargin(10,10,0,0);mNode.addChild(listItem);this.listItem=listItem},
onExit:function(){this._super();LobbyClient.getInstance().removeListener(this)},setVisible:function(visible){this._super(visible);if(visible){this.mNode.visible=false;LobbyClient.getInstance().send({command:"fetchLoginAccumulationLandmark"})}},_onRecvData:function(cmd,data){var items=data["data"]["landmarks"];if(items.length>0){this.mNode.visible=true;this.listItem.removeAllItems();for(var i=0;i<items.length;i++){var itemId=items[i]["id"];var name=items[i]["name"];var reward=items[i]["prize"];var status=
items[i]["status"];if(status==2)var result=0;else if(status==3)var result=1;else{var result=items[i]["statusDesc"];if(!result)result="Ch\u01b0a ho\u00e0n th\u00e0nh"}this.addItem(name,reward,result,itemId)}}},addItem:function(date,reward,status,itemId){var container=new ccui.Widget;container.setContentSize(cc.size(this.listItem.getContentSize().width,50));this.listItem.pushItem(container);if(this.listItem.size()%2){var bg=new ccui.Scale9Sprite("activity_cell_bg.png",cc.rect(10,10,4,4));bg.setPreferredSize(container.getContentSize());
bg.setAnchorPoint(cc.p(0,0));container.addChild(bg)}var dateBg=new cc.Sprite("#activity_bg_1.png");dateBg.setPosition(40,container.getContentSize().height/2);container.addChild(dateBg);var dateLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_18,date);dateLabel.setColor(cc.color("#ffde00"));dateLabel.setPosition(dateBg.getPosition());container.addChild(dateLabel);var rewardLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_18,reward);rewardLabel.setColor(cc.color("#ffde00"));
rewardLabel.setPosition(175,dateLabel.y);container.addChild(rewardLabel);if(status===0||status===1){var statusLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,"\u0110\u00e3 nh\u1eadn");statusLabel.setColor(cc.color("#ffde00"));statusLabel.setAnchorPoint(cc.p(0,.5));statusLabel.setPosition(310,dateLabel.y);container.addChild(statusLabel);if(status===1){statusLabel.visible=false;var okButton=new ccui.Button("activity_button_1.png","","",ccui.Widget.PLIST_TEXTURE);okButton.setAnchorPoint(cc.p(0,
.5));okButton.setPosition(310,dateLabel.y);okButton.setZoomScale(.01);container.addChild(okButton);okButton.addClickEventListener(function(){statusLabel.visible=true;okButton.visible=false;_activity_request_reward(itemId)})}}else{var statusLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,status);statusLabel.setColor(cc.color("#95c8e6"));statusLabel.setAnchorPoint(cc.p(0,.5));statusLabel.setPosition(310,dateLabel.y);container.addChild(statusLabel)}}});
var ActivityOnlineLayer=cc.Node.extend({ctor:function(){this._super();LobbyClient.getInstance().addListener("fetchOnlineAccumulationLandmark",this._onRecvData,this);var mNode=new cc.Node;this.addChild(mNode);this.mNode=mNode;var nameLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_20,"Online nh\u1eadn qu\u00e0");nameLabel.setColor(cc.color("#ffde00"));nameLabel.setAnchorPoint(cc.p(0,.5));nameLabel.setPosition(356,575);mNode.addChild(nameLabel);var contentLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,
cc.Global.getStringRes()["Mission"]["onlineContent"],cc.TEXT_ALIGNMENT_LEFT,570);contentLabel.setColor(cc.color("#ffffff"));contentLabel.setAnchorPoint(cc.p(0,1));contentLabel.setPosition(356,550);mNode.addChild(contentLabel);var timeLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_16,"Th\u1eddi gian");timeLabel.setColor(cc.color("#4d6181"));timeLabel.setPosition(394,485);mNode.addChild(timeLabel);var rewardLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_16,"Ph\u1ea7n th\u01b0\u1edfng");
rewardLabel.setColor(cc.color("#4d6181"));rewardLabel.setPosition(529,485);mNode.addChild(rewardLabel);var statusLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_16,"Tr\u1ea1ng th\u00e1i");statusLabel.setAnchorPoint(cc.p(0,.5));statusLabel.setColor(cc.color("#4d6181"));statusLabel.setPosition(664,485);mNode.addChild(statusLabel);var listItem=new newui.TableView(cc.size(641,370),1);listItem.setPosition(cc.p(355,98));listItem.setMargin(10,10,0,0);mNode.addChild(listItem);this.listItem=listItem},
onExit:function(){this._super();LobbyClient.getInstance().removeListener(this)},setVisible:function(visible){this._super(visible);if(visible){this.mNode.visible=false;LobbyClient.getInstance().send({command:"fetchOnlineAccumulationLandmark"})}},_onRecvData:function(cmd,data){var items=data["data"]["landmarks"];if(items.length>0){this.mNode.visible=true;this.listItem.removeAllItems();for(var i=0;i<items.length;i++){var itemId=items[i]["id"];var name=items[i]["name"];var reward=items[i]["prize"];var status=
items[i]["status"];if(status==2)var result=0;else if(status==3)var result=1;else{var result=items[i]["statusDesc"];if(!result)result="Ch\u01b0a ho\u00e0n th\u00e0nh"}this.addItem(name,reward,result,itemId)}}},addItem:function(time,reward,status,itemId){var container=new ccui.Widget;container.setContentSize(cc.size(this.listItem.getContentSize().width,50));this.listItem.pushItem(container);if(this.listItem.size()%2){var bg=new ccui.Scale9Sprite("activity_cell_bg.png",cc.rect(10,10,4,4));bg.setPreferredSize(container.getContentSize());
bg.setAnchorPoint(cc.p(0,0));container.addChild(bg)}var timeLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_18,time);timeLabel.setColor(cc.color("#95c8e6"));timeLabel.setPosition(40,container.getContentSize().height/2);container.addChild(timeLabel);var rewardLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_18,reward);rewardLabel.setColor(cc.color("#ffde00"));rewardLabel.setPosition(175,timeLabel.y);container.addChild(rewardLabel);if(status===0||status===1){var statusLabel=
cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,"\u0110\u00e3 nh\u1eadn");statusLabel.setColor(cc.color("#ffde00"));statusLabel.setAnchorPoint(cc.p(0,.5));statusLabel.setPosition(310,timeLabel.y);container.addChild(statusLabel);if(status===1){statusLabel.visible=false;var okButton=new ccui.Button("activity_button_1.png","","",ccui.Widget.PLIST_TEXTURE);okButton.setAnchorPoint(cc.p(0,.5));okButton.setPosition(statusLabel.getPosition());okButton.setZoomScale(.01);container.addChild(okButton);
okButton.addClickEventListener(function(){statusLabel.visible=true;okButton.visible=false;_activity_request_reward(itemId)})}}else{var statusLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,status);statusLabel.setColor(cc.color("#95c8e6"));statusLabel.setAnchorPoint(cc.p(0,.5));statusLabel.setPosition(310,timeLabel.y);container.addChild(statusLabel)}}});
var ActivityQuestTab=ccui.Widget.extend({ctor:function(tabName){this._super();var nameLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_16,tabName);this.setContentSize(cc.size(nameLabel.getContentSize().width+30,44));nameLabel.setPosition(this.getContentSize().width/2,this.getContentSize().height/2);this.addChild(nameLabel,1);var selectSprite=new ccui.Scale9Sprite("activity_tab_1.png",cc.rect(10,10,4,4));selectSprite.setPreferredSize(cc.size(this.getContentSize()));selectSprite.setPosition(nameLabel.getPosition());
this.addChild(selectSprite);this.nameLabel=nameLabel;this.selectSprite=selectSprite},select:function(selected){if(selected){this.selectSprite.visible=true;this.nameLabel.setColor(cc.color("#364865"));this.setTouchEnabled(false)}else{this.selectSprite.visible=false;this.nameLabel.setColor(cc.color("#69768d"));this.setTouchEnabled(true)}}});
var ActivityQuestLayer=cc.Node.extend({ctor:function(){this._super();LobbyClient.getInstance().addListener("fetchUserLandmark",this._onRecvItemData,this);LobbyClient.getInstance().addListener("fetchMissionInActionGroup",this._onRecvGroupData,this);var mNode=new cc.Node;this.addChild(mNode);this.mNode=mNode;this.itemNode=new cc.Node;mNode.addChild(this.itemNode);var questLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_16,"Nhi\u1ec7m v\u1ee5");questLabel.setAnchorPoint(cc.p(0,.5));questLabel.setColor(cc.color("#4d6181"));
questLabel.setPosition(375,507);mNode.addChild(questLabel);var rewardLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_16,"Ph\u1ea7n th\u01b0\u1edfng");rewardLabel.setColor(cc.color("#4d6181"));rewardLabel.setPosition(704,507);mNode.addChild(rewardLabel);var statusLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_16,"Tr\u1ea1ng th\u00e1i");statusLabel.setAnchorPoint(cc.p(0,.5));statusLabel.setColor(cc.color("#4d6181"));statusLabel.setPosition(789,507);mNode.addChild(statusLabel);
var listItem=new newui.TableView(cc.size(641,370),1);listItem.setPosition(cc.p(355,98));listItem.setMargin(10,10,0,0);this.itemNode.addChild(listItem);this.listItem=listItem;var groupList=new newui.TableView(cc.size(641,75),1);groupList.setDirection(ccui.ScrollView.DIR_HORIZONTAL);groupList.setPosition(cc.p(355,529));groupList.setMargin(0,0,20,20);mNode.addChild(groupList);this.groupList=groupList},onExit:function(){this._super();LobbyClient.getInstance().removeListener(this)},setVisible:function(visible){this._super(visible);
if(visible){this.mNode.visible=false;LobbyClient.getInstance().send({command:"fetchMissionInActionGroup"})}},_onRecvGroupData:function(cmd,data){this.groupItem=null;var items=data["data"]["userMissions"];if(items.length>0){this.listItem.removeAllItems();this.groupList.removeAllItems();this.mNode.visible=true;this.itemNode.visible=false;for(var i=0;i<items.length;i++){var name=items[i]["name"];var groupId=items[i]["id"];this.addGroup(name,groupId)}}},_onRecvItemData:function(cmd,data){var items=data["data"]["landmarks"];
if(items.length>0){this.mNode.visible=true;this.listItem.removeAllItems();for(var i=0;i<items.length;i++){var itemId=items[i]["id"];var name=items[i]["name"];var reward=items[i]["prize"];var status=items[i]["status"];if(status==2)var result=0;else if(status==3)var result=1;else{var result=items[i]["statusDesc"];if(!result)result="Ch\u01b0a ho\u00e0n th\u00e0nh"}this.addItem(name,reward,result,itemId)}}},_selectGroup:function(groupItem,groupId){if(this.groupItem){this.groupItem.select(false);this.groupItem=
null}groupItem.select(true);this.groupItem=groupItem;if(groupId){var request={command:"fetchUserLandmark",missionId:groupId};LobbyClient.getInstance().send(request);this.itemNode.visible=false}},addGroup:function(name,groupId){var thiz=this;var groupItem=new ActivityQuestTab(name);this.groupList.pushItem(groupItem);groupItem.select(false);groupItem.addClickEventListener(function(){thiz._selectGroup(groupItem,groupId)});if(this.groupList.size()==1){this.groupItem=null;thiz._selectGroup(groupItem,groupId)}},
addItem:function(date,reward,status,itemId){var questLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_18,"Nhi\u1ec7m v\u1ee5",cc.TEXT_ALIGNMENT_LEFT,245);var containerHeight=questLabel.getContentSize().height;if(containerHeight<50)containerHeight=50;var container=new ccui.Widget;container.setContentSize(cc.size(this.listItem.getContentSize().width,containerHeight));this.listItem.pushItem(container);if(this.listItem.size()%2){var bg=new ccui.Scale9Sprite("activity_cell_bg.png",cc.rect(10,
10,4,4));bg.setPreferredSize(container.getContentSize());bg.setAnchorPoint(cc.p(0,0));container.addChild(bg)}questLabel.setColor(cc.color("#95c8e6"));questLabel.setAnchorPoint(cc.p(0,.5));questLabel.setPosition(20,container.getContentSize().height/2);container.addChild(questLabel);var rewardLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_18,reward);rewardLabel.setColor(cc.color("#ffde00"));rewardLabel.setPosition(350,questLabel.y);container.addChild(rewardLabel);if(status===0||status===
1){var statusLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,"\u0110\u00e3 nh\u1eadn");statusLabel.setColor(cc.color("#ffde00"));statusLabel.setAnchorPoint(cc.p(0,.5));statusLabel.setPosition(435,questLabel.y);container.addChild(statusLabel);if(status===1){statusLabel.visible=false;var okButton=new ccui.Button("activity_button_1.png","","",ccui.Widget.PLIST_TEXTURE);okButton.setAnchorPoint(cc.p(0,.5));okButton.setPosition(statusLabel.getPosition());okButton.setZoomScale(.01);container.addChild(okButton);
okButton.addClickEventListener(function(){statusLabel.visible=true;okButton.visible=false;_activity_request_reward(itemId)})}}else{var statusLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,status);statusLabel.setColor(cc.color("#95c8e6"));statusLabel.setAnchorPoint(cc.p(0,.5));statusLabel.setPosition(435,questLabel.y);container.addChild(statusLabel)}}});
var ActivityEventLayer=cc.Node.extend({ctor:function(){this._super();LobbyClient.getInstance().addListener("getNews",this._onRecvData,this);var mNode=new cc.Node;this.addChild(mNode);this.mNode=mNode;6;var titleLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_16,"N\u1ed9i dung");titleLabel.setColor(cc.color("#4d6181"));titleLabel.setPosition(572,580);mNode.addChild(titleLabel);var timeLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_16,"Th\u1eddi gian");timeLabel.setColor(cc.color("#4d6181"));
timeLabel.setPosition(892,580);mNode.addChild(timeLabel);var listItem=new newui.TableView(cc.size(641,460),1);listItem.setPosition(cc.p(355,98));listItem.setMargin(10,10,0,0);mNode.addChild(listItem);this.listItem=listItem},onExit:function(){this._super();LobbyClient.getInstance().removeListener(this)},setVisible:function(visible){this._super(visible);if(visible){this.mNode.visible=false;var request={command:"getNews",type:"MISSION"};LobbyClient.getInstance().send(request)}},_onRecvData:function(cmd,
data){var items=data["data"]["mission"];if(items&&items.length>0){this.listItem.removeAllItems();for(var i=0;i<items.length;i++){var title=items[i]["title"];var content=items[i]["content"];var time=items[i]["createTime"];this.addItem(title,content,cc.Global.DateToString(new Date(time)))}}},addItem:function(title,time,content){var titleLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_18,title,cc.TEXT_ALIGNMENT_CENTER,400);var containerHeight=titleLabel.getContentSize().height;if(containerHeight<
50)containerHeight=50;var container=new ccui.Widget;container.setContentSize(cc.size(this.listItem.getContentSize().width,containerHeight));this.listItem.pushItem(container);if(this.listItem.size()%2){var bg=new ccui.Scale9Sprite("activity_cell_bg.png",cc.rect(10,10,4,4));bg.setPreferredSize(container.getContentSize());bg.setAnchorPoint(cc.p(0,0));container.addChild(bg)}titleLabel.setColor(cc.color("#95c8e6"));titleLabel.setPosition(218,container.getContentSize().height/2);container.addChild(titleLabel);
var timeLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_18,time);timeLabel.setColor(cc.color("#ffde00"));timeLabel.setPosition(538,titleLabel.y);container.addChild(timeLabel);container.setTouchEnabled(true);container.addClickEventListener(function(){var dialog=new MessageDialog;dialog.setTitle(title);dialog.setMessage(content);dialog.showWithAnimationScale()})}});var s_activity_tab_name=s_activity_tab_name||["\u0110I\u1ec2M DANH","T\u00cdCH L\u0168Y \u0110\u0102NG NH\u1eacP","ONLINE NH\u1eacN QU\u00c0","NHI\u1ec6M V\u1ee4","S\u1ef0 KI\u1ec6N"];
var ActivityCountNode=InboxCountNode.extend({_initListener:function(){LobbyClient.getInstance().addListener("updateLandmarkCompleted",this.refreshView,this)},refreshView:function(){if(PlayerMe.missionCount<=0)this.newsBg.visible=false;else{this.newsBg.visible=true;if(PlayerMe.missionCount>9)this.newLabel.setString("9+");else this.newLabel.setString(PlayerMe.missionCount.toString())}}});
var ActivityTab=ToggleNodeItem.extend({ctor:function(title){this._super(cc.size(260,60));var titleLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_18,title);titleLabel.setAnchorPoint(cc.p(0,.5));titleLabel.setPosition(cc.p(18,this.getContentSize().height/2+10));this.addChild(titleLabel);this.titleLabel=titleLabel;var statusLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_16,"status");statusLabel.setAnchorPoint(cc.p(0,.5));statusLabel.setPosition(cc.p(titleLabel.x,this.getContentSize().height/
2-10));this.addChild(statusLabel);this.statusLabel=statusLabel},setStatus:function(status){this.statusLabel.setString(status)},select:function(isForce,ext){this.titleLabel.setColor(cc.color("#682e2e"));this.statusLabel.setColor(cc.color("#682e2e"));this._super(isForce,ext)},unSelect:function(isForce,ext){this.titleLabel.setColor(cc.color("#4c6080"));this.statusLabel.setColor(cc.color("#4c6080"));this._super(isForce,ext)}});
var ActivityDialog=Dialog.extend({ctor:function(){this._super();LobbyClient.getInstance().addListener("fetchUserMissionInfo",this._onRecvActivityStatus,this);this.okButton.visible=false;this.cancelButton.visible=false;this.title.setString("Ho\u1ea1t \u0111\u1ed9ng");this.initWithSize(cc.size(918,578));this._initView()},_initView:function(){var allLayer=[new ActivityDiemDanhLayer,new ActivityLoginLayer,new ActivityOnlineLayer,new ActivityQuestLayer,new ActivityEventLayer];for(var i=0;i<allLayer.length;i++)this.addChild(allLayer[i]);
var selectSprite=new cc.Sprite("#activiti_tab_2.png");selectSprite.setPosition(210,100);this.addChild(selectSprite);var mToggle=new ToggleNodeGroup;this.mToggle=mToggle;this.allTab=[];var thiz=this;this.addChild(mToggle);for(var i=0;i<s_activity_tab_name.length;i++)(function(){var mNode=allLayer[i];var tab=new ActivityTab(s_activity_tab_name[i]);thiz.allTab.push(tab);tab.setPosition(thiz._marginLeft+tab.getContentSize().width/2,thiz._marginBottom+480-i*60);tab.onSelect=function(isForce){mNode.setVisible(true);
if(isForce)selectSprite.y=tab.y;else{selectSprite.stopAllActions();selectSprite.runAction(new cc.MoveTo(.1,cc.p(selectSprite.x,tab.y)))}};tab.onUnSelect=function(){mNode.setVisible(false)};mToggle.addItem(tab)})()},_onRecvActivityStatus:function(cmd,data){var type=data["data"]["typeMission"];var info=data["data"]["shortInfo"];if(type==0)this.allTab[0].setStatus(info);else if(type==2)this.allTab[1].setStatus(info);else if(type==3)this.allTab[2].setStatus(info);else if(type==1)this.allTab[3].setStatus(info)},
onEnter:function(){this._super();this.mToggle.selectItem(0);cc.Label.c;for(var i=0;i<this.allTab.length;i++)this.allTab[i].setStatus("");LobbyClient.getInstance().send({command:"fetchUserMissionInfo",typeMission:0});LobbyClient.getInstance().send({command:"fetchUserMissionInfo",typeMission:1});LobbyClient.getInstance().send({command:"fetchUserMissionInfo",typeMission:2});LobbyClient.getInstance().send({command:"fetchUserMissionInfo",typeMission:3})},onExit:function(){this._super();LobbyClient.getInstance().removeListener(this)}});
var ActivityNotificationNode=cc.Node.extend({ctor:function(){this._super();LobbyClient.getInstance().addListener("inboxMessage",this._onInboxMessageHandler,this);var bg=new cc.Sprite("#top_bar_news_bg.png");bg.setPosition(cc.p(0,0));this.addChild(bg);this.newsBg=bg;var newLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_20,"9+");newLabel.setPosition(bg.getContentSize().width/2,bg.getContentSize().height/2);newLabel.setColor(cc.color("#682e2e"));bg.addChild(newLabel);this.newLabel=newLabel},
refreshView:function(){if(PlayerMe.messageCount<=0)this.newsBg.visible=false;else{this.newsBg.visible=true;if(PlayerMe.messageCount>9)this.newLabel.setString("9+");else this.newLabel.setString(PlayerMe.messageCount.toString())}},_onInboxMessageHandler:function(){this.refreshView()},onEnter:function(){this._super();this.refreshView()},onExit:function(){this._super();LobbyClient.getInstance().removeListener(this)}});var HomeShopLayer=IDialog.extend({ctor:function(){this._super();this._bgColor=cc.color(0,0,0,0);this.setContentSize(cc.winSize);this.mTouch=cc.rect(0,0,cc.winSize.width,cc.winSize.height)},onEnter:function(){this._super();var thiz=this;var inventoryDialog=new InventoryDialog;inventoryDialog._moveEnable=true;inventoryDialog._bgColor=cc.color(0,0,0,0);inventoryDialog.show(this);inventoryDialog.setPositionX(cc.winSize.width-235);inventoryDialog.closeButtonHandler=function(){thiz.hide()};inventoryDialog.onTouchDialog=
function(){var p1=inventoryDialog.getParent();var p2=shopDialog.getParent();setTimeout(function(){p2.setLocalZOrder(0);p1.setLocalZOrder(1)},0)};var shopDialog=new ShopItemDialog;shopDialog._moveEnable=true;shopDialog._bgColor=cc.color(0,0,0,0);shopDialog.show(this);shopDialog.setPositionX(345);shopDialog.closeButtonHandler=function(){thiz.hide()};shopDialog.onTouchDialog=function(){var p1=inventoryDialog.getParent();var p2=shopDialog.getParent();setTimeout(function(){p1.setLocalZOrder(0);p2.setLocalZOrder(1)},
0)}}});var InventoryItemIcon=cc.Node.extend({ctor:function(){this._super();var defaultItem=new cc.Sprite("#inventory_defaultItem.png");this.setContentSize(defaultItem.getContentSize());this.setAnchorPoint(cc.p(.5,.5));defaultItem.setPosition(this.getContentSize().width/2,this.getContentSize().height/2);this.addChild(defaultItem);this.imgSprite=defaultItem},_setItemWithTexture:function(texture){if(this.imgSprite){this.imgSprite.removeFromParent(true);this.imgSprite=0}this.imgSprite=new cc.Sprite(texture);
this.imgSprite.setPosition(this.getContentSize().width/2,this.getContentSize().height/2);this.addChild(this.imgSprite);var scaleX=this.getContentSize().width/this.imgSprite.getContentSize().width;var scaleY=this.getContentSize().height/this.imgSprite.getContentSize().height;var scale=scaleX<scaleY?scaleX:scaleY;if(scale<1)this.imgSprite.setScale(scale)},loadFromUrl:function(url){if(!url||url=="")return;var thiz=this;var textureInCache=cc.textureCache.getTextureForKey(url);if(textureInCache)thiz._setItemWithTexture(textureInCache);
else if(cc.sys.isNative)quyetnd.ResourcesDownloader.loadTexture(url,function(texture){if(texture)thiz._setItemWithTexture(texture)});else cc.loader.loadImg(url,function(err,texture){if(texture){cc.textureCache.cacheImage(url,texture);thiz._setItemWithTexture(texture)}})}});var InventoryTimeAction=cc.CustomAction.extend({ctor:function(duration){this._super();this.initWithDuration(duration);this._time=duration},_updateTarget:function(){var sec=this._currentNumber%60;var min=Math.floor(this._currentNumber/60)%60;var hour=Math.floor(this._currentNumber/3600);if(hour>0)this._target.setString(cc.Global.NumberFormatWithPadding(hour)+":"+cc.Global.NumberFormatWithPadding(min)+":"+cc.Global.NumberFormatWithPadding(sec));else this._target.setString(cc.Global.NumberFormatWithPadding(min)+
":"+cc.Global.NumberFormatWithPadding(sec))},onUpdate:function(dt){var number=Math.floor(this._time*(1-dt));if(this._currentNumber==number)return;this._currentNumber=number;this._updateTarget()},onStartWithTarget:function(target){this._target=target;this._currentNumber=Math.floor(this._time);this._updateTarget()}});
var InventoryUseDialog=Dialog.extend({ctor:function(info){this._super();this._bgColor=cc.color(0,0,0,0);this.okButton.visible=false;this.cancelButton.visible=false;this.title.setString("V\u1eadt ph\u1ea9m");this.initWithSize(cc.size(478,278));this._initView(info)},_initView:function(info){var thiz=this;var itemId=info.itemId;this.title.setString(info.itemName);var iconBg=new ccui.Scale9Sprite("shop_item_bg.png",cc.rect(20,20,4,4));iconBg.setPreferredSize(cc.size(100,100));iconBg.setPosition(168,236);
this.addChild(iconBg);var icon=new InventoryItemIcon;icon.loadFromUrl(info.iconUrl);icon.setPosition(iconBg.getPosition());this.addChild(icon,2);var contentLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,info.itemContent,cc.TEXT_ALIGNMENT_LEFT,340);contentLabel.setAnchorPoint(cc.p(0,1));contentLabel.setPosition(229,277);this.addChild(contentLabel,1);var countLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,"S\u1ed1 l\u01b0\u1ee3ng: "+info.count.toString());countLabel.setAnchorPoint(cc.p(0,
1));countLabel.setPosition(contentLabel.x,contentLabel.y-contentLabel.getContentSize().height-5);this.addChild(countLabel,1);var okButton=new ccui.Button("inventory_button.png","","",ccui.Widget.PLIST_TEXTURE);okButton.setScale9Enabled(true);okButton.setCapInsets(cc.rect(10,10,4,4));okButton.setContentSize(cc.size(180,50));okButton.setPosition(this.getContentSize().width/2,145);okButton.setZoomScale(.02);this.addChild(okButton);var okTitle=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,
"S\u1eed d\u1ee5ng");okTitle.setColor(cc.color("#682e2e"));okTitle.setPosition(okButton.getContentSize().width/2,okButton.getContentSize().height/2);okButton.getRendererNormal().addChild(okTitle);okButton.addClickEventListener(function(){var request={command:"changeStatusUserItem",idItem:itemId,status:0};LobbyClient.getInstance().send(request);thiz.hide()})}});
var InventoryDialog=Dialog.extend({ctor:function(){this._super();this.okButton.visible=false;this.cancelButton.visible=false;this.title.setString("Kho \u0111\u1ed3");this.initWithSize(cc.size(466,648));this.initItemListView();this.initUsedItemView()},initItemListView:function(){var _left=106;var _right=556;var _top=558;var _bottom=98;var listItem=new newui.TableView(cc.size(_right-_left,_top-_bottom),4);listItem.setPosition(cc.p(_left,_bottom));listItem.setMargin(20,20,0,0);listItem.setPadding(10);
this.addChild(listItem,1);this.listItem=listItem},addItem:function(iconUrl,itemName,itemContent,count,itemId){var thiz=this;var container=new ccui.Widget;container.setContentSize(cc.size(100,100));this.listItem.pushItem(container);var bg=new ccui.Scale9Sprite("shop_item_bg.png",cc.rect(20,20,4,4));bg.setPreferredSize(container.getContentSize());bg.setPosition(container.getContentSize().width/2,container.getContentSize().height/2);container.addChild(bg);var icon=new InventoryItemIcon;icon.loadFromUrl(iconUrl);
icon.setPosition(bg.getPosition());container.addChild(icon);if(count>1){var countLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_20,"x"+count.toString());countLabel.setAnchorPoint(cc.p(1,0));countLabel.setPosition(92,6);container.addChild(countLabel)}container.setTouchEnabled(true);container.addClickEventListener(function(){var info={iconUrl:iconUrl,itemName:itemName,itemContent:itemContent,count:count,itemId:itemId};var dialog=new InventoryUseDialog(info);dialog.show()})},initUsedItemView:function(){var _left=
119;var _right=543;var _top=657;var _bottom=575;var usedItemBg=new ccui.Scale9Sprite("shop_item_bg.png",cc.rect(20,20,4,4));usedItemBg.setPreferredSize(cc.size(_right-_left+4,_top-_bottom+4));usedItemBg.setPosition((_right+_left)/2,(_top+_bottom)/2);this.addChild(usedItemBg);var listUsedItem=new newui.TableView(cc.size(_right-_left,_top-_bottom),1);listUsedItem.setDirection(ccui.ScrollView.DIR_HORIZONTAL);listUsedItem.setPosition(cc.p(_left,_bottom));listUsedItem.setBounceEnabled(false);this.addChild(listUsedItem,
1);this.listUsedItem=listUsedItem;for(var i=0;i<4;i++)this.addUsedItem(null,null)},addUsedItem:function(iconUrl,time){var container=new ccui.Widget;container.setContentSize(cc.size(this.listUsedItem.getContentSize().width/4,this.listUsedItem.getContentSize().height));if(this.listUsedItem.size()>0){var padding=new cc.Sprite("#inventory_used_padding.png");padding.setPosition(0,container.getContentSize().height/2);container.addChild(padding)}if(iconUrl!=null){var icon=new InventoryItemIcon;icon.loadFromUrl(iconUrl);
icon.setScale(.62);icon.setPosition(container.getContentSize().width/2,53);container.addChild(icon);if(time){var timeLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_16,"time");timeLabel.setPosition(icon.x,16);container.addChild(timeLabel);timeLabel.runAction(new InventoryTimeAction(time/1E3))}}this.listUsedItem.pushItem(container)},onFetchUserItem:function(cmd,data){this.listItem.removeAllItems();var userItems=data["data"]["userItems"];var items={};for(var i=0;i<userItems.length;i++){var type=
userItems[i]["type"];if(type!=2){var idItem=userItems[i]["idItem"];if(items[idItem])items[idItem].count++;else{var name=userItems[i]["name"];var description=userItems[i]["description"];var avt=userItems[i]["avatar"];items[idItem]={idItem:idItem,name:name,description:description,avt:avt,count:1}}}}for(var key in items){if(!items.hasOwnProperty(key))continue;var item=items[key];this.addItem(item["avt"],item["name"],item["description"],item["count"],item["idItem"])}this.listUsedItem.removeAllItems();
var usedItems=data["data"]["userItemActive"];var itemUsedCount=0;for(var i=0;i<usedItems.length;i++){var type=usedItems[i]["type"];if(type!=2){itemUsedCount++;var avt=usedItems[i]["avatar"];var timeRemaining=usedItems[i]["timeRemaining"];this.addUsedItem(avt,timeRemaining)}}var n=4-itemUsedCount;for(var i=0;i<n;i++)this.addUsedItem(null,null);if(n>0)this.listUsedItem.setBounceEnabled(false);else this.listUsedItem.setBounceEnabled(true)},onChangeStatusUserItem:function(cmd,data){this.fetchUserItem()},
onBuyItem:function(){this.fetchUserItem()},fetchUserItem:function(){var request={command:"fetchUserItem"};LobbyClient.getInstance().send(request)},onEnter:function(){this._super();LobbyClient.getInstance().addListener("fetchUserItem",this.onFetchUserItem,this);LobbyClient.getInstance().addListener("changeStatusUserItem",this.onChangeStatusUserItem,this);LobbyClient.getInstance().addListener("buyItem",this.onBuyItem,this);this.fetchUserItem()},onExit:function(){this._super();LobbyClient.getInstance().removeListener(this)}});
var ChangeAvatarDialog=Dialog.extend({ctor:function(){this._super()}});var ShopItemBuyDialog=Dialog.extend({ctor:function(info){this._super();this._bgColor=cc.color(0,0,0,0);this.okButton.visible=false;this.cancelButton.visible=false;this.title.setString("V\u1eadt ph\u1ea9m");this.initWithSize(cc.size(518,348));this._initView(info);this._itemCount=1;this._itemPrice=info.price;this._updateView()},_initView:function(info){var thiz=this;var itemId=info.itemId;this.title.setString(info.itemName);var iconBg=new ccui.Scale9Sprite("shop_item_bg.png",cc.rect(20,20,4,4));iconBg.setPreferredSize(cc.size(100,
100));iconBg.setPosition(197,306);this.addChild(iconBg);var icon=new InventoryItemIcon;icon.loadFromUrl(info.iconUrl);icon.setPosition(iconBg.getPosition());this.addChild(icon,2);var contentLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,info.itemContent,cc.TEXT_ALIGNMENT_LEFT,350);contentLabel.setAnchorPoint(cc.p(0,1));contentLabel.setPosition(262,355);this.addChild(contentLabel,1);var buyBg=new cc.Sprite("#shop_buy_bg.png");buyBg.setPosition(this.getContentSize().width/2,contentLabel.y-
contentLabel.getContentSize().height-40);this.addChild(buyBg);var subBt=new ccui.Button("shop_buy_sub.png","","",ccui.Widget.PLIST_TEXTURE);subBt.setPosition(buyBg.x-60,buyBg.y);this.addChild(subBt);subBt.addClickEventListener(function(){if(thiz._itemCount>0){thiz._itemCount--;thiz._updateView()}});var addBt=new ccui.Button("shop_buy_add.png","","",ccui.Widget.PLIST_TEXTURE);addBt.setPosition(buyBg.x+60,buyBg.y);this.addChild(addBt);addBt.addClickEventListener(function(){thiz._itemCount++;if(!thiz._updateView())MessageNode.getInstance().show("B\u1ea1n kh\u00f4ng \u0111\u1ee7 ti\u1ec1n")});
var countLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_25,"0");countLabel.setPosition(buyBg.getPosition());this.addChild(countLabel,1);var goldLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_20,"1,000");goldLabel.setColor(cc.color("#f4d501"));goldLabel.setAnchorPoint(cc.p(0,.5));goldLabel.setPosition(buyBg.x+125,buyBg.y);this.addChild(goldLabel,1);var currentGold=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_20,"S\u1ed1 v\u00e0ng c\u00f2n l\u1ea1i: ");
currentGold.setAnchorPoint(cc.p(1,.5));currentGold.setPosition(362,140);this.addChild(currentGold,1);var currentGoldLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_20,"100,100");currentGoldLabel.setColor(cc.color("#f4d501"));currentGoldLabel.setAnchorPoint(cc.p(0,.5));currentGoldLabel.setPosition(362,140);this.addChild(currentGoldLabel,1);var okButton=new ccui.Button("inventory_button.png","","",ccui.Widget.PLIST_TEXTURE);okButton.setScale9Enabled(true);okButton.setCapInsets(cc.rect(10,
10,4,4));okButton.setContentSize(cc.size(180,50));okButton.setPosition(buyBg.x,190);okButton.setZoomScale(.02);this.addChild(okButton);var okTitle=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,"Mua");okTitle.setColor(cc.color("#682e2e"));okTitle.setPosition(okButton.getContentSize().width/2,okButton.getContentSize().height/2);okButton.getRendererNormal().addChild(okTitle);okButton.addClickEventListener(function(){if(thiz._itemCount<=0){MessageNode.getInstance().show("B\u1ea1n ph\u1ea3i ch\u1ecdn v\u1eadt ph\u1ea9m");
return}var items=[];for(var i=0;i<thiz._itemCount;i++)items.push(itemId);var request={command:"buyItem",items:items};LobbyClient.getInstance().send(request);thiz.hide()});this.countLabel=countLabel;this.goldLabel=goldLabel;this.currentGoldLabel=currentGoldLabel},_updateView:function(){var gold=this._itemCount*this._itemPrice;if(gold>PlayerMe.gold){this._itemCount--;this._updateView();return false}else{var currentGold=PlayerMe.gold-gold;this.goldLabel.setString(cc.Global.NumberFormat1(gold)+" V");
this.currentGoldLabel.setString(cc.Global.NumberFormat1(currentGold)+" V");this.countLabel.setString(this._itemCount.toString())}return true}});var s_shop_tabName=s_shop_tabName||["AVATAR","V\u1eacT PH\u1ea8M","\u0110\u1ed2 \u0102N"];var s_shop_tabId=s_shop_tabId||[2,1,3];
var ShopItemDialog=Dialog.extend({ctor:function(){this._super();var thiz=this;LobbyClient.getInstance().addListener("fetchItem",this._onRecvItemData,this);this.okButton.visible=false;this.cancelButton.visible=false;this.title.setString("C\u1eeda h\u00e0ng");this.initWithSize(cc.size(686,648));var _left=106;var _right=776;var _top=572;var _bottom=98;var tabBg=new ccui.Scale9Sprite("shop_tab_0.png",cc.rect(10,10,4,4));tabBg.setPreferredSize(cc.size(420,50));tabBg.setPosition(this.getContentSize().width/
2,617);this.addChild(tabBg);var mToggle=new ToggleNodeGroup;this.addChild(mToggle);this.mToggle=mToggle;var dx=tabBg.getContentSize().width/s_shop_tabName.length;var x=tabBg.x-tabBg.getContentSize().width/2+dx/2;for(var i=0;i<s_shop_tabName.length;i++)(function(){var icon=new ccui.Scale9Sprite("shop_tab_"+(i+1).toString()+".png",cc.rect(10,10,4,4));icon.setPreferredSize(cc.size(dx,tabBg.getContentSize().height));icon.setPosition(x+dx*i,tabBg.y);thiz.addChild(icon);var tabLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_25,
s_shop_tabName[i]);tabLabel.setPosition(icon.getPosition());thiz.addChild(tabLabel,1);var tabIdx=i;var mItem=new ToggleNodeItem(icon.getContentSize());mItem.setPosition(icon.getPosition());mToggle.addItem(mItem);mItem.onSelect=function(){icon.visible=true;tabLabel.setColor(cc.color("#ffffff"));thiz._sendRefreshItem(tabIdx)};mItem.onUnSelect=function(){icon.visible=false;tabLabel.setColor(cc.color("#626ea5"))}})();var listItem=new newui.TableView(cc.size(_right-_left,_top-_bottom),6);listItem.setPosition(cc.p(_left,
_bottom));listItem.setMargin(20,20,0,0);listItem.setPadding(10);this.addChild(listItem);this.listItem=listItem},addItem:function(iconUrl,itemName,itemContent,price,itemId){var thiz=this;var container=new ccui.Widget;container.setContentSize(cc.size(100,100));this.listItem.pushItem(container);var bg=new ccui.Scale9Sprite("shop_item_bg.png",cc.rect(20,20,4,4));bg.setPreferredSize(container.getContentSize());bg.setPosition(container.getContentSize().width/2,container.getContentSize().height/2);container.addChild(bg);
var icon=new InventoryItemIcon;icon.loadFromUrl(iconUrl);icon.setPosition(bg.getPosition());container.addChild(icon);container.setTouchEnabled(true);container.addClickEventListener(function(){var info={iconUrl:iconUrl,itemName:itemName,itemContent:itemContent,price:price,itemId:itemId};var dialog=new ShopItemBuyDialog(info);dialog.show();dialog.setPosition(thiz.getPosition())})},_onRecvItemData:function(cmd,data){var items=data["data"]["items"];if(items.length>0){this.listItem.removeAllItems();for(var i=
0;i<items.length;i++){var avt=items[i]["avatar"];var name=items[i]["name"];var content=items[i]["description"];var price=items[i]["cost"];var idItem=items[i]["idItem"];this.addItem(avt,name,content,price,idItem)}}},_sendRefreshItem:function(tabIdx){this.listItem.removeAllItems();var request={command:"fetchItem",groupType:s_shop_tabId[tabIdx]};LobbyClient.getInstance().send(request)},onEnter:function(){this._super();this.mToggle.selectItem(1)},onExit:function(){this._super();LobbyClient.getInstance().removeListener(this)}});var CardSuit=CardSuit||{};CardSuit.Spades=0;CardSuit.Clubs=1;CardSuit.Diamonds=2;CardSuit.Hearts=3;var s_card_suit=s_card_suit||[];s_card_suit[CardSuit.Hearts]="c";s_card_suit[CardSuit.Diamonds]="r";s_card_suit[CardSuit.Clubs]="t";s_card_suit[CardSuit.Spades]="b";
var Card=cc.Sprite.extend({ctor:function(rank,suit){this.canTouch=true;this.rank=rank;this.suit=suit;this._super("#"+rank+s_card_suit[suit]+".png");this.touchRect=cc.rect(0,0,this.getContentSize().width,this.getContentSize().height);this.cardDistance=this.getContentSize().width;this.origin=cc.p();this.isTouched=false;this._cardSelected=false},onEnter:function(){this._super();var thiz=this;cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:true,onTouchBegan:function(touch,
event){return thiz.onTouchBegan(touch,event)},onTouchEnded:function(touch,event){thiz.onTouchEnded(touch,event)},onTouchMoved:function(touch,event){thiz.onTouchMoved(touch,event)}},this)},onExit:function(){this._super();cc.eventManager.removeListeners(this)},moveToOriginPosition:function(){if(!this.isTouched){this.stopAllActions();var thiz=this;var beforeMove=new cc.CallFunc(function(){thiz.getParent().reorderChild(thiz,thiz.cardIndex+100)});var afterMove=new cc.CallFunc(function(){thiz.getParent().reorderChild(thiz,
thiz.cardIndex)});var move=new cc.MoveTo(.1,cc.p(this.origin.x,this.origin.y));this.runAction(new cc.Sequence(beforeMove,move,afterMove));this._cardSelected=false}},setSelected:function(selected,force){if(force){this.stopAllActions();this.setPosition(this.origin)}this._cardSelected=selected;if(selected)this.y=this.origin.y+50;else this.y=this.origin.y},isSelected:function(){return this._cardSelected},onTouchBegan:function(touch,event){if(this.canTouch&&!this.isTouched){var p=this.convertToNodeSpace(touch.getLocation());
if(cc.rectContainsPoint(this.touchRect,p)){this.isTouched=true;this.isMoved=false;this.preTouchPoint=touch.getLocation();return true}}return false},onTouchEnded:function(touch,event){this.isTouched=false;if(this.isMoved){this.moveToOriginPosition();this.getParent().reorderChild(this,this.cardIndex)}else{this.setSelected(!this._cardSelected);this.getParent().onSelected(this,this.isSelected())}},onTouchMoved:function(touch,event){var p=touch.getLocation();if(!this.isMoved)if(cc.pDistance(this.preTouchPoint,
p)<5)return;else{this.getParent().reorderChild(this,200);this.isMoved=true}this.x+=(p.x-this.preTouchPoint.x)/this.getParent().getScale();this.y+=(p.y-this.preTouchPoint.y)/this.getParent().getScale();this.preTouchPoint=p;var dx=this.x-this.origin.x;if(Math.abs(dx)>this.cardDistance)if(dx>0)this.getParent().swapCardRight(this.cardIndex);else this.getParent().swapCardLeft(this.cardIndex)}});
var CardList=cc.Node.extend({ctor:function(size){this.canTouch=true;this._super();this.cardList=[];this.setContentSize(size);this.setAnchorPoint(cc.p(.5,.5))},onSelected:function(card,isSelected){},removeCardById:function(id){var card=this.getCardWithId(id);for(var i=0;i<this.cardList.length;i++)if(this.cardList[i].rank==card.rank&&this.cardList[i].suit==card.suit){var retVal=this.cardList[i];retVal.setPosition(this.convertToWorldSpace(retVal.getPosition()));retVal.retain();retVal.removeFromParent(true);
retVal.canTouch=false;this.cardList.splice(i,1);return retVal}cc.log("card id "+id+" "+JSON.stringify(card));return null},getCardWithId:function(cardId){var rankCard=cardId%13+3;if(rankCard>13)rankCard-=13;return{rank:rankCard,suit:Math.floor(cardId/13)}},getCardIdWithRank:function(rank,suit){var rankCard=rank-3;if(rankCard<0)rankCard=13+rankCard;return suit*13+rankCard},reArrangeCards:function(sortFunc){if(!sortFunc)this.cardList.sort(function(a,b){return a.rank-b.rank});else this.cardList.sort(sortFunc);
this.reOrder()},reOrder:function(){if(this.cardList.length>0){var width=this.cardSize.width*this.cardList.length;if(width>this.getContentSize().width)width=this.getContentSize().width;var dx=width/this.cardList.length;var x=this.getContentSize().width/2-width/2+dx/2;var y=this.getContentSize().height/2;for(var i=0;i<this.cardList.length;i++){var card=this.cardList[i];card.origin=cc.p(x,y);card.cardIndex=i;card.cardDistance=dx;this.reorderChild(card,i);card.moveToOriginPosition();x+=dx}}},reOrderWithoutAnimation:function(){if(this.cardList.length>
0){var width=this.cardSize.width*this.cardList.length;if(width>this.getContentSize().width)width=this.getContentSize().width;var dx=width/this.cardList.length;var x=this.getContentSize().width/2-width/2+dx/2;var y=this.getContentSize().height/2;for(var i=0;i<this.cardList.length;i++){var card=this.cardList[i];card.origin=cc.p(x,y);card.cardIndex=i;card.cardDistance=dx;this.reorderChild(card,i);card.setPosition(x,y);x+=dx}}},onEnter:function(){this._super();this.deckPoint=this.convertToNodeSpace(cc.p(cc.winSize.width/
2,cc.winSize.height/2))},addNewCard:function(cardId){for(var i=0;i<cardId.length;i++){var card=new Card(cardId[i].rank,cardId[i].suit);this.addCard(card)}this.reOrderWithoutAnimation()},addCard:function(card){if(!this.cardSize){this.cardSize=card.getContentSize();if(this.cardSize.height>this.getContentSize().height){var ratio=this.getContentSize().height/this.cardSize.height;this.cardSize.width*=ratio;this.cardSize.height*=ratio}}if(card.getContentSize().height>this.cardSize.height)card.setScale(this.cardSize.height/
card.getContentSize().height);card.cardIndex=this.cardList.length;card.canTouch=this.canTouch;this.addChild(card,this.cardList.length);this.cardList.push(card)},setTouchEnable:function(touch){this.canTouch=touch;for(var i=0;i<this.cardList.length;i++)this.cardList[i].canTouch=this.canTouch},dealCards:function(cards,animation){if(!this.deckPoint){var thiz=this;setTimeout(function(){thiz.dealCards(cards,animation)},.1);return}this.removeAll();for(var i=0;i<cards.length;i++){var card=new Card(cards[i].rank,
cards[i].suit);if(animation)card.setPosition(this.deckPoint);this.addCard(card)}var width=this.cardSize.width*this.cardList.length;if(width>this.getContentSize().width)width=this.getContentSize().width;var dx=width/this.cardList.length;var x=this.getContentSize().width/2-width/2+dx/2;var y=this.getContentSize().height/2;for(var i=0;i<this.cardList.length;i++){this.reorderChild(this.cardList[i],i);var card=this.cardList[i];card.origin=cc.p(x,y);card.cardDistance=dx;if(animation){card.visible=false;
var delayAction=new cc.DelayTime(.02*i);var beforeAction=new cc.CallFunc(function(target){target.visible=true},card);var moveAction=new cc.MoveTo(.2,cc.p(x,y));var soundAction=new cc.CallFunc(function(){SoundPlayer.playSound("chia_bai")});card.runAction(new cc.Sequence(delayAction,soundAction,beforeAction,moveAction))}else card.setPosition(x,y);x+=dx}},containsWithCard:function(card){var cardRect=card.getCardBounding();for(var i=0;i<this.cardList.length;i++)if(this.cardList[i]!=card){var rect=this.cardList[i].getCardBounding();
if(cc.rectIntersectsRect(cardRect,rect))return this.cardList[i]}return null},swapCardLeft:function(index){if(index>0){var cardMove=this.cardList[index];var cardSwap=this.cardList[index-1];this.swapCard(cardMove,cardSwap)}},swapCardRight:function(index){if(index<this.cardList.length-1){var cardMove=this.cardList[index];var cardSwap=this.cardList[index+1];this.swapCard(cardMove,cardSwap)}},swapCard:function(card1,card2){var _origin=card1.origin;var _cardIndex=card1.cardIndex;card1.origin=card2.origin;
card1.cardIndex=card2.cardIndex;card2.origin=_origin;card2.cardIndex=_cardIndex;card1.moveToOriginPosition();card2.moveToOriginPosition();this.cardList[card1.cardIndex]=card1;this.cardList[card2.cardIndex]=card2},removeCard:function(cards){var arrCard=[];for(var i=0;i<cards.length;i++){var rank=cards[i].rank;var suit=cards[i].suit;for(var j=0;j<this.cardList.length;j++){var card=this.cardList[j];if(card.rank==rank&&card.suit==suit){var p=this.convertToWorldSpace(card.getPosition());card.setPosition(p);
card.canTouch=false;card.retain();card.removeFromParent(true);arrCard.push(card);this.cardList.splice(j,1);break}}}return arrCard},removeAll:function(){this.removeAllChildren(true);this.cardList=[]},getCardAtIndex:function(index){return this.cardList[index]},getCardByRank:function(rank,suit){},getCardSelected:function(){var cardSelected=[];for(var i=0;i<this.cardList.length;i++)if(this.cardList[i].isSelected())cardSelected.push(this.cardList[i]);return cardSelected}});
var CardOnTable=cc.Node.extend({ctor:function(){this._super();this.cardList=[];this.cardSize=null;this.cardScale=.5;this.cardPosition=cc.p(cc.winSize.width/2,cc.winSize.height/2)},moveOldCard:function(){if(this.cardList.length==2){var arr=this.cardList[0];for(var i=0;i<arr.length;i++)arr[i].removeFromParent(true);this.cardList.splice(0,1)}if(this.cardList.length==1){var arr=this.cardList[0];for(var i=0;i<arr.length;i++){arr[i].y+=40;arr[i].setColor(cc.color(100,100,100))}}},addNewCardList:function(cards,
startPosition){var arrCard=[];for(var i=0;i<cards.length;i++){var card=new cc.Sprite("#"+cards[i].rank+s_card_suit[cards[i].suit]+".png");card.setPosition(startPosition);arrCard.push(card)}this.addCard(arrCard);return arrCard},addCardReconnect:function(cards){var arrCard=[];for(var i=0;i<cards.length;i++){var card=new cc.Sprite("#"+cards[i].rank+s_card_suit[cards[i].suit]+".png");arrCard.push(card)}this.addCardWithoutAnimation(arrCard);return arrCard},addCard:function(cards){var animationDuration=
.3;if(!this.cardSize)this.cardSize=cards[0].getContentSize();this.cardList.push(cards);var dx=this.cardSize.width*this.cardScale;var width=cards.length*dx;var x=this.cardPosition.x-width/2+dx/2;for(var i=0;i<cards.length;i++){var card=cards[i];var moveAction=new cc.MoveTo(animationDuration,cc.p(x,this.cardPosition.y));var scaleAction=new cc.ScaleTo(animationDuration,.5);card.runAction(new cc.EaseBackIn(new cc.Spawn(moveAction,scaleAction)));var rotate=20-Math.random()*40;card.setRotation(rotate);
this.addChild(card,0);x+=dx}},addCardWithoutAnimation:function(cards){if(!this.cardSize)this.cardSize=cards[0].getContentSize();this.cardList.push(cards);var dx=this.cardSize.width*this.cardScale;var width=cards.length*dx;var x=this.cardPosition.x-width/2+dx/2;for(var i=0;i<cards.length;i++){var card=cards[i];card.setPosition(x,this.cardPosition.y);card.setScale(.5);var rotate=20-Math.random()*40;card.setRotation(rotate);this.addChild(card,0);x+=dx}},removeAll:function(){this.cardList=[];this.removeAllChildren(true)}});var s_sfs_error_msg=s_sfs_error_msg||[];
var GameController=cc.Class.extend({ctor:function(){},initWithView:function(view){this._view=view;SmartfoxClient.getInstance().addListener(socket.SmartfoxClient.SocketStatus,this.onSmartfoxSocketStatus,this);SmartfoxClient.getInstance().addListener(socket.SmartfoxClient.UserExitRoom,this.onSmartfoxUserExitRoom,this);SmartfoxClient.getInstance().addListener(socket.SmartfoxClient.CallExtension,this.onSFSExtension,this);SmartfoxClient.getInstance().addListener(socket.SmartfoxClient.GenericMessage,this.onSmartfoxRecvChatMessage,
this);SmartfoxClient.getInstance().addExtensionListener("0",this.onUpdateGold,this);SmartfoxClient.getInstance().addExtensionListener("1",this._onJoinRoomHandler,this);SmartfoxClient.getInstance().addExtensionListener("2",this._onUserJoinRoomHandler,this);SmartfoxClient.getInstance().addExtensionListener("9",this.onUserExit,this);SmartfoxClient.getInstance().addExtensionListener("11",this._onUpdateOwnerHandler,this);SmartfoxClient.getInstance().addExtensionListener("13",this._onReconnectHandler,this);
SmartfoxClient.getInstance().addExtensionListener("19",this.onExitGame,this);SmartfoxClient.getInstance().addExtensionListener("___err___",this.onError,this);SmartfoxClient.getInstance().addExtensionListener("ping",this.onPingHandler,this);LobbyClient.getInstance().addListener("getLastSessionInfo",this.onGetLastSessionInfo,this)},releaseController:function(){SmartfoxClient.getInstance().removeListener(this);LobbyClient.getInstance().removeListener(this);this._view=null},onSmartfoxSocketStatus:function(type,
eventName){if(eventName=="LostConnection"){LoadingDialog.getInstance().show("\u0110ang k\u1ebft n\u1ed1i l\u1ea1i m\u00e1y ch\u1ee7");LobbyClient.getInstance().requestGetLastSessionInfo()}},onSmartfoxUserExitRoom:function(messageType,contents){},onSmartfoxRecvChatMessage:function(event,data){if(data["m"]==="[emoji]"&&data["p"]["emojiName"])this._view.onChatEmotion(data.p.userName,data["p"]["emojiName"]);else this._view.onChatMessage(data.p.userName,data.m)},onSFSExtension:function(messageType,content){},
onPingHandler:function(cmd,content){SmartfoxClient.getInstance().sendExtensionRequestCurrentRoom("ping",null)},onUpdateGold:function(cmd,content){var params=content.p;this._view.updateGold(params.u,params["2"]);if(params.u==PlayerMe.username)PlayerMe.gold=parseInt(params["2"])},onUserExit:function(cmd,content){var params=content.p;if(params.u!=PlayerMe.username)this._onUserExit(params.u);else{var message=null;switch(params.reason){case 3:message="B\u1ea1n b\u1ecb kick do kh\u00f4ng b\u1eaft \u0111\u1ea7u v\u00e1n ch\u01a1i";
break;case 4:message="B\u1ea1n kh\u00f4ng \u0111\u1ee7 v\u00e0ng \u0111\u1ec3 ch\u01a1i, vui l\u00f2ng ra n\u1ea1p v\u00e0ng";break}this._view.exitToLobby(message)}},_onUserExit:function(username){for(var i=0;i<this.playerSlot.length;i++)if(this.playerSlot[i].username==username)this.playerSlot[i].username="";this._view.userExitRoom(username)},onError:function(cmd,content){var params=content.p;var ec=params.code;var msg=s_sfs_error_msg[ec];if(msg)this._view.showErrorMessage(msg);else this._view.showErrorMessage("M\u00e3 l\u1ed7i kh\u00f4ng x\u00e1c \u0111\u1ecbnh["+
ec+"]")},onExitGame:function(cmd,content){var param=content.p;this._view.updateRegExitRoom(param["1"]);if(param["1"])MessageNode.getInstance().show("B\u1ea1n \u0111\u00e3 \u0111\u0103ng k\u00fd tho\u00e1t ph\u00f2ng th\u00e0nh c\u00f4ng !");else MessageNode.getInstance().show("B\u1ea1n \u0111\u00e3 h\u1ee7y \u0111\u0103ng k\u00fd tho\u00e1t ph\u00f2ng th\u00e0nh c\u00f4ng !")},_onJoinRoomHandler:function(cmd,content){this.onJoinRoom(content.p)},_onReconnectHandler:function(cmd,content){this.onReconnect(content.p)},
_onUpdateOwnerHandler:function(cmd,content){this.onUpdateOwner(content.p.u)},_onUserJoinRoomHandler:function(cmd,content){this.onUserJoinRoom(content.p)},onJoinRoom:function(params){this._processPlayerPosition(params["5"])},onReconnect:function(params){this._processPlayerPosition(params["1"]["5"])},onUpdateOwner:function(params){if(PlayerMe.username==params)this.isOwnerMe=true;else this.isOwnerMe=false;this._view.setOwner(params)},onUserJoinRoom:function(p){var slotIndex=p["4"];var username=p["u"];
for(var i=0;i<this.playerSlot.length;i++)if(this.playerSlot[i].userIndex==slotIndex){this.playerSlot[i].username=username;break}var userInfo={index:slotIndex,username:username,gold:p["3"],avt:p["avtUrl"]};this._view.userJoinRoom(userInfo)},_createUserInfo:function(data){if(!data)return{gold:0,spectator:false};return{gold:data["3"],spectator:data["2"]}},_processPlayerPosition:function(players){var meIndex=0;this.isSpectator=false;for(var i=0;i<players.length;i++)if(players[i].u==PlayerMe.username){meIndex=
players[i]["4"];if(meIndex<0)meIndex=0;this.isSpectator=players[i]["2"];var regExt=players[i]["regExt"];this._view.updateRegExitRoom(regExt);break}this.playerSlot=[];var maxSlot=this.getMaxSlot();for(var i=0;i<maxSlot;i++){var slot=i-meIndex;if(slot<0)slot+=maxSlot;this.playerSlot[slot]={userIndex:i,username:"",avt:"",gold:0,spectator:false,info:this._createUserInfo(null)}}for(var i=0;i<players.length;i++){if(players[i]["4"]<0)continue;var slot=players[i]["4"]-meIndex;if(slot<0)slot+=maxSlot;this.playerSlot[slot].username=
players[i]["u"];this.playerSlot[slot].avt=players[i]["avtUrl"];this.playerSlot[slot].gold=players[i]["3"];this.playerSlot[slot].spectator=players[i]["2"];this.playerSlot[slot].info=this._createUserInfo(players[i])}this._view.fillPlayerToSlot(this.playerSlot);var ownerPlayer=null;for(var i=0;i<players.length;i++)if(players[i]["1"]==true){ownerPlayer=players[i].u;if(PlayerMe.username==ownerPlayer)this.isOwnerMe=true;else this.isOwnerMe=false;break}this.onUpdateOwner(ownerPlayer)},onGetLastSessionInfo:function(command,
eventData){var info=eventData.data.lastSessionInfo;if(info&&info.ip&&info.port){var serverInfo=LobbyClient.getInstance().createServerInfo(info);this._view.showLoading("\u0110ang k\u1ebft n\u1ed1i l\u1ea1i m\u00e1y ch\u1ee7");SmartfoxClient.getInstance().connect(serverInfo);return}this._view.exitToLobby()},requestQuitRoom:function(){SmartfoxClient.getInstance().sendExtensionRequest(PlayerMe.SFS.roomId,"19",null)},sendChat:function(message){var content={t:0,r:PlayerMe.SFS.roomId,u:PlayerMe.SFS.userId,
m:message,p:{userName:PlayerMe.username}};SmartfoxClient.getInstance().send(socket.SmartfoxClient.GenericMessage,content)},sendChatEmotion:function(icon){var content={t:0,r:PlayerMe.SFS.roomId,u:PlayerMe.SFS.userId,m:"[emoji]",p:{userName:PlayerMe.username,emojiName:icon}};SmartfoxClient.getInstance().send(socket.SmartfoxClient.GenericMessage,content)}});s_sfs_error_msg[1]="\u0110\u00e1nh b\u00e0i kh\u00f4ng h\u1ee3p l\u1ec7";s_sfs_error_msg[2]="B\u1ea1n kh\u00f4ng ph\u1ea3i ch\u1ee7 ph\u00f2ng";s_sfs_error_msg[3]="Kh\u00f4ng \u0111\u1ee7 ng\u01b0\u1eddi ch\u01a1i \u0111\u1ec3 b\u1eaft \u0111\u1ea7u";s_sfs_error_msg[4]="B\u1ea1n ph\u1ea3i \u0111\u00e1nh qu\u00e2n b\u00e0i nh\u1ecf nh\u1ea5t";s_sfs_error_msg[5]="B\u1ea1n kh\u00f4ng th\u1ec3 b\u1ecf l\u01b0\u1ee3t";s_sfs_error_msg[6]="Ng\u01b0\u1eddi ch\u01a1i ch\u01b0a s\u1eb5n s\u00e0ng";
s_sfs_error_msg[7]="B\u1ea1n ch\u01b0a \u0111\u1ebfn l\u01b0\u1ee3t";s_sfs_error_msg[8]="B\u1ea1n kh\u00f4ng c\u00f3 4 \u0111\u00f4i th\u00f4ng";s_sfs_error_msg[9]="B\u1ea1n kh\u00f4ng c\u00f3 \u0111\u1ee7 ti\u1ec1n";s_defWin=["T\u1ee9 qu\u00fd 3","Ba \u0111\u00f4i th\u00f4ng ch\u1ee9a 3 b\u00edch","T\u1ee9 qu\u00fd 2","S\u00e1u \u0111\u00f4i","N\u0103m \u0111\u00f4i th\u00f4ng","S\u1ea3nh r\u1ed3ng"];
var TLMNGameController=GameController.extend({ctor:function(view){this._super();this.initWithView(view);SmartfoxClient.getInstance().addExtensionListener("3",this._onStartGameHandler,this);SmartfoxClient.getInstance().addExtensionListener("4",this._onDanhBaiThanhCongHandler,this);SmartfoxClient.getInstance().addExtensionListener("5",this._onBoLuotHandler,this);SmartfoxClient.getInstance().addExtensionListener("6",this._onNewTurnHandler,this);SmartfoxClient.getInstance().addExtensionListener("7",this._onNextTurnHandler,
this);SmartfoxClient.getInstance().addExtensionListener("8",this._onGameFinishedHandler,this);SmartfoxClient.getInstance().addExtensionListener("10",this._updateStatusHandler,this);SmartfoxClient.getInstance().addExtensionListener("12",this._onChatChemHandler,this);SmartfoxClient.getInstance().addExtensionListener("50",this._onUpdateCardReamin,this)},getMaxSlot:function(){if(this.isSolo)return 2;return 4},onJoinRoom:function(params){this._super(params);this.updateGameInfo(params);var userInfo=params["5"];
for(var i=0;i<userInfo.length;i++)this._view.updateCardRemaining(userInfo[i]["u"],userInfo[i]["8"])},onReconnect:function(params){this._super(params);this._reconnectCardOnTable=null;this._reconnectTurnMe=false;this.updateGameInfo(params["1"]);var status=params["1"]["1"];if(status==2){var cardData=params["3"];var cards=[];for(var i=0;i<cardData.length;i++)cards.push(CardList.prototype.getCardWithId(cardData[i]));this._view.setCardMe(cards)}else{this._view.removeCardList();this._view.onUpdateTurn(".",
0,0)}var userInfo=params["1"]["5"];for(var i=0;i<userInfo.length;i++)this._view.updateCardRemaining(userInfo[i]["u"],userInfo[i]["8"]);if(this._reconnectCardOnTable&&this._reconnectTurnMe){this._view.suggestCardWithCards(this._reconnectCardOnTable);this._reconnectCardOnTable=null}},onUserJoinRoom:function(param){this._super(param);this._view.updateCardRemaining(param.u,0)},onUpdateOwner:function(params){this._super(params);if(this.gameStatus==1&&this.isOwnerMe)this._view.setStartBtVisible(true)},
_updateStatusHandler:function(cmd,content){this.onGameStatus(content.p["1"])},_onStartGameHandler:function(cmd,content){this.onStartGame(content.p);this._view.suggestCard()},_onNewTurnHandler:function(cmd,content){this._view.removeCardOnTable();this.onUpdateTurn(content.p.u,this.timeTurn,true);this._view.suggestCard()},_onNextTurnHandler:function(cmd,content){this.onUpdateTurn(content.p.u,this.timeTurn,false)},_onBoLuotHandler:function(cmd,content){var user=content.p.u;this._view.onBoLuot(user)},
_onDanhBaiThanhCongHandler:function(cmd,content){this.onDanhBaiThanhCong(content.p)},_onGameFinishedHandler:function(cmd,content){this.onGameFinished(content.p)},_onChatChemHandler:function(cmd,content){this._view.onChatChem(content.p)},_onUpdateCardReamin:function(cmd,content){this.onUpdateCardReamain(content.p)},onUpdateCardReamain:function(param){this._view.updateCardRemaining(param.u,param["1"])},updateGameInfo:function(params){this.timeTurn=params["7"];var gameStatus=params["1"];this.onGameStatus(gameStatus);
if(gameStatus==2){var cardData=params["12"]["3"];if(cardData.length>0){var cards=[];for(var i=0;i<cardData.length;i++)cards.push(CardList.prototype.getCardWithId(cardData[i]));this._view.setCardOnTable(cards);this._reconnectCardOnTable=cards}var username=params["12"]["u"];var currentTime=params["12"]["2"]/1E3;var newTurn=cardData.length>0?false:true;this.onUpdateTurn(username,currentTime,newTurn);this._reconnectTurnMe=username===PlayerMe.username}},onStartGame:function(params){var cards=[];var cardData=
params["1"];for(var i=0;i<cardData.length;i++)cards.push(CardList.prototype.getCardWithId(cardData[i]));this._view.dealCards(cards);for(var i=0;i<this.playerSlot.length;i++)this._view.updateCardRemaining(this.playerSlot[i].username,cardData.length)},onUpdateTurn:function(username,currentTime,newTurn){if(newTurn)this._view.removeCardOnTable();if(PlayerMe.username==username){this._view.setDanhBaiBtVisible(true);if(newTurn)this._view.setBoLuotBtVisible(false);else this._view.setBoLuotBtVisible(true)}else{this._view.setDanhBaiBtVisible(false);
this._view.setBoLuotBtVisible(false)}this._view.onUpdateTurn(username,currentTime,this.timeTurn)},onGameStatus:function(status){this.gameStatus=status;if(status==0){this._view.setDanhBaiBtVisible(false);this._view.setXepBaiBtVisible(false);this._view.setBoLuotBtVisible(false);this._view.setStartBtVisible(false);this._view.removeCardList();this._view.removeCardOnTable()}else if(status==1){this._view.setDanhBaiBtVisible(false);this._view.setXepBaiBtVisible(false);this._view.setBoLuotBtVisible(false);
this._view.setStartBtVisible(false);this._view.removeCardList();this._view.removeCardOnTable();this.isSpectator=false;if(this.isOwnerMe)this._view.setStartBtVisible(true)}else if(status==2)if(this.isSpectator)this._view.showErrorMessage("B\u00e0n \u0111ang ch\u01a1i, vui l\u00f2ng ch\u1edd");else{this._view.setXepBaiBtVisible(true);this._view.setStartBtVisible(false)}else if(status==3)if(this.isSpectator)this._view.showErrorMessage("B\u00e0n \u0111ang ch\u01a1i, vui l\u00f2ng ch\u1edd");else{this._view.setDanhBaiBtVisible(false);
this._view.setXepBaiBtVisible(false);this._view.setBoLuotBtVisible(false);this._view.setStartBtVisible(false);this._view.removeCardList();this._view.removeCardOnTable()}},onDanhBaiThanhCong:function(param){var username=param.u;var cards=[];var cardData=param["2"];for(var i=0;i<cardData.length;i++)cards.push(CardList.prototype.getCardWithId(cardData[i]));if(PlayerMe.username==username)this._view.onDanhbaiMe(username,cards);else this._view.onDanhbaiOther(username,cards)},onGameFinished:function(params){this._view.onUpdateTurn(".",
0,0);var winPlayer=params.u;var playerData=params["3"];var defWinType=params["4"];var player=[];for(var i=0;i<playerData.length;i++){var username=playerData[i].u;var gold=parseInt(playerData[i]["4"]);var title=null;var cardListData=playerData[i]["2"];var cardList=[];for(var j=0;j<cardListData.length;j++)cardList.push(CardList.prototype.getCardWithId(cardListData[j]));if(username==winPlayer)title=s_defWin[defWinType]?s_defWin[defWinType]:"Th\u1eafng";else title="Thua "+cardList.length+" l\u00e1";player[i]=
{username:username,title:title,gold:gold,cardList:cardList,isWinner:username==winPlayer};var userGold=parseInt(playerData[i]["3"]);this._view.updateGold(username,userGold)}this._view.showFinishedDialog(player)},sendStartRequest:function(){SmartfoxClient.getInstance().sendExtensionRequestCurrentRoom("3",null)},sendBoluotRequest:function(){SmartfoxClient.getInstance().sendExtensionRequestCurrentRoom("5",null)},sendDanhBai:function(cards){if(cards.length>0){var cardId=[];for(var i=0;i<cards.length;i++)cardId.push(CardList.prototype.getCardIdWithRank(cards[i].rank,
cards[i].suit));var param={2:cardId};SmartfoxClient.getInstance().sendExtensionRequestCurrentRoom("4",param)}else this._view.showErrorMessage("B\u1ea1n ph\u1ea3i ch\u1ecdn qu\u00e2n b\u00e0i \u0111\u00e1nh")}});PK_ACTION_PLAYER_VIEW=0;PK_ACTION_PLAYER_BET=1;PK_ACTION_PLAYER_ALL_IN=2;PK_ACTION_PLAYER_FOLD=3;PK_ACTION_PLAYER_RAISE=4;PK_ACTION_PLAYER_CALL=5;PK_ACTION_PLAYER_CHECK=6;PK_ACTION_PLAYER_NONE=7;PK_SUGGEST_NONE=0;PK_SUGGEST_FOLD=1;PK_SUGGEST_CHECK=2;PK_SUGGEST_CALL=3;PK_SUGGEST_CHECK_FOLD=4;S_TYPE_CARDS=["HIGH CARD","PAIR","TWO PAIRS","THREE OF A KIND","STRAIGHT","FLUSH","FULL HOUSE","FOUR OF A KIND","STRAIGHT FLUSH","ROYAL FLUSH"];
var PokerController=GameController.extend({ctor:function(view){this.statusRoom=0;this.turnId=0;this._super();this.initWithView(view);SmartfoxClient.getInstance().addExtensionListener("653",this._onUserSitDownHandler,this);SmartfoxClient.getInstance().addExtensionListener("10",this._updateStatusHandler,this);SmartfoxClient.getInstance().addExtensionListener("651",this._onFinisRow,this);SmartfoxClient.getInstance().addExtensionListener("663",this._onTipHandler,this);SmartfoxClient.getInstance().addExtensionListener("655",
this._onTipCaveHandler,this);SmartfoxClient.getInstance().addExtensionListener("656",this._onNewRoundHandler,this);SmartfoxClient.getInstance().addExtensionListener("658",this._onUserStandupHandler,this);SmartfoxClient.getInstance().addExtensionListener("7",this._onTurnChangedHandler,this);SmartfoxClient.getInstance().addExtensionListener("3",this._onStartGameHandler,this);SmartfoxClient.getInstance().addExtensionListener("11",this._onRoomOwnerChangedHandler,this);SmartfoxClient.getInstance().addExtensionListener("659",
this._onActionPlayer,this);SmartfoxClient.getInstance().addExtensionListener("660",this._onPreStart,this);SmartfoxClient.getInstance().addExtensionListener("8",this._onEndGame,this);SmartfoxClient.getInstance().addExtensionListener("661",this._onHandleSuggest,this);SmartfoxClient.getInstance().addExtensionListener("652",this._onDrawCard,this);SmartfoxClient.getInstance().addExtensionListener("657",this._onRegeditStandup,this);SmartfoxClient.getInstance().addExtensionListener("654",this._onUpdateMoney,
this)},onUpdateGold:function(cmd,content){this._super(cmd,content);this._view.setGoldRemain(true,content.p["2"])},_updateStatusHandler:function(cmd,content){this.onGameStatus(content.p["1"])},_createUserInfo:function(data){if(!data)return{moneyBet:0,isPlaying:false,idAction:PK_ACTION_PLAYER_NONE,typePlayer:PK_TYPE_PLAYER_NOMARL};return{money:parseInt(data["10"]),moneyBet:data["12"],isPlaying:!data["2"],idAction:data["11"],typePlayer:PK_TYPE_PLAYER_NOMARL}},_updateTypePLayer:function(username,type){for(var i=
0;i<this.playerSlot.length;i++)if(this.playerSlot[i].username==username){this.playerSlot[i].info.typePlayer=type;this._view.setTypePlayer(username,type)}},_updateRoomInfo:function(params){if(params){this._updateTypePLayer(params["3"],PK_TYPE_PLAYER_BIGBLIND);this._updateTypePLayer(params["2"],PK_TYPE_PLAYER_SMALLBLIND);this._updateTypePLayer(params["1"],PK_TYPE_PLAYER_DEALER);var cards=params["6"];if(cards.length>0){this._view.cardMix.removeAll();var cardObjs=[];for(var i=0;i<cards.length;i++)cardObjs.push(CardList.prototype.getCardWithId(cards[i]));
this._view.cardMix.addCardReconnect(cardObjs)}var moneyPot=parseInt(params["9"]["1"]);this._view.lblPot.setString(cc.Global.NumberFormat1(moneyPot));this._view.timeMaxTurn=params["8"]}},_onUserStandupHandler:function(cmd,data){var timeInfor={timeRemain:0,username:""};if(data.p.u==PlayerMe.username){this._view.setGoldRemain(false,"0");this._view.gameTopBar.backBt.loadTextureNormal("ingame-backBt.png",ccui.Widget.PLIST_TEXTURE);this._view.allSlot[0].setIsMe(false);this._view.stateMe=PK_STATUSME_STANDUP;
timeInfor=this._view.getTimePlayerCurrent();if(timeInfor.timeRemain>0)cc.log("aaaaaa11");var newSlot=[];for(var i=0;i<this.playerSlot.length;i++){var idx=this.playerSlot[i].userIndex;if(idx<0)idx+=maxSlot;newSlot[idx]=this.playerSlot[i]}this.playerSlot=newSlot}var slot=this.getSlotPlayerByUsername(data.p.u);if(slot){slot.info.moneyBet=0;slot.info.isPlaying=false;slot.info.idAction=PK_ACTION_PLAYER_NONE;slot.info.isDealer=PK_TYPE_PLAYER_NOMARL}this._onUserExit(data.p.u);this._view.fillPlayerToSlot(this.playerSlot);
this._view.updateInviteButton();for(var i=0;i<this.playerSlot.length;i++)this._view.allSlot[i].fillInforAgain(this.playerSlot[i].info);if(data.p.u==PlayerMe.username&&timeInfor.timeRemain>0){cc.log("aaaaaa");this._view.setTimeRemainOfPlayer(timeInfor.username,timeInfor.timeRemain)}},_onUserSitDownHandler:function(cmd,content){this.onUserSitDown(content.p)},_onGameStatusHandler:function(cmd,content){this.onGameStatus(content.p)},_onRoomOwnerChangedHandler:function(cmd,content){this.onRoomOwnerChanged(content.p)},
_onBetStatusHandler:function(cmd,content){},_onFinisRow:function(cmd,content){this.onFinisRow(content.p)},_onTipCaveHandler:function(cmd,content){this.onTipCaveHandler(content.p)},_onTipHandler:function(cmd,content){this.onTipHandler(content.p)},_onStartGameHandler:function(cmd,content){this.onStartGame(content.p)},_onNewRoundHandler:function(cmd,content){this.onNewRound(content.p)},_onPreStart:function(cmd,content){this.onPreStart(content.p)},_onEndGame:function(cmd,content){this.onEndGame(content.p)},
_onHandleSuggest:function(cmd,content){this.onHandleSuggest(content.p)},_onDrawCard:function(cmd,content){this.onDrawCard(content.p)},_onRegeditStandup:function(cmd,content){this.onRegeditStandup(content.p)},_onUpdateMoney:function(cmd,content){this.onUpdateMoney(content.p)},_onTurnChangedHandler:function(cmd,content){this.onTurnChanged(content.p)},_onActionPlayer:function(cmd,content){this.onActionPlayer(content.p)},getSlotPlayerByUsername:function(username){for(var i=0;i<this.playerSlot.length;i++)if(this.playerSlot[i].username==
username)return this.playerSlot[i];return null},onActionPlayer:function(param){var username=param["u"];var money=parseInt(param["3"]);var moneyExchange=param["2"];var action=param["1"];this._view.updateActionPlayer(username,money,moneyExchange,action);var slot=this.getSlotPlayerByUsername(username);if(slot){slot.info.idAction=action;slot.info.moneyBet=money}},onInitJoin:function(param){this._view.stateMe=PK_STATUSME_STANDUP;this._view.setMinBetting(param["8"]);this.numberSlot=param["19"];this._view.initPlayer(this.numberSlot);
this._view.setMinMaxSitDown(parseInt(param["16"]),parseInt(param["15"]));var arrListPlayer=param["5"];for(var i=0;i<arrListPlayer.length;i++){var play=arrListPlayer[i];if(PlayerMe.username==play["u"]&&play["4"]>-1){this._view.stateMe=PK_STATUSME_SITDOWN;break}}},onJoinRoom:function(param){this.onInitJoin(param);this._super(param);this.onUpdateMe(param);this._updateRoomInfo(param["12"]);var currenrt=param["ct"];if(currenrt)this._view.setTimeRemainOfPlayer(currenrt["u"],currenrt["1"]/1E3);this._view.updateInviteButton();
this._view.findSlotSitDown()},onUpdateMe:function(param){var arrListPlayer=param["5"];for(var i=0;i<arrListPlayer.length;i++){var play=arrListPlayer[i];if(PlayerMe.username==play["u"]&&play["4"]>-1){this._view.allSlot[0].setIsMe(true);break}}},showGoldRemainReconnect:function(param,gold){var arrListPlayer=param["5"];for(var i=0;i<arrListPlayer.length;i++){var play=arrListPlayer[i];if(PlayerMe.username==play["u"]&&play["4"]>-1){this._view.setGoldRemain(true,gold);break}}},onReconnect:function(param){this.onInitJoin(param["1"]);
this._super(param);this.statusRoom=param["1"]["1"];this.onUpdateMe(param["1"]);this.showGoldRemainReconnect(param["1"],param["2"]["3"]);this._updateRoomInfo(param["1"]["12"]);this._view.updateInviteButton();if(param["8"]&&this._view.stateMe==PK_STATUSME_SITDOWN)this._view.gameTopBar.backBt.loadTextureNormal("pk_standup_ac.png",ccui.Widget.PLIST_TEXTURE);else if(this._view.stateMe==PK_STATUSME_SITDOWN)this._view.gameTopBar.backBt.loadTextureNormal("pk_standup.png",ccui.Widget.PLIST_TEXTURE);var currenrt=
param["ct"];if(currenrt){var arrButton=currenrt["2"];this._view.handleButtons(arrButton);this._view.setTimeRemainOfPlayer(currenrt["u"],currenrt["1"]/1E3)}if(param["7"])this._view.tipBt.setVisible(param["7"]);var cards=param["3"];if(cards.length>0){this._view.allSlot[0].cardList.removeAll();var cardObjs=[];for(var i=0;i<cards.length;i++)cardObjs.push(CardList.prototype.getCardWithId(cards[i]));this._view.allSlot[0].cardList.dealCards(cardObjs,false)}if(param["4"]){var typeHand=param["4"]["1"];this._view.allSlot[0].setNameHand(S_TYPE_CARDS[typeHand],
false);var cardsLight=param["4"]["2"];var cardsBorder=param["4"]["3"];var cLight=[];for(var j=0;j<cardsLight.length;j++)cLight.push(CardList.prototype.getCardWithId(cardsLight[j]));var cBorder=[];for(var j=0;j<cardsBorder.length;j++)cBorder.push(CardList.prototype.getCardWithId(cardsBorder[j]));this._view.allSlot[0].cardList.showBoderCards(cBorder);this._view.allSlot[0].cardList.showCardBlack(cLight);this._view.cardMix.showBoderCards(cBorder);this._view.cardMix.showCardBlack(cLight)}},onRoomOwnerChanged:function(param){this.isOwnerMe=
param.u==PlayerMe.username},onHandleSuggest:function(param){var action=param["1"];var idActive=param["2"];this._view.handleCheckBox(idActive,action)},onRegeditStandup:function(param){var isSuccess=param[1];if(isSuccess){this._view.gameTopBar.backBt.loadTextureNormal("pk_standup_ac.png",ccui.Widget.PLIST_TEXTURE);MessageNode.getInstance().show("\u0110\u0103ng k\u00fd \u0111\u1ee9ng l\u00ean khi h\u1ebft v\u00e1n th\u00e0nh c\u00f4ng.")}else{this._view.gameTopBar.backBt.loadTextureNormal("pk_standup.png",
ccui.Widget.PLIST_TEXTURE);MessageNode.getInstance().show("B\u1ea1n \u0111\u00e3 H\u1ee6Y \u0111\u1ee9ng l\u00ean khi h\u1ebft v\u00e1n")}},onUpdateMoney:function(param){var userName=param["u"];var money=parseInt(param["1"]);var slot=this.getSlotPlayerByUsername(userName);if(slot){slot.info.money=money;if(param["reason"]&&userName==PlayerMe.username)if(param["reason"]==30){var moneyEx=cc.Global.NumberFormat1(parseInt(param["2"]));MessageNode.getInstance().show("B\u1ea1n \u0111\u00e3 t\u1ef1 \u0111\u1ed9ng mua th\u00eam "+
moneyEx+" chip v\u00e0o b\u00e0n")}}var slotView=this._view.getSlotByUsername(userName);if(slotView)slotView.setGold(money)},onDrawCard:function(param){if(this.statusRoom!=2)return;var thiz=this;var typeHand=param["1"];var cardsLight=param["2"];var cardsBorder=param["3"];var cLight=[];for(var j=0;j<cardsLight.length;j++)cLight.push(CardList.prototype.getCardWithId(cardsLight[j]));var cBorder=[];for(var j=0;j<cardsBorder.length;j++)cBorder.push(CardList.prototype.getCardWithId(cardsBorder[j]));var timeDelay=
.6;if(this.turnId==1)timeDelay=1.2;this._view.stopActionByTag(111);var actionDraw=new cc.Sequence(new cc.DelayTime(timeDelay),new cc.CallFunc(function(){thiz._view.allSlot[0].cardList.showBoderCards(cBorder);thiz._view.allSlot[0].cardList.showCardBlack(cLight);thiz._view.allSlot[0].setNameHand(S_TYPE_CARDS[typeHand],false);thiz._view.cardMix.showBoderCards(cBorder);thiz._view.cardMix.showCardBlack(cLight)}));actionDraw.setTag(111);this._view.runAction(actionDraw)},onEndGame:function(param){var thiz=
this;this._view.stopActionByTag(111);var timeRemain=param["18"]/1E3;for(var i=0;i<thiz.playerSlot.length;i++){thiz.playerSlot[i].info.isPlaying=false;thiz.playerSlot[i].info.idAction=PK_ACTION_PLAYER_NONE;thiz.playerSlot[i].info.isDealer=PK_TYPE_PLAYER_NOMARL}var actionClearPlaew=new cc.Sequence(new cc.DelayTime(timeRemain),new cc.CallFunc(function(){for(var i=0;i<thiz._view.allSlot.length;i++){cc.log("call here");thiz._view.allSlot[i].resetEndGame()}}));actionClearPlaew.setTag(222);this._view.runAction(actionClearPlaew);
this._view.runAction(new cc.Sequence(new cc.DelayTime(2),new cc.CallFunc(function(){thiz._view.resetGame(timeRemain-2)}),new cc.DelayTime(timeRemain-2),new cc.CallFunc(function(){for(var i=0;i<thiz.playerSlot.length;i++){thiz.playerSlot[i].info.moneyBet=0;thiz.playerSlot[i].info.isPlaying=false;thiz.playerSlot[i].info.idAction=PK_ACTION_PLAYER_NONE;thiz.playerSlot[i].info.isDealer=PK_TYPE_PLAYER_NOMARL}thiz._view.cardMix.removeAll()})));this._view.handleButtons(null);var arrPlays=param["3"];this._view.runAction(new cc.Sequence(new cc.DelayTime(.5),
new cc.CallFunc(function(){SoundPlayer.playSound("pk_chips_bet_many2")})));for(var i=0;i<arrPlays.length;i++)(function(){var temp=arrPlays[i];var username=temp["u"];var money=parseInt(temp["5"]);var isWin=temp["7"];var cards=[];var cardData=temp["2"];for(var j=0;j<cardData.length;j++)cards.push(CardList.prototype.getCardWithId(cardData[j]));var slotController=thiz.getSlotPlayerByUsername(username);if(slotController)slotController.info.money=money;var slotView=thiz._view.getSlotByUsername(username);
if(slotView){slotView.setGold(money);slotView.setUserNamePoker();slotView.setMoneyBet(0);if(isWin){var moneyWin=cc.Global.NumberFormat1(parseInt(temp["4"]));thiz._view.runChipWin(slotView,moneyWin);slotView.setEffectWin(isWin);thiz._view.lblPot.setString("")}if(temp["6"]){cc.log("co key 6");var typeHand=temp["6"]["1"];var cardsLight=temp["6"]["2"];var cardsBorder=temp["6"]["3"];var cLight=[];for(var j=0;j<cardsLight.length;j++)cLight.push(CardList.prototype.getCardWithId(cardsLight[j]));var cBorder=
[];for(var j=0;j<cardsBorder.length;j++)cBorder.push(CardList.prototype.getCardWithId(cardsBorder[j]));if(PlayerMe.username!=username){slotView.phomVituarl.setVisible(false);slotView.cardList.addCardsPokerEndGame(cards)}slotView.setNameHand(S_TYPE_CARDS[typeHand],isWin);if(isWin)thiz._view.runAction(new cc.Sequence(new cc.DelayTime(.9),new cc.CallFunc(function(){slotView.cardList.showBoderCards(cBorder);slotView.cardList.showCardBlack(cLight);thiz._view.cardMix.showBoderCards(cBorder);thiz._view.cardMix.showCardBlack(cLight)})));
else{slotView.cardList.showBoderCards(cBorder);slotView.cardList.showCardBlack(cLight)}}}})()},onPreStart:function(param){var bigBlind=param["3"];var smallBlind=param["2"];var dealer=param["1"];this._view.stopActionByTag(222);for(var i=0;i<this._view.allSlot.length;i++){cc.log("resetEndGame 1");this._view.allSlot[i].resetEndGame();cc.log("resetEndGame 3")}this._view.setTypePlayer(bigBlind,PK_TYPE_PLAYER_BIGBLIND);this._view.setTypePlayer(smallBlind,PK_TYPE_PLAYER_SMALLBLIND);this._view.setTypePlayer(dealer,
PK_TYPE_PLAYER_DEALER)},onNewRound:function(param){var turnId=param["1"];this.turnId=turnId;var publicCards=param["2"];var thiz=this;if(!param["3"]){SoundPlayer.stopAllSound();if(turnId==1)SoundPlayer.playSound("pk_dealer_flop");else if(turnId==2)SoundPlayer.playSound("pk_dealer_turn");else if(turnId==3)SoundPlayer.playSound("pk_dealer_river")}if(turnId==0)this._view.cardMix.removeAll();var pointCave=this._view.imgCave.getParent().convertToWorldSpace(this._view.imgCave.getPosition());if(publicCards.length>
0)if(turnId==1){var cardObjs=[];for(var i=0;i<publicCards.length;i++)cardObjs.push(CardList.prototype.getCardWithId(publicCards[i]));for(var j=0;j<cardObjs.length;j++)(function(){var jnew=j;thiz._view.cardMix.runAction(new cc.Sequence(new cc.DelayTime(j*.5),new cc.CallFunc(function(){SoundPlayer.playSound("pk_card_deal");cc.log("\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d"+cardObjs[jnew].rank);thiz._view.cardMix.addCardsPoker(cardObjs[jnew],pointCave)})))})()}else{SoundPlayer.playSound("pk_card_deal");thiz._view.cardMix.addCardsPoker(CardList.prototype.getCardWithId(publicCards[0]),
pointCave)}},sendActionRequest:function(action,money){SmartfoxClient.getInstance().sendExtensionRequestCurrentRoom("659",{1:action,2:money})},onTipHandler:function(param){this._view.tipBt.setVisible(param["1"])},onTipCaveHandler:function(param){var moneyT="+"+cc.Global.NumberFormat1(parseInt(param["1"]));var userName=param["u"];this._view.playerTip(userName,moneyT)},onFinisRow:function(param){var moneyPot=param["2"]["1"];this._view.updateMoneyPot(parseInt(moneyPot));this._view.resetMoneyBetAllSlot();
for(var i=0;i<this.playerSlot.length;i++){if(this.playerSlot[i].info.idAction!=PK_ACTION_PLAYER_FOLD&&this.playerSlot[i].info.idAction!=PK_ACTION_PLAYER_ALL_IN)this._view.allSlot[i].setUserNamePoker();if(this.playerSlot[i].info.moneyBet>0)this._view.takeMoneyFromSlot(this._view.allSlot[i],cc.Global.NumberFormat1(this.playerSlot[i].info.moneyBet));this.playerSlot[i].info.moneyBet=0}},onStartGame:function(param){var cards=param["1"];var cardObjs=[];for(var i=0;i<cards.length;i++)cardObjs.push(CardList.prototype.getCardWithId(cards[i]));
this._view.performDealCards(cardObjs,true)},onTurnChanged:function(param){var username=param.u;var availableActions=param["2"];var minBet=param["3"];var maxBet=param["4"];this._view.onUpdateTurn(username);this._view.handleButtons(availableActions);if(username==PlayerMe.username)this._view.bettingPoker.setMinMaxAgain(minBet,maxBet)},onUserJoinRoom:function(p){},onUserSitDown:function(param){var thiz=this;var slotIndex=param["4"];var username=param["u"];var gold=param["10"];var spectator=param["2"];
var avt=param["avtUrl"];for(var i=0;i<this.playerSlot.length;i++)if(this.playerSlot[i].userIndex==slotIndex){this.playerSlot[i].username=username;this.playerSlot[i].spectator=spectator;this.playerSlot[i].avt=avt;this.playerSlot[i].info=thiz._createUserInfo(param);break}var timeInfor={timeRemain:0,username:""};if(PlayerMe.username==param.u){this._view.allSlot[0].setIsMe(true);this._view.stateMe=PK_STATUSME_SITDOWN;this._view.gameTopBar.backBt.loadTextureNormal("pk_standup.png",ccui.Widget.PLIST_TEXTURE);
timeInfor=this._view.getTimePlayerCurrent();if(timeInfor.timeRemain>0)cc.log("vvv1");var maxSlot=this.getMaxSlot();var newSlot=[];for(var i=0;i<this.playerSlot.length;i++){var idx=this.playerSlot[i].userIndex-slotIndex;if(idx<0)idx+=maxSlot;newSlot[idx]=this.playerSlot[i]}this.playerSlot=newSlot;this._view.fillPlayerToSlot(this.playerSlot)}else{var userInfo={index:slotIndex,username:username,gold:param["10"],avt:param["avtUrl"]};this._view.userJoinRoom(userInfo)}this._view.updateInviteButton();for(var i=
0;i<this.playerSlot.length;i++)this._view.allSlot[i].fillInforAgain(this.playerSlot[i].info);if(param.u==PlayerMe.username&&timeInfor.timeRemain>0){cc.log("bbbbb");this._view.setTimeRemainOfPlayer(timeInfor.username,timeInfor.timeRemain)}},onGameStatus:function(status){this.statusRoom=status},getMaxSlot:function(){return this.numberSlot},sendTipRequest:function(money){SmartfoxClient.getInstance().sendExtensionRequestCurrentRoom("655",{1:money})},sendSitDownRequest:function(index,betting,isAuto){SmartfoxClient.getInstance().sendExtensionRequestCurrentRoom("653",
{1:index,2:betting,3:isAuto})},sendStartRequest:function(){SmartfoxClient.getInstance().sendExtensionRequestCurrentRoom("3",null)},requestStandup:function(){SmartfoxClient.getInstance().sendExtensionRequestCurrentRoom("657",null)},requestSuggest:function(idAction){SmartfoxClient.getInstance().sendExtensionRequestCurrentRoom("662",{1:idAction})}});s_sfs_error_msg[61]="Kh\u00f4ng th\u1ec3 \u0103n b\u00e0i";s_sfs_error_msg[62]="Kh\u00f4ng th\u1ec3 h\u1ea1 b\u00e0i";s_sfs_error_msg[63]="Kh\u00f4ng th\u1ec3 g\u1eedi b\u00e0i";s_sfs_error_msg[64]="Kh\u00f4ng th\u1ec3 b\u1ed1c b\u00e0i";
var PhomController=GameController.extend({ctor:function(view){this._super();this.initWithView(view);this.timeTurn=15;SmartfoxClient.getInstance().addExtensionListener("3",this._onStartGameHandler,this);SmartfoxClient.getInstance().addExtensionListener("4",this._onDanhBaiThanhCongHandler,this);SmartfoxClient.getInstance().addExtensionListener("7",this._onTurnChangedHandler,this);SmartfoxClient.getInstance().addExtensionListener("8",this._onGameFinishedHandler,this);SmartfoxClient.getInstance().addExtensionListener("10",
this._onGameStatusHandler,this);SmartfoxClient.getInstance().addExtensionListener("46",this._onStealAssetUpdate,this);SmartfoxClient.getInstance().addExtensionListener("101",this._onDrawDeckHandler,this);SmartfoxClient.getInstance().addExtensionListener("103",this._onStealCardHandler,this);SmartfoxClient.getInstance().addExtensionListener("104",this._onBalanceCardHandler,this);SmartfoxClient.getInstance().addExtensionListener("106",this._onDelegateCard,this);SmartfoxClient.getInstance().addExtensionListener("108",
this._onHaBaiHandler,this);SmartfoxClient.getInstance().addExtensionListener("109",this._onStatusChangedHandler,this);SmartfoxClient.getInstance().addExtensionListener("110",this._onUpdateDrawDeckHandler,this)},onUpdateOwner:function(params){this._super(params);if(this.gameStatus==1&&this.isOwnerMe)this._view.setStartBtVisible(true)},getMaxSlot:function(){return 4},_onGameStatusHandler:function(cmd,content){this.onGameStatus(content.p["1"])},_onStartGameHandler:function(cmd,content){this.onStartGame(content.p)},
_onDanhBaiThanhCongHandler:function(cmd,content){this.onDanhBaiThanhCong(content.p)},_onTurnChangedHandler:function(cmd,content){this.onTurnChanged(content.p)},_onStealCardHandler:function(cmd,content){this.onStealCard(content.p)},_onBalanceCardHandler:function(cmd,content){this.onBalanceCard(content.p)},_onStealAssetUpdate:function(cmd,content){this.onStealAssetUpdate(content.p)},_onDelegateCard:function(cmd,content){this.onDelegateCard(content.p)},_onHaBaiHandler:function(cmd,content){this.onHaBai(content.p)},
_onGameFinishedHandler:function(cmd,content){this.onGameFinished(content.p)},_onStatusChangedHandler:function(cmd,content){this.onStatusChanged(content.p)},_onDrawDeckHandler:function(cmd,content){this.onDrawDeck(content.p)},_onUpdateDrawDeckHandler:function(cmd,content){this.onUpdateDrawDeck(content.p)},onGameStatus:function(param){if(param!=2)this._view.hideAllButton();this._view.setDeckVisible(false);this.gameStatus=param;switch(param){case 0:this._view.removeAllCards();break;case 1:this._view.removeAllCards();
this._view.setStartBtVisible(this.isOwnerMe);break;case 2:this._view.setDeckVisible(true);this._view.setXepBaiBtVisible(true);break;case 3:break}},onJoinRoom:function(params){this._super(params);this.timeTurn=params["7"];this.onInitJoin(params);this.onGameStatus(params["1"]);this._view.setXepBaiBtVisible(false)},onInitJoin:function(param){var userData=param["5"];for(var i=0;i<userData.length;i++){var data=userData[i];var username=data["u"];if(data["10"]&&param["1"]==2)this._view.setTrashCardList(data["10"],
username,true);if(data["11"]&&param["1"]==2){var groupedCard=[];for(var k=0;k<data["11"].length;k++)groupedCard=groupedCard.concat(data["11"][k]);if(username==PlayerMe.username)this._view.performHaBaiMeReconnect(groupedCard,true,data["12"]);else this._view.performHaBaiOther(username,groupedCard,data["12"],true)}}var turnInfo=param["12"];if(turnInfo&&param["1"]==2){this._view.showTimeRemainUser(turnInfo["u"],turnInfo["2"]/1E3,15);this._view.performDrawDeckUpdate(turnInfo["3"]);if(turnInfo["2"]/1E3>
0)this._view.showErrorMessage("B\u00e0n \u0111ang ch\u01a1i, vui l\u00f2ng ch\u1edd")}},onReconnect:function(param){this._super(param);this.onGameStatus(param["1"]["1"]);this._view.removeAllCards();this._view.setCardList(param["3"]);var userData=param["1"]["5"];for(var i=0;i<userData.length;i++){var data=userData[i];var username=data["u"];if(username==PlayerMe.username&&param["1"]["1"]==2)this.onTurnChanged({s:userData[i]["s"],u:username});if(data["10"]&&param["1"]["1"]==2)this._view.setTrashCardList(data["10"],
username,true);if(data["11"]&&param["1"]["1"]==2){var groupedCard=[];for(var k=0;k<data["11"].length;k++)groupedCard=groupedCard.concat(data["11"][k]);if(username==PlayerMe.username)this._view.performHaBaiMeReconnect(groupedCard,true,data["12"]);else this._view.performHaBaiOther(username,groupedCard,data["12"],true)}}var turnInfo=param["1"]["12"];if(turnInfo){this._view.showTimeRemainUser(turnInfo["u"],turnInfo["2"]/1E3,15);this._view.performDrawDeckUpdate(turnInfo["3"])}this._view.processGroupedCard(param["4"])},
onStartGame:function(param){var cards=[];var cardData=param["1"];var groupCardData=param["2"];for(var i=0;i<cardData.length;i++)cards.push(CardList.prototype.getCardWithId(cardData[i]));this._view.performDealCards(cards,groupCardData)},onDanhBaiThanhCong:function(param){var username=param.u;var card=CardList.prototype.getCardWithId(param["1"]);if(PlayerMe.username==username)this._view.performDanhBaiMe(card);else this._view.performDanhBaiOther(username,card)},onTurnChanged:function(param){var username=
param.u;this._view.showTimeRemainUser(username,this.timeTurn);this._view.hideAllButton();if(this._view.cardList.cardList.length>0)this._view.setXepBaiBtVisible(true);if(!param.s)return;switch(param.s){case 0:this._view.setXepBaiBtVisible(false);break;case 1:break;case 2:this._view.setDrawBtVisible(true);break;case 3:this._view.setDrawBtVisible(true);this._view.setAnBaiBtVisible(true);break;case 4:this._view.setDanhBaiBtVisible(true);break;case 5:this._view.setHaBaiBtVisible(true);this._view.setDanhBaiBtVisible(true);
break;case 6:this._view.setDanhBaiBtVisible(true);this._view.setGuiBaiBtVisible(true);break;case 7:this._view.setUBtVisible(true);this._view.setDanhBaiBtVisible(true);break;case 8:this._view.setXepBaiBtVisible(false);break}var thiz=this;if(param["3"]&&param["3"].length>0)this._view.runAction(new cc.Sequence(new cc.DelayTime(.2),new cc.CallFunc(function(){thiz._view.suggestCards(param["3"])})));if(param["4"]&&param["4"].length>0)this._view.runAction(new cc.Sequence(new cc.DelayTime(.2),new cc.CallFunc(function(){thiz._view.suggestCards(param["4"])})))},
onStealCard:function(param){var stealer=param["u1"];var stolenUser=param["u2"];var stolenCard=param["1"];var groupedCards=param["2"];this._view.performStealCard(stealer,stolenUser,stolenCard,groupedCards)},onBalanceCard:function(param){var cardId=param["1"];var fromUser=param["u1"];var toUser=param["u2"];this._view.performBalanceCard(fromUser,toUser,cardId)},onStealAssetUpdate:function(param){var stealer=param["u1"];var stolenUser=param["u2"];var stealerAmount=param["s1"];var stolenAmount=param["s2"];
var stealerBalance=param["m1"];var stolenBalance=param["m2"];this._view.performAssetChange(stealer,stealerAmount,stealerBalance);this._view.performAssetChange(stolenUser,-stolenAmount,stolenBalance)},onDelegateCard:function(param){var fromUser=param["u"];var delegateData=param["1"];for(var i=0;i<delegateData.length;i++){var delegateInfo=delegateData[i];var sender=delegateInfo["u1"];var receiver=delegateInfo["u2"];var cards=delegateInfo["4"];var groupedCardAfter=[];for(var j=0;j<delegateInfo["5"].length;j++)groupedCardAfter=
groupedCardAfter.concat(delegateInfo["5"][j]);this._view.performDelegateCards(sender,receiver,cards,groupedCardAfter)}},onHaBai:function(param){var username=param["u"];var groupedCards=param["11"];var stolenCards=param["12"];if(username==PlayerMe.username)this._view.performHaBaiMe(groupedCards,false);else this._view.performHaBaiOther(username,groupedCards,stolenCards,false)},onGameFinished:function(param){this._view.setUBtVisible(false);this._view.showTimeRemainUser(null);var userData=param["3"];
var resultData=[];var resultStringArray=["B\u00e9t ","\u00d9 Khan","\u00d9 Tr\u00f2n","\u00d9 Th\u01b0\u1eddng","\u00d9 \u0110\u1ec1n","Nh\u1ea5t ","Nh\u00ec ","Ba ","M\u00f3m"];for(var i=0;i<userData.length;i++){var resultEntry={};resultEntry.username=userData[i].u;resultEntry.gold=parseInt(userData[i]["4"]);resultEntry.cardList=userData[i]["2"];resultEntry.resultString=resultStringArray[userData[i]["5"]];resultEntry.isWinner=[1,2,3,4,5].indexOf(userData[i]["5"])!=-1;if([0,5,6,7].indexOf(userData[i]["5"])!=
-1)if(userData[i]["7"])resultEntry.resultString+=userData[i]["7"]+" \u0111i\u1ec3m";this._view.updateGold(userData[i].u,userData[i]["3"]);resultData.push(resultEntry)}this._view.showResultDialog(resultData)},onStatusChanged:function(param){},onDrawDeck:function(param){var username=param.u;var cardId=param["1"];var groupedCard=param["2"];if(username==PlayerMe.username)this._view.performDrawCardMe(cardId,groupedCard);else this._view.performDrawCardOther(username)},onUpdateDrawDeck:function(param){this._view.performDrawDeckUpdate(param["1"])},
sendURequest:function(){SmartfoxClient.getInstance().sendExtensionRequestCurrentRoom("109",null)},sendAnBaiRequest:function(){SmartfoxClient.getInstance().sendExtensionRequestCurrentRoom("103",null)},sendGuiBaiRequest:function(cards){SmartfoxClient.getInstance().sendExtensionRequestCurrentRoom("106",{1:cards})},sendHaBaiRequest:function(cards){SmartfoxClient.getInstance().sendExtensionRequestCurrentRoom("108",{1:cards})},sendStartRequest:function(){SmartfoxClient.getInstance().sendExtensionRequestCurrentRoom("3",
null)},sendDanhBai:function(cardId){SmartfoxClient.getInstance().sendExtensionRequestCurrentRoom("4",{1:cardId})},sendDrawRequest:function(){SmartfoxClient.getInstance().sendExtensionRequestCurrentRoom("101",null)}});var maubinh_wintypes=maubinh_wintypes||["","S\u1eadp ba chi","Binh l\u1ee7ng","3 S\u1ea3nh","3 Th\u00f9ng","L\u1ee5c ph\u00e9 b\u00f4n","5 \u0111\u00f4i 1 s\u00e1m","12 l\u00e1 \u0111\u1ed3ng m\u00e0u","13 l\u00e1 \u0111\u1ed3ng m\u00e0u","S\u1ea3nh r\u1ed3ng","R\u1ed3ng cu\u1ed1n"];var maubinh_chitypes=maubinh_chitypes||["","M\u1eadu th\u1ea7u","\u0110\u00f4i","Th\u00fa","X\u00e1m","S\u1ea3nh","Th\u00f9ng","C\u00f9 l\u0169","T\u1ee9 qu\u00fd","Th\u00f9ng ph\u00e1 s\u1ea3nh","S\u1ea3nh r\u1ed3ng"];
var MauBinhController=GameController.extend({ctor:function(view){this._super();this.initWithView(view);SmartfoxClient.getInstance().addExtensionListener("3",this._onStartGameHandler,this);SmartfoxClient.getInstance().addExtensionListener("10",this._onGameStatusHandler,this);SmartfoxClient.getInstance().addExtensionListener("451",this._onXepXongHandler,this);SmartfoxClient.getInstance().addExtensionListener("452",this._onXepLaiHandler,this);SmartfoxClient.getInstance().addExtensionListener("8",this._onGameFinishHandler,
this);SmartfoxClient.getInstance().addExtensionListener("100005",this._onNoHuHandler,this);SmartfoxClient.getInstance().addExtensionListener("100004",this._onUpdateJackpotHandler,this)},onUpdateOwner:function(params){this._super(params);if(this.gameStatus==1&&this.isOwnerMe)this._view.setStartBtVisible(true)},_onUpdateJackpotHandler:function(cmd,content){this._view.performChangeRewardFund(content.p.data["2"])},_onNoHuHandler:function(cmd,content){this.onNoHuHandler(content.p)},_onStartGameHandler:function(cmd,
content){this.onStartGame(content.p)},_onGameStatusHandler:function(cmd,content){this.onGameStatus(content.p)},_onXepXongHandler:function(cmd,content){this.onXepXong(content.p)},_onXepLaiHandler:function(cmd,content){this.onXepLai(content.p)},_onGameFinishHandler:function(cmd,content){this.onGameFinish(content.p,false)},onStartGame:function(param){var typeTrang=param["2"];this._view.performDealCards(param["1"],true,typeTrang)},onNoHuHandler:function(param){var nameNo=param["data"]["u"];var money=
param["data"]["2"];var thiz=this;thiz._view.showJackpot(nameNo,money)},onGameStatus:function(param){this._view.hideAllButton();this.gameStatus=param["1"];cc.log(param);switch(param["1"]){case 1:this._view.setStartBtVisible(this.isOwnerMe);this._view.cleanBoard();break;case 2:this._view.setIngameButtonVisible(true);this._view.showTimeRemaining(param["2"]);break;case 3:this._view.onTimeOut();break}},onXepXong:function(param){var user=param["u"];this._view.onUserXepBaiStatus(user,true);if(user==PlayerMe.username){var thangTrangMode=
param["2"];if(thangTrangMode>1)this._view.performAnnounce(user,maubinh_wintypes[thangTrangMode])}},onReconnect:function(param){this._super(param);var stateGame=param[1][1];this._view.performChangeRewardFund(param["1"]["11"]["2"]);var isShowArrange=param["4"];this.onGameStatus({1:param["1"]["1"],2:Math.floor(param["1"]["13"]/1E3)});if(stateGame==2||stateGame==3){this._view.performDealCards(param["3"],false,0);if(stateGame==2){this._view.xepLaiBt.setVisible(isShowArrange);this._view.showNodeArrangement(!isShowArrange)}else this.onGameFinish(param["1"]["14"],
true)}},onXepLai:function(param){var user=param["u"];this._view.onUserXepBaiStatus(user,false)},onGameFinish:function(param,isReconnect){var thiz=this;var arrAction=[];var delayUp=new cc.DelayTime(1);arrAction.push(delayUp);var phaseCurr=param["2"];var idPhaseCurr=phaseCurr["1"];var timeCurrent=phaseCurr["2"]/1E3;var delayTCurr=new cc.DelayTime(timeCurrent);var phases=param["1"];for(var i=0;i<phases.length;i++)(function(){var iNew=i;var phase=phases[iNew];var idPhase=phase["1"];var timePhase=phase["2"]/
1E3;var delayTime=new cc.DelayTime(timePhase);var arrResuft=phase["3"];var callFun=null;callFun=new cc.CallFunc(function(){for(var k=0;k<arrResuft.length;k++)(function(){var knew=k;var exMoney=arrResuft[knew]["3"]?arrResuft[knew]["3"]:"0";var arrCard=arrResuft[knew]["1"];var namePlayer=arrResuft[knew]["u"];var moneyPlayer=arrResuft[knew]["4"]?arrResuft[knew]["4"]:"0";if(idPhase==1){var rankChi=arrResuft[knew]["0"];thiz._view.performLatBaiSpecial(namePlayer,arrCard,rankChi,exMoney,isReconnect)}else if(idPhase==
2||idPhase==3||idPhase==4){var isReconnectNew=isReconnect;if(idPhaseCurr<idPhase)isReconnectNew=false;var rankChi=arrResuft[knew]["10"];var typeBaoLang=arrResuft[knew]["0"];var txtSap=typeBaoLang==1?"S\u1eadp":"";thiz._view.performSoChi(namePlayer,idPhase-2,rankChi,exMoney,arrCard,parseInt(moneyPlayer),txtSap,isReconnectNew)}else if(idPhase==5){var rankChi=arrResuft[knew]["0"];thiz._view.performPhase5(namePlayer,rankChi,exMoney,isReconnect)}else if(idPhase==6){var winType=arrResuft[knew]["0"];var soChiWin=
arrResuft[knew]["6"];var wholeCards=arrResuft[knew]["8"];var moneyChange=arrResuft[knew]["5"];thiz._view.addResultEntry(namePlayer,winType,soChiWin,wholeCards,parseInt(moneyPlayer),moneyChange)}})();if(idPhase==6)thiz._view.performShowResult(0)});if(callFun!=null)if(idPhase>=idPhaseCurr){arrAction.push(callFun);if(idPhase!=6)arrAction.push(idPhase>idPhaseCurr?delayTime:delayTCurr)}else thiz._view.runAction(callFun)})();this._view.runAction(new cc.Sequence(arrAction))},sendXepBaiXong:function(cards){SmartfoxClient.getInstance().sendExtensionRequestCurrentRoom("451",
{1:cards})},getMaxSlot:function(){return 4},onJoinRoom:function(param){var thiz=this;this._super(param);var huThuongValue=param["11"]["2"];this._view.performChangeRewardFund(huThuongValue);var cards=[1,1,1,1,1,1,1,1,1,1,1,1,1];var cardArray=[];for(var i=0;i<cards.length;i++)cardArray.push(CardList.prototype.getCardWithId(cards[i]));var gameStatus=param["1"];this.gameStatus=gameStatus;if(gameStatus==2){this._view.showErrorMessage("B\u00e0n \u0111ang ch\u01a1i, vui l\u00f2ng ch\u1edd",this._view);var userInfo=
param["5"];for(var i=0;i<userInfo.length;i++){var isSpector=userInfo[i]["2"];if(!isSpector){var userName=userInfo[i]["u"];var slot=thiz._view.getSlotByUsername(userName);slot.cardList.dealCards(cardArray,false,false);var isDone=userInfo[i]["5"];if(isDone)slot.cardList.setNameChi(MB_CHI_DAU,"X\u1ebfp xong",true);else slot.cardList.setNameChi(MB_CHI_DAU,"\u0110ang x\u1ebfp",false)}}}},sendStartRequest:function(){SmartfoxClient.getInstance().sendExtensionRequestCurrentRoom("3",null)},sendXepBaiLai:function(){SmartfoxClient.getInstance().sendExtensionRequestCurrentRoom("452",
null)}});var BaCayController=GameController.extend({ctor:function(view){this._super();this.initWithView(view);this.isPlaying=false;SmartfoxClient.getInstance().addExtensionListener("100004",this._onUpdateJackpotHandler,this);SmartfoxClient.getInstance().addExtensionListener("10",this._onChangeRoomStateHandler,this);SmartfoxClient.getInstance().addExtensionListener("3",this._onDealCardHandler,this);SmartfoxClient.getInstance().addExtensionListener("301",this._onRevealCardHandler,this);SmartfoxClient.getInstance().addExtensionListener("8",
this._onGameResultHandler,this);SmartfoxClient.getInstance().addExtensionListener("100005",this._onNoHuBaCayHandler,this)},onJoinRoom:function(param){this._super(param);var huThuongValue=param["11"]["2"];this._view.performChangeRewardFund(huThuongValue);this.onChangeRoomState(param)},_onUpdateJackpotHandler:function(cmd,content){this._view.performChangeRewardFund(content.p.data["2"])},_onChangeRoomStateHandler:function(cmd,content){this.onChangeRoomState(content.p)},_onDealCardHandler:function(cmd,
content){this.onDealCard(content.p)},_onRevealCardHandler:function(cmd,content){this.onRevealCard(content.p)},_onGameResultHandler:function(cmd,content){this.onGameResult(content.p)},_onNoHuBaCayHandler:function(cmd,content){this.onNoHuBaCay(content.p)},onNoHuBaCay:function(param){var data=param.data;var nameNo=data["u"];var money=data["2"];var thiz=this;thiz._view.showJackpot(nameNo,money)},onChangeRoomState:function(param){var roomState=param["1"];var remainingTime=param["2"];switch(roomState){case 0:this._view.setStateString("\u0110ang \u0111\u1ee3i ng\u01b0\u1eddi ch\u01a1i");
break;case 1:this._view.setStateString("Chu\u1ea9n b\u1ecb v\u00e1n m\u1edbi");break;case 2:this._view.setStateString("");break;case 3:this._view.setStateString("Game \u0111\u00e3 k\u1ebft th\u00fac");break}this._view.setRevealBtVisible(roomState==2&&this.isPlaying);if(roomState==2&&!this.isPlaying){this._view.showErrorMessage("B\u00e0n \u0111ang ch\u01a1i, vui l\u00f2ng ch\u1edd",this._view);this._view.creatCardListForOther([1,2,3])}this._view.showTimeRemaining(remainingTime);if(roomState!=2)this._view.resetBoard()},
onDealCard:function(param){this.isPlaying=true;var cards=param["1"];this._view.dealCard(cards)},onRevealCard:function(param){var userPoints=param["1"];var username=param["u"];var userCards=param["2"];if(username==PlayerMe.username){this._view.setRevealBtVisible(false);this._view.setResultString(userPoints,username)}this._view.revealCards(userCards,username)},onReconnect:function(param){this._super(param);this.isPlaying=true;this._view.resetBoard();var stategame=param["1"]["1"];var remainTime=Math.floor(param["1"]["6"]/
1E3);this.onChangeRoomState({1:stategame,2:remainTime});if(stategame==2||stategame==3){this._view.reappearCard(param["3"]);this._view.performChangeRewardFund(param["1"]["11"]["2"]);if(param["1"]["4"]){var userInfo=param["1"]["5"];for(var i=0;i<userInfo.length;i++){var username=userInfo[i]["u"];this._view.revealCards(userInfo[i]["9"],username);this._view.setResultString(userInfo[i]["10"],username)}}}},onGameResult:function(param){this.isPlaying=false;for(var i=0;i<param["3"].length;i++){var data=param["3"][i];
var cardArray=data["2"];var goldAfter=data["3"];var goldChange=data["4"];var resultString=data["10"];var username=data["u"];this._view.revealCards(cardArray,username);this._view.setResultString(resultString,username);this._view.performAssetChange(goldChange,goldAfter,username)}this._view.setRevealBtVisible(false)},sendRevealCard:function(){SmartfoxClient.getInstance().sendExtensionRequestCurrentRoom("301",null)},getMaxSlot:function(){return 6}});s_sfs_error_msg[34]="Kh\u00f4ng \u0111\u01b0\u1ee3c \u0111\u1ec3 2 cu\u1ed1i";s_sfs_error_msg[32]="H\u1ebft th\u1eddi gian b\u00e1o s\u00e2m";var s_defWin_Sam=s_defWin_Sam||[];s_defWin_Sam[0]="\u0102n tr\u1eafng 5 \u0111\u00f4i";s_defWin_Sam[1]="\u0102n tr\u1eafng 3 X\u00e1m";s_defWin_Sam[2]="\u0102n tr\u1eafng \u0111\u1ed3ng m\u00e0u";s_defWin_Sam[3]="\u0102n tr\u1eafng T\u1ee9 2";s_defWin_Sam[4]="\u0102n tr\u1eafng s\u1ea3nh r\u1ed3ng";s_defWin_Sam[6]="\u0102n tr\u1eafng s\u1ea3nh";
s_defWin_Sam[15]="H\u00f2a";s_defWin_Sam[16]="\u0102n s\u00e2m";s_defWin_Sam[17]="B\u1ecb b\u1eaft s\u00e2m";s_defWin_Sam[18]="Ph\u1ea1t b\u00e1o 1";s_defWin_Sam[19]="B\u1ecb \u0103n tr\u1eafng";s_defWin_Sam[21]="B\u1eaft s\u00e2m";
var SamController=TLMNGameController.extend({ctor:function(view){this._super();this.initWithView(view);SmartfoxClient.getInstance().addExtensionListener("51",this._onUserCallSamHandler,this);SmartfoxClient.getInstance().addExtensionListener("52",this._onUserFoldSamHandler,this);SmartfoxClient.getInstance().addExtensionListener("53",this._onChangeSamStateHandler,this);SmartfoxClient.getInstance().addExtensionListener("54",this._onNotifiOneHandler,this)},getMaxSlot:function(){if(this.isSolo)return 2;
return 5},_onUserCallSamHandler:function(cmd,content){this.onUserCallSam(content.p.u)},_onUserFoldSamHandler:function(cmd,content){this.onUserFoldSam(content.p.u)},_onChangeSamStateHandler:function(cmd,content){this.onChangeSamState(content.p["1"],content.p["2"])},_onNotifiOneHandler:function(cmd,content){this.onNotifiOne(content.p.u)},onUserCallSam:function(username){if(username==PlayerMe.username){var msg="B\u1ea1n \u0111\u00e3 b\u00e1o s\u00e2m th\u00e0nh c\u00f4ng";this._view.alertMessage(msg)}else this._view.notifyBaoSam(username,
true);this._view.setSamBtVisible(false)},onUserFoldSam:function(username){if(username==PlayerMe.username){var msg="B\u1ea1n \u0111\u00e3 hu\u1ef7 s\u00e2m th\u00e0nh c\u00f4ng";this._view.alertMessage(msg)}else this._view.notifyBaoSam(username,false);if(PlayerMe.username==username)this._view.setSamBtVisible(false)},onChangeSamState:function(state,timeRemaining){this._view.setSamBtVisible(state==1);if(state==1){this._view.showBaoSamTimeRemaining(Math.round(timeRemaining/1E3));this._view.setDanhBaiBtVisible(false);
for(var i=0;i<this._view.playerView.length;i++)this._view.playerView[i].stopTimeRemain()}else this._view.showBaoSamTimeRemaining(0)},onGameFinished:function(params){this._view.setDanhBaiBtVisible(false);this._view.setXepBaiBtVisible(false);this._view.setBoLuotBtVisible(false);this._view.setStartBtVisible(false);this._view.setSamBtVisible(false);this._view.onUpdateTurn(".",0,0);var winPlayer=params.u;var playerData=params["3"];var player=[];for(var i=0;i<playerData.length;i++){var username=playerData[i].u;
var gold=parseInt(playerData[i]["4"]);var title=null;var defWinType=playerData[i]["5"];var cardListData=playerData[i]["2"];var cardList=[];for(var j=0;j<cardListData.length;j++)cardList.push(CardList.prototype.getCardWithId(cardListData[j]));if(username==winPlayer)title=s_defWin_Sam[defWinType]?s_defWin_Sam[defWinType]:"Th\u1eafng";else{var msg=s_defWin_Sam[defWinType];title=msg?msg:"Thua "+cardList.length+" l\u00e1"}player[i]={username:username,title:title,gold:gold,cardList:cardList,isWinner:username==
winPlayer};var userGold=parseInt(playerData[i]["3"]);this._view.updateGold(username,userGold)}this._view.showFinishedDialog(player);this._view.hideAllNotifyOne()},onNotifiOne:function(username){if(username!=PlayerMe.username)this._view.notifyOne(username)},sendBaoSamRequest:function(){SmartfoxClient.getInstance().sendExtensionRequestCurrentRoom("51",{})},sendHuySamRequest:function(){SmartfoxClient.getInstance().sendExtensionRequestCurrentRoom("52",{})}});s_sfs_error_msg[91]="C\u01b0\u1ee3c v\u01b0\u1ee3t qu\u00e1 cho ph\u00e9p";s_sfs_error_msg[92]="C\u1eeda \u0111\u1eb7t kh\u00f4ng x\u00e1c \u0111\u1ecbnh";s_sfs_error_msg[93]="B\u1ea1n kh\u00f4ng \u0111\u1ee7 ti\u1ec1n \u0111\u1ec3 l\u00e0m nh\u00e0 c\u00e1i";s_sfs_error_msg[94]="B\u1ea1n kh\u00f4ng ph\u1ea3i nh\u00e0 c\u00e1i";s_sfs_error_msg[95]="Nh\u00e0 c\u00e1i \u0111\u00e3 t\u1ed3n t\u1ea1i";s_sfs_error_msg[96]="H\u1ebft th\u1eddi gian \u0111\u1eb7t c\u01b0\u1ee3c";s_sfs_error_msg[97]="B\u00e1n c\u1eeda kh\u00f4ng th\u00e0nh c\u00f4ng";
s_sfs_error_msg[98]="B\u1ea1n \u0111\u00e3 b\u00e1n c\u1eeda r\u1ed3i";s_sfs_error_msg[99]="S\u1ed1 ti\u1ec1n b\u00e1n c\u1eeda kh\u00f4ng h\u1ee3p l\u1ec7";s_sfs_error_msg[100]="H\u1ee7y c\u01b0\u1ee3c kh\u00f4ng th\u00e0nh c\u00f4ng";s_sfs_error_msg[101]="Nh\u00e0 c\u00e1i kh\u00f4ng th\u1ec3 \u0111\u1eb7t c\u01b0\u1ee3c";s_sfs_error_msg[102]="H\u1ee7y c\u00e1i kh\u00f4ng th\u00e0nh c\u00f4ng";
var XocDiaController=GameController.extend({ctor:function(view){this._super();this.bettingSlotCount=7;this.initWithView(view);this.slotGold=[];this.userGoldSlot=[];this._isRunning=false;SmartfoxClient.getInstance().addExtensionListener("8",this._onOpenDiskHandler,this);SmartfoxClient.getInstance().addExtensionListener("10",this._onUpdateStatusHandler,this);SmartfoxClient.getInstance().addExtensionListener("14",this._onDatCuocThanhCongHandler,this);SmartfoxClient.getInstance().addExtensionListener("15",
this._onHuyCuocThanhCongHandler,this);SmartfoxClient.getInstance().addExtensionListener("21",this._onUpdateUserCountHandler,this);SmartfoxClient.getInstance().addExtensionListener("202",this._onUpdateTongCuocHandler,this);SmartfoxClient.getInstance().addExtensionListener("203",this._onFinishedGameHandler,this);SmartfoxClient.getInstance().addExtensionListener("205",this._onDatLaiThanhCongHandler,this)},getMaxSlot:function(){return 1},onJoinRoom:function(params){this._updateStatus(params["cs"]);this._updateChipValue(params["14"]);
this._updateHistory(params["15"]);this._updateUserCount(params["uc"]);this._updateTongCuoc(params["16"]);var status=params["cs"]["1"];if(status==5||status==1)this._view.showErrorMessage("S\u1eafp b\u1eaft \u0111\u1ea7u v\u00e1n m\u1edbi");this._isRunning=true},onReconnect:function(params){this._updateStatus(params["2"]);this._updateChipValue(params["1"]["14"]);this._updateHistory(params["1"]["15"]);this._updateUserCount(params["1"]["uc"]);this._updateTongCuoc(params["1"]["16"]);var slotData=params["3"];
if(slotData)for(var i=0;i<slotData.length;i++){var slotId=slotData[i]["1"];var userGold=slotData[i]["3"];this._updateUserGoldSlot(slotId,userGold);if(userGold>0&&!this._isRunning)this._addFakeChip(slotId,userGold,false)}this._isRunning=true},_onUpdateStatusHandler:function(cmd,content){this._updateStatus(content.p)},_onDatCuocThanhCongHandler:function(cmd,content){this.onDatCuocThanhCong(content.p)},_onUpdateTongCuocHandler:function(cmd,content){this._updateTongCuoc(content.p["1"])},_onUpdateUserCountHandler:function(cmd,
content){this._updateUserCount(content.p["1"])},_onOpenDiskHandler:function(cmd,content){this.openDisk(content.p)},_onFinishedGameHandler:function(cmd,content){this.finishGame(content.p)},_onDatLaiThanhCongHandler:function(cmd,content){this.datLaiThanhCong(content.p)},_onHuyCuocThanhCongHandler:function(cmd,content){this.huyCuocThanhCong(content.p)},openDisk:function(params){var slots=params["2"];var winSlot=[];var loseSlot=[];for(var i=0;i<slots.length;i++)if(slots[i]["4"])winSlot.push(slots[i]["1"]);
else loseSlot.push(slots[i]["1"]);var data={result:params["1"],winSlot:winSlot,loseSlot:loseSlot};this._view.openDisk(data)},finishGame:function(params){this._view.setTongCuocLabel(params["4"]);this._view.setWinLabel(params["1"])},onDatCuocThanhCong:function(params){var chipId=params["2"];var slotId=params["6"][0]["1"];this._view.addChipToSlot(slotId,chipId,1);var allSlot=params["6"];for(var i=0;i<allSlot.length;i++){this._updateGoldSlot(allSlot[i]["1"],allSlot[i]["2"]);this._updateUserGoldSlot(allSlot[i]["1"],
allSlot[i]["3"])}this._view.setHuyCuocButtonVisible(true);this._view.setDatLaiButtonVisible(false)},datLaiThanhCong:function(param){this._view.setHuyCuocButtonVisible(true);this._view.setDatLaiButtonVisible(false);this._view.datLaiThanhCong();var slots=param["6"];for(var i=0;i<slots.length;i++){var slotId=slots[i]["1"];var slotGold=slots[i]["2"];var userGold=slots[i]["3"];this._updateGoldSlot(slotId,slotGold);this._updateUserGoldSlot(slotId,userGold);if(userGold>0)this._addFakeChip(slotId,userGold,
true)}},_addFakeChip:function(slotId,gold,animation){while(gold>0){var chipSelected=this._chipValue[0];for(var i=0;i<this._chipValue.length;i++){var chip=this._chipValue[i];if(chip.gold>gold)break;chipSelected=chip}gold-=chipSelected.gold;this._view.addChipToSlot(slotId,chipSelected.chipId,1,null,animation?false:true)}},huyCuocThanhCong:function(param){this._view.setHuyCuocButtonVisible(false);this._view.setDatLaiButtonVisible(false);this._view.huyCuocThanhCong();for(var i=0;i<this.bettingSlotCount;i++)this._updateUserGoldSlot(i,
0)},_updateChipValue:function(chips){this._chipValue=[];for(var i=0;i<chips.length;i++){this._view.setChipValue(chips[i]["1"],chips[i]["2"]);this._chipValue.push({chipId:chips[i]["1"],gold:chips[i]["2"]})}this._chipValue.sort(function(a,b){return a.gold-b.gold})},_updateStatus:function(statusObj){var status=statusObj["1"];var currentTime=statusObj["3"]/1E3;var maxTime=statusObj["4"]/1E3;switch(status){case 1:this.slotGold=[];this.userGoldSlot=[];this._view.setTimeRemaining(0,0);this._view.hideDisk();
this._view.resetGame();break;case 2:this.slotGold=[];this.userGoldSlot=[];this._view.setTimeRemaining(0,0);this._view.shakeDisk();this._view.resetGame();break;case 3:this.slotGold=[];this.userGoldSlot=[];this._view.hideDisk();this._view.setTimeRemaining(currentTime,maxTime);this._view.playSoundDatCuoc();break;case 4:this._view.setTimeRemaining(0,0);this._view.hideDisk();break;case 5:this._view.setTimeRemaining(0,0);this._view.hideDisk();break}this._view.setDatLaiButtonVisible(statusObj["2"]);this._view.setHuyCuocButtonVisible(statusObj["5"])},
_updateTongCuoc:function(tongCuoc){for(var i=0;i<tongCuoc.length;i++){var slotId=tongCuoc[i]["1"];var gold=tongCuoc[i]["2"];if(this.slotGold[slotId]!=undefined&&gold>this.slotGold[slotId]){var chipCount=Math.floor(4+Math.random()*4);for(var i=0;i<chipCount;i++){var chipId=Math.floor(Math.random()*4);this._view.addChipToSlot(slotId,chipId,2)}}this._updateGoldSlot(slotId,gold)}},_updateGoldSlot:function(slotId,gold){this._view.updateSlotGold(slotId,gold);this.slotGold[slotId]=gold},_updateUserGoldSlot:function(slotId,
gold){this._view.updateUserGold(slotId,gold);this.userGoldSlot[slotId]=gold;var totalGold=0;for(var i=0;i<this.bettingSlotCount;i++)if(this.userGoldSlot[i])totalGold+=this.userGoldSlot[i];if(totalGold>0)this._view.setTongCuocLabel(totalGold);else this._view.setTongCuocLabel(-1)},_updateHistory:function(historyList){this._view.setHistory(historyList)},_updateUserCount:function(userCount){this._view.updateUserCount(userCount)},requestDatCuoc:function(slotId,chipId){var params={1:slotId,2:chipId};SmartfoxClient.getInstance().sendExtensionRequestCurrentRoom("14",
params)},requestDatlai:function(){SmartfoxClient.getInstance().sendExtensionRequestCurrentRoom("205",{})},requestHuyCuoc:function(){SmartfoxClient.getInstance().sendExtensionRequestCurrentRoom("15",{})}});var TaiXiuController=XocDiaController.extend({ctor:function(view){this._super(view);this.bettingSlotCount=31}});var ChipGroup=cc.Node.extend({ctor:function(){this._super();this.allChips=[];this.chipSelected=null},selectChipAtIndex:function(index,isForce){this.selectChip(this.allChips[index],isForce)},selectChip:function(chip,isForce){if(this.chipSelected){this.chipSelected.unSelect(isForce);this.chipSelected=null}this.chipSelected=chip;if(this.chipSelected)this.chipSelected.select(isForce)},addChip:function(chip){this.allChips.push(chip);this.addChild(chip);chip.unSelect(true)},getChip:function(idx){return this.allChips[idx]},
setTouchEnable:function(enable){for(var i=0;i<this.allChips.length;i++)this.allChips[i].setTouchEnable(enable)}});
var ChipButton=cc.Node.extend({ctor:function(){this._super();this._touchEnabled=true;this.selected=false;this.rectTouch=cc.rect()},onEnter:function(){this._super();var thiz=this;cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:true,onTouchBegan:function(touch,event){return thiz.onTouchBegan(touch,event)}},this)},onExit:function(){this._super();cc.eventManager.removeListeners(this)},onTouchBegan:function(touch,event){if(!this._touchEnabled)return false;if(!this.selected){var p=
this.convertToNodeSpace(touch.getLocation());if(cc.rectContainsPoint(this.rectTouch,p)){this.getParent().selectChip(this,false);return true}}return false},select:function(isForce){this.selected=true;if(this.onSelect)this.onSelect(isForce)},unSelect:function(isForce){this.selected=false;if(this.onUnSelect)this.onUnSelect(isForce)},setTouchEnable:function(enable){this._touchEnabled=enable}});var xocdia_chip_color=xocdia_chip_color||["#ffffff","#ffffff","#ffffff","#ffffff"];
var XocDiaChip=ChipButton.extend({ctor:function(index){this._super();this.chipIndex=index;var normalSprite=new cc.Sprite("#xocdia-chip-"+index+".png");var selectedSprite=new cc.Sprite("#xocdia-chipSelected-"+index+".png");this.addChild(normalSprite);this.addChild(selectedSprite);this.normalSprite=normalSprite;this.selectedSprite=selectedSprite;var label=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_25,"50V");label.setColor(cc.color(xocdia_chip_color[index-1]));this.addChild(label);this.label=
label;var s=normalSprite.getContentSize();this.rectTouch=cc.rect(-s.width/2,-s.height/2,s.width,s.height);selectedSprite.visible=false},select:function(isForce){this._super();this.normalSprite.visible=false;this.selectedSprite.visible=true;this.label.setOpacity(255);var dy=25;if(isForce)this.setPositionY(this.originPoint.y+dy);else{this.stopAllActions();var moveAction=new cc.MoveTo(.2,cc.p(this.x,this.originPoint.y+dy));this.runAction(new cc.EaseSineOut(moveAction))}},unSelect:function(isForce){this._super();
this.normalSprite.visible=true;this.selectedSprite.visible=false;this.label.setOpacity(125);if(isForce)this.setPositionY(this.originPoint.y);else{this.stopAllActions();var moveAction=new cc.MoveTo(.2,cc.p(this.x,this.originPoint.y));this.runAction(new cc.EaseSineOut(moveAction))}},setGold:function(gold){this.label.setString(cc.Global.NumberFormat2(gold))}});PL_POSITION_TOP=0;PL_POSITION_LEFT=1;PL_POSITION_BOTTOM=2;PL_POSITION_RIGHT=3;
var GamePlayer=cc.Node.extend({ctor:function(){this._super();this.setContentSize(cc.size(158,120));this.setAnchorPoint(cc.p(.5,.5));this.isMe=false;this.username="";this.gold=0;this.infoLayer=new cc.Node;this.addChild(this.infoLayer);var avt=UserAvatar.createAvatar();avt.setPosition(this.getContentSize().width/2,79);this.infoLayer.addChild(avt);var chatView=new PlayerMessageView;chatView.setPosition(avt.getPosition());this.infoLayer.addChild(chatView,10);this.chatView=chatView;var isOwnerSprite=new cc.Sprite("#icon_owner.png");
isOwnerSprite.setPosition(avt.x+38,avt.y+38);this.infoLayer.addChild(isOwnerSprite);this.isOwnerSprite=isOwnerSprite;var timer=new cc.ProgressTimer(new cc.Sprite("#player-progress-2.png"));timer.setType(cc.ProgressTimer.TYPE_RADIAL);timer.setPosition(avt.getPosition());timer.setPercentage(100);this.infoLayer.addChild(timer);this.timer=timer;var timer2=new cc.ProgressTimer(new cc.Sprite("#player-progress-1.png"));timer2.setType(cc.ProgressTimer.TYPE_RADIAL);timer2.setReverseDirection(true);timer2.setPosition(avt.getPosition());
timer2.setPercentage(0);this.infoLayer.addChild(timer2);this.timer2=timer2;var inviteBt=new ccui.Button("ingame_inviteBt.png","","",ccui.Widget.PLIST_TEXTURE);inviteBt.setPosition(avt.getPosition());this.addChild(inviteBt);var userLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_20,"PlayePlayePlaye",cc.TEXT_ALIGNMENT_CENTER);userLabel.setColor(cc.color("#63b0f1"));userLabel.setLineBreakWithoutSpace(true);userLabel.setDimensions(this.getContentSize().width,userLabel.getLineHeight());
userLabel.setPosition(this.getContentSize().width/2,34);this.infoLayer.addChild(userLabel,1);var goldLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_20,"1.000V",cc.TEXT_ALIGNMENT_CENTER);goldLabel.setColor(cc.color("#ffde00"));goldLabel.setPosition(this.getContentSize().width/2,14);this.infoLayer.addChild(goldLabel,1);var bgInfor=new ccui.Scale9Sprite("dialog-textinput-bg.png",cc.rect(10,10,4,4));bgInfor.setPreferredSize(cc.size(180,60));bgInfor.setVisible(false);bgInfor.setPosition(avt.getPosition());
this.infoLayer.addChild(bgInfor);this.bgInfor=bgInfor;this.userLabel=userLabel;this.goldLabel=goldLabel;this.inviteBt=inviteBt;this.avt=avt;var thiz=this;inviteBt.addClickEventListener(function(){thiz.onInviteBtClick()});var infoBt=new ccui.Widget;infoBt.setContentSize(avt.getContentSize());infoBt.setPosition(avt.getPosition());this.infoLayer.addChild(infoBt);infoBt.setTouchEnabled(true);infoBt.addClickEventListener(function(){thiz.showInfoDialog()});this.setEnable(true)},setPositionInfo:function(postion){switch(postion){case PK_POSITION_LEFT:this.bgInfor.setPosition(this.avt.getPositionX()-
140,this.avt.getPositionY());this.userLabel.setAnchorPoint(1,.5);this.goldLabel.setAnchorPoint(1,.5);this.userLabel.setPosition(this.bgInfor.getPositionX()+80,this.bgInfor.getPositionY()+10);this.goldLabel.setPosition(this.bgInfor.getPositionX()+80,this.bgInfor.getPositionY()-10);break;case PK_POSITION_RIGHT:this.bgInfor.setPosition(this.avt.getPositionX()+140,this.avt.getPositionY());this.userLabel.setAnchorPoint(0,.5);this.goldLabel.setAnchorPoint(0,.5);this.userLabel.setPosition(this.bgInfor.getPositionX()-
80,this.bgInfor.getPositionY()+10);this.goldLabel.setPosition(this.bgInfor.getPositionX()-80,this.bgInfor.getPositionY()-10);break;case PK_POSITION_TOP:this.bgInfor.setPosition(this.avt.getPositionX(),this.avt.getPositionY()+70);this.userLabel.setAnchorPoint(.5,.5);this.goldLabel.setAnchorPoint(.5,.5);this.userLabel.setPosition(this.bgInfor.getPositionX(),this.bgInfor.getPositionY()+10);this.goldLabel.setPosition(this.bgInfor.getPositionX(),this.bgInfor.getPositionY()-10);break;case PK_POSITION_BOTTOM:this.bgInfor.setPosition(this.avt.getPositionX(),
this.avt.getPositionY()-65);this.userLabel.setAnchorPoint(.5,.5);this.goldLabel.setAnchorPoint(.5,.5);this.userLabel.setPosition(this.bgInfor.getPositionX(),this.bgInfor.getPositionY()+10);this.goldLabel.setPosition(this.bgInfor.getPositionX(),this.bgInfor.getPositionY()-10);break}},onInviteBtClick:function(){this.showInviteDialog()},showChatMessage:function(message){},setGold:function(gold){this.goldLabel.setString(cc.Global.NumberFormat1(gold));this.gold=gold},setUsername:function(name){this.username=
name;if(name.length>15)name=name.substring(0,15);if(name.length>3&&name!=PlayerMe.username)name=name.substring(0,name.length-3)+"***";this.userLabel.setString(name)},setEnable:function(enable){if(enable){this.infoLayer.visible=true;this.inviteBt.visible=false}else{this.username="";this.spectator=false;this.infoLayer.visible=false;this.inviteBt.visible=true}},setIsOwner:function(isOwner){this.isOwnerSprite.visible=isOwner},showInviteDialog:function(){var dialog=new InviteDialog;dialog.show()},showInfoDialog:function(){},
showChatEmotion:function(emotion){var emotion=new cc.Sprite("#"+emotion);emotion.setScale(1.5);emotion.setPosition(this.avt.getPosition());this.addChild(emotion,10);emotion.runAction(new cc.Sequence(new cc.DelayTime(3),new cc.CallFunc(function(){emotion.removeFromParent(true)})))},setAvatar:function(avt){this._avatarUrl=avt;if(this.avt)this.avt.setAvatar(avt)},runChangeGoldEffect:function(gold){var goldNumber=gold;if(typeof gold==="string")goldNumber=parseInt(gold);var strGold=cc.Global.NumberFormat1(Math.abs(goldNumber))+
"V";if(gold>=0)strGold="+"+strGold;else strGold="-"+strGold;var labelEffect=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_30,strGold);if(gold>=0)labelEffect.setColor(cc.color("#ffde00"));else labelEffect.setColor(cc.color("#ff0000"));labelEffect.setPosition(this.userLabel.getPosition());this.infoLayer.addChild(labelEffect,10);var effectDuration=2;var moveAction=new cc.MoveBy(effectDuration,cc.p(0,100));var finishedAction=new cc.CallFunc(function(){labelEffect.removeFromParent(true)});
labelEffect.runAction(new cc.Sequence(moveAction,finishedAction))},showTimeRemain:function(currentTime,maxTime){var startValue=100*(currentTime/maxTime);this.setProgressPercentage(startValue);var thiz=this;var action=new quyetnd.ActionTimer(currentTime,function(dt){thiz.setProgressPercentage((1-dt)*startValue)});if(this.timer){this.timer.stopAllActions();this.timer.runAction(action)}},setProgressPercentage:function(percentage){this.timer.setPercentage(100-percentage);this.timer2.setPercentage(percentage)},
stopTimeRemain:function(){if(this.timer){this.timer.stopAllActions();this.setProgressPercentage(0)}},setInfo:function(info){}});
var GamePlayerMe=GamePlayer.extend({ctor:function(){cc.Node.prototype.ctor.call(this);this.isMe=true;this.infoLayer=new cc.Node;this.addChild(this.infoLayer);this.setContentSize(cc.size(300,100));this.setAnchorPoint(cc.p(.5,.5));var avt=UserAvatar.createMe();avt.setPosition(60,50);this.infoLayer.addChild(avt);var isOwnerSprite=new cc.Sprite("#icon_owner.png");isOwnerSprite.setVisible(false);isOwnerSprite.setPosition(avt.x+38,avt.y+38);this.infoLayer.addChild(isOwnerSprite);this.isOwnerSprite=isOwnerSprite;
var chatView=new PlayerMessageView;chatView.setPosition(avt.getPosition());chatView.setAnchorPoint(cc.p(0,0));this.infoLayer.addChild(chatView,10);this.chatView=chatView;var timer=new cc.ProgressTimer(new cc.Sprite("#player-progress-2.png"));timer.setType(cc.ProgressTimer.TYPE_RADIAL);timer.setPosition(avt.getPosition());timer.setReverseDirection(true);timer.setPercentage(100);this.infoLayer.addChild(timer);this.timer=timer;var timer2=new cc.ProgressTimer(new cc.Sprite("#player-progress-1.png"));
timer2.setType(cc.ProgressTimer.TYPE_RADIAL);timer2.setPosition(avt.getPosition());timer2.setPercentage(0);this.infoLayer.addChild(timer2);this.timer2=timer2;var userLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_18,PlayerMe.username,cc.TEXT_ALIGNMENT_LEFT);userLabel.setColor(cc.color("#63b0f1"));userLabel.setAnchorPoint(cc.p(0,.5));userLabel.setLineBreakWithoutSpace(true);userLabel.setDimensions(194,userLabel.getLineHeight());userLabel.setPosition(107,60);this.infoLayer.addChild(userLabel);
var goldLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,"99.999.999V",cc.TEXT_ALIGNMENT_CENTER);goldLabel.setAnchorPoint(cc.p(0,.5));goldLabel.setColor(cc.color("#ffde00"));goldLabel.setPosition(107,40);this.infoLayer.addChild(goldLabel);this.userLabel=userLabel;this.goldLabel=goldLabel;this.avt=avt},onEnter:function(){this._super();this.setGold(PlayerMe.gold)},setEnable:function(enable){}});
var PlayerMessageView=cc.Node.extend({ctor:function(){this._super();this.setAnchorPoint(cc.p(.5,.5));var bg=new ccui.Scale9Sprite("ingame-chat-bg.png",cc.rect(20,20,4,4));bg.setPreferredSize(cc.size(100,100));this.setContentSize(bg.getContentSize());this.addChild(bg);bg.setPosition(this.getContentSize().width/2,this.getContentSize().height/2);this.bg=bg;var label=new cc.LabelBMFont("Message",cc.res.font.Roboto_Condensed_25,300,cc.TEXT_ALIGNMENT_CENTER);label.setPosition(bg.getPosition());this.addChild(label);
this.label=label;this.setVisible(false)},show:function(message){this.setVisible(true);this.stopAllActions();var thiz=this;this.runAction(new cc.Sequence(new cc.DelayTime(5),new cc.CallFunc(function(){thiz.setVisible(false)})));this.label.setString(message);this.bg.setPreferredSize(cc.size(this.label.getContentSize().width+40,this.label.getContentSize().height+20));this.setContentSize(this.bg.getContentSize());this.bg.setPosition(this.getContentSize().width/2,this.getContentSize().height/2);this.label.setPosition(this.bg.getPosition())}});var GameTopBar=cc.Node.extend({ctor:function(){this._super();SmartfoxClient.getInstance().addListener(socket.SmartfoxClient.CallExtension,this.onExtensionCommand,this);var backBt=new ccui.Button("ingame-backBt.png","","",ccui.Widget.PLIST_TEXTURE);backBt.setPosition(54,666);this.addChild(backBt);var settingBt=new ccui.Button("ingame-settingBt.png","","",ccui.Widget.PLIST_TEXTURE);settingBt.setPosition(1220,backBt.y);this.addChild(settingBt);this.setAnchorPoint(0,1);this.setContentSize(1280,720);this.setPosition(0,
720);this.setScale(cc.winSize.screenScale);this.backBt=backBt;this.settingBt=settingBt},onExit:function(){this._super();SmartfoxClient.getInstance().removeListener(this)},onExtensionCommand:function(messageType,contents){}});
var IGameScene=IScene.extend({ctor:function(){this._super();this.miniGameLayer=new cc.Node;this.addChild(this.miniGameLayer,1);this.initController();this.type="GameScene";this.isOwnerMe=false;var bg=new cc.Sprite("res/game-bg.jpg");bg.x=cc.winSize.width/2;bg.y=cc.winSize.height/2;this.sceneLayer.addChild(bg);this.bg=bg;var gameTopBar=new GameTopBar;this.gameTopBar=gameTopBar;this.sceneLayer.addChild(gameTopBar);var thiz=this;gameTopBar.backBt.addClickEventListener(function(){thiz.backButtonClickHandler()});
gameTopBar.settingBt.addClickEventListener(function(){thiz.onSettingButtonHandler()})},initController:function(){},setOwner:function(username){for(var i=0;i<this.allSlot.length;i++)if(this.allSlot[i].username==username)this.allSlot[i].setIsOwner(true);else this.allSlot[i].setIsOwner(false)},showGameInfo:function(gameName,betAmount){var nameTitle=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_25,gameName);nameTitle.setAnchorPoint(cc.p(0,.5));nameTitle.setPosition(96,684);this.gameTopBar.addChild(nameTitle);
var goldIcon=new cc.Sprite("#ingame-goldIcon.png");goldIcon.setPosition(109,656);this.gameTopBar.addChild(goldIcon);var betTitle=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_18,cc.Global.NumberFormat1(betAmount));betTitle.setAnchorPoint(cc.p(0,.5));betTitle.setColor(cc.color("#ffde00"));betTitle.setPosition(126,656);this.gameTopBar.addChild(betTitle)},getMaxSlot:function(){if(this.playerView)return this.playerView.length;return 0},backButtonClickHandler:function(){if(LoadingDialog.getInstance().isShow())return;
if(this.popupLayer.getChildren().length>0){this.popupLayer.removeAllChildren();return}if(this._controller)this._controller.requestQuitRoom()},exitToLobby:function(message){var homeScene=new HomeScene;var gameId=s_games_chanel_id[PlayerMe.gameType];homeScene.startLobby(gameId);cc.director.replaceScene(homeScene);if(message)MessageNode.getInstance().show(message,null,homeScene)},exitToGame:function(message){var homeScene=new HomeScene;homeScene.startGame();cc.director.replaceScene(homeScene);if(message)MessageNode.getInstance().show(message,
null,homeScene)},onExit:function(){this._super();SoundPlayer.stopAllSound();if(this._controller){this._controller.releaseController();this._controller=null}},onEnter:function(){this._super();var thiz=this;cc.eventManager.addListener({event:cc.EventListener.KEYBOARD,onKeyReleased:function(keyCode,event){if(cc.sys.isNative){if(parseKeyCode(keyCode)===cc.KEY.back)thiz.backButtonClickHandler()}else if(keyCode===cc.KEY.escape)thiz.backButtonClickHandler()}},this)},showErrorMessage:function(message,scene){MessageNode.getInstance().show(message,
null,this.messageLayer)},onSettingButtonHandler:function(){var dialog=new SettingDialog;dialog.showWithAnimationMove()},sendChatMessage:function(message){if(this._controller)this._controller.sendChat(message)},sendEmotion:function(icon){if(this._controller)this._controller.sendChatEmotion(icon)},showLoading:function(message){},updateGold:function(username,gold){var goldNumber=gold;if(typeof gold==="string")goldNumber=parseInt(gold);for(var i=0;i<this.allSlot.length;i++)if(this.allSlot[i].username==
username){this.allSlot[i].setGold(goldNumber);return}},getSlotByUsername:function(username){for(var i=0;i<this.allSlot.length;i++)if(this.allSlot[i].username==username)return this.allSlot[i];return null},fillPlayerToSlot:function(playerList){this.allSlot=this.playerView;for(var i=0;i<this.allSlot.length;i++){this.allSlot[i]=this.playerView[i];var data=playerList[i];this.allSlot[i].stopTimeRemain();this.allSlot[i].userIndex=data.userIndex;if(data.username=="")this.allSlot[i].setEnable(false);else{this.allSlot[i].setEnable(true);
this.allSlot[i].setUsername(data.username);this.allSlot[i].setGold(data.gold);this.allSlot[i].setAvatar(data.avt);this.allSlot[i].spectator=data.spectator;this.allSlot[i].setInfo(data["info"])}}},userJoinRoom:function(info){SoundPlayer.playSound("join_room");for(var i=0;i<this.allSlot.length;i++)if(info.index==this.allSlot[i].userIndex){this.allSlot[i].setEnable(true);this.allSlot[i].userIndex=info.index;this.allSlot[i].stopTimeRemain();this.allSlot[i].setUsername(info.username);this.allSlot[i].setGold(info.gold);
this.allSlot[i].setAvatar(info.avt);this.allSlot[i].setInfo(info["info"]);return}},userExitRoom:function(username){for(var i=0;i<this.allSlot.length;i++)if(this.allSlot[i].username==username){this.allSlot[i].setEnable(false);this.allSlot[i].stopTimeRemain();break}},updateRegExitRoom:function(exit){if(exit)this.gameTopBar.backBt.loadTextureNormal("ingame-backBt-active.png",ccui.Widget.PLIST_TEXTURE);else this.gameTopBar.backBt.loadTextureNormal("ingame-backBt.png",ccui.Widget.PLIST_TEXTURE)},onChatMessage:function(username,
message){for(var i=0;i<this.allSlot.length;i++)if(this.allSlot[i].username===username){this.allSlot[i].chatView.show(message);break}},onChatEmotion:function(username,message){for(var i=0;i<this.allSlot.length;i++)if(this.allSlot[i].username===username){this.allSlot[i].showChatEmotion(message);break}},onSFSExtension:function(){},performChangeRewardFund:function(value){if(this.huThuongValueLabel)this.huThuongValueLabel.setString(cc.Global.NumberFormat1(value))},performAssetChange:function(amount,goldAfter,
username){var slot=this.getSlotByUsername(username);var changeLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_25,"");changeLabel.setString(amount>0?"+"+amount:amount);changeLabel.setColor(cc.color(amount>0?"#ffde00":"#c52829"));changeLabel.setPosition(slot.avt.getPosition());if(username==PlayerMe.username)this.sceneLayer.addChild(changeLabel);else slot.addChild(changeLabel);if(goldAfter)slot.setGold(goldAfter);var moveAction=new cc.MoveTo(1,slot.avt.x,slot.avt.y+50);var removeAction=
new cc.CallFunc(function(){changeLabel.removeFromParent(true)});changeLabel.runAction(new cc.Sequence(moveAction,removeAction))}});var TLMNUtility={HAI:0,DOI:1,BA:2,TUQUY:3,BADOITHONG:4,BONDOITHONG:5,DAY:6,preventable:[[3,4,5],[1],[2],[3,5],[4,5],[5],[6]],getGroupType:function(cards){if(!cards)return-1;if(cards.length<=0)return-1;if(cards.length==1&&cards[0].rank!=2)return-1;if(cards.length==1&&cards[0].rank==2)return TLMNUtility.HAI;if(cards.length==2&&cards[0].rank==2&&cards[1].rank==2)return TLMNUtility.HAI;var rankFreq=[0,0,0,0,0,0,0,0,0,0,0,0,0,0];var suitFreq=[0,0,0,0];for(var i=0;i<cards.length;i++){rankFreq[cards[i].rank]++;
suitFreq[cards[i].suit]++}for(var i=0;i<rankFreq.length;i++)if(rankFreq[i]==cards.length)switch(cards.length){case 2:return TLMNUtility.DOI;case 3:return TLMNUtility.BA;case 4:return TLMNUtility.TUQUY}if(cards.length==6)for(var i=0;i<rankFreq.length-2;i++)if(rankFreq[i]==2&&rankFreq[i+1]==2&&rankFreq[i+2]==2)return TLMNUtility.BADOITHONG;if(cards.length==8)for(var i=0;i<rankFreq.length-3;i++)if(rankFreq[i]==2&&rankFreq[i+1]==2&&rankFreq[i+2]==3&&rankFreq[i+3]==2)return TLMNUtility.BONDOITHONG;var longestStreak=
0;var currentStreak=0;for(var i=0;i<rankFreq.length;i++)if(rankFreq[i]==1){currentStreak++;longestStreak=longestStreak>currentStreak?longestStreak:currentStreak}else currentStreak=0;if(longestStreak==cards.length&&longestStreak>=3)return TLMNUtility.DAY;return-1},getSuggestedCards:function(cards,handCards){var suggestGroups=[];if(!cards){for(var i=3;i<13;i++)suggestGroups=suggestGroups.concat(this.findDay(handCards,null,null,i));suggestGroups=suggestGroups.concat(this.findSameCards(handCards,null,
null,2));suggestGroups=suggestGroups.concat(this.findSameCards(handCards,null,null,3));suggestGroups=suggestGroups.concat(this.findSameCards(handCards,null,null,4));suggestGroups=suggestGroups.concat(this.findDoiThong(handCards,null,null,3));suggestGroups=suggestGroups.concat(this.findDoiThong(handCards,null,null,4));return suggestGroups}var groupType=this.getGroupType(cards);if(groupType==-1)return[];var rankFreq=[0,0,0,0,0,0,0,0,0,0,0,0,0,0];var suitFreq=[0,0,0,0];for(var i=0;i<handCards.length;i++){rankFreq[handCards[i].rank]++;
suitFreq[handCards[i].suit]++}var preventableGroupType=this.preventable[groupType];var minRank=cards[0].rank;for(var i=1;i<cards.length;i++)minRank=cards[i].rank<minRank?cards[i].rank:minRank;for(var i=0;i<preventableGroupType.length;i++)switch(preventableGroupType[i]){case TLMNUtility.DOI:suggestGroups=suggestGroups.concat(this.findSameCards(handCards,rankFreq,suitFreq,2,minRank));break;case TLMNUtility.BA:suggestGroups=suggestGroups.concat(this.findSameCards(handCards,rankFreq,suitFreq,3,minRank));
break;case TLMNUtility.TUQUY:suggestGroups=suggestGroups.concat(this.findSameCards(handCards,rankFreq,suitFreq,4,groupType==TLMNUtility.TUQUY?minRank:0));break;case TLMNUtility.BADOITHONG:suggestGroups=suggestGroups.concat(this.findDoiThong(handCards,rankFreq,suitFreq,3,groupType==TLMNUtility.BADOITHONG?minRank:0));break;case TLMNUtility.BONDOITHONG:suggestGroups=suggestGroups.concat(this.findDoiThong(handCards,rankFreq,suitFreq,4,groupType==TLMNUtility.BONDOITHONG?minRank:0));break;case TLMNUtility.DAY:suggestGroups=
suggestGroups.concat(this.findDay(handCards,rankFreq,suitFreq,cards.length,minRank,cards));break}return suggestGroups},findDay:function(handCards,rankFreq,suitFreq,length,minRank,source){if(length>handCards.length)return[];if(length<3)return[];if(!rankFreq||!suitFreq){rankFreq=[0,0,0,0,0,0,0,0,0,0,0,0,0,0];suitFreq=[0,0,0,0];for(var i=0;i<handCards.length;i++){rankFreq[handCards[i].rank]++;suitFreq[handCards[i].suit]++}}var sameCards=[];var result=[];for(var i=0;i<handCards.length;i++){if(!sameCards[handCards[i].rank])sameCards[handCards[i].rank]=
[];sameCards[handCards[i].rank].push(handCards[i])}rankFreq[14]=rankFreq[1];sameCards[14]=sameCards[1];for(var i=3;i<=15-length;i++){var isLegal=true;for(var j=0;j<length;j++)if(!rankFreq[i+j]){isLegal=false;break}if(!isLegal)continue;if(i<minRank)continue;var fcallStr="this.getCombination(";for(var j=0;j<length;j++)fcallStr+="sameCards["+(i+j)+"],";fcallStr+=");";fcallStr=fcallStr.replace(",)",")");var groups=eval(fcallStr);if(!source)result=result.concat(groups);else for(var j=0;j<groups.length;j++)if(this.isGreaterDay(source,
groups[j]))result.push(groups[j])}return result},isGreaterDay:function(source,dest){if(source.length!=dest.length)return false;var comparefn=function(a,b){var cmpRankA=a.rank<3?a.rank+13:a.rank;var cmpRankB=b.rank<3?b.rank+13:b.rank;return cmpRankA-cmpRankB};source.sort(comparefn);dest.sort(comparefn);if(dest[0].rank>source[0].rank)return true;if(dest[0].rank<source[0].rank)return false;return source[source.length-1].suit<dest[source.length-1].suit},findSameCards:function(handCards,rankFreq,suitFreq,
length,minRank){if(!rankFreq||!suitFreq){rankFreq=[0,0,0,0,0,0,0,0,0,0,0,0,0,0];suitFreq=[0,0,0,0];for(var i=0;i<handCards.length;i++){rankFreq[handCards[i].rank]++;suitFreq[handCards[i].suit]++}}var sameCards=[];var result=[];for(var i=0;i<handCards.length;i++)if(rankFreq[handCards[i].rank]>=length){if(handCards[i].rank>2&&handCards[i].rank<minRank)continue;if(!sameCards[handCards[i].rank])sameCards[handCards[i].rank]=[];sameCards[handCards[i].rank].push(handCards[i])}for(var i=0;i<sameCards.length;i++){if(!sameCards[i])continue;
if(length==2&&sameCards[i][0].suit!=3&&sameCards[i][1].suit!=3&&i==minRank)continue;if(minRank<=2&&i>=3&&minRank!=0)continue;for(var j=0;j<=sameCards[i].length-length;j++)result.push(sameCards[i].slice(j,length+j))}return result},findDoiThong:function(handCards,rankFreq,suitFreq,length,minRank){if(length!=3&&length!=4)return[];if(!rankFreq||!suitFreq){rankFreq=[0,0,0,0,0,0,0,0,0,0,0,0,0,0];suitFreq=[0,0,0,0];for(var i=0;i<handCards.length;i++){rankFreq[handCards[i].rank]++;suitFreq[handCards[i].suit]++}}var sameCards=
[];var result=[];for(var i=0;i<handCards.length;i++)if(rankFreq[handCards[i].rank]>=2){if(!sameCards[handCards[i].rank])sameCards[handCards[i].rank]=[];sameCards[handCards[i].rank].push(handCards[i])}rankFreq[14]=rankFreq[1];sameCards[14]=sameCards[1];if(length==3)for(var i=3;i<13;i++){if(i<minRank)continue;if(rankFreq[i]>=2&&rankFreq[i+1]>=2&&rankFreq[i+2]>=2){var isLegal=i>minRank;for(var j=0;j<sameCards[i+2].length;j++)isLegal=isLegal||sameCards[i+2][j].suit==3;if(!isLegal)continue;result=result.concat(this.getCombination(this.getSubGroup(sameCards[i],
2),this.getSubGroup(sameCards[i+1],2),this.getSubGroup(sameCards[i+2],2)))}}if(length==4)for(var i=3;i<12;i++){if(i<minRank)continue;if(rankFreq[i]>=2&&rankFreq[i+1]>=2&&rankFreq[i+2]>=2&&rankFreq[i+3]>=2){var isLegal=i>minRank;for(var j=0;j<sameCards[i+3].length;j++)isLegal=isLegal||sameCards[i+3][j].suit==3;if(!isLegal)continue;result=result.concat(this.getCombination(this.getSubGroup(sameCards[i],2),this.getSubGroup(sameCards[i+1],2),this.getSubGroup(sameCards[i+2],2),this.getSubGroup(sameCards[i+
3],2)))}}return result},getCombination:function(){var result=[];var pre=arguments[0];if(arguments.length==2){var post=arguments[1].length?arguments[1]:[arguments[1]];for(var i=0;i<pre.length;i++)for(var j=0;j<post.length;j++)if(pre[i].length)result.push(pre[i].concat(post[j]));else result.push([pre[i]].concat(post[j]));return result}var fcallStr="this.getCombination(";for(var i=1;i<arguments.length;i++)fcallStr+="arguments["+i+"],";fcallStr+=");";fcallStr=fcallStr.replace(",)",")");var recursionResult=
eval(fcallStr);for(var i=0;i<pre.length;i++)for(var j=0;j<recursionResult.length;j++)if(pre[i].length)result.push(pre[i].concat(recursionResult[j]));else result.push([pre[i]].concat(recursionResult[j]));return result},getSubGroup:function(group,length){var result=[];for(var i=0;i<=group.length-length;i++)result.push(group.slice(i,i+length));return result}};var CardRemaining=cc.Node.extend({ctor:function(){this._super();this.setAnchorPoint(cc.p(.5,.5));var bg=new cc.Sprite("#card_remain_bg_1.png");this.setContentSize(bg.getContentSize());bg.setPosition(this.getContentSize().width/2,this.getContentSize().height/2);this.addChild(bg);this.bg=bg;var label=new cc.LabelBMFont("99",cc.res.font.Roboto_Condensed_25);label.setPosition(bg.x,bg.y);this.addChild(label);this.label=label},setCardRemain:function(card){if(card<=0)this.setVisible(false);else{this.setVisible(true);
this.label.setString(card);if(card>1)this.bg.setSpriteFrame("card_remain_bg_2.png");else this.bg.setSpriteFrame("card_remain_bg_1.png")}}});
var TienLen=IGameScene.extend({ctor:function(){this._super();var thiz=this;var table_bg=new cc.Sprite("res/gp_table.png");table_bg.setPosition(cc.winSize.width/2,320);table_bg.setScale(cc.winSize.screenScale);this.sceneLayer.addChild(table_bg);this.initPlayer();this.initButton();var cardList=new CardList(cc.size(cc.winSize.width-10,100));cardList.setAnchorPoint(cc.p(.5,0));cardList.setPosition(cc.winSize.width/2,100);this.sceneLayer.addChild(cardList);this.cardList=cardList;cardList.onSelected=function(card,
isSelected){if(!isSelected)return;if(cardList.getCardSelected().length>2)return;thiz.handleSelectSuggest(card)};var cardOnTable=new CardOnTable;cardOnTable.setPosition(cc.p(0,0));this.sceneLayer.addChild(cardOnTable,2);this.cardOnTable=cardOnTable},handleSelectSuggest:function(card){},initController:function(){this._controller=new TLMNGameController(this)},initButton:function(){var danhbaiBt=new ccui.Button("game-danhbaiBt.png","","",ccui.Widget.PLIST_TEXTURE);danhbaiBt.setPosition(cc.winSize.width-
110,46);this.sceneLayer.addChild(danhbaiBt);var xepBaiBt=new ccui.Button("game-xepbaiBt.png","","",ccui.Widget.PLIST_TEXTURE);xepBaiBt.setPosition(cc.winSize.width-510,danhbaiBt.y);this.sceneLayer.addChild(xepBaiBt);var boluotBt=new ccui.Button("game-boluotBt.png","","",ccui.Widget.PLIST_TEXTURE);boluotBt.setPosition(cc.winSize.width-310,danhbaiBt.y);this.sceneLayer.addChild(boluotBt);var startBt=new ccui.Button("game-startBt.png","","",ccui.Widget.PLIST_TEXTURE);startBt.setPosition(boluotBt.getPosition());
this.sceneLayer.addChild(startBt);var thiz=this;xepBaiBt.visible=false;boluotBt.visible=false;startBt.visible=false;this.danhbaiBt=danhbaiBt;this.xepBaiBt=xepBaiBt;this.boluotBt=boluotBt;this.startBt=startBt;startBt.addClickEventListener(function(){thiz.sendStartRequest()});boluotBt.addClickEventListener(function(){if(thiz.cardList)for(var i=0;i<thiz.cardList.cardList.length;i++)thiz.cardList.cardList[i].setSelected(false);thiz.sendBoluotRequest()});danhbaiBt.addClickEventListener(function(){thiz.sendDanhBai()});
xepBaiBt.addClickEventListener(function(){thiz.onXepBaiBtClick()})},onXepBaiBtClick:function(){this.cardList.reArrangeCards(function(a,b){var operatorA=a.rank,operatorB=b.rank;if(operatorA<3)operatorA+=13;if(operatorB<3)operatorB+=13;return(operatorA-operatorB)*100+a.suit-b.suit})},initPlayer:function(){var playerMe=new GamePlayerMe;playerMe.setPosition(150,50);this.sceneLayer.addChild(playerMe,1);var player1=new GamePlayer;player1.setPosition(cc.winSize.width-144*cc.winSize.screenScale,320*cc.winSize.screenScale);
this.sceneLayer.addChild(player1,1);player1.chatView.setAnchorPoint(cc.p(1,0));player1.chatView.y+=20;var player2=new GamePlayer;player2.setPosition(cc.winSize.width/2,cc.winSize.height-140/cc.winSize.screenScale);this.sceneLayer.addChild(player2,1);player2.chatView.setAnchorPoint(cc.p(1,1));var player3=new GamePlayer;player3.setPosition(144*cc.winSize.screenScale,player1.y);this.sceneLayer.addChild(player3,1);player3.chatView.setAnchorPoint(cc.p(0,0));player3.chatView.y+=20;this.playerView=[playerMe,
player1,player2,player3];var cardRemaining1=new CardRemaining;cardRemaining1.setPosition(30,70);player1.infoLayer.addChild(cardRemaining1);player1.cardRemaining=cardRemaining1;var cardRemaining2=new CardRemaining;cardRemaining2.setPosition(130,70);player2.infoLayer.addChild(cardRemaining2);player2.cardRemaining=cardRemaining2;var cardRemaining3=new CardRemaining;cardRemaining3.setPosition(130,70);player3.infoLayer.addChild(cardRemaining3);player3.cardRemaining=cardRemaining3},onBoLuot:function(username){if(PlayerMe.username==
username)return;for(var i=0;i<this.allSlot.length;i++)if(this.allSlot[i].username==username){var slot=this.allSlot[i];var labelEffect=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_30,"B\u1ecf l\u01b0\u1ee3t");labelEffect.setColor(cc.color("#ff0000"));labelEffect.setPosition(slot.avt.getPosition());slot.addChild(labelEffect,10);labelEffect.runAction(new cc.Sequence(new cc.DelayTime(1),new cc.CallFunc(function(){labelEffect.removeFromParent(true)})));return}},showFinishedDialog:function(player){var dialog=
new ResultDialog(player.length);this.cardList.removeAll();this.setDanhBaiBtVisible(false);for(var i=0;i<player.length;i++){var username=player[i].username;this.updateCardRemaining(username,0);if(username.length>3&&username!=PlayerMe.username)username=username.substring(0,username.length-3)+"***";dialog.userLabel[i].setString(username);if(player[i].username==PlayerMe.username)SoundPlayer.playSound(player[i].isWinner?"winning":"losing");dialog.contentLabel[i].setString(player[i].title);this.setCardList(dialog.cardList[i],
player[i].cardList);dialog.cardList[i].reOrderWithoutAnimation();var gold=player[i].gold;var goldStr=cc.Global.NumberFormat1(Math.abs(gold))+" V";if(gold>=0)goldStr="+"+goldStr;else goldStr="-"+goldStr;dialog.goldLabel[i].setString(goldStr);if(gold>=0)dialog.goldLabel[i].setColor(cc.color("#ffde00"));else dialog.goldLabel[i].setColor(cc.color("#ff0000"));this.performAssetChange(gold,null,player[i].username)}dialog.show()},onChatChem:function(params){var player1=params["7"];var gold1=params["3"];var changeGold1=
params["2"];var player2=params["8"];var gold2=params["6"];var changeGold2=params["5"];for(var i=0;i<this.allSlot.length;i++){if(this.allSlot[i].username==player1)this.allSlot[i].runChangeGoldEffect(changeGold1);if(this.allSlot[i].username==player2)this.allSlot[i].runChangeGoldEffect("-"+changeGold2)}this.updateGold(player1,gold1);this.updateGold(player2,gold2)},setCardMe:function(cardList){this.setCardList(this.cardList,cardList)},suggestCard:function(){},suggestCardWithCards:function(cards){},setCardList:function(list,
data){list.removeAll();for(var i=0;i<data.length;i++){var cardNew=new Card(data[i].rank,data[i].suit);list.addCard(cardNew)}list.reOrderWithoutAnimation()},setCardOnTable:function(cardList){this.cardOnTable.addCardReconnect(cardList)},dealCards:function(cardList){this.cardList.dealCards(cardList,true)},removeCardList:function(){this.cardList.removeAll()},removeCardOnTable:function(){this.cardOnTable.removeAll()},setDanhBaiBtVisible:function(visible){this.danhbaiBt.setVisible(visible)},setXepBaiBtVisible:function(visible){this.xepBaiBt.setVisible(visible)},
setBoLuotBtVisible:function(visible){this.boluotBt.setVisible(visible)},setStartBtVisible:function(visible){this.startBt.setVisible(visible)},onDanhbaiMe:function(username,cards){var arr=this.cardList.removeCard(cards);this.cardOnTable.moveOldCard();this.cardOnTable.addCard(arr);this.cardList.reOrder();for(var i=0;i<arr.length;i++)arr[i].release();SoundPlayer.playSound("danh_bai");if(this.cardList.cardList.length===0){this.setDanhBaiBtVisible(false);this.setBoLuotBtVisible(false);this.setXepBaiBtVisible(false)}},
onDanhbaiOther:function(username,cards){var slot=this.getSlotByUsername(username);this.cardOnTable.moveOldCard();this.cardOnTable.addNewCardList(cards,slot.getPosition());this.isNewTurn=false;SoundPlayer.playSound("danh_bai")},onUpdateTurn:function(username,currentTime,maxTime){cc.log("updateTurn: "+currentTime+":"+maxTime+" - "+Date.now());for(var i=0;i<this.allSlot.length;i++)if(this.allSlot[i].username==username)this.allSlot[i].showTimeRemain(currentTime,maxTime);else this.allSlot[i].stopTimeRemain()},
updateCardRemaining:function(username,card){cc.log("updateCardRemaining: "+username);for(var i=0;i<this.allSlot.length;i++){if(this.allSlot[i].username=="")continue;if(this.allSlot[i].username==username){if(this.allSlot[i].cardRemaining)this.allSlot[i].cardRemaining.setCardRemain(card);break}}},sendStartRequest:function(){this._controller.sendStartRequest()},sendBoluotRequest:function(){this._controller.sendBoluotRequest()},sendDanhBai:function(){var cards=this.cardList.getCardSelected();this._controller.sendDanhBai(cards)}});PK_POSITION_TOP=0;PK_POSITION_LEFT=1;PK_POSITION_BOTTOM=2;PK_POSITION_RIGHT=3;PK_TYPE_PLAYER_NOMARL=0;PK_TYPE_PLAYER_DEALER=1;PK_TYPE_PLAYER_SMALLBLIND=2;PK_TYPE_PLAYER_BIGBLIND=3;PK_STATUSME_STANDUP=0;PK_STATUSME_SITDOWN=1;
var PokerGamePlayer=GamePlayer.extend({ctor:function(playerIndex,handler){this._super();this.playerIndex=playerIndex;this._handler=handler;var btnSitDown=new ccui.Button("pk_btn_sitdown.png","","",ccui.Widget.PLIST_TEXTURE);var thiz=this;btnSitDown.setPosition(thiz.avt.getPosition());btnSitDown.visible=false;thiz.addChild(btnSitDown);this.btnSitDown=btnSitDown;var txtBetBg=new ccui.Scale9Sprite("pk_bg_txtbet.png",cc.rect(17,17,2,2));txtBetBg.setPosition(0,0);txtBetBg.setPreferredSize(cc.size(120,
34));this.addChild(txtBetBg);this.txtBetBg=txtBetBg;var lblBet=new cc.LabelTTF("222222",cc.res.font.Roboto_Condensed,24);lblBet.setPosition(thiz.avt.getPositionX(),thiz.avt.getPositionY()+100);lblBet.setColor(cc.color(255,222,0,255));lblBet.visible=true;txtBetBg.addChild(lblBet);this.lblBet=lblBet;var iconBet=new cc.Sprite("#pk_xeng.png");iconBet.setPosition(19,17);this.iconBet=iconBet;txtBetBg.addChild(iconBet);var imgDeal=new cc.Sprite("#pk_icon_dealer.png");imgDeal.setPosition(thiz.avt.getPositionX(),
thiz.avt.getPositionY()+42);imgDeal.visible=true;thiz.addChild(imgDeal);this.imgDeal=imgDeal;this.setVisbleSitDown(true);var cardList=new CardPoker(cc.size(130,86));cardList.setPosition(thiz.avt.getPosition());this.addChild(cardList);cardList.setTouchEnable(false);this.cardList=cardList;var phomVituarl=new cc.Sprite("#pk_cardMask.png");phomVituarl.setVisible(false);phomVituarl.setPosition(thiz.avt.getPositionX()-20,thiz.avt.getPositionY()-30);thiz.addChild(phomVituarl);this.phomVituarl=phomVituarl;
var imgWin=new cc.Sprite("#pk_bg_win.png");imgWin.setPosition(thiz.avt.getPosition());imgWin.visible=false;thiz.addChild(imgWin,-1);this.imgWin=imgWin;imgWin.runAction(new cc.RepeatForever(new cc.RotateBy(.5,360)));var bg_nameHand=new ccui.Scale9Sprite("pk_bg_nameHand.png",cc.rect(16,16,2,2));bg_nameHand.setContentSize(160,34);bg_nameHand.setVisible(false);bg_nameHand.setPosition(thiz.avt.getPositionX(),thiz.avt.getPositionY()-55);this.addChild(bg_nameHand,2);this.bg_nameHand=bg_nameHand;var lblHandNomarl=
new cc.LabelTTF("",cc.res.font.Roboto_Condensed,23);lblHandNomarl.setPosition(bg_nameHand.getContentSize().width/2,bg_nameHand.getContentSize().height/2);lblHandNomarl.setColor(cc.color(201,214,237,255));bg_nameHand.addChild(lblHandNomarl);this.lblHandNomarl=lblHandNomarl;var lblHandWin=new cc.LabelTTF("",cc.res.font.Roboto_CondensedBold,30);lblHandWin.setPosition(thiz.avt.getPositionX(),thiz.avt.getPositionY()+55);lblHandWin.setColor(cc.color(255,228,0,255));this.addChild(lblHandWin,2);this.lblHandWin=
lblHandWin;var bgText=new ccui.Scale9Sprite("dialog-textinput-bg.png",cc.rect(10,10,4,4));bgText.setPreferredSize(cc.size(180,60));bgText.setVisible(false);bgText.setPosition(thiz.avt.getPosition());this.addChild(bgText);this.bgText=bgText;this.userLabel.removeFromParent();var userLabel=new cc.LabelTTF("",cc.res.font.Roboto_CondensedBold,20);this.infoLayer.addChild(userLabel);userLabel.setColor(cc.color(191,242,255,255));this.goldLabel.removeFromParent();var goldLabel=new cc.LabelTTF("",cc.res.font.Roboto_CondensedBold,
20);this.infoLayer.addChild(goldLabel);goldLabel.setColor(cc.color("#ffde00"));this.userLabel=userLabel;this.goldLabel=goldLabel;this.isOwnerSprite.setVisible(false)},setIsOwner:function(isOwner){this.isOwnerSprite.visible=false},getTimeCurrent:function(timeMax){return this.timer2.getPercentage()*timeMax/100},setNameHand:function(nameHand,isWin){if(isWin){this.lblHandWin.setString(nameHand);this.bg_nameHand.setVisible(false);this.lblHandNomarl.setString("")}else{this.lblHandWin.setString("");this.bg_nameHand.setVisible(true);
this.lblHandNomarl.setString(nameHand)}},setIsMe:function(isMe){if(isMe){this.cardList.setPosition(this.avt.getPositionX(),this.avt.getPositionY()+100);this.txtBetBg.setPosition(this.avt.getPositionX(),this.avt.getPositionY()+90+75);this.bg_nameHand.setPosition(this.avt.getPositionX(),this.avt.getPositionY()+100-55);this.lblHandWin.setPosition(this.avt.getPositionX(),this.avt.getPositionY()+100+55);this.phomVituarl.setVisible(false)}else{this.cardList.setPosition(this.avt.getPosition());this.txtBetBg.setPosition(this.avt.getPositionX(),
this.avt.getPositionY()+75);this.bg_nameHand.setPosition(this.avt.getPositionX(),this.avt.getPositionY()-55);this.lblHandWin.setPosition(this.avt.getPositionX(),this.avt.getPositionY()+55)}},setPositionInfo:function(posBase,posBet,posDel){switch(posBase){case PK_POSITION_LEFT:this.bgText.setPosition(this.avt.getPositionX()-140,this.avt.getPositionY());this.userLabel.setAnchorPoint(1,.5);this.goldLabel.setAnchorPoint(1,.5);this.userLabel.setPosition(this.bgText.getPositionX()+80,this.bgText.getPositionY()+
10);this.goldLabel.setPosition(this.bgText.getPositionX()+80,this.bgText.getPositionY()-10);break;case PK_POSITION_RIGHT:this.bgText.setPosition(this.avt.getPositionX()+140,this.avt.getPositionY());this.userLabel.setAnchorPoint(0,.5);this.goldLabel.setAnchorPoint(0,.5);this.userLabel.setPosition(this.bgText.getPositionX()-80,this.bgText.getPositionY()+10);this.goldLabel.setPosition(this.bgText.getPositionX()-80,this.bgText.getPositionY()-10);break;case PK_POSITION_TOP:this.bgText.setPosition(this.avt.getPositionX(),
this.avt.getPositionY()+70);this.userLabel.setAnchorPoint(.5,.5);this.goldLabel.setAnchorPoint(.5,.5);this.userLabel.setPosition(this.bgText.getPositionX(),this.bgText.getPositionY()+10);this.goldLabel.setPosition(this.bgText.getPositionX(),this.bgText.getPositionY()-10);break;case PK_POSITION_BOTTOM:this.bgText.setPosition(this.avt.getPositionX(),this.avt.getPositionY()-65);this.userLabel.setAnchorPoint(.5,.5);this.goldLabel.setAnchorPoint(.5,.5);this.userLabel.setPosition(this.bgText.getPositionX(),
this.bgText.getPositionY()+10);this.goldLabel.setPosition(this.bgText.getPositionX(),this.bgText.getPositionY()-10);break}switch(posBet){case PK_POSITION_LEFT:this.txtBetBg.setPosition(this.avt.getPositionX()-120,this.avt.getPositionY());break;case PK_POSITION_RIGHT:this.txtBetBg.setPosition(this.avt.getPositionX()+120,this.avt.getPositionY());break;case PK_POSITION_TOP:this.txtBetBg.setPosition(this.avt.getPositionX(),this.avt.getPositionY()+75);break;case PK_POSITION_BOTTOM:this.txtBetBg.setPosition(this.avt.getPositionX(),
this.avt.getPositionY()-75);break}switch(posDel){case PK_POSITION_LEFT:this.imgDeal.setPosition(this.avt.getPositionX()-50,this.avt.getPositionY()+20);break;case PK_POSITION_RIGHT:this.imgDeal.setPosition(this.avt.getPositionX()+50,this.avt.getPositionY()+20);break;case PK_POSITION_TOP:this.imgDeal.setPosition(this.avt.getPositionX()+50,this.avt.getPositionY()+50);break;case PK_POSITION_BOTTOM:this.imgDeal.setPosition(this.avt.getPositionX()+50,this.avt.getPositionY()-50);break}},fillInforAgain:function(infor){if(infor.isPlaying){if(infor.moneyBet>
0)this.setMoneyBet(infor.moneyBet);this.phomVituarl.visible=true;this.updateAction(infor.idAction)}},setEnable:function(enable){this._super(enable);this.isOwnerSprite.setVisible(false);if(enable)if(this.btnSitDown)this.btnSitDown.setVisible(false);if(!enable){if(this.phomVituarl)this.phomVituarl.setVisible(false);this.lblBet.setString("");this.imgDeal.setVisible(false);this.bg_nameHand.setVisible(false);this.lblHandNomarl.setString("");this.lblHandWin.setString("");this.lblBet.setString("");this.txtBetBg.setVisible(false);
this.cardList.removeAll();this.imgWin.setVisible(false)}},setUserNamePoker:function(){this.setUsername(this.username);this.userLabel.setColor(cc.color(191,242,255,255))},setType:function(type){this.imgDeal.setVisible(true);if(type==PK_TYPE_PLAYER_DEALER)this.imgDeal.setSpriteFrame("pk_icon_dealer.png");else if(type==PK_TYPE_PLAYER_SMALLBLIND)this.imgDeal.setSpriteFrame("pk_icon_smallBlind.png");else if(type==PK_TYPE_PLAYER_BIGBLIND)this.imgDeal.setSpriteFrame("pk_icon_bigBlind.png");else this.imgDeal.setVisible(false)},
setCardVituarlVisible:function(isVisible){this.phomVituarl.visible=isVisible},setMoneyBet:function(moneyBet){var withText=this.lblBet.getContentSize().width+40;if(withText<120)withText=120;this.txtBetBg.setPreferredSize(cc.size(withText,34));this.lblBet.setPosition(withText/2+11,17);this.txtBetBg.setVisible(moneyBet>0?true:false);this.lblBet.setString(cc.Global.NumberFormat1(moneyBet))},setInfo:function(info){if(info){this.setGold(info.money);this.setMoneyBet(info.moneyBet);this.setType(info.typePlayer);
if(info.idAction!=PK_ACTION_PLAYER_FOLD&&info.isPlaying&&PlayerMe.username!=this.username)this.phomVituarl.setVisible(true);this.updateAction(info.idAction);this.setMoneyBet(info.moneyBet)}},updateAction:function(idAction){if(idAction==PK_ACTION_PLAYER_CHECK){this.userLabel.setString("CHECK");this.userLabel.setColor(cc.color(185,230,78,255))}else if(idAction==PK_ACTION_PLAYER_CALL){this.userLabel.setString("CALL");this.userLabel.setColor(cc.color(255,174,70,255))}else if(idAction==PK_ACTION_PLAYER_FOLD){this.userLabel.setString("FOLD");
this.userLabel.setColor(cc.color(255,147,147,255))}else if(idAction==PK_ACTION_PLAYER_RAISE){this.userLabel.setString("RAISE");this.userLabel.setColor(cc.color(255,174,70,255))}else if(idAction==PK_ACTION_PLAYER_BET){this.userLabel.setString("BET");this.userLabel.setColor(cc.color(255,174,70,255))}else if(idAction==PK_ACTION_PLAYER_ALL_IN){this.userLabel.setColor(cc.color(255,222,0,255));this.userLabel.setString("ALL_IN")}else this.userLabel.setColor(cc.color(191,242,255,255))},resetEndGame:function(){cc.log("resetEndGame 2");
this.cardList.removeAll();this.lblBet.setString("");this.phomVituarl.setVisible(false);this.imgWin.setVisible(false);this.imgDeal.setVisible(false);this.stopTimeRemain();this.lblHandNomarl.setString("");this.lblHandWin.setString("");this.bg_nameHand.setVisible(false);this.txtBetBg.setVisible(false)},setVisbleSitDown:function(isVisible){this.btnSitDown.visible=isVisible;this.inviteBt.visible=!isVisible},setEffectWin:function(isWin){this.imgWin.setVisible(isWin)}});
var Poker=IGameScene.extend({timeMaxTurn:20,minBuy:0,maxBuy:0,ctor:function(){this._super();this.timeMaxTurn=20;this.minBuy=0;this.maxBuy=0;this.stateMe=PK_STATUSME_STANDUP;var bgPoker=new cc.Sprite("res/gp_table.png");bgPoker.x=cc.winSize.width/2;bgPoker.y=cc.winSize.height/2;bgPoker.setScale(cc.winSize.screenScale);this.sceneLayer.addChild(bgPoker);this.bgPoker=bgPoker;this.initButton();this.minBetting=0;var pad=-150;var cardMix=new CardPoker(cc.size(600,100));cardMix.setPosition(this.bgPoker.getContentSize().width/
2,this.bgPoker.getContentSize().height/2-20);cardMix.visible=true;this.bgPoker.addChild(cardMix);this.cardMix=cardMix;var bg_pot=new cc.Sprite("#pk_bg_totalBet.png");bg_pot.setPosition(bgPoker.getContentSize().width/2,420+pad);bgPoker.addChild(bg_pot,1);this.bg_pot=bg_pot;var lblPot=new cc.LabelTTF("",cc.res.font.Roboto_CondensedBold,25);lblPot.setColor(cc.color(255,222,0,255));lblPot.setPosition(bg_pot.getContentSize().width/2+15,bg_pot.getContentSize().height/2);bg_pot.addChild(lblPot);this.lblPot=
lblPot;var thiz=this;var imgCave=new cc.Sprite("#pk_cave.png");imgCave.setPosition(bgPoker.getContentSize().width/2,590+pad);bgPoker.addChild(imgCave);this.imgCave=imgCave;var caveBig=new cc.Sprite("#pk_cave_big.png");caveBig.setPosition(bgPoker.getContentSize().width/2,590+pad);caveBig.runAction(new cc.RepeatForever(new cc.Sequence(new cc.FadeTo(1,0),new cc.FadeTo(.7,255),new cc.DelayTime(.2),new cc.FadeTo(1.2,0),new cc.DelayTime(3))));bgPoker.addChild(caveBig);var caveTextBG=new cc.Sprite("#pk_bg_caveChat.png");
caveTextBG.setPosition(cc.p(imgCave.getPositionX()-130,imgCave.getPositionY()+50));bgPoker.addChild(caveTextBG,2);caveTextBG.setVisible(false);var caveText=new cc.LabelTTF("",cc.res.font.Roboto_Condensed,22);caveText.setPosition(caveTextBG.getContentSize().width/2,caveTextBG.getContentSize().height/2);caveText.setColor(cc.color(102,200,255,255));caveTextBG.addChild(caveText);this.caveText=caveText;this.caveTextBG=caveTextBG;this.createHeart();var tipBt=new ccui.Button("pk_btn_tip.png","","",ccui.Widget.PLIST_TEXTURE);
tipBt.setPosition(imgCave.getPositionX(),imgCave.getPositionY()-imgCave.getContentSize().height/2);tipBt.setVisible(false);this.tipBt=tipBt;bgPoker.addChild(tipBt);tipBt.addClickEventListener(function(){thiz._controller.sendTipRequest(thiz.minBetting)});var bettingPoker=new BettingPoker;this.addChild(bettingPoker);bettingPoker.setVisible(false);bettingPoker.btnConfirm.addClickEventListener(function(){thiz.handleButtonCofirm()});this.bettingPoker=bettingPoker;this.bettingPoker.setMinMaxAgain(100,1E3);
var countDown=new CountDownPoker;countDown.setPosition(bgPoker.getContentSize().width/2,420+pad);bgPoker.addChild(countDown,2);this.countDown=countDown;var vcl=new cc.LabelTTF("V\u00e0ng c\u00f2n l\u1ea1i:",cc.res.font.Roboto_Condensed,24);vcl.setPosition(95,20);vcl.setColor(cc.color(187,201,255,255));this.vcl=vcl;this.sceneLayer.addChild(vcl);var lblVcl=new cc.LabelTTF("0",cc.res.font.Roboto_Condensed,24);lblVcl.setAnchorPoint(cc.p(0,.5));lblVcl.setPosition(160,20);lblVcl.setColor(cc.color(255,216,
0,255));vcl.setVisible(false);lblVcl.setVisible(false);this.lblVcl=lblVcl;this.sceneLayer.addChild(lblVcl);this.runAction(new cc.Sequence(new cc.DelayTime(2),new cc.CallFunc(function(){})))},setGoldRemain:function(isShow,gold){if(isShow){this.lblVcl.setVisible(true);this.vcl.setVisible(true);this.lblVcl.setString(cc.Global.NumberFormat1(parseInt(gold)))}else{this.lblVcl.setVisible(false);this.vcl.setVisible(false)}},updateGold:function(username,gold){},handleButtonCofirm:function(){this.hideAllButton();
this.bettingPoker.setVisible(false);this._controller.sendActionRequest(this.bettingPoker.type,this.bettingPoker.gold)},setMinMaxSitDown:function(minbuy,maxbuy){this.minBuy=minbuy;this.maxBuy=maxbuy;this.maxOld=maxbuy},resetGame:function(time){this.countDown.startCountDown(time)},updateMoneyPot:function(moneyPot){this.lblPot.setString(cc.Global.NumberFormat1(moneyPot))},resetMoneyBetAllSlot:function(){for(var i=0;i<this.allSlot.length;i++)this.allSlot[i].setMoneyBet("")},updateActionPlayer:function(username,
money,moneyEXchang,idAction){this.handleButtons(null);var slot=this.getSlotByUsername(username);if(slot)switch(idAction){case PK_ACTION_PLAYER_BET:SoundPlayer.playSound("pk_chips_bet");break;case PK_ACTION_PLAYER_CALL:SoundPlayer.playSound("pk_call");SoundPlayer.playSound("pk_chips_bet");break;case PK_ACTION_PLAYER_FOLD:SoundPlayer.playSound("pk_fold");break;case PK_ACTION_PLAYER_CHECK:SoundPlayer.playSound("pk_check");break;case PK_ACTION_PLAYER_RAISE:SoundPlayer.playSound("pk_raise");SoundPlayer.playSound("pk_chips_bet");
break;case PK_ACTION_PLAYER_ALL_IN:SoundPlayer.playSound("pk_allin");SoundPlayer.playSound("pk_chips_bet");break}slot.stopTimeRemain();if(idAction==PK_ACTION_PLAYER_ALL_IN||idAction==PK_ACTION_PLAYER_CALL||idAction==PK_ACTION_PLAYER_RAISE||idAction==PK_ACTION_PLAYER_NONE||idAction==PK_ACTION_PLAYER_BET){slot.setMoneyBet(money);this.runChipBetting(slot)}else if(idAction==PK_ACTION_PLAYER_FOLD)slot.phomVituarl.setVisible(false);slot.updateAction(idAction)},initPlayer:function(numberSlot){if(this.allSlot&&
this.allSlot.length>0){for(var i=0;i<this.allSlot.length;i++)this.allSlot[i].removeFromParent(true);this.allSlot=null}this.playerView=[];var thiz=this;var sizeOrgX=this.bgPoker.getContentSize().width/2;var pad=-150;if(numberSlot==5){var distanceX=390;var higtRow1=170+pad;var higtRow2=460+pad;var player1=new PokerGamePlayer(i,this);player1.setPosition(sizeOrgX-distanceX,higtRow1);player1.setPositionInfo(PK_POSITION_LEFT,PK_POSITION_RIGHT,PK_POSITION_RIGHT);this.bgPoker.addChild(player1,1);var player2=
new PokerGamePlayer(i,this);player2.setPosition(sizeOrgX-distanceX,higtRow2);player2.setPositionInfo(PK_POSITION_LEFT,PK_POSITION_RIGHT,PK_POSITION_RIGHT);this.bgPoker.addChild(player2,1);var player3=new PokerGamePlayer(i,this);player3.setPosition(sizeOrgX+distanceX,higtRow2);player3.setPositionInfo(PK_POSITION_RIGHT,PK_POSITION_LEFT,PK_POSITION_LEFT);this.bgPoker.addChild(player3,1);var player4=new PokerGamePlayer(i,this);player4.setPosition(sizeOrgX+distanceX,higtRow1);player4.setPositionInfo(PK_POSITION_RIGHT,
PK_POSITION_LEFT,PK_POSITION_LEFT);this.bgPoker.addChild(player4,1);var player0=new PokerGamePlayer(i,this);player0.setPosition(sizeOrgX,55+pad);player0.setPositionInfo(PK_POSITION_BOTTOM,PK_POSITION_TOP,PK_POSITION_TOP);this.bgPoker.addChild(player0,1);this.playerView.push(player0);this.playerView.push(player1);this.playerView.push(player2);this.playerView.push(player3);this.playerView.push(player4)}else{var distanceX1=224;var distanceX2=390;var distanceX3=390;var distanceX4=165;var higtRow1=90+
pad;var higtRow2=220+pad;var higtRow3=420+pad;var higtRow4=555+pad;var player1=new PokerGamePlayer(i,this);player1.setPosition(sizeOrgX-distanceX1,higtRow1);player1.setPositionInfo(PK_POSITION_LEFT,PK_POSITION_RIGHT,PK_POSITION_RIGHT);this.bgPoker.addChild(player1,1);var player2=new PokerGamePlayer(i,this);player2.setPosition(sizeOrgX-distanceX2,higtRow2);player2.setPositionInfo(PK_POSITION_BOTTOM,PK_POSITION_RIGHT,PK_POSITION_RIGHT);this.bgPoker.addChild(player2,1);var player3=new PokerGamePlayer(i,
this);player3.setPosition(sizeOrgX-distanceX3,higtRow3);player3.setPositionInfo(PK_POSITION_BOTTOM,PK_POSITION_RIGHT,PK_POSITION_RIGHT);this.bgPoker.addChild(player3,1);var player4=new PokerGamePlayer(i,this);player4.setPosition(sizeOrgX-distanceX4,higtRow4);player4.setPositionInfo(PK_POSITION_LEFT,PK_POSITION_BOTTOM,PK_POSITION_BOTTOM);this.bgPoker.addChild(player4,1);var player5=new PokerGamePlayer(i,this);player5.setPosition(sizeOrgX+distanceX4,higtRow4);player5.setPositionInfo(PK_POSITION_RIGHT,
PK_POSITION_BOTTOM,PK_POSITION_BOTTOM);this.bgPoker.addChild(player5,1);var player6=new PokerGamePlayer(i,this);player6.setPosition(sizeOrgX+distanceX3,higtRow3);player6.setPositionInfo(PK_POSITION_BOTTOM,PK_POSITION_LEFT,PK_POSITION_LEFT);this.bgPoker.addChild(player6,1);var player7=new PokerGamePlayer(i,this);player7.setPosition(sizeOrgX+distanceX2,higtRow2);player7.setPositionInfo(PK_POSITION_BOTTOM,PK_POSITION_LEFT,PK_POSITION_LEFT);this.bgPoker.addChild(player7,1);var player8=new PokerGamePlayer(i,
this);player8.setPosition(sizeOrgX+distanceX1,higtRow1);player8.setPositionInfo(PK_POSITION_RIGHT,PK_POSITION_LEFT,PK_POSITION_LEFT);this.bgPoker.addChild(player8,1);var player0=new PokerGamePlayer(i,this);player0.setPosition(sizeOrgX,65+pad);player0.setPositionInfo(PK_POSITION_BOTTOM,PK_POSITION_TOP,PK_POSITION_TOP);this.bgPoker.addChild(player0,1);this.playerView.push(player0);this.playerView.push(player1);this.playerView.push(player2);this.playerView.push(player3);this.playerView.push(player4);
this.playerView.push(player5);this.playerView.push(player6);this.playerView.push(player7);this.playerView.push(player8)}for(var i=0;i<numberSlot;i++)(function(){var idx=i;thiz.playerView[i].btnSitDown.addClickEventListener(function(){thiz.showSitDownDialog(idx)})})()},runChipWin:function(slot,money){var to=slot.avt.getParent().convertToWorldSpace(slot.avt.getPosition());var from=this.bg_pot.getParent().convertToWorldSpace(this.bg_pot.getPosition());this.moveChipWithText(from,to,money)},runChipBetting:function(slot){var from=
slot.avt.getParent().convertToWorldSpace(slot.avt.getPosition());var to=slot.iconBet.getParent().convertToWorldSpace(slot.iconBet.getPosition());this.move4Chip(from,to)},takeMoneyFromSlot:function(slot,money){if(slot){var from=slot.iconBet.getParent().convertToWorldSpace(slot.iconBet.getPosition());var to=this.bg_pot.getParent().convertToWorldSpace(this.bg_pot.getPosition());this.moveChipWithText(from,to,money)}},initController:function(){this._controller=new PokerController(this)},initButton:function(){var thiz=
this;var raiseBt=new ccui.Button("pk_btn_raise.png","","",ccui.Widget.PLIST_TEXTURE);raiseBt.setPosition(1160*cc.winSize.screenScale,50);raiseBt.setScale(cc.winSize.screenScale);this.raiseBt=raiseBt;this.sceneLayer.addChild(raiseBt);var callBt=new ccui.Button("pk_btn_call.png","","",ccui.Widget.PLIST_TEXTURE);callBt.setPosition(1040*cc.winSize.screenScale,50);callBt.setScale(cc.winSize.screenScale);this.callBt=callBt;this.sceneLayer.addChild(callBt);var checkBt=new ccui.Button("pk_btn_check.png",
"","",ccui.Widget.PLIST_TEXTURE);checkBt.setPosition(920*cc.winSize.screenScale,50);checkBt.setScale(cc.winSize.screenScale);this.checkBt=checkBt;this.sceneLayer.addChild(checkBt);var foldBt=new ccui.Button("pk_btn_fold.png","","",ccui.Widget.PLIST_TEXTURE);foldBt.setPosition(795*cc.winSize.screenScale,50);foldBt.setScale(cc.winSize.screenScale);this.foldBt=foldBt;this.sceneLayer.addChild(foldBt);var allinBt=new ccui.Button("pk_btn_allin.png","","",ccui.Widget.PLIST_TEXTURE);allinBt.setPosition(raiseBt.getPosition());
allinBt.setScale(cc.winSize.screenScale);this.allinBt=allinBt;this.sceneLayer.addChild(allinBt);var betBt=new ccui.Button("pk_btn_Bet.png","","",ccui.Widget.PLIST_TEXTURE);betBt.setPosition(raiseBt.getPosition());betBt.setScale(cc.winSize.screenScale);this.betBt=betBt;this.sceneLayer.addChild(betBt);betBt.addClickEventListener(function(){thiz.bettingPoker.setTypeAgain(PK_ACTION_PLAYER_BET);thiz.bettingPoker.setVisible(true)});allinBt.addClickEventListener(function(){thiz._controller.sendActionRequest(PK_ACTION_PLAYER_ALL_IN,
0)});foldBt.addClickEventListener(function(){thiz._controller.sendActionRequest(PK_ACTION_PLAYER_FOLD,0);thiz.handleButtons(null)});raiseBt.addClickEventListener(function(){thiz.bettingPoker.setTypeAgain(PK_ACTION_PLAYER_RAISE);thiz.bettingPoker.setVisible(true)});callBt.addClickEventListener(function(){thiz._controller.sendActionRequest(PK_ACTION_PLAYER_CALL,0);thiz.handleButtons(null)});checkBt.addClickEventListener(function(){thiz._controller.sendActionRequest(PK_ACTION_PLAYER_CHECK,0);thiz.handleButtons(null)});
this.buttons=[betBt,raiseBt,callBt,checkBt,foldBt,allinBt];this.hideAllButton();var cbFold=new ccui.CheckBox;cbFold.loadTextureBackGround("pk_s_fold.png",ccui.Widget.PLIST_TEXTURE);cbFold.loadTextureFrontCross("pk_s_fold_at.png",ccui.Widget.PLIST_TEXTURE);cbFold.addEventListener(function(){thiz._controller.requestSuggest(PK_SUGGEST_FOLD)});cbFold.setPosition(foldBt.getPosition());cbFold.setScale(cc.winSize.screenScale);this.sceneLayer.addChild(cbFold);var cbCheck=new ccui.CheckBox;cbCheck.loadTextureBackGround("pk_s_check.png",
ccui.Widget.PLIST_TEXTURE);cbCheck.loadTextureFrontCross("pk_s_check_at.png",ccui.Widget.PLIST_TEXTURE);cbCheck.addEventListener(function(){thiz._controller.requestSuggest(PK_SUGGEST_CHECK)});cbCheck.setPosition(checkBt.getPosition());cbCheck.setScale(cc.winSize.screenScale);this.sceneLayer.addChild(cbCheck);var cbChectOrFold=new ccui.CheckBox;cbChectOrFold.loadTextureBackGround("pk_s_foldCheck.png",ccui.Widget.PLIST_TEXTURE);cbChectOrFold.loadTextureFrontCross("pk_s_foldCheck_at.png",ccui.Widget.PLIST_TEXTURE);
cbChectOrFold.addEventListener(function(){thiz._controller.requestSuggest(PK_SUGGEST_CHECK_FOLD)});cbChectOrFold.setPosition(callBt.getPosition());cbChectOrFold.setScale(cc.winSize.screenScale);this.sceneLayer.addChild(cbChectOrFold);var cbCallAny=new ccui.CheckBox;cbCallAny.loadTextureBackGround("pk_s_call.png",ccui.Widget.PLIST_TEXTURE);cbCallAny.loadTextureFrontCross("pk_s_Call_at.png",ccui.Widget.PLIST_TEXTURE);cbCallAny.addEventListener(function(){thiz._controller.requestSuggest(PK_SUGGEST_CALL)});
cbCallAny.setPosition(raiseBt.getPosition());cbCallAny.setScale(cc.winSize.screenScale);this.sceneLayer.addChild(cbCallAny);this.cbFold=cbFold;this.cbCheck=cbCheck;this.cbChectOrFold=cbChectOrFold;this.cbCallAny=cbCallAny;this.checkBoxs=[cbFold,cbCheck,cbChectOrFold,cbCallAny];this.hideAllCheckBox()},handleCheckBox:function(idActive,arrAction){cc.log("handleCheckBox");this.hideAllCheckBox();this.hideAllButton();this.bettingPoker.setVisible(false);for(var i=0;i<arrAction.length;i++)if(arrAction[i]==
PK_SUGGEST_CHECK_FOLD){this.cbChectOrFold.setVisible(true);if(idActive==arrAction[i])this.cbChectOrFold.setSelected(true)}else if(arrAction[i]==PK_SUGGEST_CALL){this.cbCallAny.setVisible(true);if(idActive==arrAction[i])this.cbCallAny.setSelected(true)}else if(arrAction[i]==PK_SUGGEST_FOLD){this.cbFold.setVisible(true);if(idActive==arrAction[i])this.cbFold.setSelected(true)}else if(arrAction[i]==PK_SUGGEST_CHECK){this.cbCheck.setVisible(true);if(idActive==arrAction[i])this.cbCheck.setSelected(true)}},
handleButtons:function(arrAction){this.hideAllButton();this.hideAllCheckBox();this.bettingPoker.setVisible(false);if(arrAction!=null){for(var i=0;i<arrAction.length;i++)if(arrAction[i]==PK_ACTION_PLAYER_RAISE)this.raiseBt.setVisible(true);else if(arrAction[i]==PK_ACTION_PLAYER_CALL)this.callBt.setVisible(true);else if(arrAction[i]==PK_ACTION_PLAYER_FOLD)this.foldBt.setVisible(true);else if(arrAction[i]==PK_ACTION_PLAYER_CHECK)this.checkBt.setVisible(true);else if(arrAction[i]==PK_ACTION_PLAYER_ALL_IN)this.allinBt.setVisible(true);
else if(arrAction[i]==PK_ACTION_PLAYER_BET)this.betBt.setVisible(true);if(this.raiseBt.isVisible()||this.betBt.isVisible())this.allinBt.setVisible(false)}},onUpdateTurn:function(username){for(var i=0;i<this.allSlot.length;i++)if(this.allSlot[i].username==username)this.allSlot[i].showTimeRemain(this.timeMaxTurn,this.timeMaxTurn);else this.allSlot[i].stopTimeRemain()},setMinBetting:function(minBetting){this.minBetting=minBetting},createHeart:function(){var heart1=new cc.Sprite("#pk_heart1.png");heart1.setPosition(cc.p(140,
110));this.imgCave.addChild(heart1);heart1.setVisible(false);this.heart1=heart1;var heart2=new cc.Sprite("#pk_heart2.png");heart2.setPosition(cc.p(heart1.getContentSize().width/2,heart1.getContentSize().height/2));heart1.addChild(heart2,-1);var heart3=new cc.Sprite("#pk_heart3.png");heart3.setPosition(cc.p(heart2.getPosition()));heart1.addChild(heart3,-2);var timeFadeHeart=.5;heart1.runAction(new cc.RepeatForever(new cc.Sequence(new cc.CallFunc(function(){heart2.runAction(new cc.FadeTo(timeFadeHeart,
255))}),new cc.DelayTime(timeFadeHeart),new cc.CallFunc(function(){heart3.runAction(new cc.FadeTo(timeFadeHeart,255))}),new cc.DelayTime(timeFadeHeart),new cc.CallFunc(function(){heart3.runAction(new cc.FadeTo(timeFadeHeart,0))}),new cc.DelayTime(timeFadeHeart),new cc.CallFunc(function(){heart2.runAction(new cc.FadeTo(timeFadeHeart,0))}),new cc.DelayTime(timeFadeHeart))))},hideAllButton:function(){for(var i=0;i<this.buttons.length;i++)this.buttons[i].setVisible(false)},hideAllCheckBox:function(){for(var i=
0;i<this.checkBoxs.length;i++){this.checkBoxs[i].setVisible(false);this.checkBoxs[i].setSelected(false)}},setTypePlayer:function(username,type){cc.log("username"+username);var slot=this.getSlotByUsername(username);if(slot){cc.log("username"+username+"\x3d\x3d"+type);slot.setType(type)}},setTimeRemainOfPlayer:function(userName,timeRemain){var slot=this.getSlotByUsername(userName);if(slot)slot.showTimeRemain(timeRemain,this.timeMaxTurn)},performDealCards:function(cards,animation){var thiz=this;this.allSlot[0].cardList.removeAll();
var pointCave=this.imgCave.getParent().convertToWorldSpace(this.imgCave.getPosition());if(cards.length>0);var m=0;for(var j=0;j<2;j++){(function(){var jNew=j;thiz.runAction(new cc.Sequence(new cc.DelayTime(m*.5),new cc.CallFunc(function(){if(cards.length>1)thiz.allSlot[0].cardList.addCardsPoker(cards[jNew],pointCave)})));m++})();for(var k=0;k<thiz.allSlot.length;k++)(function(){var kNew=k;if(thiz.allSlot[kNew].username!=""&&thiz.allSlot[kNew].username!=PlayerMe.username)thiz.allSlot[kNew].phomVituarl.setVisible(true)})()}},
getTimePlayerCurrent:function(){var timeInfor={timeRemain:0,username:""};for(var i=0;i<this.allSlot.length;i++){var timeOfPlayer=this.allSlot[i].getTimeCurrent(this.timeMaxTurn);if(timeOfPlayer>0){timeInfor.username=this.allSlot[i].username;timeInfor.timeRemain=timeOfPlayer;return timeInfor}}return timeInfor},backButtonClickHandler:function(){if(this.stateMe==PK_STATUSME_STANDUP)this._controller.requestQuitRoom();else if(this._controller)this._controller.requestStandup()},updateInviteButton:function(){if(this.allSlot[0].username==
PlayerMe.username)for(var i=0;i<this.allSlot.length;i++){if(this.allSlot[i].username=="")this.allSlot[i].setVisbleSitDown(false)}else for(var i=0;i<this.allSlot.length;i++)if(this.allSlot[i].username=="")this.allSlot[i].setVisbleSitDown(true)},showSitDownDialog:function(index){var thiz=this;if(this.minBuy>PlayerMe.gold)MessageNode.getInstance().show("B\u1ea1n kh\u00f4ng \u0111\u1ee7 v\u00e0ng \u0111\u1ec3 ch\u01a1i, vui l\u00f2ng ra n\u1ea1p v\u00e0ng");else{var isMax=false;if(this.maxOld>PlayerMe.gold){if(PlayerMe.gold<
this.maxOld/2)isMax=true;this.maxBuy=PlayerMe.gold}var dialog=new PopupSitdown(this.maxBuy,this.minBuy,isMax);dialog.okButtonHandler=function(){thiz._controller.sendSitDownRequest(index,dialog.getGold(),dialog.cbAutoBuy.isSelected());dialog.hide()};dialog.show()}},findSlotSitDown:function(){var thiz=this;var isCanSit=false;for(var z=0;z<this.allSlot.length;z++)if(this.allSlot[z].username==""){this.allSlot[z].runAction(new cc.Sequence(new cc.DelayTime(1),new cc.CallFunc(function(){cc.log("\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d damn"+
z);thiz.showSitDownDialog(z)})));isCanSit=true;break}if(!isCanSit)this.runAction(new cc.Sequence(new cc.DelayTime(.1),new cc.CallFunc(function(){MessageNode.getInstance().show("H\u1ebft gh\u1ebf \u0111\u1ec3 ng\u1ed3i, vui l\u00f2ng sang b\u00e0n kh\u00e1c ho\u1eb7c ch\u1edd!")})))},move4Chip:function(from,to){var thiz=this;for(var i=0;i<4;i++)(function(){var a=i;var chip=new cc.Sprite("#pk_xeng.png");chip.setPosition(from);chip.setVisible(true);chip.runAction(new cc.Sequence(new cc.DelayTime(.1*
i),new cc.MoveTo(.5,to),new cc.CallFunc(function(){chip.removeFromParent(true)})));thiz.sceneLayer.addChild(chip,10)})()},moveChipWithText:function(from,to,money){var distance=cc.pDistance(from,to);var timeRun=distance/380;var thiz=this;var chip=new cc.Sprite("#pk_xeng.png");chip.setPosition(from);chip.setVisible(true);chip.runAction(new cc.Sequence(new cc.MoveTo(timeRun,to),new cc.CallFunc(function(){chip.removeFromParent(true)})));thiz.sceneLayer.addChild(chip,10);var lblMoney=new cc.LabelTTF("+"+
money,cc.res.font.Roboto_CondensedBold,25);lblMoney.setAnchorPoint(0,.5);lblMoney.setColor(cc.color(255,222,0,255));lblMoney.setPosition(from.x+30,from.y);this.sceneLayer.addChild(lblMoney,10);lblMoney.runAction(new cc.Sequence(new cc.MoveTo(timeRun,cc.p(to.x+30,to.y)),new cc.CallFunc(function(){lblMoney.removeFromParent(true)})))},playerTip:function(username,money){var slot=this.getSlotByUsername(username);if(slot){var thiz=this;var from=slot.avt.getParent().convertToWorldSpace(slot.avt.getPosition());
var to=this.imgCave.getParent().convertToWorldSpace(cc.p(this.imgCave.getPositionX(),this.imgCave.getPositionY()-40));var timeRun=cc.pDistance(from,to)/500;var chip=new cc.Sprite("#pk_xeng.png");chip.setPosition(from);chip.setVisible(true);chip.runAction(new cc.Sequence(new cc.MoveTo(timeRun,to),new cc.CallFunc(function(){chip.removeFromParent(true);thiz.setTextTip(username)})));this.heart1.setVisible(true);this.sceneLayer.addChild(chip,10);var lblMoney=new cc.LabelTTF(money,cc.res.font.Roboto_Condensed,
20);lblMoney.setAnchorPoint(.5,.5);lblMoney.setColor(cc.color(255,222,0,255));lblMoney.setOpacity(255);lblMoney.setVisible(false);lblMoney.setPosition(this.imgCave.getPositionX(),this.imgCave.getPositionY()-50);this.bgPoker.addChild(lblMoney,10);lblMoney.runAction(new cc.Sequence(new cc.DelayTime(timeRun),new cc.CallFunc(function(){lblMoney.setVisible(true);lblMoney.runAction(new cc.MoveTo(.7,cc.p(thiz.imgCave.getPositionX(),thiz.imgCave.getPositionY())));lblMoney.runAction(new cc.FadeTo(.7,100))}),
new cc.DelayTime(1.2),new cc.CallFunc(function(){lblMoney.removeFromParent(true);thiz.heart1.setVisible(false)})))}},setTextTip:function(name){this.caveTextBG.setVisible(true);var thiz=this;if(name.length>15)name=name.substring(0,15);if(name.length>3)name=name.substring(0,name.length-3)+"***";var txtTip="    Thanks,\n"+name;this.caveText.setString(txtTip);this.caveTextBG.stopAllActions();this.caveTextBG.runAction(new cc.Sequence(new cc.DelayTime(2.5),new cc.CallFunc(function(){thiz.caveTextBG.setVisible(false)})))}});
var CountDownPoker=cc.Node.extend({ctor:function(){this._super();this._timeCount=0;var bg_CountDown=new cc.Sprite("#pk_bg_countDown.png");this.addChild(bg_CountDown);bg_CountDown.setVisible(false);var icon_gold=new cc.Sprite("#pk_numBuy.png");icon_gold.setPosition(150,bg_CountDown.getContentSize().height/2);bg_CountDown.addChild(icon_gold);icon_gold.runAction(new cc.RepeatForever(new cc.RotateBy(1,360)));var _txtCountDown=new cc.LabelTTF("adsfasdfsdfsadfsa",cc.res.font.Roboto_CondensedBold,25);_txtCountDown.setColor(cc.color(255,
222,0,255));_txtCountDown.setPosition(bg_CountDown.getContentSize().width/2+30,bg_CountDown.getContentSize().height/2);this._txtCountDown=_txtCountDown;bg_CountDown.addChild(_txtCountDown,1);this.bg_CountDown=bg_CountDown},startCountDown:function(time){this._timeCount=time;this.scheduleUpdate();this.bg_CountDown.setVisible(true)},stopCountDown:function(){this.unscheduleUpdate();this.bg_CountDown.setVisible(false)},update:function(dt){this._timeCount-=dt;if(this._timeCount<0){this._timeCount=0;this.bg_CountDown.setVisible(false)}this._txtCountDown.setString("Ch\u1edd v\u00e1n m\u1edbi b\u1eaft \u0111\u1ea7u ("+
Math.floor(this._timeCount)+"s)")}});
var PopupSitdown=Dialog.extend({ctor:function(maxBuy,minBuy,isMax){this._super();this.title.setString("\u0110\u1ed4I CHIP V\u00c0O B\u00c0N");this.initWithSize(cc.size(750,500));var thiz=this;var lblMoney=new cc.LabelTTF("0",cc.res.font.Roboto_Condensed,30);lblMoney.setPosition(this.getContentSize().width/2,this.getContentSize().height/2+100);lblMoney.setColor(cc.color(255,255,0,255));this.addChild(lblMoney);this.lblMoney=lblMoney;var slider=new ccui.Slider("pk_pg_slider.png","",ccui.Widget.PLIST_TEXTURE);
slider.loadSlidBallTextureNormal("pk_numBuy.png",ccui.Widget.PLIST_TEXTURE);slider.loadProgressBarTexture("bg_trong.png",ccui.Widget.PLIST_TEXTURE);slider.setPosition(this.getContentSize().width/2,this.getContentSize().height/2);slider.percent=isMax?100:50;var maxGold=maxBuy-minBuy;slider.addEventListener(function(selector,target){if(target==ccui.Slider.EVENT_PERCENT_CHANGED){cc.log("persent:"+slider.percent);thiz.gold=Math.floor(slider.percent*maxGold/100)+minBuy;thiz.lblMoney.setString(cc.Global.NumberFormat1(thiz.gold))}});
this.addChild(slider);this.gold=Math.floor(slider.percent*maxGold/100)+minBuy;thiz.lblMoney.setString(cc.Global.NumberFormat1(this.gold));var rightBut=new ccui.Button("pk_plus.png","","",ccui.Widget.PLIST_TEXTURE);rightBut.setPosition(this.getContentSize().width/2+300,this.getContentSize().height/2);this.addChild(rightBut);var leftBut=new ccui.Button("pk_minus.png","","",ccui.Widget.PLIST_TEXTURE);leftBut.setPosition(this.getContentSize().width/2-300,this.getContentSize().height/2);this.addChild(leftBut);
var lblAuto=new cc.LabelTTF("T\u1ef1 \u0111\u1ed9ng \u0111\u1ed5i khi h\u1ebft chip",cc.res.font.Roboto_Condensed,24);lblAuto.setColor(cc.color(119,203,238,255));lblAuto.setAnchorPoint(0,.5);lblAuto.setPosition(400,280);this.addChild(lblAuto);var cbAutoBuy=new ccui.CheckBox;cbAutoBuy.loadTextureBackGround("home-checkBox.png",ccui.Widget.PLIST_TEXTURE);cbAutoBuy.loadTextureFrontCross("home-checkCross.png",ccui.Widget.PLIST_TEXTURE);cbAutoBuy.setSelected(true);cbAutoBuy.setPosition(370,280);this.addChild(cbAutoBuy);
this.cbAutoBuy=cbAutoBuy;rightBut.addClickEventListener(function(){var percentCurr=slider.percent+10;if(percentCurr>100)percentCurr=100;slider.percent=percentCurr;this.gold=Math.floor(slider.percent*maxGold/100)+minBuy;thiz.lblMoney.setString(cc.Global.NumberFormat1(this.gold))});leftBut.addClickEventListener(function(){var percentCurr=slider.percent-10;if(percentCurr<0)percentCurr=0;slider.percent=percentCurr;this.gold=Math.floor(slider.percent*maxGold/100)+minBuy;thiz.lblMoney.setString(cc.Global.NumberFormat1(this.gold))});
this.cancelButtonHandler=function(){thiz.hide()};this.cancelTitle.setString("H\u1ee7y");this.okTitle.setString("\u0110\u1ed3ng \u00fd");this.cancelTitle.setScale(1.3);this.okTitle.setScale(1.3)},getGold:function(){return this.gold}});
var BettingPoker=cc.Node.extend({minBuy:0,maxBuy:0,type:PK_ACTION_PLAYER_BET,ctor:function(){this._super();var bg=new cc.Sprite("#pk_bg_betting.png");bg.setAnchorPoint(1,0);bg.setPosition(cc.winSize.width,0);this.addChild(bg);this.mTouch=cc.rect(cc.winSize.width-bg.getContentSize().width,0,bg.getContentSize().width,bg.getContentSize().height);var slider=new ccui.Slider("pk_bg_slider.png","",ccui.Widget.PLIST_TEXTURE);slider.loadSlidBallTextureNormal("pk-slider-ball.png",ccui.Widget.PLIST_TEXTURE);
slider.loadProgressBarTexture("bg_trong.png",ccui.Widget.PLIST_TEXTURE);slider.setRotation(-90);slider.setPosition(bg.getContentSize().width/2,bg.getContentSize().height/2+10);this.slider=slider;bg.addChild(slider);var lblGold=new cc.LabelTTF("100",cc.res.font.Roboto_CondensedBold,25);lblGold.setColor(cc.color(251,192,1,255));lblGold.setPosition(bg.getContentSize().width/2,655);bg.addChild(lblGold);this.lblGold=lblGold;var allIn=new cc.Sprite("#tg_allin.png");allIn.setPosition(lblGold.getPosition());
bg.addChild(allIn);allIn.setVisible(false);this.allIn=allIn;var btnConfirm=new ccui.Button("pk_btn_conFirm.png","","",ccui.Widget.PLIST_TEXTURE);btnConfirm.setPosition(bg.getContentSize().width/2,54);bg.addChild(btnConfirm);var imgGold=new cc.Sprite("#pk_bg_slider_gold.png");var hightClip=imgGold.getContentSize().height;this.hightClip=hightClip;var clipping=new ccui.Layout;clipping.setContentSize(cc.size(130,0));clipping.setClippingEnabled(true);clipping.setClippingType(ccui.Layout.CLIPPING_SCISSOR);
clipping.setPosition(bg.getContentSize().width/2+29,127);imgGold.setPosition(imgGold.getContentSize().width/2-10,imgGold.getContentSize().height/2);clipping.addChild(imgGold);bg.addChild(clipping);this.clipping=clipping;var thiz=this;slider.percent=0;this.gold=this.minBuy;thiz.lblGold.setString(cc.Global.NumberFormat1(this.gold));slider.addEventListener(function(selector,target){if(target==ccui.Slider.EVENT_PERCENT_CHANGED){var leng=thiz.slider.percent/100*thiz.hightClip;thiz.clipping.setContentSize(cc.rect(0,
0,50,leng));thiz.gold=Math.floor(slider.percent*(thiz.maxBuy-thiz.minBuy)/100)+thiz.minBuy;thiz.lblGold.setString(cc.Global.NumberFormat1(thiz.gold));thiz.allIn.setVisible(thiz.slider.percent<100?false:true);thiz.type=thiz.slider.percent<100?thiz.typeOld:PK_ACTION_PLAYER_ALL_IN;thiz.lblGold.setVisible(!thiz.allIn.isVisible())}});this.btnConfirm=btnConfirm},setMinMaxAgain:function(minBuy,maxBuy){this.maxBuy=maxBuy;this.minBuy=minBuy;this.gold=minBuy;this.lblGold.setString(cc.Global.NumberFormat1(this.gold));
this.slider.percent=0;this.clipping.setContentSize(cc.size(130,0))},setTypeAgain:function(type){this.type=type;this.typeOld=type},onEnter:function(){this._super();var thiz=this;cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:true,onTouchBegan:function(touch,event){if(!thiz.isVisible())return false;var p=thiz.convertToNodeSpace(touch.getLocation());if(!cc.rectContainsPoint(thiz.mTouch,p))thiz.setVisible(false);return true}},this)}});
var CardEx=Card.extend({ctor:function(rank,suit){this._super(rank,suit);var thiz=this;var borderSprite=new cc.Sprite("#boder_vang.png");borderSprite.setScale(.95);borderSprite.setVisible(false);borderSprite.setPosition(this.getContentSize().width/2,this.getContentSize().height/2);this.addChild(borderSprite);this.borderSprite=borderSprite;var cardblack=new cc.Sprite("#card-black.png");cardblack.setOpacity(100);cardblack.setScale(1.05);cardblack.setVisible(false);cardblack.setPosition(this.getContentSize().width/
2,this.getContentSize().height/2);this.addChild(cardblack);this.cardblack=cardblack}});
var CardSmall=cc.Node.extend({ctor:function(size){this._super();this.setContentSize(size);this.setAnchorPoint(cc.p(.5,.5))},addCard:function(from,index){if(index==0)this.removeAllChildren(true);var card=new cc.Sprite("#gp_card_up.png");this.addChild(card);card.setPosition(this.convertToNodeSpace(from));var x=this.getContentSize().width/2-index*5;var y=this.getContentSize().height/2;card.setScale(this.getContentSize().height/card.getContentSize().height);if(index==0)card.setRotation(15);var moveAction=
new cc.MoveTo(.2,cc.p(x,y));card.stopActionByTag(100);moveAction.setTag(100);card.runAction(moveAction)},addCardReconnect:function(){this.removeAll();for(var i=0;i<2;i++){var card=new cc.Sprite("#gp_card_up.png");this.addChild(card);var x=this.getContentSize().width/2-i*5;var y=this.getContentSize().height/2;card.setPosition(cc.p(x,y));card.setScale(this.getContentSize().height/card.getContentSize().height);if(index==0)card.setRotation(15)}},removeAll:function(){this.removeAllChildren(true)},setVisible:function(isVisible){this._super(isVisible)}});
var CardPoker=cc.Node.extend({ctor:function(size){this.canTouch=false;this._super();this.cardList=[];this.setContentSize(size);this.setAnchorPoint(cc.p(.5,.5))},addCardsPoker:function(cardID,from){var cardAdd=new CardEx(cardID.rank,cardID.suit);cardAdd.setPosition(this.convertToNodeSpace(from));cardAdd.setSpriteFrame("gp_card_up.png");this.addCard(cardAdd);var width=this.cardSize.width*this.cardList.length;if(width>this.getContentSize().width)width=this.getContentSize().width;var dx=width/this.cardList.length+
7;var x=this.getContentSize().width/2-width/2+dx/2;var y=this.getContentSize().height/2;for(var i=0;i<this.cardList.length;i++){this.reorderChild(this.cardList[i],i);var card=this.cardList[i];card.origin=cc.p(x,y);card.cardDistance=dx;var moveAction=new cc.MoveTo(.2,cc.p(x,y));card.stopActionByTag(100);moveAction.setTag(100);card.runAction(moveAction);x+=dx}var originScale=cardAdd.getScale();var changeSprite=new cc.CallFunc(function(){cardAdd.setSpriteFrame(cardID.rank+s_card_suit[cardID.suit]+".png")});
var scale1=new cc.ScaleTo(.2,0,originScale);var scale2=new cc.ScaleTo(.2,originScale,originScale);cardAdd.runAction(new cc.Sequence(new cc.DelayTime(.5),scale1,changeSprite,scale2))},reOrder:function(isAnimation){if(this.cardList.length>0){var width=this.cardSize.width*this.cardList.length;if(width>this.getContentSize().width)width=this.getContentSize().width;var dx=width/this.cardList.length+7;var x=this.getContentSize().width/2-width/2+dx/2;var y=this.getContentSize().height/2;for(var i=0;i<this.cardList.length;i++){var card=
this.cardList[i];card.origin=cc.p(x,y);card.cardIndex=i;card.cardDistance=dx;this.reorderChild(card,i);if(isAnimation)card.moveToOriginPosition();else card.setPosition(card.origin);x+=dx}}},addCardsPokerEndGame:function(cards){var thiz=this;this.removeAll();for(var j=0;j<cards.length;j++){var card=new CardEx(cards[j].rank,cards[j].suit);card.setSpriteFrame("gp_card_up.png");this.addCard(card)}var width=this.cardSize.width*this.cardList.length;if(width>this.getContentSize().width)width=this.getContentSize().width;
var dx=width/this.cardList.length+4;var x=this.getContentSize().width/2-width/2+dx/2;var y=this.getContentSize().height/2;for(var i=0;i<this.cardList.length;i++){this.reorderChild(this.cardList[i],i);(function(){var card=thiz.cardList[i];card.origin=cc.p(x,y);card.cardDistance=dx;card.setPosition(x,y);x+=dx;var originScale=card.getScale();var changeSprite=new cc.CallFunc(function(){cc.log("c\x3d+++++++++++++++"+card.rank+s_card_suit[card.suit]+".png");card.setSpriteFrame(card.rank+s_card_suit[card.suit]+
".png")});var scale1=new cc.ScaleTo(.2,0,originScale);var scale2=new cc.ScaleTo(.2,originScale,originScale);card.runAction(new cc.Sequence(new cc.DelayTime(.1*i),scale1,changeSprite,scale2))})()}},addCard:function(card){if(!this.cardSize){this.cardSize=card.getContentSize();if(this.cardSize.height>this.getContentSize().height){var ratio=this.getContentSize().height/this.cardSize.height;this.cardSize.width*=ratio;this.cardSize.height*=ratio}}if(card.getContentSize().height>this.cardSize.height)card.setScale(this.cardSize.height/
card.getContentSize().height);card.cardIndex=this.cardList.length;card.canTouch=this.canTouch;this.addChild(card,this.cardList.length);this.cardList.push(card)},addCardReconnect:function(cardId){for(var i=0;i<cardId.length;i++){var card=new CardEx(cardId[i].rank,cardId[i].suit);this.addCard(card)}this.reOrder(false)},dealCards:function(cards,animation,posCave){this.removeAll();for(var i=0;i<cards.length;i++){var card=new CardEx(cards[i].rank,cards[i].suit);if(animation)card.setPosition(this.convertToNodeSpace(posCave));
this.addCard(card)}var width=this.cardSize.width*this.cardList.length;if(width>this.getContentSize().width)width=this.getContentSize().width;var dx=width/this.cardList.length+4;var x=this.getContentSize().width/2-width/2+dx/2;var y=this.getContentSize().height/2;for(var i=0;i<this.cardList.length;i++){this.reorderChild(this.cardList[i],i);var card=this.cardList[i];card.origin=cc.p(x,y);card.cardDistance=dx;if(animation){card.visible=false;var delayAction=new cc.DelayTime(.02*i);var beforeAction=new cc.CallFunc(function(target){target.visible=
true},card);var moveAction=new cc.MoveTo(.2,cc.p(x,y));var soundAction=new cc.CallFunc(function(){SoundPlayer.playSound("chia_bai")});card.runAction(new cc.Sequence(delayAction,soundAction,beforeAction,moveAction))}else card.setPosition(x,y);x+=dx}},onEnter:function(){this._super();this.deckPoint=this.convertToNodeSpace(cc.p(cc.winSize.width/2,cc.winSize.height/2))},setTouchEnable:function(touch){this.canTouch=touch;for(var i=0;i<this.cardList.length;i++)this.cardList[i].canTouch=this.canTouch},removeAll:function(){this.removeAllChildren(true);
this.cardList=[]},showBoderCards:function(cards){var thiz=this;(function(){for(var i=0;i<thiz.cardList.length;i++){var card=thiz.cardList[i];card.borderSprite.setVisible(false);for(var j=0;j<cards.length;j++)if(cards[j].rank==card.rank&&cards[j].suit==card.suit){card.borderSprite.setVisible(true);break}}})()},showCardBlack:function(cards){var thiz=this;(function(){for(var i=0;i<thiz.cardList.length;i++){var card=thiz.cardList[i];card.cardblack.setVisible(true);for(var j=0;j<cards.length;j++)if(cards[j].rank==
card.rank&&cards[j].suit==card.suit){card.cardblack.setVisible(false);break}}})()}});var TLMNSolo=TienLen.extend({ctor:function(){this._super();this._controller.isSolo=true},initPlayer:function(){var playerMe=new GamePlayerMe;playerMe.setPosition(150,50);this.sceneLayer.addChild(playerMe,1);var player1=new GamePlayer;player1.setPosition(cc.winSize.width/2,cc.winSize.height-140/cc.winSize.screenScale);this.sceneLayer.addChild(player1,1);player1.chatView.setAnchorPoint(cc.p(1,1));var cardRemaining1=new CardRemaining;cardRemaining1.setPosition(130,70);player1.infoLayer.addChild(cardRemaining1);
player1.cardRemaining=cardRemaining1;this.playerView=[playerMe,player1]}});var BaCayCardList=CardList.extend({dealCards:function(cards,animation){this._super(cards,animation);for(var i=0;i<this.cardList.length;i++){this.cardList[i].setSpriteFrame("gp_card_up.png");this.overrideReveal(this.cardList[i])}},overrideReveal:function(card){card.setSelected=function(selected,force){if(force){card.stopAllActions();card.setPosition(card.origin)}if(selected==true)card.reveal()};card.reveal=function(){if(card.revealed)return;card.revealed=true;var duration=.1;var oldScaleX=card.scaleX;
var scaleDown=new cc.ScaleTo(duration,0,card.scaleY);var revealAction=new cc.CallFunc(function(){card.setSpriteFrame(""+card.rank+s_card_suit[card.suit]+".png")});var scaleUp=new cc.ScaleTo(duration,oldScaleX,card.scaleY);card.runAction(new cc.Sequence(scaleDown,revealAction,scaleUp));SoundPlayer.playSound("open_card")}},addCard:function(card){this._super(card);this.overrideReveal(card)},revealAll:function(cards){if(cards)for(var i=0;i<cards.length;i++){var card=CardList.prototype.getCardWithId(cards[i]);
this.cardList[i].rank=card.rank;this.cardList[i].suit=card.suit}for(var j=0;j<this.cardList.length;j++)this.cardList[j].reveal()}});
var BaCay=IGameScene.extend({ctor:function(){this._super();this.initScene();this.timeRemaining=0;this.timeInterval=null},initScene:function(){var table_bg=new cc.Sprite("res/gp_table.png");table_bg.setPosition(cc.winSize.width/2,320);table_bg.setScale(cc.winSize.screenScale);this.sceneLayer.addChild(table_bg);this.tabe_bg=table_bg;this.initPlayer();this.initButton();var stateString=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_30,"",cc.TEXT_ALIGNMENT_CENTER);stateString.setColor(cc.color("#8e9bff"));
stateString.setPosition(cc.winSize.width/2,cc.winSize.height/2);this.sceneLayer.addChild(stateString);this.stateString=stateString;var huThuongBg=new ccui.Button("bacayhuthuong_bg.png","","",ccui.Widget.PLIST_TEXTURE);huThuongBg.setScale9Enabled(true);huThuongBg.setCapInsets(cc.rect(15,15,4,4));huThuongBg.setContentSize(cc.size(322,47));huThuongBg.addClickEventListener(function(){var huMau=new HistoryNoHu(false);huMau.show()});huThuongBg.setPosition(cc.winSize.width/2,280);this.sceneLayer.addChild(huThuongBg);
var huThuongLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_25,"H\u0168 BA C\u00c2Y : ");huThuongLabel.setPosition(huThuongBg.x-75,huThuongBg.y);huThuongLabel.setColor(cc.color("#c1ceff"));this.sceneLayer.addChild(huThuongLabel);var huThuongValueLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_25,"");huThuongValueLabel.setPosition(huThuongBg.x+60,huThuongBg.y);huThuongValueLabel.setColor(cc.color("#ffde00"));this.sceneLayer.addChild(huThuongValueLabel);this.huThuongValueLabel=
huThuongValueLabel;var timeLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_40,"",cc.TEXT_ALIGNMENT_CENTER,500);timeLabel.setScale(1.5);timeLabel.setPosition(cc.winSize.width/2,420);this.sceneLayer.addChild(timeLabel);this.timeLabel=timeLabel},initPlayer:function(){var playerMe=new GamePlayerMe;playerMe.setPosition(cc.winSize.width/2,50);playerMe.cardList=new BaCayCardList(cc.size(240,100));playerMe.cardList.setPosition(cc.winSize.width/2,150);playerMe.resultLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_30,
"",cc.TEXT_ALIGNMENT_CENTER);playerMe.resultLabel.setColor(cc.color("#8e9bff"));playerMe.resultLabel.setPosition(playerMe.cardList.x,playerMe.cardList.y+80);playerMe.assetChangePos=cc.p(playerMe.avt.x,playerMe.avt.y-30);playerMe.setIsOwner(false);this.sceneLayer.addChild(playerMe,1);this.sceneLayer.addChild(playerMe.cardList,2);this.sceneLayer.addChild(playerMe.resultLabel,2);var player1=new GamePlayer;player1.setPosition(cc.winSize.width-144*cc.winSize.screenScale,240*cc.winSize.screenScale);this.sceneLayer.addChild(player1,
1);var player2=new GamePlayer;player2.setPosition(cc.winSize.width-180*cc.winSize.screenScale,cc.winSize.height-270/cc.winSize.screenScale);this.sceneLayer.addChild(player2,1);var player3=new GamePlayer;player3.setPosition(this.tabe_bg.x,this.tabe_bg.y+250);this.sceneLayer.addChild(player3,1);var player4=new GamePlayer;player4.setPosition(180*cc.winSize.screenScale,player2.y);this.sceneLayer.addChild(player4,1);var player5=new GamePlayer;player5.setPosition(144*cc.winSize.screenScale,player1.y);this.sceneLayer.addChild(player5,
1);this.playerView=[playerMe,player1,player2,player3,player4,player5];for(var i=1;i<this.playerView.length;i++){var cardList=new BaCayCardList(cc.size(240,100));cardList.setPosition(this.playerView[i].avt.x,30);cardList.setScale(.6);cardList.setTouchEnable(false);this.playerView[i].infoLayer.addChild(cardList,2);this.playerView[i].cardList=cardList;var resultLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_25,"",cc.TEXT_ALIGNMENT_LEFT);resultLabel.setColor(cc.color("#8e9bff"));resultLabel.setAnchorPoint(cc.p(1,
.5));resultLabel.setPosition(this.playerView[i].avt.x-45,this.playerView[i].avt.y);if(i==4||i==5){resultLabel.setAlignment(cc.TEXT_ALIGNMENT_RIGHT);resultLabel.setAnchorPoint(cc.p(0,.5));resultLabel.setPosition(this.playerView[i].avt.x+45,this.playerView[i].avt.y)}this.playerView[i].infoLayer.addChild(resultLabel);this.playerView[i].resultLabel=resultLabel;this.playerView[i].assetChangePos=cc.p(this.playerView[i].avt.x,this.playerView[i].avt.y-30)}},initButton:function(){var thiz=this;var revealBt=
new ccui.Button("game-lathetBt.png","","",ccui.Widget.PLIST_TEXTURE);revealBt.setPosition(cc.winSize.width-420*cc.winSize.screenScale,46);this.sceneLayer.addChild(revealBt);this.revealBt=revealBt;this.setRevealBtVisible(false);this.revealBt.addClickEventListener(function(){thiz.onRevealBtClick()})},playResultSound:function(winner){SoundPlayer.playSound(winner==PlayerMe.username?"winning":"losing")},onRevealBtClick:function(){this._controller.sendRevealCard()},showTimeRemaining:function(timeRemaining){if(timeRemaining>
0){this.timeRemaining=timeRemaining;if(this.timeInterval)clearInterval(this.timeInterval);var thiz=this;thiz.timeLabel.setString(timeRemaining);thiz.timeRemaining--;this.timeInterval=setInterval(function(){if(thiz.timeRemaining<=0){thiz.timeLabel.setString("");clearInterval(thiz.timeInterval)}else{thiz.timeLabel.setString(thiz.timeRemaining);thiz.timeRemaining--}},1E3)}else{this.timeRemaining=0;this.timeLabel.setString("")}},performAssetChange:function(amount,goldAfter,username){var slot=this.getSlotByUsername(username);
var changeLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_25,"");changeLabel.setString(amount>0?"+"+amount:amount);changeLabel.setColor(cc.color(amount>0?"#ffde00":"#c52829"));changeLabel.setPosition(slot.assetChangePos);slot.addChild(changeLabel);slot.setGold(goldAfter);var moveAction=new cc.MoveTo(1,slot.assetChangePos.x,slot.assetChangePos.y+50);var removeAction=new cc.CallFunc(function(){changeLabel.removeFromParent(true)});changeLabel.runAction(new cc.Sequence(moveAction,removeAction))},
revealCards:function(cards,username){var slot=this.getSlotByUsername(username);if(slot.revealed)return;slot.cardList.revealAll(username==PlayerMe.username?null:cards);slot.revealed=true},setResultString:function(str,usr){var slot=this.getSlotByUsername(usr);slot.resultLabel.setString(str)},setRevealBtVisible:function(isVisible){this.revealBt.visible=isVisible},initController:function(){this._controller=new BaCayController(this)},dealCard:function(cards){var cardArray=[];for(var i=0;i<cards.length;i++)cardArray.push(CardList.prototype.getCardWithId(cards[i]));
this.playerView[0].cardList.dealCards(cardArray,true);for(var j=1;j<this.playerView.length;j++)if(this.playerView[j].username!="")this.playerView[j].cardList.dealCards(cardArray,true)},reappearCard:function(cards){for(var j=0;j<this.playerView.length;j++)if(this.playerView[j].username!=""){for(var i=0;i<cards.length;i++){var card=CardList.prototype.getCardWithId(cards[i]);var cardObject=new Card(card.rank,card.suit);cardObject.setSpriteFrame("gp_card_up.png");this.playerView[j].cardList.addCard(cardObject)}this.playerView[j].cardList.reOrderWithoutAnimation()}},
resetBoard:function(){for(var i=0;i<this.playerView.length;i++){this.playerView[i].cardList.removeAll();this.playerView[i].resultLabel.setString("");this.playerView[i].revealed=false}},setStateString:function(str){this.stateString.setString(str)},creatCardListForOther:function(cards){for(var j=0;j<this.playerView.length;j++)if(this.playerView[j].username!=PlayerMe.username){for(var i=0;i<cards.length;i++){var card=CardList.prototype.getCardWithId(cards[i]);var cardObject=new Card(card.rank,card.suit);
cardObject.setSpriteFrame("gp_card_up.png");this.playerView[j].cardList.addCard(cardObject)}this.playerView[j].cardList.reOrderWithoutAnimation()}},showJackpot:function(nameNo,money){if(PlayerMe.username!=nameNo)return;var textNo="Ch\u00fac m\u1eebng "+nameNo+" n\u1ed5 h\u0169 \n "+cc.Global.NumberFormat1(parseInt(money));var lblText=new cc.LabelTTF(textNo,cc.res.font.Roboto_CondensedBold,45,500,cc.TEXT_ALIGNMENT_CENTER);lblText.setColor(cc.color(255,245,91,255));lblText.enableStroke(cc.color(223,
28,42,255),3);lblText.setPosition(cc.winSize.width/2,cc.winSize.height/2+50);lblText.setVisible(false);this.addChild(lblText);var thiz=this;this.runAction(new cc.Sequence(new cc.DelayTime(1.5),new cc.CallFunc(function(){lblText.setVisible(true);var layer=new JackpotLayer;layer.show()}),new cc.DelayTime(4),new cc.CallFunc(function(){lblText.removeFromParent(true)})))}});MB_CHI_DAU=0;MB_CHI_GIUA=1;MB_CHI_CUOI=2;s_sfs_error_msg[212]="Kh\u00f4ng ph\u1ea3i l\u01b0\u1ee3t x\u1ebfp b\u00e0i";var MB_CARD_MAUBINH=MB_CARD_MAUBINH||[8,12,16,20,24,28,32,36,40,44,48,0,4,9,13,17,21,25,29,33,37,41,45,49,1,5,10,14,18,22,26,30,34,38,42,46,50,2,6,11,15,19,23,27,31,35,39,43,47,51,3,7];
var TimeOutMB=cc.Node.extend({ctor:function(){this._super();var bg=new cc.Sprite("#xocdia_timer_2.png");bg.setColor(cc.color(0,0,0,255));this.setContentSize(cc.size(800,800));bg.setPosition(this.getContentSize().width/2,this.getContentSize().height/2);this.addChild(bg);this.setAnchorPoint(cc.p(.5,.5));var timer=new cc.ProgressTimer(new cc.Sprite("#xocdia_timer_2.png"));timer.setColor(cc.color(255,201,15,255));timer.setType(cc.ProgressTimer.TYPE_RADIAL);timer.setPosition(bg.getPosition());timer.setPercentage(0);
this.addChild(timer);this.timer=timer;var lbl=new cc.LabelTTF("",cc.res.font.Roboto_CondensedBold,50);lbl.setPosition(bg.getPosition());this.addChild(lbl);this.lblTime=lbl;this._timeCount=0;this.isAlert=false;this.setVisible(false)},update:function(dt){this._timeCount-=dt;if(this._timeCount<0)this.stop();else{this.lblTime.setString(Math.floor(this._timeCount));if(this._timeCount<=5&&this.isAlert){this.isAlert=false;this.lblTime.stopAllActions();this.timer.setColor(cc.color(255,0,0,255));this.lblTime.setColor(cc.color(255,
0,0,255));this.lblTime.runAction(new cc.RepeatForever(new cc.Sequence(new cc.FadeTo(.2,50),new cc.FadeTo(.2,255))))}}},startCoutDown:function(timeRemain,timeMax){this.lblTime.setOpacity(255);this.lblTime.setColor(cc.color(255,255,255,255));this.timer.setColor(cc.color(255,201,15,255));if(timeMax==0)return;this.isAlert=true;this._timeCount=timeRemain;this.scheduleUpdate();this.setVisible(true);var thiz=this;this.lblTime.stopAllActions();this.timer.setPercentage(timeRemain*100/timeMax);this.timer.runAction(new cc.ProgressTo(timeRemain,
0))},stop:function(){this.isAlert=false;this.unscheduleUpdate();this.stopAllActions();this.setVisible(false);this.lblTime.stopAllActions()}});
var MauBinhCard=Card.extend({setSelected:null,isSelected:null,onTouchEnded:function(touch,event){this.isTouched=false;if(this.isMoved){this.getParent().performSwapCardInPoint(this,touch.getLocation());this.moveToOriginPosition();this.getParent().reorderChild(this,this.cardIndex)}else;},onTouchBegan:function(touch,event){cc.log("onTouchBegan");if(!this.getParent().getParent().isVisible())return false;if(this.canTouch&&!this.isTouched){var p=this.convertToNodeSpace(touch.getLocation());if(cc.rectContainsPoint(this.touchRect,
p)){this.isTouched=true;this.isMoved=false;this.preTouchPoint=touch.getLocation();return true}}return false},onTouchMoved:function(touch,event){var p=touch.getLocation();if(!this.isMoved)if(cc.pDistance(this.preTouchPoint,p)<5)return;else{this.getParent().reorderChild(this,200);this.isMoved=true}this.x+=(p.x-this.preTouchPoint.x)/1.3;this.y+=(p.y-this.preTouchPoint.y)/1.3;this.preTouchPoint=p}});
var ListChiMB=cc.Node.extend({ctor:function(pos){this._super();this.setContentSize(90*5,115*3);this.cardList=[];this.setPosition(pos);this.resultLabels=[]},getCardsId:function(){var result=[];for(var i=0;i<this.cardList.length;i++)result.push(CardList.prototype.getCardIdWithRank(this.cardList[i].rank,this.cardList[i].suit));return result},removeAll:function(){this.removeAllChildren(true);this.cardList=[]},onEnter:function(){this._super();this.deckPoint=this.convertToNodeSpace(cc.p(cc.winSize.width/
2,cc.winSize.height/2))},addCard:function(card,index){if(this.deckPoint)card.setPosition(this.deckPoint);this.addChild(card,index)},dealCards:function(cards,isMe,animation){this.removeAll();var rows=[];if(cards&&cards.length==13)for(var i=0;i<3;i++)rows.push(cards.slice(i*5,i*5+5));var index=0;var dx=50;var dy=80;for(var i=0;i<rows.length;i++){var basex=0-(rows[i].length-1)/2*dx;var basey=dy*(i-1);var lengt=rows[i].length;for(var j=0;j<rows[i].length;j++){var cardObj=new MauBinhCard(rows[i][j].rank,
rows[i][j].suit);cardObj.cardIndex=index;cardObj.origin=cc.p(basex+j*dx,basey);cardObj.origin.y-=Math.abs(j-Math.floor(lengt/2))*(8+(Math.abs(j-Math.floor(lengt/2))-1)*8);cardObj.cardDistance=dx;cardObj.canTouch=false;var conerRotate=(j-Math.floor(lengt/2))*15;cardObj.setRotation(conerRotate);if(!isMe)cardObj.setSpriteFrame("gp_card_up.png");this.cardList.push(cardObj);this.addCard(cardObj,3-i);if(animation){cardObj.visible=false;var delayAction=new cc.DelayTime(.02*index);var beforeAction=new cc.CallFunc(function(target){target.visible=
true},cardObj);var moveAction=new cc.MoveTo(.2,cardObj.origin);var soundAction=new cc.CallFunc(function(){if(isMe)SoundPlayer.playSound("chia_bai")});cardObj.runAction(new cc.Sequence(delayAction,soundAction,beforeAction,moveAction))}else cardObj.setPosition(cardObj.origin);index++}}},setNameChi:function(chi,name,isWin){this.removeChildByTag(1234);if(name=="")return;var bg_name=new cc.Sprite("#mb_bg_text1.png");bg_name.setScale(1.3);bg_name.setPosition(0,-160+80*chi);bg_name.setTag(1234);this.addChild(bg_name,
1234);var nameChi=new cc.LabelTTF(name,cc.res.font.Roboto_Condensed,25);if(isWin)nameChi.setColor(cc.color(80,41,3,255));else{nameChi.setColor(cc.color(142,155,255,255));bg_name.setSpriteFrame("mb_bg_text2.png")}nameChi.setPosition(bg_name.getContentSize().width/2,bg_name.getContentSize().height/2);bg_name.addChild(nameChi)},setAgainOder:function(){this.removeChildByTag(1234);var zLocal1=3;var zLocal2=2;var zLocal3=1;for(var i=0;i<this.cardList.length;i++)if(i<5)this.cardList[i].setLocalZOrder(zLocal1);
else if(i<10)this.cardList[i].setLocalZOrder(zLocal2);else this.cardList[i].setLocalZOrder(zLocal3)},removeText:function(){this.removeChildByTag(1234)},latChi:function(chi,arrCard,isReconnect,typeChi,isWin){var cardArray=[];for(var i=0;i<arrCard.length;i++)cardArray.push(CardList.prototype.getCardWithId(arrCard[i]));if(this.cardList.length==13){var thiz=this;if(typeChi!=0)this.setNameChi(chi,maubinh_chitypes[typeChi],isWin);var zLocal1=3;var zLocal2=2;var zLocal3=1;if(chi==MB_CHI_GIUA){zLocal1=2;
zLocal2=3}else if(chi==MB_CHI_CUOI){zLocal1=2;zLocal2=1;zLocal3=3}for(var i=0;i<this.cardList.length;i++)if(i<5)this.cardList[i].setLocalZOrder(zLocal1);else if(i<10)this.cardList[i].setLocalZOrder(zLocal2);else this.cardList[i].setLocalZOrder(zLocal3);for(var i=0;i<cardArray.length;i++)(function(){var card=thiz.cardList[chi*5+i];card.stopAllActions();var orgScale=card.getScale();var nameCard=cardArray[i].rank+s_card_suit[cardArray[i].suit]+".png";if(isReconnect){var changeFrame=new cc.CallFunc(function(){card.setSpriteFrame(nameCard)});
var scale1=new cc.ScaleTo(.2,0,orgScale);var scale2=new cc.ScaleTo(.2,orgScale,orgScale);card.runAction(new cc.Sequence(scale1,changeFrame,scale2))}else card.setSpriteFrame(nameCard)})()}},latAll:function(arrCard,isReconnect,typeChi,isWin){var cardArray=[];for(var i=0;i<arrCard.length;i++)cardArray.push(CardList.prototype.getCardWithId(arrCard[i]));if(this.cardList.length==13){var thiz=this;if(typeChi!=0)this.setNameChi(MB_CHI_DAU,maubinh_wintypes[typeChi],isWin);for(var i=0;i<cardArray.length;i++)(function(){var card=
thiz.cardList[i];card.stopAllActions();var orgScale=card.getScale();var nameCard=cardArray[i].rank+s_card_suit[cardArray[i].suit]+".png";if(isReconnect){var changeFrame=new cc.CallFunc(function(){card.setSpriteFrame(nameCard)});var scale1=new cc.ScaleTo(.2,0,orgScale);var scale2=new cc.ScaleTo(.2,orgScale,orgScale);card.runAction(new cc.Sequence(scale1,changeFrame,scale2))}else card.setSpriteFrame(nameCard)})()}}});
var MauBinhCardList=cc.Node.extend({ctor:function(pos,displayResultRight){this._super();this.setContentSize(90*5,200*3);this.cardList=[];this.setPosition(pos);this.displayResultRight=displayResultRight;this.resultLabels=[]},swapCardLeft:function(index){},swapCardRight:function(index){},addCard:function(card){if(this.deckPoint)card.setPosition(this.deckPoint);this.addChild(card)},dealCards:function(cards,isMe,animation){this.removeAll();if(isMe)this.setScale(1.3);var rows=[];if(cards&&cards.length==
13)for(var i=0;i<3;i++)rows.push(cards.slice(i*5,i*5+5));var index=0;var dx=95;var dy=125;for(var i=0;i<rows.length;i++){var basex=0-(rows[i].length-1)/2*dx;var basey=dy*(i-1);var dnew=i==2?dx:0;for(var j=0;j<rows[i].length;j++){var cardObj=new MauBinhCard(rows[i][j].rank,rows[i][j].suit);cardObj.cardIndex=index;cardObj.origin=cc.p(basex+j*dx-dnew,basey);cardObj.cardDistance=dx;cardObj.canTouch=isMe;if(!isMe)cardObj.setSpriteFrame("gp_card_up.png");this.cardList.push(cardObj);this.addCard(cardObj);
if(animation){cardObj.visible=false;var delayAction=new cc.DelayTime(.02*index);var beforeAction=new cc.CallFunc(function(target){target.visible=true},cardObj);var moveAction=new cc.MoveTo(.2,cardObj.origin);var soundAction=new cc.CallFunc(function(){if(isMe)SoundPlayer.playSound("chia_bai")});cardObj.runAction(new cc.Sequence(delayAction,soundAction,beforeAction,moveAction))}else cardObj.setPosition(cardObj.origin);index++}}},onEnter:function(){this._super();this.deckPoint=this.convertToNodeSpace(cc.p(cc.winSize.width/
2,cc.winSize.height/2))},getCardsId:function(){var result=[];for(var i=0;i<this.cardList.length;i++)result.push(CardList.prototype.getCardIdWithRank(this.cardList[i].rank,this.cardList[i].suit));return result},removeAll:function(){this.removeAllChildren(true);this.cardList=[];this.resultLabels=[]},showResultChi:function(index,nameChi,duration){if(this.resultLabels[index]){this.resultLabels[index].removeFromParent(true);this.resultLabels[index]=undefined}var resultLabel=new cc.LabelBMFont(nameChi,
cc.res.font.Roboto_CondensedBold_30);resultLabel.setAnchorPoint(1,.5);resultLabel.setColor(cc.color(255,238,92,255));resultLabel.setPosition(this.displayResultRight?500:-250,(index-1)*115);this.addChild(resultLabel);if(duration){var delayAction=new cc.DelayTime(duration);var removeAction=new cc.CallFunc(function(target){target.removeFromParent(true)},resultLabel);resultLabel.runAction(new cc.Sequence(delayAction,removeAction))}else this.resultLabels[index]=resultLabel},showThangTrang:function(winType,
duration){var thangTrangLabel=new cc.LabelBMFont(maubinh_wintypes[winType],cc.res.font.Roboto_CondensedBold_40);thangTrangLabel.setScale(2);thangTrangLabel.setColor(cc.color("#ff0000"));this.addChild(thangTrangLabel,420);if(duration){var delayAction=new cc.DelayTime(duration);var removeAction=new cc.CallFunc(function(target){target.removeFromParent(true)},thangTrangLabel)}},swapCard:function(card1,card2){var _origin=card1.origin;var _cardIndex=card1.cardIndex;card1.origin=card2.origin;card1.cardIndex=
card2.cardIndex;card2.origin=_origin;card2.cardIndex=_cardIndex;card2.moveToOriginPosition();this.cardList[card1.cardIndex]=card1;this.cardList[card2.cardIndex]=card2},performSwapCardInPoint:function(card,touchPoint){for(var i=0;i<this.cardList.length;i++){var destCard=this.cardList[i];if(cc.rectContainsPoint(destCard.touchRect,destCard.convertToNodeSpace(touchPoint))){if(destCard===card)continue;this.swapCard(card,destCard);break}}cc.director.getRunningScene().OnSwapPhom()},revealCards:function(cardArray){for(var i=
0;i<this.cardList.length;i++){var card=cardArray[i];if(!this.cardList[i]){cc.log("Clgv deo hieu sao");continue}this.cardList[i].setSpriteFrame(""+card.rank+s_card_suit[card.suit]+".png")}},setArrangeEnable:function(enabled){this.setScale(enabled?1:.8);this.setPositionY(enabled?200:150);for(var i=0;i<this.cardList.length;i++){this.cardList[i].canTouch=enabled;this.cardList[i].setOpacity(enabled?255:200)}for(var j=0;j<3;j++)if(this.resultLabels[i])this.resultLabels[i].setScale(1/this.getScale())}});
var MauBinh=IGameScene.extend({ctor:function(){this._super();var table_bg=new cc.Sprite("res/gp_table.png");table_bg.setPosition(cc.winSize.width/2,cc.winSize.height/2);table_bg.setScale(cc.winSize.screenScale);this.table_bg=table_bg;this.sceneLayer.addChild(table_bg);this.initScene();this.initPlayer();this.initButton();this.libMB=new LibMB},initScene:function(){var huThuongBg=new ccui.Button("bacayhuthuong_bg.png","","",ccui.Widget.PLIST_TEXTURE);huThuongBg.setScale9Enabled(true);huThuongBg.setCapInsets(cc.rect(15,
15,4,4));huThuongBg.setContentSize(cc.size(322,47));huThuongBg.addClickEventListener(function(){cc.log("1233");var huMau=new HistoryNoHu(true);huMau.show()});huThuongBg.setPosition(this.table_bg.getContentSize().width/2,100+30);this.table_bg.addChild(huThuongBg);var huThuongLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_25,"H\u0168 M\u1eacU BINH: ");huThuongLabel.setPosition(huThuongBg.x-75,huThuongBg.y);huThuongLabel.setColor(cc.color("#c1ceff"));this.table_bg.addChild(huThuongLabel);
var huThuongValueLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_25,"");huThuongValueLabel.setPosition(huThuongBg.x+60,huThuongBg.y);huThuongValueLabel.setColor(cc.color("#ffde00"));this.table_bg.addChild(huThuongValueLabel);this.huThuongValueLabel=huThuongValueLabel;var timeOutGame=new TimeOutMB;timeOutGame.setScale(.6);timeOutGame.setPosition(this.table_bg.getContentSize().width/2,this.table_bg.getContentSize().height/2+30);this.table_bg.addChild(timeOutGame);this.timeOutGame=timeOutGame;
this.isMeToiTrang=false},initLayerArrangement:function(){var nodeArrange=new cc.Node;nodeArrange.setContentSize(cc.size(1024,720));nodeArrange.setScale(cc.winSize.screenScale);var layerBlack=new cc.LayerColor(cc.color(0,0,0,150),1280,720);layerBlack.setScaleY(2*(1/cc.winSize.screenScale));nodeArrange.addChild(layerBlack);this.arrangeLayer=nodeArrange;this.addChild(nodeArrange);cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:true,onTouchBegan:function(touch,event){if(nodeArrange.visible)return true;
return false},onTouchEnded:function(touch,event){}},this);var listCardMe=new MauBinhCardList(cc.p(732-44,250));this.listCardMe=listCardMe;nodeArrange.addChild(listCardMe);nodeArrange.setVisible(false);var timeOutMe=new TimeOutMB;timeOutMe.setPosition(860,430);nodeArrange.addChild(timeOutMe);this.timeOutMe=timeOutMe},initPlayer:function(){var playerMe=new GamePlayer;playerMe.setPosition(this.table_bg.getContentSize().width/2-120,-110);playerMe.cardList=new ListChiMB(cc.p(240,140));playerMe.setPositionInfo(PL_POSITION_LEFT);
playerMe.cardList.setScale(.7);playerMe.infoLayer.addChild(playerMe.cardList,2);this.table_bg.addChild(playerMe,1);var player1=new GamePlayer;player1.setPosition(this.table_bg.getContentSize().width/2+500,this.table_bg.getContentSize().height/2);player1.cardList=new ListChiMB(cc.p(-80,150));player1.inviteBt.setPosition(player1.inviteBt.getPositionX()-30,player1.inviteBt.getPositionY());player1.setPositionInfo(PL_POSITION_BOTTOM);player1.cardList.setScale(.7);player1.infoLayer.addChild(player1.cardList,
2);this.table_bg.addChild(player1,1);var player2=new GamePlayer;player2.setPosition(this.table_bg.getContentSize().width/2-120,this.table_bg.getContentSize().height+25);player2.cardList=new ListChiMB(cc.p(240,100));player2.inviteBt.setPosition(player2.inviteBt.getPositionX()+110,player2.inviteBt.getPositionY());player2.setPositionInfo(PL_POSITION_LEFT);player2.cardList.setScale(.7);player2.infoLayer.addChild(player2.cardList,2);this.table_bg.addChild(player2,1);var player3=new GamePlayer;player3.setPosition(this.table_bg.getContentSize().width/
2-500,this.table_bg.getContentSize().height/2);player3.setPositionInfo(PL_POSITION_BOTTOM);player3.inviteBt.setPosition(player3.inviteBt.getPositionX()+30,player3.inviteBt.getPositionY());player3.cardList=new ListChiMB(cc.p(240,150));player3.cardList.setScale(.7);player3.cardList.displayResultRight=true;player3.infoLayer.addChild(player3.cardList,2);this.table_bg.addChild(player3,1);this.playerView=[playerMe,player1,player2,player3]},convertNew2Old:function(arrCard){var arrCardNew=[];for(var i=0;i<
arrCard.length;i++)arrCardNew.push(MB_CARD_MAUBINH[arrCard[i]]);return arrCardNew},convertOld2New:function(arrCard){var arrCardNew=[];for(var i=0;i<arrCard.length;i++)for(var j=0;j<52;j++)if(MB_CARD_MAUBINH[j]==arrCard[i]){arrCardNew.push(j);break}return arrCardNew},showNodeArrangement:function(isVisible){this.arrangeLayer.setVisible(isVisible);this.timeOutGame.setVisible(!isVisible);this.allSlot[0].setVisible(!isVisible)},OnSwapPhom:function(){cc.log("vai lon con chon");var cardIDMe=this.listCardMe.getCardsId();
this.refreshChiType(this.convertNew2Old(cardIDMe));if(!this.isMeToiTrang)this.nhanhBt.setVisible(true)},initButton:function(){var startBt=new ccui.Button("game-startBt.png","","",ccui.Widget.PLIST_TEXTURE);startBt.setScale(cc.winSize.screenScale);startBt.setPosition(cc.winSize.width-100*cc.winSize.screenScale,55);this.startBt=startBt;this.sceneLayer.addChild(startBt);this.initLayerArrangement();var xongBt=new ccui.Button("mb_btnXepXong.png","","",ccui.Widget.PLIST_TEXTURE);xongBt.setPosition(1170,
46);this.xongBt=xongBt;this.arrangeLayer.addChild(xongBt);var nhanhBt=new ccui.Button("mb_btnXepNhanh.png","","",ccui.Widget.PLIST_TEXTURE);nhanhBt.setPosition(1170,124);this.nhanhBt=nhanhBt;this.arrangeLayer.addChild(nhanhBt);var xepLaiBt=new ccui.Button("mb_btnXepLai.png","","",ccui.Widget.PLIST_TEXTURE);xepLaiBt.setScale(cc.winSize.screenScale);xepLaiBt.setPosition(cc.p(startBt.getPositionX(),startBt.getPositionY()+70));this.sceneLayer.addChild(xepLaiBt);this.xepLaiBt=xepLaiBt;var thiz=this;startBt.addClickEventListener(function(){thiz._controller.sendStartRequest()});
xongBt.addClickEventListener(function(){thiz.xepBaiXong()});xepLaiBt.addClickEventListener(function(){thiz._controller.sendXepBaiLai()});nhanhBt.addClickEventListener(function(){thiz.xepNhanh()});this.allButtons=[xepLaiBt,xongBt,startBt];this.hideAllButton()},initController:function(){this._controller=new MauBinhController(this)},refreshChiType:function(cardIDMe){var arr1=cardIDMe.slice(0,5);var arr2=cardIDMe.slice(5,10);var arr3=cardIDMe.slice(10,13);var arrName=this.libMB.setBinhLung(arr1,arr2,
arr3);for(var i=0;i<3;i++)this.listCardMe.showResultChi(i,arrName[i])},xepBaiXong:function(){var cards=[];this.showNodeArrangement(false);var cardArray=[];var cardIDMe=this.listCardMe.getCardsId();for(var i=0;i<cardIDMe.length;i++)cardArray.push(CardList.prototype.getCardWithId(cardIDMe[i]));this.allSlot[0].cardList.dealCards(cardArray,true,false);this._controller.sendXepBaiXong(cardIDMe)},xepNhanh:function(){var libMb=new LibMB;var cardIDMe=libMb.autoSapXep(this.convertNew2Old(this.listCardMe.getCardsId()));
var arrLung=cardIDMe.slice(0,cardIDMe.length);var carNew=this.convertOld2New(cardIDMe);var cardArray=[];for(var i=0;i<carNew.length;i++)cardArray.push(CardList.prototype.getCardWithId(carNew[i]));this.listCardMe.removeAll();this.listCardMe.dealCards(cardArray,true,false);this.refreshChiType(arrLung)},setIngameButtonVisible:function(visible){this.xongBt.visible=visible},setStartBtVisible:function(visible){cc.log("aaaaaa\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d");this.startBt.visible=visible},showTimeRemaining:function(timeRemaining){this.timeOutMe.startCoutDown(timeRemaining,
timeRemaining);this.timeOutGame.startCoutDown(timeRemaining,timeRemaining)},onTimeOut:function(){this.showNodeArrangement(false);this.timeOutMe.stop();this.timeOutGame.stop();for(var i=0;i<this.allSlot.length;i++)this.allSlot[i].stopAllActions()},performDealCards:function(cards,animation,typeTrang){var thiz=this;if(this.cleanTimeout){clearTimeout(this.cleanTimeout);this.cleanTimeout=null}var cardArray=[];for(var i=0;i<cards.length;i++)cardArray.push(CardList.prototype.getCardWithId(cards[i]));this.listCardMe.dealCards(cardArray,
true,false);for(var j=0;j<this.playerView.length;j++)if(this.playerView[j].username!=""&&!this.playerView[j].spectator){this.playerView[j].cardList.dealCards(cardArray,j==0,animation);if(j!=0)this.playerView[j].cardList.setNameChi(MB_CHI_DAU,"\u0110ang x\u1ebfp",false)}if(typeTrang<7){var cardIDMe=this.convertNew2Old(this.listCardMe.getCardsId());this.refreshChiType(cardIDMe);thiz.nhanhBt.setVisible(true);this.isMeToiTrang=false}else{this.isMeToiTrang=true;thiz.nhanhBt.setVisible(false)}if(typeTrang!=
0)thiz.listCardMe.showResultChi(MB_CHI_GIUA,maubinh_wintypes[typeTrang]);if(typeTrang>6)this.allSlot[0].cardList.setNameChi(MB_CHI_DAU,maubinh_wintypes[typeTrang],true);if(animation&&typeTrang<7){var action=new cc.Sequence(new cc.DelayTime(.5),new cc.CallFunc(function(){thiz.showNodeArrangement(true)}));action.setTag(109);this.runAction(action)}},dealCardWhenJoin:function(cards,animation,typeTrang){var thiz=this;var cardArray=[];for(var i=0;i<cards.length;i++)cardArray.push(CardList.prototype.getCardWithId(cards[i]));
for(var j=0;j<this.playerView.length;j++)if(this.playerView[j].username!=""&&!this.playerView[j].spectator){this.playerView[j].cardList.dealCards(cardArray,j==0,animation);if(j!=0)this.playerView[j].cardList.setNameChi(MB_CHI_DAU,"\u0110ang x\u1ebfp",false)}},hideAllButton:function(){this.allButtons.forEach(function(item,index){item.setVisible(false)})},onUserXepBaiStatus:function(username,isDone){if(isDone)if(username==PlayerMe.username){this.xepLaiBt.setVisible(true);this.showNodeArrangement(false)}else{var slot=
this.getSlotByUsername(username);if(slot)slot.cardList.setNameChi(MB_CHI_DAU,"X\u1ebfp xong",true)}else if(username==PlayerMe.username){this.xepLaiBt.setVisible(false);this.showNodeArrangement(true)}else{var slot=this.getSlotByUsername(username);if(slot)slot.cardList.setNameChi(MB_CHI_DAU,"\u0110ang x\u1ebfp",false)}},showJackpot:function(nameNo,money){var name=nameNo;if(name.length>15)name=name.substring(0,15);if(name.length>3&&name!=PlayerMe.username)name=name.substring(0,name.length-3)+"***";var textNo=
"Ch\u00fac m\u1eebng "+name+" n\u1ed5 h\u0169: "+cc.Global.NumberFormat1(parseInt(money)+"V");var lblText=new cc.LabelTTF(textNo,cc.res.font.Roboto_CondensedBold,45);lblText.setColor(cc.color(255,245,91,255));lblText.enableStroke(cc.color(223,28,42,255),3);lblText.setPosition(cc.winSize.width/2,cc.winSize.height/2+50);lblText.setVisible(false);this.addChild(lblText);var thiz=this;this.runAction(new cc.Sequence(new cc.DelayTime(1.5),new cc.CallFunc(function(){lblText.setVisible(true);var layer=new JackpotLayer;
layer.show()}),new cc.DelayTime(5),new cc.CallFunc(function(){lblText.removeFromParent(true)})));if(nameNo==PlayerMe.username)this.showNodeArrangement(false)},performAnnounce:function(username,announceStr){},performLatBaiSpecial:function(username,arrCard,rankChi,exMoney,isReconnect){var thiz=this;var slot=thiz.getSlotByUsername(username);if(slot){var isWin=parseInt(exMoney)>0?true:false;slot.cardList.latAll(arrCard,isReconnect,rankChi,isWin);slot.cardList.removeText();if(exMoney!="0")thiz.showMoneyChange(slot.getPosition(),
exMoney,isReconnect);if(rankChi>1)slot.cardList.setNameChi(MB_CHI_DAU,maubinh_wintypes[rankChi],isWin)}},performPhase5:function(username,rankChi,exMoney,isReconnect){var thiz=this;var slot=thiz.getSlotByUsername(username);if(slot){var isWin=parseInt(exMoney)>0?true:false;slot.cardList.setNameChi(MB_CHI_DAU,maubinh_wintypes[rankChi],isWin);thiz.showMoneyChange(slot.getPosition(),exMoney,isReconnect)}},performSoChi:function(username,index,rankChi,exMoney,cardArray,moneyPlayer,txtSap,isReconnect){cc.log("\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d"+
username);var thiz=this;var slot=thiz.getSlotByUsername(username);if(slot){if(moneyPlayer)slot.setGold(moneyPlayer);var iswin=parseInt(exMoney)>0?true:false;slot.cardList.latChi(index,cardArray,isReconnect,rankChi,iswin);thiz.showMoneyChange(slot.getPosition(),exMoney,isReconnect);if(txtSap!=""&&index==2)this.runAction(new cc.Sequence(new cc.DelayTime(3),new cc.CallFunc(function(){thiz.showSap3Chi(cc.p(slot.getPosition().x,slot.getPosition().y-100),isReconnect)})))}},performSummaryChange:function(username,
winType,exMoney,delay){var thiz=this;setTimeout(function(){cc.log("User "+username+"  "+maubinh_wintypes[winType]+"\nchangeGold : "+exMoney)},delay)},addResultEntry:function(username,winType,soChiWin,cards,newMoney,moneyChange){var thiz=this;var slot=thiz.getSlotByUsername(username);if(slot){thiz.showMoneyChange(slot.getPosition(),moneyChange,false);slot.cardList.setAgainOder();if(newMoney)slot.setGold(newMoney)}if(!this.resultEntries)this.resultEntries=[];this.resultEntries.push({username:username,
winType:winType,soChiWin:soChiWin,newMoney:newMoney,moneyChange:moneyChange,cards:cards})},performShowResult:function(delay){var thiz=this;setTimeout(function(){thiz.stopActionByTag(109);if(!thiz.resultEntries.length){cc.log("No result entry found");return}var dialog=new ResultDialog(thiz.resultEntries.length);for(var i=0;i<thiz.resultEntries.length;i++){var username=thiz.resultEntries[i].username;if(username.length>3&&username!=PlayerMe.username)username=username.substring(0,username.length-3)+"***";
dialog.userLabel[i].setString(username);var goldStr=thiz.resultEntries[i].moneyChange>=0?"+":"-";goldStr+=cc.Global.NumberFormat1(Math.abs(thiz.resultEntries[i].moneyChange))+" V";dialog.goldLabel[i].setString(goldStr);dialog.goldLabel[i].setColor(thiz.resultEntries[i].moneyChange>=0?cc.color("#ffde00"):cc.color("#ff0000"));var string1="";var sochi=thiz.resultEntries[i].soChiWin;if(sochi>0)string1="Th\u1eafng "+sochi+" chi";else if(sochi<0)string1="Thua "+-sochi+" chi";else if(sochi==0)string1="H\u00f2a";
if(thiz.resultEntries[i].winType>0)string1="";dialog.contentLabel[i].setString(string1+" "+maubinh_wintypes[thiz.resultEntries[i].winType]);for(var j=0;j<thiz.resultEntries[i].cards.length;j++){var cardData=CardList.prototype.getCardWithId(thiz.resultEntries[i].cards[j]);var card=new Card(cardData.rank,cardData.suit);dialog.cardList[i].addCard(card)}dialog.cardList[i].reOrderWithoutAnimation()}dialog.showWithAnimationMove();thiz.resultEntries=[]},delay)},cleanBoard:function(delay){var thiz=this;delay=
delay||1;this.cleanTimeout=setTimeout(function(){for(var i=0;i<thiz.playerView.length;i++)thiz.playerView[i].cardList.removeAll()},delay)},showMoneyChange:function(pos,amount,isReconnect){if(isReconnect)return;var lol=parseInt(amount);var changeSprite=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_30,"");var changeText=cc.Global.NumberFormat1(lol);changeSprite.setString(changeText);changeSprite.setColor(cc.color(amount>=0?"#ffde00":"#ff0000"));changeSprite.setPosition(pos);this.table_bg.addChild(changeSprite,
420);changeSprite.runAction(new cc.Sequence(new cc.MoveTo(1.5,cc.p(pos.x,pos.y+100)),new cc.DelayTime(3),new cc.CallFunc(function(){changeSprite.removeFromParent(true)})))},showSap3Chi:function(pos,isReconnect){if(isReconnect)return;var changeSprite=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_30,"");changeSprite.setString("S\u1eacP 3 CHI");changeSprite.setColor(cc.color("#ff0000"));changeSprite.setPosition(pos);this.table_bg.addChild(changeSprite,420);changeSprite.runAction(new cc.Sequence(new cc.MoveTo(1.5,
cc.p(pos.x,pos.y+200)),new cc.DelayTime(3),new cc.CallFunc(function(){changeSprite.removeFromParent(true)})))}});TYPE_SANH_NO_SANH=-1;TYPE_SANH_NORMAL=0;TYPE_SANH_HA=1;TYPE_SANH_THUONG=2;TYPE_BAOLANG=["R\u1ed3ng cu\u1ed1n","S\u1ea3nh r\u1ed3ng","13 l\u00e1 \u0111\u1ed3ng m\u00e0u","12 l\u00e1 \u0111\u1ed3ng m\u00e0u","5 \u0111\u00f4i 1 s\u00e1m","L\u1ee5c ph\u00e9 b\u00f4n","3 th\u00f9ng","3 s\u1ea3nh"];NAME_BINH=["S\u1ea3nh ch\u00faa","Th\u00f9ng ph\u00e1 s\u1ea3nh ","Th\u00f9ng ph\u00e1 s\u1ea3nh","T\u1ee9 qu\u00fd","C\u00f9 l\u0169","Th\u00f9ng","S\u1ea3nh","X\u00e1m chi","Th\u00fa","\u0110\u00f4i","M\u1ea7u th\u1ea7u"];
var LibMB=cc.Class.extend({convertNameToValue:function(nameCard){var rank=(parseInt(nameCard.substring(0,nameCard.length-1))-1)*4;var strSuit=nameCard.substring(nameCard.length-1,nameCard.length);var suit=0;if(strSuit=="t")suit=1;else if(strSuit=="r")suit=2;else if(strSuit=="c")suit=3;return rank+suit},convertToName:function(number){var du=number%4;chat="c";if(du==0)chat="b";else if(du==1)chat="t";else if(du==3)chat="c";else if(du==2)chat="r";rank=Math.floor(number/4)+1;return rank.toString()+chat},
checkIsColor:function(arrValue){var chat=arrValue[0]%4;for(var i=1;i<arrValue.length;i++)if(arrValue[i]%4!=chat)return false;return true},getRankSanh:function(numberPair){if(Math.floor(numberPair[0]/4)==0)return 100+numberPair[0];else return numberPair[numberPair.length-1]},getRankPair:function(numberPair){var sub=numberPair[0];if(sub[0]/4==0)return 100+sub[sub.length-1];else{var subCuoi=numberPair[numberPair.length-1];return subCuoi[subCuoi.length-1]}},checkLungThung:function(arr1,arr2){arr1.sort(function(a,
b){if(Math.floor(a/4)==0||Math.floor(b/4)==0)return a-b;return b-a});arr2.sort(function(a,b){if(Math.floor(a/4)==0||Math.floor(b/4)==0)return a-b;return b-a});for(var i=0;i<arr2.length;i++){var rank2=Math.floor(arr2[i]/4);if(rank2==0)rank2=100;var rank1=Math.floor(arr1[i]/4);if(rank1==0)rank1=100;if(rank2>rank1)return true;else if(rank2<rank1)return false}return false},setBinhLung:function(arr1,arr2,arr3){var nameChiDau=this.caculateBinh(arr1);var nameChiGiua=this.caculateBinh(arr2);var nameChiCuoi=
this.caculateBinh(arr3);var isBinhLung=false;if(nameChiDau.type_chi>nameChiGiua.type_chi||nameChiGiua.type_chi>nameChiCuoi.type_chi)isBinhLung=true;if(nameChiDau.type_chi==nameChiGiua.type_chi){if(nameChiDau.type_chi==8||nameChiDau.type_chi==9)isBinhLung=this.checkLungDoi_Thu(arr1,arr2);if(nameChiDau.type_chi==5)isBinhLung=this.checkLungThung(arr1,arr2);if(nameChiDau.rank_chi<nameChiGiua.rank_chi&&nameChiDau.type_chi!=6)isBinhLung=true;if(nameChiDau.type_chi==6&&nameChiGiua.type_chi==6&&nameChiDau.rank_chi<
nameChiGiua.rank_chi)isBinhLung=true}if(!isBinhLung)if(nameChiGiua.type_chi==nameChiCuoi.type_chi){if(nameChiGiua.type_chi==9)isBinhLung=this.checkLungDoi_Thu(arr2,arr3);if(nameChiGiua.rank_chi<nameChiCuoi.rank_chi)isBinhLung=true}if(isBinhLung)return["","Binh L\u1ee7ng",""];else{if(nameChiDau.type_chi==nameChiGiua.type_chi)if(nameChiDau.type_chi==5){var isColor=this.checkIsColor(arr3);if(isColor)return["","3 "+NAME_BINH[nameChiGiua.type_chi],""]}else if(nameChiDau.type_chi==6){var isSanh=this.checkSanhChiCuoi(arr3);
if(isSanh)return["","3 "+NAME_BINH[nameChiGiua.type_chi],""]}return[NAME_BINH[nameChiDau.type_chi],NAME_BINH[nameChiGiua.type_chi],NAME_BINH[nameChiCuoi.type_chi]]}},checkLungDoi_Thu:function(arr1,arr2){arr1.sort(function(a,b){if(Math.floor(a/4)==0||Math.floor(b/4)==0)return a-b;return b-a});arr2.sort(function(a,b){if(Math.floor(a/4)==0||Math.floor(b/4)==0)return a-b;return b-a});var pair1=this.findNumBerpair32(arr1);var pair2=this.findNumBerpair32(arr2);for(var i=0;i<pair2.length;i++){var rank2=
pair2[i][0];if(Math.floor(rank2/4)==0)rank2=100;var rank1=pair1[i][0];if(Math.floor(rank1/4)==0)rank1=100;if(rank2>rank1)return true;else if(rank2<rank1)return false}return false},caculateBinh:function(arrValue){arrValue.sort(function(a,b){return a-b});var chi_maubinh={type_chi:-1,rank_chi:-1,name_chi:""};var isColor=this.checkIsColor(arrValue);if(isColor&&arrValue.length==5){var typeThungPhaSanh=this.findThungPhaSanh(arrValue);var rankSanh=this.getRankSanh(arrValue);if(typeThungPhaSanh==2){chi_maubinh.type_chi=
0;chi_maubinh.rank_chi=arrValue[0];return chi_maubinh}else if(typeThungPhaSanh==1){chi_maubinh.type_chi=2;chi_maubinh.rank_chi=arrValue[arrValue.length-1];return chi_maubinh}else if(typeThungPhaSanh==0){chi_maubinh.type_chi=2;chi_maubinh.rank_chi=arrValue[arrValue.length-1];return chi_maubinh}}var numberPair=this.findNumBerpair(arrValue);var rankPair=0;if(numberPair.length>0)rankPair=this.getRankPair(numberPair);if(numberPair.length==1&&numberPair[0].length==4){chi_maubinh.type_chi=3;if(Math.floor(numberPair[0][0]/
4)==0)chi_maubinh.rank_chi=100;else chi_maubinh.rank_chi=numberPair[0][0];return chi_maubinh}if(numberPair.length==2&&numberPair[0].length+numberPair[1].length==5){chi_maubinh.type_chi=4;if(numberPair[0].length==2){var rank=numberPair[1][2];if(Math.floor(rank/4)==0)rank=100;chi_maubinh.rank_chi=rank}else{var rank=numberPair[0][2];if(Math.floor(rank/4)==0)rank=100;chi_maubinh.rank_chi=rank}return chi_maubinh}if(isColor&&arrValue.length==5){chi_maubinh.type_chi=5;var rankSanh=0;chi_maubinh.rank_chi=
rankSanh;return chi_maubinh}if(!isColor&&arrValue.length==5){var typeThungPhaSanh=this.findThungPhaSanh(arrValue);if(typeThungPhaSanh>-1){chi_maubinh.type_chi=6;if(typeThungPhaSanh==2)chi_maubinh.rank_chi=100;else chi_maubinh.rank_chi=arrValue[arrValue.length-1];return chi_maubinh}}if(numberPair.length==1&&numberPair[0].length==3){chi_maubinh.type_chi=7;chi_maubinh.rank_chi=rankPair;return chi_maubinh}if(numberPair.length==2&&numberPair[0].length+numberPair[1].length==4){chi_maubinh.type_chi=8;chi_maubinh.rank_chi=
0;return chi_maubinh}if(numberPair.length==1&&numberPair[0].length==2){chi_maubinh.type_chi=9;chi_maubinh.rank_chi=0;return chi_maubinh}chi_maubinh.type_chi=10;chi_maubinh.rank_chi=this.getRankSanh(arrValue);return chi_maubinh},findNumBerpair:function(arrValue){var resulft=[];var item=Math.floor(arrValue[0]/4);var indexItemNext=0;var isFinish=true;while(isFinish){var sub=[];for(var i=indexItemNext;i<arrValue.length;i++){var iNew=i;if(Math.floor(arrValue[iNew]/4)==item){sub.push(arrValue[iNew]);if(iNew==
arrValue.length-1)isFinish=false}else{item=Math.floor(arrValue[iNew]/4);indexItemNext=iNew;break}}if(sub.length>1)resulft.push(sub)}return resulft},findNumBerpair3:function(arrValue){var resulft=[];var item=Math.floor(arrValue[0]/4);var indexItemNext=0;var isFinish=true;while(isFinish){var sub=[];for(var i=indexItemNext;i<arrValue.length;i++){var iNew=i;if(Math.floor(arrValue[iNew]/4)==item){sub.push(arrValue[iNew]);if(i==arrValue.length-1)isFinish=false}else{item=Math.floor(arrValue[iNew]/4);indexItemNext=
i;break}}resulft.push(sub)}return resulft},findNumBerpair32:function(arrValue){var resulft=[];var item=Math.floor(arrValue[0]/4);var indexItemNext=0;var isFinish=true;while(isFinish){var sub=[];for(var i=indexItemNext;i<arrValue.length;i++){var iNew=i;if(Math.floor(arrValue[iNew]/4)==item){sub.push(arrValue[iNew]);if(i==arrValue.length-1)isFinish=false}else{item=Math.floor(arrValue[iNew]/4);indexItemNext=i;break}}if(sub.length>1)resulft.push(sub)}return resulft},getarrColor:function(arrValue){var resulft=
[];for(var i=0;i<4;i++){var sub=[];for(var j=0;j<arrValue.length;j++)if(arrValue[j]%4==i)sub.push(arrValue[j]);if(sub.length>1)resulft.push(sub)}return resulft},findSanh13:function(arrValue,index,value){var resuft=[];var item=0;for(var i=index;i<arrValue.length;i++)(function(){var inew=i;if(Math.floor(arrValue[inew]/4)!=value)return resuft;else{item++;resuft.push(arrValue[inew])}if(item==4)return resuft;value++})();if(item<4)return resuft;return resuft},logName:function(arrValue){for(var i=0;i<arrValue.length;i++)(function(){var number=
arrValue[i];var du=number%4;var chat="c";if(du==0)chat="b";else if(du==1)chat="t";else if(du==3)chat="c";else if(du==2)chat="r";var rank=Math.floor(number/4)+1;cc.log("card: "+rank+chat)})()},findSanh13Nomarl:function(arrValue){arrValue.sort(function(a,b){return b-a});var resuft=[];var item=0;var value=Math.floor(arrValue[0]/4);for(var i=0;i<arrValue.length;i++){if(Math.floor(arrValue[i]/4)!=value){resuft=[];value=Math.floor(arrValue[i]/4);item=1;resuft.push(arrValue[i])}else{item++;resuft.push(arrValue[i])}if(item==
5)return resuft;value--}if(item<4)return resuft;return resuft},indexCard10:function(arrValue){for(var i=0;i<arrValue.length;i++)if(Math.floor(arrValue[i]/4)==9)return i;return-1},getThungMax:function(thung1,thung2){var zz=thung1;for(var i=0;i<thung1.length;i++){var rank1=Math.floor(thung1[i]/4);if(rank1==0)rank1=100;var rank2=Math.floor(thung2[i]/4);if(rank2==0)rank2=100;if(rank2>rank1){zz=thung2;break}else if(rank2<rank1){zz=thung1;break}}return zz},findThungPhaSanh:function(arrValue){if(Math.floor(arrValue[0]/
4)==0){if(Math.floor(arrValue[1]/4)==9){var isSanh=this.findSanh(arrValue,2,10);if(isSanh)return 2}var isSanh=this.findSanh(arrValue,1,Math.floor(arrValue[0]/4)+1);if(isSanh)return 1}var isSanh=this.findSanh(arrValue,1,Math.floor(arrValue[0]/4)+1);if(isSanh)return 0;return-1},findSanh:function(arrValue,index,value){var isSanh=true;for(var i=index;i<arrValue.length;i++){if(Math.floor(arrValue[i]/4)!=value){isSanh=false;break}value++}return isSanh},findThungPhaSanh13:function(arrValue){var tem=[];var indexC10=
this.indexCard10(arrValue);if(Math.floor(arrValue[0]/4)==0&&indexC10>-1){var arrsanh=this.findSanh13(arrValue,indexC10+1,10);if(arrsanh.length==3){arrsanh.splice(0,0,arrValue[indexC10]);arrsanh.splice(0,0,arrValue[0]);arrsanh.push(111);return arrsanh}}var arrsanh=this.findSanh13Nomarl(arrValue);if(arrsanh.length==5){arrsanh.sort(function(a,b){return a-b});return arrsanh}return tem},findColorpair:function(arrValue){var resuftdsd=[];var item=arrValue[0]%4;var indexItemNext=0;var isFinish=true;while(isFinish){var sub=
[];for(var i=indexItemNext;i<arrValue.length;i++)if(arrValue[i]%4==item){if(sub.length<5)sub.push(arrValue[i]);if(i==arrValue.length-1)isFinish=false}else{item=arrValue[i]%4;indexItemNext=i;break}if(sub.length>=5)resuftdsd.push(sub)}return resuftdsd},find5Card:function(arrValue){var temp=[];arrValue.sort(function(a,b){return b%4-a%4});var arrColor=this.getarrColor(arrValue);var mangThung=[];if(arrValue.length>=5){for(var i=0;i<arrColor.length;i++){var arrItem=arrColor[i];if(arrItem.length>=5){arrItem.sort(function(a,
b){return a-b});var temp2=this.findThungPhaSanh13(arrItem);if(temp2.length>=5)mangThung.push(temp2)}}if(mangThung.length>0){temp=mangThung[0];for(var i=1;i<mangThung.length;i++)if(mangThung[i].length==6)temp=mangThung[i];if(temp.length==6)temp.splice(5,1);return temp}arrValue.sort(function(a,b){if(Math.floor(a/4)==0||Math.floor(b/4)==0)return a-b;return b-a})}cc.log("check thung pha sanh");var numberPair=this.findNumBerpair(arrValue);if(arrValue.length>=5)for(var i=0;i<numberPair.length;i++)if(numberPair[i].length==
4)return numberPair[i];cc.log("check tu quy");if(arrValue.length>=5){var numberPairRemain;for(var i=0;i<numberPair.length;i++)if(numberPair[i].length==3){var culu=[];culu.push.apply(culu,numberPair[i]);for(var j=numberPair.length-1;j>=0;j--)if(numberPair[j].length==2){culu.push.apply(culu,numberPair[j]);return culu}for(var j=numberPair.length-1;j>i;j--)if(numberPair[j].length==3){numberPair[j].splice(1,1);culu.push.apply(culu,numberPair[j]);return culu}}}cc.log("xamco");arrValue.sort(function(a,b){if(a%
4!=b%4)return b%4-a%4;if(Math.floor(a/4)==0||Math.floor(b/4)==0)return a-b;return b-a});if(arrValue.length>=5){var arrColor2=this.findColorpair(arrValue);if(arrColor2.length>0)if(arrColor2.length==1)return arrColor2[0];else{var thung=this.getThungMax(arrColor2[0],arrColor2[1]);return thung}}arrValue.sort(function(a,b){return b-a});var numberPair3=this.findNumBerpair3(arrValue);if(numberPair3.length>=5){if(Math.floor(numberPair3[numberPair3.length-1][0]/4)==0){var item=9;var sanhThuong=[];sanhThuong.push(numberPair3[numberPair3.length-
1][0]);for(var i=numberPair3.length-2;i>=0;i--)if(Math.floor(numberPair3[i][0]/4)==item){item++;sanhThuong.push(numberPair3[i][0])}if(item==13)return sanhThuong}for(var i=0;i<numberPair3.length-4;i++){var rank1=Math.floor(numberPair3[i][0]/4);var rank2=Math.floor(numberPair3[i+4][0]/4);if(rank1-rank2==4){var sanhThuong2=[];for(var j=i;j<i+5;j++)sanhThuong2.push(numberPair3[j][0]);return sanhThuong2}}}for(var i=0;i<numberPair.length;i++)if(numberPair[i].length==3){var xamco=[];xamco.push.apply(xamco,
numberPair[i]);return xamco}for(var i=0;i<numberPair.length;i++)if(numberPair[i].length==2){var xamco=[];xamco.push.apply(xamco,numberPair[i]);for(var j=numberPair.length-1;j>i;j--)if(numberPair[j].length==2){xamco.push.apply(xamco,numberPair[j]);return xamco}return xamco}cc.log("xong");return temp},checkSanhChiCuoi:function(arr3){if(arr3.length==3){arr3.sort(function(a,b){return a-b});if(Math.floor(arr3[0]/4)+1==Math.floor(arr3[1]/4)&&Math.floor(arr3[1]/4)+1==Math.floor(arr3[2]/4))return true;if(Math.floor(arr3[0]/
4)==0&&Math.floor(arr3[1]/4)==12&&Math.floor(arr3[2]/4)==13)return true}return false},_remove_value:function(arr1,arr2){for(var i=0;i<arr2.length;i++)for(var j=0;j<arr1.length;j++)if(arr2[i]==arr1[j]){arr1.splice(j,1);break}},autoSapXep:function(arrValue){var resulft=[];var arr11=arrValue.slice(0,arrValue.length);var chidau=this.find5Card(arr11);this._remove_value(arrValue,chidau);var arr22=arrValue.slice(0,arrValue.length);var chigiua=this.find5Card(arr22);this._remove_value(arrValue,chigiua);var arr33=
arrValue.slice(0,arrValue.length);var chicuoi=this.find5Card(arr33);this._remove_value(arrValue,chicuoi);arrValue.sort(function(a,b){if(Math.floor(a/4)==0||Math.floor(b/4)==0)return a-b;return b-a});if(chidau.length==0){var aaa=arrValue[0];chidau.push(arrValue[0]);arrValue.splice(0,1)}if(chigiua.length==0){chigiua.push(arrValue[0]);arrValue.splice(0,1)}if(chicuoi.length==0){chicuoi.push(arrValue[0]);arrValue.splice(0,1)}var index=0;for(var i=0;i<arrValue.length;){if(index%3==0)if(chicuoi.length<3){chicuoi.push(arrValue[i]);
index++;i++;continue}else index++;if(index%3==1)if(chigiua.length<5){chigiua.push(arrValue[i]);index++;i++;continue}else index++;if(index%3==2)if(chidau.length<5){chidau.push(arrValue[i]);index++;i++;continue}else index++}if(chidau.length<5){chidau.push(chicuoi[0]);chicuoi.splice(0,1)}if(chigiua.length<5){chigiua.push(chicuoi[0]);chicuoi.splice(0,1)}resulft.push.apply(resulft,chidau);resulft.push.apply(resulft,chigiua);resulft.push.apply(resulft,chicuoi);return resulft}});POSITION_PHOM_CENTER=0;POSITION_PHOM_LEFT=-1;POSITION_PHOM_RIGHT=1;
var TrashCardOnTable=cc.Node.extend({ctor:function(width_Phom,height_Phom,typeArrange){this._super();this.cardList=[];this.cardSize=null;this.setContentSize(cc.size(width_Phom,height_Phom));this.typeArrange=typeArrange;this.width_Phom=width_Phom;this.height_Phom=height_Phom},setAnchor:function(anchor){this.anchor=anchor},setCardPosition:function(x,y){this.cardPosition=cc.p(0,0);this.setPosition(x,y)},removeCardById:function(id){var card=CardList.prototype.getCardWithId(id);for(var i=0;i<this.cardList.length;i++)if(this.cardList[i].rank==
card.rank&&this.cardList[i].suit==card.suit){var retVal=this.cardList[i];retVal.setPosition(this.convertToWorldSpace(retVal.getPosition()));retVal.retain();retVal.removeFromParent(true);this.cardList.splice(i,1);return retVal}cc.log("card id "+id+" "+JSON.stringify(card));return null},addCard:function(card,noAnimation){var p=this.convertToNodeSpace(card.getPosition());card.setPosition(p);var animationDuration=.2;if(!this.cardSize)this.cardSize=card.getContentSize();card.canTouch=false;this.cardList.push(card);
this.addChild(card,0);card.setScale(this.height_Phom/this.cardSize.height);var moveAction=new cc.MoveTo(animationDuration,this.getNewPostionCard(this.cardList.length-1));var thiz=this;var delay=new cc.DelayTime(animationDuration);var orderAgain=new cc.CallFunc(function(){thiz.reOrder(noAnimation)});if(noAnimation)thiz.reOrder(noAnimation);else card.runAction(new cc.Sequence(moveAction,orderAgain))},getNewPostionCard:function(i){var tileCard=this.cardSize.width/this.cardSize.height;var distanceCard=
0;var lol=this.cardList.length*this.height_Phom*tileCard-this.width_Phom;if(lol>0)distanceCard=lol/(this.cardList.length-1);var y=this.getContentSize().height/2;var x=0;if(distanceCard<=0)if(this.typeArrange==POSITION_PHOM_CENTER){var wSub=this.cardList.length*this.height_Phom*tileCard;var ogrFirst=-wSub/2;x=ogrFirst+i*this.height_Phom*tileCard+this.height_Phom*tileCard/2}else if(this.typeArrange==POSITION_PHOM_LEFT){var ogrFirst=-this.width_Phom/2;x=ogrFirst+i*this.height_Phom*tileCard+this.height_Phom*
tileCard/2}else{var wSub=this.cardList.length*this.height_Phom*tileCard;var ogrFirst=this.width_Phom/2-wSub;x=ogrFirst+i*this.height_Phom*tileCard+this.height_Phom*tileCard/2}else x=i*this.height_Phom*tileCard-i*distanceCard+this.height_Phom*tileCard/2-this.width_Phom/2;return cc.p(x,y)},reOrder:function(noAnimation){if(this.cardList.length>0){var tileCard=this.cardSize.width/this.cardSize.height;var distanceCard=0;var lol=this.cardList.length*this.height_Phom*tileCard-this.width_Phom;if(lol>0)distanceCard=
lol/(this.cardList.length-1);var y=this.getContentSize().height/2;for(var i=0;i<this.cardList.length;i++){var x=0;if(distanceCard<=0)if(this.typeArrange==POSITION_PHOM_CENTER){var wSub=this.cardList.length*this.height_Phom*tileCard;var ogrFirst=-wSub/2;x=ogrFirst+i*this.height_Phom*tileCard+this.height_Phom*tileCard/2}else if(this.typeArrange==POSITION_PHOM_LEFT){var ogrFirst=-this.width_Phom/2;x=ogrFirst+i*this.height_Phom*tileCard+this.height_Phom*tileCard/2}else{var wSub=this.cardList.length*this.height_Phom*
tileCard;var ogrFirst=this.width_Phom/2-wSub;x=ogrFirst+(this.cardList.length-i-1)*this.height_Phom*tileCard+this.height_Phom*tileCard/2}else x=i*this.height_Phom*tileCard-i*distanceCard+this.height_Phom*tileCard/2-this.width_Phom/2;var card=this.cardList[i];if(card.origin){card.origin=cc.p(x,y);card.cardIndex=i;if(noAnimation)card.setPosition(card.origin);else card.moveToOriginPosition()}}}},addNewCard:function(card,posFrom){var cardSprite=new Card(card.rank,card.suit);cardSprite.setPosition(posFrom);
cardSprite.canTouch=false;this.addCard(cardSprite,true)},addCardObj:function(card){var cardSprite=new Card(card.rank,card.suit);cardSprite.setPosition(this.getParent().getPosition());cardSprite.canTouch=false;var p=this.convertToNodeSpace(cardSprite.getPosition());cardSprite.setPosition(p);var animationDuration=.3;if(!this.cardSize)this.cardSize=cardSprite.getContentSize();var dx=this.cardSize.width*this.height_Phom/this.cardSize.height;cardSprite.setScale(this.height_Phom/this.cardSize.height);cardSprite.canTouch=
false;this.cardList.push(cardSprite);this.addChild(cardSprite,0)},addCardWithoutAnimation:function(cards){if(!this.cardSize)this.cardSize=cards[0].getContentSize();this.cardList.concat(cards);var dx=this.cardSize.width*this.cardScale;var width=cards.length*dx;var x=this.getContentSize().width/2+dx/2;var y=this.getContentSize().height/2;for(var i=0;i<cards.length;i++){var card=cards[i];card.setScale(this.cardScale);card.setPosition(x,y);this.addChild(card,0);x+=dx}},addArrayCard:function(cards){this.removeAll();
for(var i=0;i<cards.length;i++)this.addCardObj(cards[i]);this.reOrder()},removeAll:function(){this.cardList=[];this.removeAllChildren(true)}});
var PhomCardList=CardList.extend({dealCards:function(cards,animation){this._super(cards,animation);this.typeOrder=true},setTypeOder:function(){this.typeOrder=!this.typeOrder},reArrangeCards:function(){var groupedCard=[];var ungroupedCard=[];for(var i=0;i<this.cardList.length;i++){var cardId=CardList.prototype.getCardIdWithRank(this.cardList[i].rank,this.cardList[i].suit);var index=this.groupedCard.indexOf(cardId);if(index!=-1)groupedCard[index]=this.cardList[i];else ungroupedCard.push(this.cardList[i])}if(this.typeOrder)ungroupedCard.sort(function(a,
b){return a.rank-b.rank});else ungroupedCard.sort(function(a,b){return a.suit-b.suit});this.cardList=[];this.cardList=groupedCard.concat(ungroupedCard);this.reOrder()},suggestCards:function(cards){for(var i=0;i<this.cardList.length;i++){var cardSprite=this.cardList[i];var selected=cards.indexOf(CardList.prototype.getCardIdWithRank(cardSprite.rank,cardSprite.suit))!=-1;cardSprite.setSelected(selected,true)}},getCardScale:function(){return this.cardList[0].getScale()},processGroupedCard:function(param){var groupedCard=
[];for(var i=0;i<param.length;i++)groupedCard=groupedCard.concat(param[i]);this.groupedCard=groupedCard;for(var i=0;i<this.cardList.length;i++){var id=CardList.prototype.getCardIdWithRank(this.cardList[i].rank,this.cardList[i].suit);if(groupedCard.indexOf(id)!=-1){this.cardList[i].removeChildByTag(11,true);var dotSprite=new cc.Sprite("#card-dot.png");dotSprite.setTag(11);dotSprite.setPosition(this.cardList[i].width-20,this.cardList[i].height-20);this.cardList[i].addChild(dotSprite)}else this.cardList[i].removeAllChildren(true)}}});
var Phom=IGameScene.extend({ctor:function(){this._super();var table_bg=new cc.Sprite("res/gp_table.png");table_bg.setPosition(cc.winSize.width/2,320);table_bg.setScale(cc.winSize.screenScale);this.sceneLayer.addChild(table_bg);this.table_bg=table_bg;this.initPlayer();this.initButton();var cardList=new PhomCardList(cc.size(cc.winSize.width-10,200));cardList.setScale(1*cc.winSize.screenScale);cardList.setAnchorPoint(cc.p(.5,0));cardList.setPosition(cc.winSize.width/2,40);this.sceneLayer.addChild(cardList,
2);this.cardList=cardList;var drawDeck=new cc.Sprite("#gp_card_up.png");drawDeck.setPosition(table_bg.getContentSize().width/2,table_bg.getContentSize().height/2+60);var drawDeckLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_30,"");drawDeckLabel.setPosition(drawDeck.width/2,drawDeck.height/2);drawDeckLabel.setVisible(true);drawDeck.addChild(drawDeckLabel);drawDeck.setScale(.7);this.drawDeckLabel=drawDeckLabel;this.drawDeck=drawDeck;this.table_bg.addChild(drawDeck);var cardArr=[];
for(var i=0;i<8;i++){var card=CardList.prototype.getCardWithId(1);cardArr.push(card)}var cardArr2=[];for(var i=0;i<4;i++){var card=CardList.prototype.getCardWithId(i);cardArr2.push(card)}var cardArr3=[];for(var i=0;i<10;i++)cardArr3.push(i);var thiz=this},initController:function(){this._controller=new PhomController(this)},setTrashCardList:function(cards,username,noAnimation){var slot=this.getSlotByUsername(username);slot.trashCards.removeAll();for(var j=0;j<cards.length;j++){var card=CardList.prototype.getCardWithId(cards[j]);
slot.trashCards.addCard(new Card(card.rank,card.suit),noAnimation)}},setCardList:function(cards){this.cardList.removeAll();for(var i=0;i<cards.length;i++){var card=CardList.prototype.getCardWithId(cards[i]);this.cardList.addCard(new Card(card.rank,card.suit))}this.cardList.reOrderWithoutAnimation()},setStolenCardsMe:function(cards){for(var i=0;i<this.cardList.cardList.length;i++){var card=this.cardList.cardList[i];var cardId=CardList.prototype.getCardIdWithRank(card.rank,card.suit);if(cards.indexOf(cardId)!=
-1){var borderSprite=new cc.Sprite("#boder_do.png");borderSprite.setPosition(card.width/2,card.height/2);card.addChild(borderSprite)}}},setStolenCardsOther:function(cards,username){var slot=this.getSlotByUsername(username);slot.dropCards.removeAll();for(var i=0;i<cards.length;i++){var card=CardList.prototype.getCardWithId(cards[i]);var cardSprite=new Card(card.rank,card.suit);var redBorder=new cc.Sprite("#boder_do.png");redBorder.setPosition(cardSprite.width/2,cardSprite.height/2);cardSprite.addChild(redBorder);
slot.dropCards.addCard(cardSprite,true)}},processGroupedCard:function(groupedCard){this.cardList.processGroupedCard(groupedCard)},showResultDialog:function(resultData){var dialog=new ResultDialog(resultData.length);for(var i=0;i<resultData.length;i++){var username=resultData[i].username;if(username.length>3&&username!=PlayerMe.username)username=username.substring(0,username.length-3)+"***";dialog.userLabel[i].setString(username);if(resultData[i].username=PlayerMe.username)SoundPlayer.playSound(resultData[i].isWinner?
"winning":"losing");var goldStr=resultData[i].gold>=0?"+":"-";goldStr+=cc.Global.NumberFormat1(Math.abs(resultData[i].gold))+" V";dialog.goldLabel[i].setString(goldStr);dialog.goldLabel[i].setColor(resultData[i].gold>=0?cc.color("#ffde00"):cc.color("#ff0000"));dialog.contentLabel[i].setString(resultData[i].resultString);for(var j=0;j<resultData[i].cardList.length;j++){var cardData=CardList.prototype.getCardWithId(resultData[i].cardList[j]);var card=new Card(cardData.rank,cardData.suit);dialog.cardList[i].addCard(card,
true)}dialog.cardList[i].reOrderWithoutAnimation()}dialog.show()},performHaBaiMe:function(groupedCards,noAnimation){var removeList=[];for(var i=0;i<groupedCards.length;i++){var list=groupedCards[i];for(var j=0;j<list.length;j++)removeList.push(CardList.prototype.getCardWithId(list[j]))}var arr=this.cardList.removeCard(removeList);for(var i=0;i<arr.length;i++){arr[i].removeChildByTag(11,true);this.playerView[0].dropCards.addCard(arr[i],noAnimation);arr[i].release()}this.playerView[0].dropCards.reOrder();
this.cardList.reOrder()},performHaBaiMeReconnect:function(groupedCards,noAnimation,cardToMau){for(var i=0;i<groupedCards.length;i++){var card=CardList.prototype.getCardWithId(groupedCards[i]);var cardSprite=new Card(card.rank,card.suit);var index=cardToMau.indexOf(groupedCards[i]);if(index!=-1){var borderSprite=new cc.Sprite("#boder_do.png");borderSprite.setPosition(objCard.width/2,objCard.height/2);cardSprite.addChild(borderSprite)}this.playerView[0].dropCards.addCard(cardSprite,true)}},performHaBaiOther:function(username,
groupedCards,stolenCards,noAnimation){var slot=this.getSlotByUsername(username);var stolenCardsId=[];var stolenCardsSprite=[];for(var i=0;i<slot.dropCards.cardList.length;i++)stolenCardsId.push(CardList.prototype.getCardIdWithRank(slot.dropCards.cardList[i].rank,slot.dropCards.cardList[i].suit));slot.dropCards.removeAll();for(var i=0;i<groupedCards.length;i++)for(var j=0;j<groupedCards[i].length;j++){var index=stolenCards.indexOf(groupedCards[i][j]);var card=CardList.prototype.getCardWithId(groupedCards[i][j]);
var objCard=new Card(card.rank,card.suit);objCard.setPosition(slot.avt.getParent().convertToWorldSpace(slot.avt.getPosition()));slot.dropCards.addCard(objCard,false);if(index==-1);else{var borderSprite=new cc.Sprite("#boder_do.png");borderSprite.setPosition(objCard.width/2,objCard.height/2);objCard.addChild(borderSprite)}}},performHaBaiOtherReconnect:function(username,groupedCards,stolenCards,noAnimation){var slot=this.getSlotByUsername(username);var stolenCardsId=[];init;for(var i=0;i<slot.dropCards.cardList.length;i++)stolenCardsId.push(CardList.prototype.getCardIdWithRank(slot.dropCards.cardList[i].rank,
slot.dropCards.cardList[i].suit));slot.dropCards.removeAll();for(var i=0;i<groupedCards.length;i++)for(var j=0;j<groupedCards[i].length;j++){var index=stolenCards.indexOf(groupedCards[i][j]);var card=CardList.prototype.getCardWithId(groupedCards[i][j]);var objCard=new Card(card.rank,card.suit);objCard.setPosition(slot.avt.getParent().convertToWorldSpace(slot.avt.getPosition()));slot.dropCards.addCard(objCard,false);if(index==-1);else{var borderSprite=new cc.Sprite("#boder_do.png");borderSprite.setPosition(objCard.width/
2,objCard.height/2);objCard.addChild(borderSprite)}}},performReorderCards:function(){this.cardList.reOrder()},performDelegateCards:function(sender,receiver,cards,groupedCardAfter){var finalList=[];var receiverSlot=this.getSlotByUsername(receiver);for(var j=0;j<groupedCardAfter.length;j++)if(cards.indexOf(groupedCardAfter[j])==-1){var cardSprite=receiverSlot.dropCards.removeCardById(groupedCardAfter[j]);receiverSlot.dropCards.addCard(cardSprite,true)}else if(sender==PlayerMe.username){var cardSprite=
this.cardList.removeCardById(groupedCardAfter[j]);receiverSlot.dropCards.addCard(cardSprite,true);cc.log("Removed card id "+groupedCardAfter[j]+" from my deck")}else{var card=CardList.prototype.getCardWithId(groupedCardAfter[j]);var cardSprite=new Card(card.rank,card.suit);var slotTemp=this.getSlotByUsername(sender);cardSprite.setPosition(slotTemp.avt.getParent().convertToWorldSpace(slotTemp.avt.getPosition()));finalList.push(cardSprite);cc.log("Added card id "+groupedCardAfter[j]);receiverSlot.dropCards.addCard(cardSprite,
true)}for(var i=0;i<finalList.length;i++);this.cardList.reOrder()},performAssetChange:function(username,changeAmount,balance){this._super(changeAmount,balance,username)},performBalanceCard:function(from,to,card){var fromUser=this.getSlotByUsername(from);var toUser=this.getSlotByUsername(to);var cardSprite=fromUser.trashCards.removeCardById(card);toUser.trashCards.addCard(cardSprite,false);cardSprite.release();fromUser.trashCards.reOrder()},performStealCard:function(stealer,stolenUser,stolenCard,groupedCard){var stolenUserSlot=
this.getSlotByUsername(stolenUser);var cardSprite=stolenUserSlot.trashCards.removeCardById(stolenCard);cardSprite.removeAllChildren(true);stolenUserSlot.trashCards.reOrder();var borderSprite=new cc.Sprite("#boder_do.png");borderSprite.setPosition(cardSprite.width/2,cardSprite.height/2);cardSprite.addChild(borderSprite);if(stealer==PlayerMe.username){cardSprite.setScale(this.cardList.getCardScale());this.cardList.addCard(cardSprite,false);cardSprite.release();this.cardList.processGroupedCard(groupedCard);
this.cardList.reArrangeCards()}else{var stealerSlot=this.getSlotByUsername(stealer);stealerSlot.dropCards.addCard(cardSprite,false)}},performDrawCardMe:function(cardId,groupedCard){var card=CardList.prototype.getCardWithId(cardId);var cardSprite=new Card(card.rank,card.suit);cardSprite.setPosition(cc.winSize.width/2,cc.winSize.height/2);this.cardList.addCard(cardSprite,false);this.cardList.reOrder();this.cardList.processGroupedCard(groupedCard)},performDrawCardOther:function(username){var slot=this.getSlotByUsername(username);
var card=new cc.Sprite("#gp_card_up.png");this.sceneLayer.addChild(card);card.setScale(.5);card.setPosition(cc.winSize.width/2,cc.winSize.height/2);var moveAction=new cc.MoveTo(.3,slot.avt.getParent().convertToWorldSpace(slot.avt.getPosition()));var removeAction=new cc.CallFunc(function(){card.removeFromParent(true)});card.runAction(new cc.Sequence(moveAction,removeAction))},performDrawDeckUpdate:function(cardCount){if(cardCount)this.drawDeckLabel.setString(cardCount)},showTimeRemainUser:function(username,
currentTime,maxTime){maxTime=maxTime||currentTime;for(var i=0;i<this.allSlot.length;i++)if(this.allSlot[i].username==username)this.allSlot[i].showTimeRemain(currentTime,maxTime);else this.allSlot[i].stopTimeRemain()},setDrawBtVisible:function(visible){this.drawBt.visible=visible},setAnBaiBtVisible:function(visible){this.anbaiBt.visible=visible},setDanhBaiBtVisible:function(visible){this.danhbaiBt.visible=visible},setHaBaiBtVisible:function(visible){this.habaiBt.visible=visible},setGuiBaiBtVisible:function(visible){this.guibaiBt.visible=
visible},setUBtVisible:function(visible){this.uBt.visible=visible},suggestCards:function(cards){this.cardList.suggestCards(cards)},performDanhBaiMe:function(card){var arr=this.cardList.removeCard([card]);this.playerView[0].trashCards.addCard(arr[0],true);this.cardList.reOrder();for(var i=0;i<arr.length;i++){arr[i].removeAllChildren(true);arr[i].release()}},performDanhBaiOther:function(username,card){var slot=this.getSlotByUsername(username);slot.trashCards.addNewCard(card,slot.avt.getParent().convertToWorldSpace(slot.avt.getPosition()))},
performDealCards:function(cards,groupedCards){this.cardList.dealCards(cards,true);this.cardList.processGroupedCard(groupedCards)},initPlayer:function(){var withPhom=280;var playerMe=new GamePlayerMe;playerMe.setPosition(150,50);playerMe.setScale(cc.winSize.screenScale);playerMe.trashCards=new TrashCardOnTable(withPhom,80,POSITION_PHOM_CENTER);playerMe.trashCards.setCardPosition(playerMe.convertToNodeSpace(cc.p(cc.winSize.width/2,190*cc.winSize.screenScale)));playerMe.dropCards=new TrashCardOnTable(withPhom,
80,POSITION_PHOM_CENTER);playerMe.dropCards.setCardPosition(playerMe.trashCards.x,playerMe.trashCards.y+70);playerMe.addChild(playerMe.dropCards);playerMe.addChild(playerMe.trashCards);this.sceneLayer.addChild(playerMe,1);var player1=new GamePlayer;player1.setPosition(this.table_bg.getContentSize().width/2+500,this.table_bg.getContentSize().height/2);player1.trashCards=new TrashCardOnTable(withPhom,80,POSITION_PHOM_RIGHT);player1.trashCards.setCardPosition(player1.width/2-(withPhom/2+50),player1.height/
2-15);player1.dropCards=new TrashCardOnTable(withPhom,80,POSITION_PHOM_RIGHT);player1.dropCards.setCardPosition(player1.trashCards.x,player1.trashCards.y+70);player1.addChild(player1.dropCards);player1.addChild(player1.trashCards);this.table_bg.addChild(player1,1);player1.chatView.setAnchorPoint(cc.p(1,0));var player2=new GamePlayer;player2.setPosition(this.table_bg.getContentSize().width/2,this.table_bg.getContentSize().height+50);player2.trashCards=new TrashCardOnTable(withPhom,80,POSITION_PHOM_RIGHT);
player2.trashCards.setCardPosition(player2.width/2-(withPhom/2+50),player2.height/2-15);player2.dropCards=new TrashCardOnTable(withPhom,80,POSITION_PHOM_RIGHT);player2.dropCards.setCardPosition(player2.trashCards.x,player2.trashCards.y+70);player2.addChild(player2.dropCards);player2.addChild(player2.trashCards);this.table_bg.addChild(player2,1);player2.chatView.setAnchorPoint(cc.p(0,1));var player3=new GamePlayer;player3.setPosition(this.table_bg.getContentSize().width/2-500,player1.y);player3.trashCards=
new TrashCardOnTable(withPhom,80,POSITION_PHOM_LEFT);player3.trashCards.setCardPosition(player3.width/2+(withPhom/2+50),player3.height/2-15);player3.dropCards=new TrashCardOnTable(withPhom,80,POSITION_PHOM_LEFT);player3.dropCards.setCardPosition(player3.trashCards.x,player3.trashCards.y+70);player3.addChild(player3.dropCards);player3.addChild(player3.trashCards);player3.chatView.setAnchorPoint(cc.p(0,0));this.table_bg.addChild(player3,1);this.playerView=[playerMe,player1,player2,player3]},initButton:function(){var danhbaiBt=
new ccui.Button("game-danhbaiBt.png","","",ccui.Widget.PLIST_TEXTURE);danhbaiBt.setPosition(cc.winSize.width-310*cc.winSize.screenScale,46);this.sceneLayer.addChild(danhbaiBt);var xepBaiBt=new ccui.Button("game-xepbaiBt.png","","",ccui.Widget.PLIST_TEXTURE);xepBaiBt.setPosition(cc.winSize.width-710*cc.winSize.screenScale,danhbaiBt.y);this.sceneLayer.addChild(xepBaiBt);var uBt=new ccui.Button("game-uBt.png","","",ccui.Widget.PLIST_TEXTURE);uBt.setPosition(cc.winSize.width-510*cc.winSize.screenScale,
danhbaiBt.y);this.sceneLayer.addChild(uBt);var drawBt=new ccui.Button("game-bocbaiBt.png","","",ccui.Widget.PLIST_TEXTURE);drawBt.setPosition(cc.winSize.width-110*cc.winSize.screenScale,danhbaiBt.y);this.sceneLayer.addChild(drawBt);var startBt=new ccui.Button("game-startBt.png","","",ccui.Widget.PLIST_TEXTURE);startBt.setPosition(drawBt.getPosition());this.sceneLayer.addChild(startBt);var habaiBt=new ccui.Button("game-habaiBt.png","","",ccui.Widget.PLIST_TEXTURE);habaiBt.setPosition(cc.winSize.width-
510*cc.winSize.screenScale,danhbaiBt.y);this.sceneLayer.addChild(habaiBt);var anbaiBt=new ccui.Button("game-anbaiBt.png","","",ccui.Widget.PLIST_TEXTURE);anbaiBt.setPosition(habaiBt.x,habaiBt.y);this.sceneLayer.addChild(anbaiBt);var guibaiBt=new ccui.Button("game-guibaiBt.png","","",ccui.Widget.PLIST_TEXTURE);guibaiBt.setPosition(anbaiBt.getPosition());this.sceneLayer.addChild(guibaiBt);var thiz=this;startBt.addClickEventListener(function(){thiz.sendStartRequest()});drawBt.addClickEventListener(function(){thiz.sendDrawRequest()});
danhbaiBt.addClickEventListener(function(){thiz.sendDanhBai()});xepBaiBt.addClickEventListener(function(){thiz.xepBai()});habaiBt.addClickEventListener(function(){thiz.sendHaBaiRequest()});anbaiBt.addClickEventListener(function(){thiz.sendAnBaiRequest()});uBt.addClickEventListener(function(){thiz.sendURequest()});guibaiBt.addClickEventListener(function(){thiz.sendGuiBaiRequest()});this.danhbaiBt=danhbaiBt;this.uBt=uBt;this.xepBaiBt=xepBaiBt;this.drawBt=drawBt;this.startBt=startBt;this.anbaiBt=anbaiBt;
this.habaiBt=habaiBt;this.guibaiBt=guibaiBt;this.danhbaiBt.setScale(cc.winSize.screenScale);this.uBt.setScale(cc.winSize.screenScale);this.xepBaiBt.setScale(cc.winSize.screenScale);this.drawBt.setScale(cc.winSize.screenScale);this.startBt.setScale(cc.winSize.screenScale);this.anbaiBt.setScale(cc.winSize.screenScale);this.habaiBt.setScale(cc.winSize.screenScale);this.guibaiBt.setScale(cc.winSize.screenScale);this.allButton=[danhbaiBt,uBt,xepBaiBt,drawBt,startBt,anbaiBt,habaiBt,guibaiBt];this.hideAllButton()},
hideAllButton:function(){for(var i=0;i<this.allButton.length;i++)this.allButton[i].visible=false},xepBai:function(){this.cardList.setTypeOder();this.cardList.reArrangeCards()},sendURequest:function(){this._controller.sendURequest()},sendAnBaiRequest:function(){this._controller.sendAnBaiRequest()},sendGuiBaiRequest:function(){var guibaiList=this.cardList.getCardSelected();var data=[];for(var i=0;i<guibaiList.length;i++)data.push(CardList.prototype.getCardIdWithRank(guibaiList[i].rank,guibaiList[i].suit));
this._controller.sendGuiBaiRequest(data)},sendHaBaiRequest:function(){var habaiList=this.cardList.getCardSelected();var data=[];for(var i=0;i<habaiList.length;i++)data.push(CardList.prototype.getCardIdWithRank(habaiList[i].rank,habaiList[i].suit));this._controller.sendHaBaiRequest(data)},sendStartRequest:function(){this._controller.sendStartRequest()},sendDanhBai:function(){var cards=this.cardList.getCardSelected();if(cards.length>0){var cardId=CardList.prototype.getCardIdWithRank(cards[0].rank,cards[0].suit);
this._controller.sendDanhBai(cardId)}else MessageNode.getInstance().show("B\u1ea1n ph\u1ea3i ch\u1ecdn 1 qu\u00e2n b\u00e0i")},sendDrawRequest:function(){this._controller.sendDrawRequest()},setStartBtVisible:function(visible){this.startBt.visible=visible},removeAllCards:function(){this.cardList.removeAll();if(this.playerView)for(var i=0;i<this.playerView.length;i++){this.playerView[i].trashCards.removeAll();this.playerView[i].dropCards.removeAll()}},setDeckVisible:function(visible){this.drawDeck.visible=
visible;this.drawDeckLabel.visible=visible},setXepBaiBtVisible:function(visible){this.xepBaiBt.visible=visible}});var Sam=TienLen.extend({ctor:function(){this._super();this.timeRemaining=0;this.timeInterval=null},initButton:function(){this._super();var baosamBt=new ccui.Button("game-baosamBt.png","","",ccui.Widget.PLIST_TEXTURE);baosamBt.setPosition(cc.winSize.width-110,46);this.sceneLayer.addChild(baosamBt);baosamBt.visible=false;this.baosamBt=baosamBt;var huysamBt=new ccui.Button("game-huysamBt.png","","",ccui.Widget.PLIST_TEXTURE);huysamBt.setPosition(cc.winSize.width-310,46);this.sceneLayer.addChild(huysamBt);
huysamBt.visible=false;this.huysamBt=huysamBt;var timeLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_BoldCondensed_36_Glow,"");timeLabel.setPosition(cc.winSize.width/2,425);timeLabel.setScale(2);this.sceneLayer.addChild(timeLabel);this.timeLabel=timeLabel;var thiz=this;baosamBt.addClickEventListener(function(){thiz.sendBaoSamRequest()});huysamBt.addClickEventListener(function(){thiz.sendHuySamRequest()})},initController:function(){this._controller=new SamController(this)},initPlayer:function(){var playerMe=
new GamePlayerMe;playerMe.stopTimeRemain();playerMe.setPosition(150,50);this.sceneLayer.addChild(playerMe,1);var progressTimerBaoSam=new cc.ProgressTimer(new cc.Sprite("#player-progress-3.png"));progressTimerBaoSam.setType(cc.ProgressTimer.TYPE_BAR);progressTimerBaoSam.setMidpoint(cc.p(0,.5));progressTimerBaoSam.setBarChangeRate(cc.p(1,0));progressTimerBaoSam.setPercentage(0);progressTimerBaoSam.setPosition(cc.p(cc.winSize.width/2,220));this.progressTimerBaoSam=progressTimerBaoSam;this.sceneLayer.addChild(progressTimerBaoSam,
2);var player1=new GamePlayer;player1.setPosition(cc.winSize.width-120*cc.winSize.screenScale,320*cc.winSize.screenScale);this.sceneLayer.addChild(player1,1);player1.chatView.setAnchorPoint(cc.p(1,0));player1.chatView.y+=20;var player2=new GamePlayer;player2.setPosition(cc.winSize.width/2-220*cc.winSize.screenScale,cc.winSize.height-140/cc.winSize.screenScale);this.sceneLayer.addChild(player2,1);player2.chatView.setAnchorPoint(cc.p(1,1));var player3=new GamePlayer;player3.setPosition(cc.winSize.width/
2+220*cc.winSize.screenScale,player2.y);this.sceneLayer.addChild(player3,1);player3.chatView.setAnchorPoint(cc.p(1,1));var player4=new GamePlayer;player4.setPosition(120*cc.winSize.screenScale,player1.y);this.sceneLayer.addChild(player4,1);player4.chatView.setAnchorPoint(cc.p(0,0));player4.chatView.y+=20;this.playerView=[playerMe,player1,player2,player3,player4];var cardRemaining1=new CardRemaining;cardRemaining1.setPosition(30,70);player1.infoLayer.addChild(cardRemaining1);player1.cardRemaining=
cardRemaining1;var cardRemaining2=new CardRemaining;cardRemaining2.setPosition(130,70);player2.infoLayer.addChild(cardRemaining2);player2.cardRemaining=cardRemaining2;var cardRemaining3=new CardRemaining;cardRemaining3.setPosition(130,70);player3.infoLayer.addChild(cardRemaining3);player3.cardRemaining=cardRemaining3;var cardRemaining4=new CardRemaining;cardRemaining4.setPosition(130,70);player4.infoLayer.addChild(cardRemaining4);player4.cardRemaining=cardRemaining4;for(var i=1;i<this.playerView.length;i++){var oneCardNotify=
new cc.LabelBMFont("B\u00e1o 1",cc.res.font.Roboto_CondensedBold_30);oneCardNotify.setColor(cc.color("#ff0000"));oneCardNotify.setPosition(90,110);this.playerView[i].infoLayer.addChild(oneCardNotify);oneCardNotify.setVisible(false);this.playerView[i].oneCardNotify=oneCardNotify;this.playerView[i].cardRemaining.setVisible(false);var oneNotifyBaoSam=new cc.LabelBMFont("B\u00e1o S\u00e2m",cc.res.font.Roboto_CondensedBold_30);oneNotifyBaoSam.setColor(cc.color("#ff0000"));oneNotifyBaoSam.setPosition(80,
110);this.playerView[i].infoLayer.addChild(oneNotifyBaoSam);oneNotifyBaoSam.setVisible(false);this.playerView[i].oneNotifyBaoSam=oneNotifyBaoSam}},setSamBtVisible:function(visible){this.baosamBt.visible=this.huysamBt.visible=visible},alertMessage:function(msg){MessageNode.getInstance().show(msg)},showBaoSamTimeRemaining:function(timeRemaining){if(timeRemaining>0){this.timeRemaining=timeRemaining;if(this.timeInterval)clearInterval(this.timeInterval);var thiz=this;thiz.timeLabel.setString(timeRemaining);
thiz.timeRemaining--;this.timeInterval=setInterval(function(){if(thiz.timeRemaining<=0){thiz.timeLabel.setString("");clearInterval(thiz.timeInterval)}else{thiz.timeLabel.setString(thiz.timeRemaining);thiz.timeRemaining--}},1E3)}else{this.timeRemaining=0;this.timeLabel.setString("")}},sendBaoSamRequest:function(){this._controller.sendBaoSamRequest()},sendHuySamRequest:function(){this._controller.sendHuySamRequest()},notifyOne:function(username){var slot=this.getSlotByUsername(username);if(slot)slot.oneCardNotify.setVisible(true)},
notifyBaoSam:function(username,isbaosam){var slot=this.getSlotByUsername(username);slot.oneNotifyBaoSam.setVisible(true);if(slot){if(isbaosam)slot.oneNotifyBaoSam.setString("B\u00e1o S\u00e2m");else slot.oneNotifyBaoSam.setString("Hu\u1ef7 S\u00e2m");var thiaaa=this;this.runAction(new cc.Sequence(new cc.DelayTime(2),new cc.CallFunc(function(){slot.oneNotifyBaoSam.setVisible(false)})))}},hideAllNotifyOne:function(){for(var i=1;i<this.playerView.length;i++)this.playerView[i].oneCardNotify.setVisible(false)}});var SamSolo=Sam.extend({ctor:function(){this._super();this._controller.isSolo=true},initPlayer:function(){var playerMe=new GamePlayerMe;playerMe.setPosition(150,50);this.sceneLayer.addChild(playerMe,1);var progressTimerBaoSam=new cc.ProgressTimer(new cc.Sprite("#player-progress-3.png"));progressTimerBaoSam.setType(cc.ProgressTimer.TYPE_BAR);progressTimerBaoSam.setMidpoint(cc.p(0,.5));progressTimerBaoSam.setBarChangeRate(cc.p(1,0));progressTimerBaoSam.setPercentage(0);progressTimerBaoSam.setPosition(cc.p(cc.winSize.width/
2,220));this.progressTimerBaoSam=progressTimerBaoSam;this.sceneLayer.addChild(progressTimerBaoSam,2);var player1=new GamePlayer;player1.setPosition(cc.winSize.width/2,cc.winSize.height-140/cc.winSize.screenScale);this.sceneLayer.addChild(player1,1);player1.chatView.setAnchorPoint(cc.p(0,1));this.playerView=[playerMe,player1];for(var i=1;i<this.playerView.length;i++){var oneCardNotify=new cc.LabelBMFont("B\u00e1o 1",cc.res.font.Roboto_CondensedBold_30);oneCardNotify.setColor(cc.color("#ff0000"));oneCardNotify.setPosition(90,
110);this.playerView[i].infoLayer.addChild(oneCardNotify);oneCardNotify.setVisible(false);this.playerView[i].oneCardNotify=oneCardNotify;var oneNotifyBaoSam=new cc.LabelBMFont("B\u00e1o S\u00e2m",cc.res.font.Roboto_CondensedBold_30);oneNotifyBaoSam.setColor(cc.color("#ff0000"));oneNotifyBaoSam.setPosition(80,110);this.playerView[i].infoLayer.addChild(oneNotifyBaoSam);oneNotifyBaoSam.setVisible(false);this.playerView[i].oneNotifyBaoSam=oneNotifyBaoSam}}});var s_xocdia_slot_id=s_xocdia_slot_id||[1,0,4,2,6,5,3];var s_xocdia_slot_position=s_xocdia_slot_position||[{x:1011,y:407},{x:271,y:407},{x:150,y:215},{x:395,y:215},{x:640,y:215},{x:885,y:215},{x:1130,y:215}];
var s_xocdia_result_position=s_xocdia_result_position||[{x:218,y:194},{x:161,y:219},{x:175,y:152},{x:235,y:144},{x:276,y:178},{x:291,y:231},{x:190,y:270},{x:242,y:248},{x:278,y:302},{x:333,y:262},{x:342,y:200},{x:342,y:146},{x:289,y:125},{x:282,y:82},{x:231,y:86},{x:175,y:95},{x:125,y:129},{x:117,y:177},{x:99,y:223},{x:116,y:279},{x:180,y:318},{x:232,y:332}];
var _get_random_array=function(take,maxSize){var arr=[];var min=0;var max=maxSize-take;for(var i=0;i<take;i++){var number=min+Math.floor(Math.random()*(max-min));min=number+1;max++;arr.push(number)}return arr};
var XocDiaBettingSlot=cc.Node.extend({ctor:function(idx,parentNode){this._super();this._chips=[];this._chipNode=new cc.Node;this.addChild(this._chipNode);this._slotGold=0;this._userGold=0;this.setAnchorPoint(cc.p(.5,.5));this.setPosition(s_xocdia_slot_position[idx]);var bg=new cc.Sprite("#xocdia_slot_"+(idx+1)+".png");this.bg=bg;this.setContentSize(bg.getContentSize());bg.setPosition(this.getContentSize().width/2,this.getContentSize().height/2);this.addChild(bg);if(idx<2){var slotGoldLabel=new cc.LabelBMFont("10.00.000",
cc.res.font.Roboto_Condensed_25);slotGoldLabel.setColor(cc.color("#392d2e"));slotGoldLabel.setPosition(this.x-this.getContentSize().width/4,this.y-this.getContentSize().height/2+25);parentNode.addChild(slotGoldLabel,1);var userGoldLabel=new cc.LabelBMFont("1.00.000",cc.res.font.Roboto_CondensedBold_25);userGoldLabel.setColor(cc.color("#392d2e"));userGoldLabel.setPosition(this.x+this.getContentSize().width/4,slotGoldLabel.y);parentNode.addChild(userGoldLabel,1)}else{var slotGoldLabel=new cc.LabelBMFont("100.000",
cc.res.font.Roboto_Condensed_25);slotGoldLabel.setColor(cc.color("#767eb6"));slotGoldLabel.setPosition(this.x-this.getContentSize().width/4,this.y-this.getContentSize().height/2+20);slotGoldLabel.setScale(20/25);parentNode.addChild(slotGoldLabel,1);var userGoldLabel=new cc.LabelBMFont("100.000",cc.res.font.Roboto_CondensedBold_25);userGoldLabel.setColor(cc.color("#ffde00"));userGoldLabel.setPosition(this.x+this.getContentSize().width/4,slotGoldLabel.y);userGoldLabel.setScale(20/25);parentNode.addChild(userGoldLabel,
1)}this.slotGoldLabel=slotGoldLabel;this.userGoldLabel=userGoldLabel;this.reset();var rectTouch=cc.rect(0,0,this.getContentSize().width,this.getContentSize().height);var thiz=this;cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:true,onTouchBegan:function(touch,event){var p=thiz.convertToNodeSpace(touch.getLocation());if(cc.rectContainsPoint(rectTouch,p)){if(thiz.onTouchSlot)thiz.onTouchSlot();return true}return false}},this)},setOpacity:function(opacity){this._super(opacity);
this.bg.setOpacity(opacity);this.slotGoldLabel.setOpacity(opacity);this.userGoldLabel.setOpacity(opacity)},reset:function(){this._chipNode.removeAllChildren(true);this.removeChip();this.setOpacity(255);this.setSlotGold(0);this.setUserGold(0)},setSlotGold:function(gold){this._slotGold=gold;this.slotGoldLabel.stopAllActions();if(gold>0){this.slotGoldLabel.visible=true;this.slotGoldLabel.setOpacity(255);var action=new quyetnd.ActionNumber(.5,gold);this.slotGoldLabel.runAction(action)}else{this.slotGoldLabel.setString("0");
this.slotGoldLabel.visible=false}},setUserGold:function(gold){this._userGold=gold;this.userGoldLabel.stopAllActions();if(gold>0){this.userGoldLabel.visible=true;this.userGoldLabel.setOpacity(255);var action=new quyetnd.ActionNumber(.5,gold);this.userGoldLabel.runAction(action)}else{this.userGoldLabel.setString("0");this.userGoldLabel.visible=false}},getSlotPosition:function(){var padding=50;var w=Math.random()*(this.getContentSize().width-padding*2)+padding;var h=Math.random()*(this.getContentSize().height-
padding*2)+padding;var x=this.x-this.getContentSize().width/2+w;var y=this.y-this.getContentSize().height/2+h;return cc.p(x,y)},addChip:function(chipSprite){this._chips.push(chipSprite)},removeChip:function(){this._chips=[]}});
var XocDiaScene=IGameScene.extend({ctor:function(){this._super();this._historyData=[];this.chipTagMe=100;this.chipTagOther=200;this._shakeDisk=false;this.initView();this.initBettingSlot();this.initChipButton();this.initHistory();this.initDisk();this.setUserCount(0)},showGameInfo:function(gameName,betAmount){},update:function(dt){if(this._shakeDisk)if(cc.Global.GetSetting("vibrator",true))if(cc.sys.isNative)cc.Device.vibrate(dt);else cc.log("vibrator: "+dt)},backButtonClickHandler:function(){var uGold=
0;for(var i=0;i<this.bettingSlot.length;i++)uGold+=this.bettingSlot[i]._userGold;if(uGold>0){var thiz=this;var dialog=new MessageConfirmDialog;dialog.setMessage("B\u1ea1n c\u00f3 mu\u1ed1n tho\u00e1t game kh\u00f4ng ? \nN\u1ebfu THO\u00c1T b\u1ea1n s\u1ebd b\u1ecb m\u1ea5t s\u1ed1 v\u00e0ng \u0111\u00e3 \u0111\u1eb7t c\u01b0\u1ee3c");dialog.showWithAnimationScale();dialog.okButtonHandler=function(){if(thiz._controller)thiz._controller.requestQuitRoom()}}else if(this._controller)this._controller.requestQuitRoom()},
initView:function(){var playerMe=new GamePlayerMe;playerMe.setPosition(150,50);this.sceneLayer.addChild(playerMe,1);this.playerMe=playerMe;var playerButton=new ccui.Button("ingame-playerBt.png","","",ccui.Widget.PLIST_TEXTURE);playerButton.setPosition(160,this.gameTopBar.backBt.y);this.gameTopBar.addChild(playerButton);this.playerButton=playerButton;playerButton.addClickEventListener(function(){var dialog=new UserListDialog;dialog.show()});var userLabel=new cc.LabelBMFont("30",cc.res.font.Roboto_CondensedBold_18);
userLabel.setColor(cc.color("#ffcf00"));userLabel.setPosition(playerButton.getContentSize().width/2,11);playerButton.getRendererNormal().addChild(userLabel);this.userLabel=userLabel;var datLaiButton=new ccui.Button("xocdia_batlaiBt.png","","",ccui.Widget.PLIST_TEXTURE);datLaiButton.setPosition(cc.winSize.width-120*cc.winSize.screenScale,50*cc.winSize.screenScale);datLaiButton.setScale(cc.winSize.screenScale);this.sceneLayer.addChild(datLaiButton);this.datLaiButton=datLaiButton;var huyCuocButton=new ccui.Button("xocdia_huyCuocButton.png",
"","",ccui.Widget.PLIST_TEXTURE);huyCuocButton.setPosition(datLaiButton.getPosition());huyCuocButton.setScale(cc.winSize.screenScale);this.sceneLayer.addChild(huyCuocButton);this.huyCuocButton=huyCuocButton;var resultBg1=new ccui.Scale9Sprite("xocdia_result_bg_1.png",cc.rect(10,10,4,4));resultBg1.setPreferredSize(cc.size(220*cc.winSize.screenScale,90*cc.winSize.screenScale));resultBg1.setPosition(950*cc.winSize.screenScale,48*cc.winSize.screenScale);this.sceneLayer.addChild(resultBg1);var resultBg2=
new ccui.Scale9Sprite("xocdia_result_bg_2.png",cc.rect(4,0,4,2));resultBg2.setPreferredSize(cc.size(218*cc.winSize.screenScale,2));resultBg2.setPosition(resultBg1.getPosition());this.sceneLayer.addChild(resultBg2);var tongCuocLabal=new cc.LabelBMFont("T\u1ed5ng c\u01b0\u1ee3c : 1000",cc.res.font.Roboto_Condensed_25);tongCuocLabal.setScale(cc.winSize.screenScale);tongCuocLabal.setColor(cc.color("#bac2f9"));tongCuocLabal.setPosition(resultBg1.x,resultBg1.y+resultBg1.getContentSize().height/4);tongCuocLabal.setVisible(false);
this.sceneLayer.addChild(tongCuocLabal,1);this.tongCuocLabal=tongCuocLabal;var winLabel=new cc.LabelBMFont("Th\u1eafng : 1000",cc.res.font.Roboto_Condensed_25);winLabel.setScale(cc.winSize.screenScale);winLabel.setColor(cc.color("#bac2f9"));winLabel.setPosition(resultBg1.x,resultBg1.y-resultBg1.getContentSize().height/4);winLabel.setVisible(false);this.sceneLayer.addChild(winLabel,1);this.winLabel=winLabel;var thiz=this;datLaiButton.addClickEventListener(function(){thiz._controller.requestDatlai()});
huyCuocButton.addClickEventListener(function(){thiz._controller.requestHuyCuoc()})},initController:function(){this._controller=new XocDiaController(this)},playSoundDatCuoc:function(){SoundPlayer.playSound(Date.now()%2?"moidatcuoc":"batdaudatcuoc")},initBettingSlot:function(){this.bettingSlot=[];var slotNode=new cc.Node;slotNode.setContentSize(cc.size(1280,720));slotNode.setAnchorPoint(cc.p(.5,.5));slotNode.setPosition(cc.p(cc.winSize.width/2,cc.winSize.height/2));slotNode.setScale(cc.winSize.screenScale);
this.sceneLayer.addChild(slotNode);var chipNode=new cc.Node;chipNode.setPosition(cc.p(0,0));slotNode.addChild(chipNode,1);this.chipNode=chipNode;for(var i=0;i<7;i++){var slot=new XocDiaBettingSlot(i,slotNode);slotNode.addChild(slot);var thiz=this;(function(){var slotIndex=s_xocdia_slot_id[i];slot.onTouchSlot=function(){thiz.onTouchSlot(slotIndex)};thiz.bettingSlot[slotIndex]=slot})()}var timer=new cc.ProgressTimer(new cc.Sprite("#xocdia_timer_2.png"));timer.setType(cc.ProgressTimer.TYPE_RADIAL);timer.setReverseDirection(true);
timer.setPosition(640,420);timer.setPercentage(30);slotNode.addChild(timer);this.timer=timer;var timerBg=new cc.Sprite("#xocdia_timer_1.png");timerBg.setPosition(timer.getContentSize().width/2,timer.getContentSize().height/2);timer.addChild(timerBg,-1);var timeLabel=new cc.LabelTTF("100",cc.res.font.Roboto_CondensedBold,60);timeLabel.setPosition(timer.getPosition());timeLabel.setColor(cc.color("#ffcf00"));slotNode.addChild(timeLabel);this.timeLabel=timeLabel},initChipButton:function(){var chipGroup=
new ChipGroup;this.sceneLayer.addChild(chipGroup);this.chipGroup=chipGroup;var left=310*cc.winSize.screenScale;var dx=110*cc.winSize.screenScale;var chip1=new XocDiaChip(1);chip1.setPosition(left+dx,30*cc.winSize.screenScale);chip1.setScale(cc.winSize.screenScale);chip1.originPoint=chip1.getPosition();chipGroup.addChip(chip1);var chip2=new XocDiaChip(2);chip2.setPosition(chip1.x+dx,chip1.y);chip2.setScale(cc.winSize.screenScale);chip2.originPoint=chip2.getPosition();chipGroup.addChip(chip2);var chip3=
new XocDiaChip(3);chip3.setPosition(chip2.x+dx,chip1.y);chip3.setScale(cc.winSize.screenScale);chip3.originPoint=chip3.getPosition();chipGroup.addChip(chip3);var chip4=new XocDiaChip(4);chip4.setPosition(chip3.x+dx,chip1.y);chip4.setScale(cc.winSize.screenScale);chip4.originPoint=chip4.getPosition();chipGroup.addChip(chip4)},initHistory:function(){var padding=2;var itemSize=cc.size(46,46);var row=4;var col=16;var left=52;var historyBg=new ccui.Scale9Sprite("xocdia_history_bg1.png",cc.rect(4,4,4,4));
historyBg.setPreferredSize(cc.size((itemSize.width+padding)*col+left,itemSize.height*row+padding*(row+1)));historyBg.setAnchorPoint(cc.p(0,0));var clippingNode=new ccui.Layout;clippingNode.setClippingEnabled(true);clippingNode.setAnchorPoint(cc.p(.5,1));clippingNode.setContentSize(historyBg.getContentSize());clippingNode.setPosition(cc.winSize.width/2,cc.winSize.height);clippingNode.setScale(cc.winSize.screenScale);this.sceneLayer.addChild(clippingNode,1);clippingNode.addChild(historyBg);this.historyBg=
historyBg;var historyBt=new ccui.Button("xocdia_history_bt.png","","",ccui.Widget.PLIST_TEXTURE);historyBt.setPosition(left/2,historyBg.getContentSize().height/2);historyBt.setZoomScale(0);historyBg.addChild(historyBt);var thiz=this;historyBt.addClickEventListener(function(){thiz.touchHistory()});var historyTouch=new ccui.Widget;historyTouch.setAnchorPoint(cc.p(0,0));historyTouch.setContentSize(historyBg.getContentSize());historyTouch.setTouchEnabled(true);historyBg.addChild(historyTouch);historyTouch.addClickEventListener(function(){thiz.touchHistory()});
this.historyTouch=historyTouch;for(var i=0;i<col;i++)for(var j=0;j<row;j++){var x=left+itemSize.width/2+(itemSize.width+padding)*i;var y=padding+itemSize.height/2+(itemSize.height+padding)*j;var bg=new ccui.Scale9Sprite("xocdia_history_bg2.png",cc.rect(4,4,4,4));bg.setPreferredSize(itemSize);bg.setPosition(x,y);historyBg.addChild(bg)}this.historyNode=new cc.Node;this.historyNode.setContentSize(historyBg.getContentSize());this.historyNode.setAnchorPoint(cc.p(0,0));historyBg.addChild(this.historyNode);
this._historyData=[]},touchHistory:function(){if(this.historyBg.showed)this.hideHistory();else this.showHistory()},showHistory:function(){var thiz=this;var left=52;this.historyBg.showed=true;this.historyBg.stopAllActions();this.historyBg.runAction(new cc.Sequence(new cc.MoveTo(.5,cc.p(0,0)),new cc.CallFunc(function(){thiz.historyTouch.setTouchEnabled(true)})))},hideHistory:function(){var thiz=this;var left=52;this.historyTouch.setTouchEnabled(false);this.historyBg.showed=false;this.historyBg.stopAllActions();
this.historyBg.runAction(new cc.Sequence(new cc.MoveTo(.5,cc.p(this.historyBg.getContentSize().width-left,0)),new cc.CallFunc(function(){})))},initDisk:function(){var diskSprite=new cc.Sprite("#xocdia_dia.png");diskSprite.setPosition(cc.winSize.width/2,cc.winSize.height+100);this.sceneLayer.addChild(diskSprite);this.diskSprite=diskSprite;var diskNode=new cc.Node;diskSprite.addChild(diskNode);this.diskNode=diskNode;var batSprite=new cc.Sprite("#xocdia_bat.png");this.batSpritePosition=cc.p(diskSprite.getContentSize().width/
2,diskSprite.getContentSize().height/2);batSprite.setPosition(this.batSpritePosition);diskSprite.addChild(batSprite);this.batSprite=batSprite},_setFinishedSlot:function(slotId,win){if(win)this.bettingSlot[slotId].setOpacity(255);else this.bettingSlot[slotId].setOpacity(100)},shakeDisk:function(){this.stopAllActions();this.diskNode.removeAllChildren(true);this.diskSprite.stopAllActions();this.batSprite.stopAllActions();this.hideHistory();this._shakeDisk=false;var thiz=this;this.batSprite.runAction(new cc.MoveTo(1,
this.batSpritePosition));this.diskSprite.runAction(new cc.Sequence(new cc.EaseSineOut(new cc.MoveTo(1,cc.p(cc.winSize.width/2,cc.winSize.height/2))),new cc.DelayTime(.2),new cc.CallFunc(function(){thiz._shakeDisk=true}),new quyetnd.ActionShake2D(3,cc.p(10,10)),new cc.CallFunc(function(){thiz._shakeDisk=false})))},hideDisk:function(){this._shakeDisk=false;this.diskNode.removeAllChildren(true);this.diskSprite.stopAllActions();this.batSprite.stopAllActions();this.showHistory();this.diskSprite.runAction(new cc.MoveTo(1,
cc.p(cc.winSize.width/2,cc.winSize.height+100)));this.batSprite.runAction(new cc.MoveTo(1,this.batSpritePosition))},openDisk:function(data){this._shakeDisk=false;this.stopAllActions();SoundPlayer.playSound(["bellopen","mobat"]);this.diskNode.removeAllChildren(true);this.diskSprite.stopAllActions();this.batSprite.stopAllActions();this.hideHistory();var result=data.result;this._addResultSprite(result);var sounds=this._getSoundOpenDisk(result);this.diskSprite.runAction(new cc.EaseSineOut(new cc.MoveTo(1,
cc.p(cc.winSize.width/2,cc.winSize.height/2))));this.batSprite.runAction(new cc.Sequence(new cc.DelayTime(1.2),new cc.EaseSineIn(new cc.MoveBy(1,cc.p(0,450))),new cc.CallFunc(function(){SoundPlayer.playSound(sounds)})));var thiz=this;var winSlot=data.winSlot;var loseSlot=data.loseSlot;this.runAction(new cc.Sequence(new cc.DelayTime(6),new cc.CallFunc(function(){thiz.hideDisk();for(var i=0;i<winSlot.length;i++)thiz._setFinishedSlot(winSlot[i],true);for(var i=0;i<loseSlot.length;i++)thiz._setFinishedSlot(loseSlot[i],
false)}),new cc.DelayTime(1),new cc.CallFunc(function(){for(var i=0;i<loseSlot.length;i++)thiz.thuTienSlot(loseSlot[i])}),new cc.DelayTime(1),new cc.CallFunc(function(){for(var i=0;i<winSlot.length;i++)thiz.traTienSlot(winSlot[i])}),new cc.DelayTime(1),new cc.CallFunc(function(){for(var i=0;i<winSlot.length;i++)thiz.traTienUser(winSlot[i])})))},_addResultSprite:function(result){var arr=_get_random_array(4,s_xocdia_result_position.length);for(var i=0;i<arr.length;i++){if(i<result)var sprite=new cc.Sprite("#xocdia_hat_do.png");
else var sprite=new cc.Sprite("#xocdia_hat_trang.png");sprite.setPosition(s_xocdia_result_position[arr[i]]);this.diskNode.addChild(sprite)}},_getSoundOpenDisk:function(result){var soundArray=[];if(result==0)soundArray.push("ngua4");else if(result==4)soundArray.push("xap4");else if(result==2)soundArray.push("xap2");else if(result==1)soundArray.push("xap1");else if(result==3)soundArray.push("xap3");soundArray.push(result%2?"le":"chan");return soundArray},onEnter:function(){this._super();this.chipGroup.selectChipAtIndex(0,
true);this.scheduleUpdate()},onTouchSlot:function(slotId){if(this.chipGroup.chipSelected){var chipId=this.chipGroup.chipSelected.chipIndex-1;this._controller.requestDatCuoc(slotId,chipId)}else this.showErrorMessage("B\u1ea1n ph\u1ea3i ch\u1ecdn m\u1ee9c c\u01b0\u1ee3c")},addChipToSlot:function(slotIndex,chipIndex,from,tag,noAnimation){if(from==1)var chipPosition=this.chipGroup.getChip(chipIndex).getPosition();else if(from==2)var chipPosition=this.playerButton.getWorldPosition();else var chipPosition=
cc.p(cc.winSize.width/2,cc.winSize.height);if(!tag)if(from==1)tag=this.chipTagMe;else if(from==2)tag=this.chipTagOther;else tag=0;var slot=this.bettingSlot[slotIndex];var thiz=this;var addChipHandler=function(){var chip=new cc.Sprite("#xocdia-chipSelected-"+(chipIndex+1)+".png");chip.chipIndex=chipIndex;chip.chipTag=tag;chip.setPosition(thiz.chipNode.convertToNodeSpace(chipPosition));thiz.chipNode.addChild(chip);slot.addChip(chip);if(noAnimation){var p=slot.getSlotPosition();chip.setPosition(p);chip.setScale(.3)}else{var p=
slot.getSlotPosition();var duration=cc.pLength(cc.pSub(chip.getPosition(),p))/1E3;var moveAction=new cc.Spawn(new cc.MoveTo(duration,p),new cc.ScaleTo(duration,.3));chip.runAction(new cc.EaseSineOut(moveAction))}SoundPlayer.playSound("singlechip")};if(from==1||from==3)addChipHandler();else{var delayTime=.5+Math.random()*1.5;this.runAction(new cc.Sequence(new cc.DelayTime(delayTime),new cc.CallFunc(addChipHandler)))}},thuTienSlot:function(slotId){var chips=this.bettingSlot[slotId]._chips;for(var i=
0;i<chips.length;i++)(function(){var chip=chips[i];chips[i].runAction(new cc.Sequence(new cc.MoveTo(.5,cc.p(cc.winSize.width/2,cc.winSize.height)),new cc.CallFunc(function(){chip.removeFromParent(true)})))})();this.bettingSlot[slotId]._chips=[]},traTienSlot:function(slotId){var chips=this.bettingSlot[slotId]._chips;var length=chips.length;for(var i=0;i<length;i++)this.addChipToSlot(slotId,chips[i].chipIndex,3,chips[i].chipTag)},traTienUser:function(slotId){var chips=this.bettingSlot[slotId]._chips;
var thiz=this;for(var i=0;i<chips.length;i++)(function(){var chip=chips[i];if(chip.chipTag==thiz.chipTagMe)chip.runAction(new cc.Sequence(new cc.MoveTo(.5,cc.p(50,50)),new cc.CallFunc(function(){chip.removeFromParent(true)}),new cc.CallFunc(function(){if(thiz.pendingGoldChange>0){thiz.performChangeAsset(thiz.pendingGoldChange);thiz.pendingGoldChange=null}})));else{var p=thiz.playerButton.getWorldPosition();chip.runAction(new cc.Sequence(new cc.MoveTo(.5,p),new cc.CallFunc(function(){chip.removeFromParent(true)})))}})();
this.bettingSlot[slotId]._chips=[]},performChangeAsset:function(changeAmount){var changeSprite=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_30,"");var changeText=(changeAmount>=0?"+":"")+changeAmount;changeSprite.setString(changeText);changeSprite.setColor(cc.color(changeAmount>=0?"#ffde00":"#ff0000"));changeSprite.setPosition(50,70);this.sceneLayer.addChild(changeSprite,420);changeSprite.runAction(new cc.Sequence(new cc.MoveTo(1,changeSprite.x,changeSprite.y+50),new cc.CallFunc(function(){changeSprite.removeFromParent(true)})))},
resetGame:function(){for(var i=0;i<this.bettingSlot.length;i++)this.bettingSlot[i].reset();this.chipNode.removeAllChildren(true);this.stopAllActions();this.setTongCuocLabel(-1);this.setWinLabel(-1);this._shakeDisk=false},datLaiThanhCong:function(){},huyCuocThanhCong:function(){var tagMe=this.chipTagMe;var pTarget=this.chipNode.convertToNodeSpace(cc.p(50,50));for(var i=0;i<this.bettingSlot.length;i++){var chips=this.bettingSlot[i]._chips;for(var j=0;j<chips.length;j++)(function(){var chip=chips[j];
if(chip.chipTag==tagMe)chip.runAction(new cc.Sequence(new cc.MoveTo(.5,pTarget),new cc.CallFunc(function(){chip.removeFromParent(true)})))})();this.bettingSlot[i]._chips=[]}},updateSlotGold:function(slotId,gold){var slot=this.bettingSlot[slotId];if(!slot)cc.log("slot null");slot.setSlotGold(gold)},updateUserGold:function(slotId,gold){var slot=this.bettingSlot[slotId];slot.setUserGold(gold)},updateUserCount:function(userCount){this.userLabel.setString(userCount)},setTimeRemaining:function(currentTime,
maxTime){this.timer.stopAllActions();this.timeLabel.stopAllActions();if(maxTime<=0){this.timeLabel.setColor(cc.color("#ffcf00"));this.timer.setColor(cc.color("#ffcf00"));this.timeLabel.setString("0");this.timer.setPercentage(0);this.timeLabel.setVisible(false);this.timer.setVisible(false);return}this.timeLabel.setVisible(true);this.timer.setVisible(true);var timerProgress=100*currentTime/maxTime;this.timer.runAction(new cc.ProgressFromTo(currentTime,timerProgress,0));this.timeLabel.runAction(new quyetnd.ActionTimeRemaining(currentTime));
var alertSoundAction=function(time){var action=new cc.Sequence(new cc.CallFunc(function(){SoundPlayer.playSound("countDownS")}),new cc.DelayTime(1));return new cc.Repeat(action,Math.floor(time))};var thiz=this;if(currentTime>5){this.timeLabel.setColor(cc.color("#ffcf00"));this.timer.setColor(cc.color("#ffcf00"));this.timeLabel.runAction(new cc.Sequence(new cc.DelayTime(currentTime-5),new cc.CallFunc(function(){var alertAction=new cc.Sequence(new cc.TintTo(.2,255,0,0),new cc.TintTo(.2,255,207,0));
thiz.timeLabel.runAction(new cc.RepeatForever(alertAction))})));this.timer.runAction(new cc.Sequence(new cc.DelayTime(currentTime-5),new cc.CallFunc(function(){var alertAction=new cc.Sequence(new cc.TintTo(.2,255,0,0),new cc.TintTo(.2,255,207,0));thiz.timer.runAction(new cc.RepeatForever(alertAction));thiz.timer.runAction(alertSoundAction(5))})))}else{var alertAction=new cc.Sequence(new cc.TintTo(.2,255,0,0),new cc.TintTo(.2,255,207,0));this.timeLabel.runAction(new cc.RepeatForever(alertAction.clone()));
this.timer.runAction(new cc.RepeatForever(alertAction));thiz.timer.runAction(alertSoundAction(currentTime))}},setChipValue:function(chipId,gold){this.chipGroup.getChip(chipId).setGold(gold)},setDatLaiButtonVisible:function(visible){this.datLaiButton.setVisible(visible)},setHuyCuocButtonVisible:function(visible){this.huyCuocButton.setVisible(visible)},_addHistory:function(history){if(this._historyData.length==0){this._historyData.push(history);return}var row=4;var col=16;var maxItem=row*col;var lastHistory=
this._historyData[this._historyData.length-1];if(lastHistory%2!=history%2){var emptyCount=this._historyData.length%row;if(emptyCount>0){emptyCount=row-emptyCount;for(var i=0;i<emptyCount;i++)this._historyData.push(-1)}}this._historyData.push(history);if(this._historyData.length>maxItem)this._historyData.splice(0,row)},_refreshHistory:function(){var padding=2;var itemSize=cc.size(46,46);var row=4;var left=52;this.historyNode.removeAllChildren(true);for(var i=0;i<this._historyData.length;i++)if(this._historyData[i]>=
0){var label=new cc.LabelBMFont(this._historyData[i].toString(),cc.res.font.Roboto_CondensedBold_25);var x=left+itemSize.width/2+(itemSize.width+padding)*Math.floor(i/row);var y=this.historyNode.getContentSize().height-padding-itemSize.height/2-(itemSize.height+padding)*(i%row);if(this._historyData[i]%2){var historyIcon=new cc.Sprite("#xocdia_history_1.png");label.setColor(cc.color("#ffffff"))}else{var historyIcon=new cc.Sprite("#xocdia_history_2.png");label.setColor(cc.color("#333333"))}historyIcon.setPosition(x,
y);this.historyNode.addChild(historyIcon,0);label.setPosition(x,y);this.historyNode.addChild(label,1)}},setHistory:function(history){this._historyData=[];for(var i=0;i<history.length;i++)this._addHistory(history[i]);this._refreshHistory()},setTongCuocLabel:function(gold){if(gold<0)this.tongCuocLabal.setVisible(false);else{this.tongCuocLabal.setVisible(true);this.tongCuocLabal.setString("T\u1ed5ng c\u01b0\u1ee3c: "+cc.Global.NumberFormat1(gold))}},setWinLabel:function(gold){if(gold<0)this.winLabel.setVisible(false);
else{this.winLabel.setVisible(true);this.winLabel.setString("Th\u1eafng: "+cc.Global.NumberFormat1(gold));this.pendingGoldChange=gold}},updateGold:function(username,gold){this.playerMe.setGold(gold)},setUserCount:function(count){this.userLabel.setString(count)},processPlayerPosition:function(){},updateOwner:function(){}});var s_taixiu_id=s_taixiu_id||[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31];
var s_taixiu_slot_position=s_taixiu_slot_position||[{x:2,y:332},{x:200,y:332},{x:340,y:332},{x:480,y:332},{x:760,y:332},{x:900,y:332},{x:1040,y:332},{x:2,y:112},{x:200,y:222},{x:320,y:222},{x:440,y:222},{x:560,y:222},{x:680,y:222},{x:800,y:222},{x:920,y:222},{x:1040,y:112},{x:200,y:112},{x:320,y:112},{x:440,y:112},{x:560,y:112},{x:680,y:112},{x:800,y:112},{x:920,y:112},{x:2,y:2},{x:200,y:2},{x:340,y:2},{x:480,y:2},{x:620,y:2},{x:760,y:2},{x:900,y:2},{x:1040,y:2}];
var s_taixiu_slot_size=s_taixiu_slot_size||[{width:193,height:110},{width:135,height:110},{width:135,height:110},{width:275,height:110},{width:135,height:110},{width:135,height:110},{width:193,height:110},{width:193,height:215},{width:115,height:105},{width:115,height:105},{width:115,height:105},{width:115,height:105},{width:115,height:105},{width:115,height:105},{width:115,height:105},{width:193,height:215},{width:115,height:105},{width:115,height:105},{width:115,height:105},{width:115,height:105},
{width:115,height:105},{width:115,height:105},{width:115,height:105},{width:193,height:105},{width:135,height:105},{width:135,height:105},{width:135,height:105},{width:135,height:105},{width:135,height:105},{width:135,height:105},{width:193,height:105}];var s_taixiu_result_position=s_taixiu_result_position||[{x:108,y:96},{x:260,y:111},{x:319,y:171},{x:255,y:220},{x:180,y:183},{x:107,y:137},{x:100,y:228},{x:192,y:165},{x:134,y:306},{x:260,y:311},{x:316,y:258}];
var TaiXiuBettingSlot=cc.Node.extend({ctor:function(idx,parentNode){this._super();this._chips=[];this._chipNode=new cc.Node;this.addChild(this._chipNode);this.setAnchorPoint(cc.p(0,0));this.setPosition(s_taixiu_slot_position[idx]);var size=s_taixiu_slot_size[idx];this.setContentSize(size);var bg=new cc.Sprite("#taixiu_winSprite.png");bg.setAnchorPoint(cc.p(0,0));bg.setScale(size.width/bg.getContentSize().width,size.height/bg.getContentSize().height);bg.setPosition(cc.p(0,0));this.addChild(bg);this.winSprite=
bg;var slotGoldLabel=new cc.LabelBMFont("100",cc.res.font.Roboto_Condensed_25);slotGoldLabel.setColor(cc.color("#767eb6"));slotGoldLabel.setPosition(this.x+size.width*.25,this.y+16);slotGoldLabel.setScale(20/25);parentNode.addChild(slotGoldLabel,2);var userGoldLabel=new cc.LabelBMFont("100",cc.res.font.Roboto_CondensedBold_25);userGoldLabel.setColor(cc.color("#ffde00"));userGoldLabel.setPosition(this.x+size.width*.75,slotGoldLabel.y);userGoldLabel.setScale(20/25);parentNode.addChild(userGoldLabel,
2);this.slotGoldLabel=slotGoldLabel;this.userGoldLabel=userGoldLabel;this.reset();var rectTouch=cc.rect(0,0,this.getContentSize().width,this.getContentSize().height);var thiz=this;cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:true,onTouchBegan:function(touch,event){var p=thiz.convertToNodeSpace(touch.getLocation());if(cc.rectContainsPoint(rectTouch,p)){if(thiz.onTouchSlot)thiz.onTouchSlot();return true}return false}},this)},reset:function(){this.winSprite.setVisible(false);
this.removeChip();this.setSlotGold(0);this.setUserGold(0)},setSlotGold:function(gold){this._slotGold=gold;this.slotGoldLabel.stopAllActions();if(gold>0){this.slotGoldLabel.visible=true;this.slotGoldLabel.setOpacity(255);this.slotGoldLabel.setString(cc.Global.NumberFormat2(gold))}else{this.slotGoldLabel.setString("0");this.slotGoldLabel.visible=false}},setUserGold:function(gold){this._userGold=gold;this.userGoldLabel.stopAllActions();if(gold>0){this.userGoldLabel.visible=true;this.userGoldLabel.setOpacity(255);
this.userGoldLabel.setString(cc.Global.NumberFormat2(gold))}else{this.userGoldLabel.setString("0");this.userGoldLabel.visible=false}},getSlotPosition:function(){var padding=50;var w=Math.random()*(this.getContentSize().width-padding*2)+padding;var h=Math.random()*(this.getContentSize().height-padding*2)+padding;var x=this.x+w;var y=this.y+h;return cc.p(x,y)},addChip:function(chipSprite){this._chips.push(chipSprite)},removeChip:function(){this._chips=[]},slotWin:function(win){if(win)this.winSprite.setVisible(true);
else this.winSprite.setVisible(false)}});
var TaiXiuScene=XocDiaScene.extend({ctor:function(){this._super()},initController:function(){this._controller=new TaiXiuController(this)},initBettingSlot:function(){this.bettingSlot=[];var slotNode=new cc.Node;slotNode.setContentSize(cc.size(1280,720));slotNode.setAnchorPoint(cc.p(.5,.5));slotNode.setPosition(cc.winSize.width/2,325);slotNode.setScale(cc.winSize.screenScale);this.sceneLayer.addChild(slotNode);var chipNode=new cc.Node;chipNode.setPosition(cc.p(0,0));slotNode.addChild(chipNode,1);this.chipNode=
chipNode;var taiXiuBg=new cc.Sprite("#taixiu_bg.png");taiXiuBg.setAnchorPoint(cc.p(0,0));taiXiuBg.setPosition(cc.p(0,0));slotNode.setContentSize(taiXiuBg.getContentSize());slotNode.addChild(taiXiuBg);for(var i=0;i<31;i++){var slot=new TaiXiuBettingSlot(i,slotNode);slotNode.addChild(slot);var thiz=this;(function(){var slotIndex=s_taixiu_id[i];slot.onTouchSlot=function(){thiz.onTouchSlot(slotIndex)};thiz.bettingSlot[slotIndex]=slot})()}var timer=new cc.ProgressTimer(new cc.Sprite("#xocdia_timer_2.png"));
timer.setType(cc.ProgressTimer.TYPE_RADIAL);timer.setReverseDirection(true);timer.setPosition(cc.winSize.width-165*cc.winSize.screenScale,cc.winSize.height-70*cc.winSize.screenScale);timer.setPercentage(30);timer.setScale(.65*cc.winSize.screenScale);this.sceneLayer.addChild(timer);this.timer=timer;var timerBg=new cc.Sprite("#xocdia_timer_1.png");timerBg.setPosition(timer.getContentSize().width/2,timer.getContentSize().height/2);timer.addChild(timerBg,-1);var timeLabel=new cc.LabelTTF("100",cc.res.font.Roboto_CondensedBold,
40);timeLabel.setPosition(timer.getPosition());timeLabel.setColor(cc.color("#ffcf00"));timeLabel.setScale(cc.winSize.screenScale);this.sceneLayer.addChild(timeLabel);this.timeLabel=timeLabel},_getSoundOpenDisk:function(result){var soundArray=[];if(result[0]==result[1]&&result[1]==result[2]){soundArray.push("dong");var template=["","nhat","nhi","tam","tu","ngu","luc"];soundArray.push(template[result[0]])}else{var tonghat=result[0]+result[1]+result[2];soundArray.push("tong");if(tonghat>10){soundArray.push("so_10");
soundArray.push("so_"+(tonghat-10))}else soundArray.push("so_"+tonghat);soundArray.push("space");soundArray.push(tonghat<11?"xiu":"tai")}return soundArray},initHistory:function(){var padding=2;var itemSize=cc.size(46,160);var col=16;var left=52;var historyBg=new ccui.Scale9Sprite("xocdia_history_bg1.png",cc.rect(4,4,4,4));historyBg.setPreferredSize(cc.size((itemSize.width+padding)*col+left,itemSize.height+padding*2));historyBg.setAnchorPoint(cc.p(0,0));var clippingNode=new ccui.Layout;clippingNode.setClippingEnabled(true);
clippingNode.setAnchorPoint(cc.p(.5,1));clippingNode.setContentSize(historyBg.getContentSize());clippingNode.setPosition(cc.winSize.width/2,cc.winSize.height);clippingNode.setScale(cc.winSize.screenScale);this.sceneLayer.addChild(clippingNode,1);clippingNode.addChild(historyBg);this.historyBg=historyBg;var historyBt=new ccui.Button("xocdia_history_bt.png","","",ccui.Widget.PLIST_TEXTURE);historyBt.setPosition(left/2,historyBg.getContentSize().height/2);historyBt.setZoomScale(0);historyBg.addChild(historyBt);
var thiz=this;historyBt.addClickEventListener(function(){thiz.touchHistory()});var historyTouch=new ccui.Widget;historyTouch.setAnchorPoint(cc.p(0,0));historyTouch.setContentSize(historyBg.getContentSize());historyTouch.setTouchEnabled(true);historyBg.addChild(historyTouch);historyTouch.addClickEventListener(function(){thiz.touchHistory()});this.historyTouch=historyTouch;for(var i=0;i<col;i++){var x=left+itemSize.width/2+(itemSize.width+padding)*i;var y=padding+itemSize.height/2;var bg=new ccui.Scale9Sprite("xocdia_history_bg2.png",
cc.rect(4,4,4,4));bg.setPreferredSize(itemSize);bg.setPosition(x,y);historyBg.addChild(bg)}this.historyNode=new cc.Node;this.historyNode.setContentSize(historyBg.getContentSize());this.historyNode.setAnchorPoint(cc.p(0,0));historyBg.addChild(this.historyNode);this._historyData=[]},_addHistory:function(history){this._historyData.push(history);if(this._historyData.length>16)this._historyData.splice(0,1)},_refreshHistory:function(){this.historyNode.removeAllChildren(true);var padding=2;var itemSize=
cc.size(46,160);var left=52;for(var i=0;i<this._historyData.length;i++){var data=this._historyData[i];var x=left+itemSize.width/2+(itemSize.width+padding)*i;var sumBg=new cc.Sprite("#taixiu_history_bg.png");sumBg.setPosition(x,53);this.historyNode.addChild(sumBg,0);var sum=0;for(var j=0;j<data.length;j++){var sprite=new cc.Sprite("#taixiu_dice_history_"+data[j]+".png");sprite.setPosition(x,91+25*j);this.historyNode.addChild(sprite,0);sum+=data[j]}if(sum>10){var label=new cc.LabelBMFont("T\u00c0I",
cc.res.font.Roboto_Condensed_25);label.setColor(cc.color("#00ccff"))}else{var label=new cc.LabelBMFont("X\u1ec8U",cc.res.font.Roboto_Condensed_25);label.setColor(cc.color("#ffde00"))}label.setScale(20/25);label.setPosition(x,16);this.historyNode.addChild(label,1);var sumLabel=new cc.LabelBMFont(sum.toString(),cc.res.font.Roboto_Condensed_25);sumLabel.setScale(20/25);sumLabel.setPosition(sumBg.getPosition());this.historyNode.addChild(sumLabel,1)}},_addResultSprite:function(result){var arr=_get_random_array(result.length,
s_taixiu_result_position.length);for(var i=0;i<arr.length;i++){var sprite=new cc.Sprite("#taixiu_dice_"+result[i]+".png");sprite.setScale(.75);sprite.setPosition(s_taixiu_result_position[arr[i]]);this.diskNode.addChild(sprite)}},_setFinishedSlot:function(slotId,win){this.bettingSlot[slotId].slotWin(win)}});var VongQuayLayer=cc.Node.extend({ctor:function(){this._super();this.state=0;this.rotateSpeed=720;var bg=new cc.Sprite("#vongquay_circle_bg.png");bg.setPosition(cc.winSize.width/2,cc.winSize.height/2);this.addChild(bg);var circle=new cc.Sprite("#vongquay_circle.png");circle.setPosition(circle.getContentSize().width/2,circle.getContentSize().height/2);bg.addChild(circle);var arrow=new cc.Sprite("#vongquay_arrow.png");arrow.setPosition(circle.getPosition());bg.addChild(arrow);var okButton=new ccui.Button("vongquay_bt.png",
"","",ccui.Widget.PLIST_TEXTURE);okButton.setZoomScale(.03);okButton.setPosition(circle.getPosition());bg.addChild(okButton);this.circle=circle;var thiz=this;okButton.addClickEventListener(function(){thiz.okButtonHandler()})},okButtonHandler:function(){if(this.state==0)this.state=1;else if(this.state==1)this.stopAtRotate(90)},stopAtRotate:function(rotate){this.state=2;var s=rotate-this.circle.getRotation();while(s<1500)s+=360;this.startRotate=this.circle.getRotation();this.acceleration=-(this.rotateSpeed*
this.rotateSpeed)/(s*2);this.timeElapsed=0;this.maxTime=s*2/this.rotateSpeed},update:function(dt){if(this.state==1){var rotate=this.circle.getRotation()+this.rotateSpeed*dt;this.circle.setRotation(rotate)}else if(this.state==2){this.timeElapsed+=dt;if(this.timeElapsed>=this.maxTime){this.timeElapsed=this.maxTime;this.onFinishedRotate()}var s=this.rotateSpeed*this.timeElapsed+this.acceleration*this.timeElapsed*this.timeElapsed/2;var rotate=this.startRotate+s;this.circle.setRotation(rotate)}},onEnter:function(){this._super();
this.scheduleUpdate()},onExit:function(){this._super();this.unscheduleUpdate()},onFinishedRotate:function(){this.state=0}});var VongQuayScene=IGameScene.extend({ctor:function(){this._super();var vongQuay=new VongQuayLayer;this.sceneLayer.addChild(vongQuay)},backButtonClickHandler:function(){this.exitToGame()}});var MiniTaiXiuNotification=cc.Node.extend({ctor:function(){this._super();this.timeRemaining=0;var _bg=cc.Sprite.create("#top_bar_news_bg.png");_bg.setVisible(false);this.addChild(_bg);this.bg=_bg;var _lb_count=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_20,"",cc.TEXT_ALIGNMENT_CENTER);_lb_count.setColor(cc.color("#000000"));_lb_count.setPosition(cc.p(this.bg.getContentSize().width/2,this.bg.getContentSize().height/2));this.bg.addChild(_lb_count);this.lb_count=_lb_count},update:function(dt){if(this.timeRemaining>=
0){this.timeRemaining-=dt;this.bg.setVisible(true);this.lb_count.setString(Math.round(this.timeRemaining))}else this.bg.setVisible(false)},onEnter:function(){this._super();LobbyClient.getInstance().addListener("updateMiniGameMetaData",this.updateMiniGameMetaData,this);this.scheduleUpdate()},onExit:function(){this._super();LobbyClient.getInstance().removeListener(this);this.unscheduleUpdate()},updateMiniGameMetaData:function(cmd,message){var data=message["data"];var game=data["game"];if(game==="mini.taixiu")this.timeRemaining=
data["remainTime"]}});var s_float_button_games=s_float_button_games||[GameType.MiniGame_CaoThap,GameType.MiniGame_Poker,GameType.MiniGame_ChanLe,GameType.MiniGame_VideoPoker];var s_float_button_animationDuration=s_float_button_animationDuration||.2;
var FloatButtonCenter=cc.Node.extend({ctor:function(){this._super();var normalSprite=new cc.Sprite("#floatBt-hide.png");this.addChild(normalSprite);this.setContentSize(cc.size(84,84));var showSprite=new cc.Sprite("#floatbt-show.png");showSprite.visible=false;this.addChild(showSprite);this.normalSprite=normalSprite;this.showSprite=showSprite},show:function(){this.normalSprite.visible=false;this.showSprite.visible=true},hide:function(){this.normalSprite.visible=true;this.showSprite.visible=false}});
var FloatButton=function(){var instance=null;var FloatButtonClass=cc.Node.extend({ctor:function(){this._super();this.showAll=false;this.setPosition(cc.winSize.width/2,cc.winSize.height/2);var bg=new cc.Sprite("#floatBt-bg.png");bg.visible=false;this.addChild(bg);this.bg=bg;var _newCountMiniTaiXiu=new MiniTaiXiuNotification;_newCountMiniTaiXiu.setPosition(cc.p(30,30));this.addChild(_newCountMiniTaiXiu,10);_newCountMiniTaiXiu.setVisible(false);this.newCountMiniTaiXiu=_newCountMiniTaiXiu;this.initComponent();
this.initButtonCenter()},initButtonCenter:function(){var btCenter=new FloatButtonCenter;btCenter.setPosition(0,0);this.addChild(btCenter);this.rectTouch=cc.rect(-btCenter.getContentSize().width/2,-btCenter.getContentSize().height/2,btCenter.getContentSize().width,btCenter.getContentSize().height);this.btCenter=btCenter},initComponent:function(){var radius=cc.p(0,120);var size=s_float_button_games.length;var allComponent=[];for(var i=0;i<size;i++){var component=new FloatButtomComponent(s_float_button_games[i]);
var angle=cc.PI*2/size*i;component.targetPosition=cc.pRotateByAngle(radius,cc.p(0,0),angle);component.visible=false;this.addChild(component);allComponent.push(component);component.setPosition(component.targetPosition)}this.allComponent=allComponent},show:function(parent){var currentParent=this.getParent();if(currentParent)currentParent.removeChild(this);parent.addChild(this,100);this.forceHide()},onEnter:function(){this._super();this.isTouch=false;var thiz=this;cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,
swallowTouches:true,onTouchBegan:function(touch,event){if(thiz.isTouch)return false;var b=thiz.onTouchBegan(touch,event);if(b)thiz.isTouch=true;return b},onTouchMoved:function(touch,event){thiz.onTouchMoved(touch,event)},onTouchEnded:function(touch,event){thiz.isTouch=false;thiz.onTouchEnded(touch,event)}},this)},onExit:function(){this._super();cc.eventManager.removeListeners(this);this.sendCommandSubrideMiniTaiXiu("unSubscribeMiniGameMetaData")},onTouchBegan:function(touch,event){if(!cc.Global.NodeIsVisible(this))return false;
var p=this.convertToNodeSpace(touch.getLocation());if(cc.rectContainsPoint(this.rectTouch,p)){this.startPosition=touch.getLocation();this.isMoved=false;this.canMoved=true;return true}else if(this.showAll){this.canMoved=false;this.hideAllComponent();return true}return false},onTouchMoved:function(touch,event){if(!this.canMoved)return;var p=touch.getLocation();if(!this.isMoved){var d=cc.pDistance(this.startPosition,p);if(cc.pDistance(this.startPosition,p)>=10)this.isMoved=true;else return}var x=this.x+
(p.x-this.startPosition.x);var y=this.y+(p.y-this.startPosition.y);var left=x-this.rectTouch.width/2;var right=x+this.rectTouch.width/2;var top=y+this.rectTouch.height/2;var bottom=y-this.rectTouch.height/2;if(left<0)x=this.rectTouch.width/2;if(right>cc.winSize.width)x=cc.winSize.width-this.rectTouch.width/2;if(bottom<0)y=this.rectTouch.height/2;if(top>cc.winSize.height)y=cc.winSize.height-this.rectTouch.height/2;this.x=x;this.y=y;this.startPosition=p},onTouchEnded:function(touch,event){if(!this.canMoved)return;
if(!this.isMoved)if(this.showAll)this.hideAllComponent();else this.showAllComponent()},showAllComponent:function(){this.newCountMiniTaiXiu.setVisible(false);this.showAll=true;this.btCenter.show();for(var i=0;i<this.allComponent.length;i++)this.allComponent[i].show(s_float_button_animationDuration);this.bg.visible=true;this.bg.setScale(0);this.bg.stopAllActions();this.bg.runAction(new cc.EaseSineOut(new cc.ScaleTo(s_float_button_animationDuration,1)))},hideAllComponent:function(){this.newCountMiniTaiXiu.setVisible(true);
this.showAll=false;this.btCenter.hide();for(var i=0;i<this.allComponent.length;i++)this.allComponent[i].hide(s_float_button_animationDuration);this.bg.stopAllActions();var scaleAction=new cc.EaseSineIn(new cc.ScaleTo(s_float_button_animationDuration,0));var thiz=this;var finishedAction=new cc.CallFunc(function(){thiz.bg.visible=false});this.bg.runAction(new cc.Sequence(scaleAction,finishedAction))},forceHide:function(){this.newCountMiniTaiXiu.setVisible(false);this.showAll=false;this.btCenter.hide();
for(var i=0;i<this.allComponent.length;i++)this.allComponent[i].visible=false;this.bg.visible=false},setVisible:function(visible){this._super(visible);this.newCountMiniTaiXiu.setVisible(visible);if(visible)this.sendCommandSubrideMiniTaiXiu("subscribeMiniGameMetaData");else this.sendCommandSubrideMiniTaiXiu("unSubscribeMiniGameMetaData")},sendCommandSubrideMiniTaiXiu:function(command){LobbyClient.getInstance().send({command:command,game:"mini.taixiu"})}});FloatButtonClass.getInstance=function(){if(!instance){instance=
new FloatButtonClass;instance.retain()}return instance};return FloatButtonClass}();var FloatButtonShowAnimation=cc.CustomAction.extend({ctor:function(duration){this._target=null;this._startPosition=null;this.targetPosition=cc.p(0);this.rotateAngle=0;this._super();this.initWithDuration(duration)},onUpdate:function(dt){var dx=this.targetPosition.x-this._startPosition.x;var dy=this.targetPosition.y-this._startPosition.y;var x=this._startPosition.x+dx*dt;var y=this._startPosition.y+dy*dt;var angle=(1-dt)*this.rotateAngle;var p=cc.pRotateByAngle(cc.p(x,y),cc.p(0,0),cc.degreesToRadians(angle));
this._target.setPosition(p)},onStartWithTarget:function(target){this._target=target;this._startPosition=target.getPosition()}});
var FloatButtonHideAnimation=FloatButtonShowAnimation.extend({ctor:function(duration){this._super(duration)},onUpdate:function(dt){var dx=this.targetPosition.x-this._startPosition.x;var dy=this.targetPosition.y-this._startPosition.y;var x=this._startPosition.x+dx*dt;var y=this._startPosition.y+dy*dt;var angle=dt*this.rotateAngle;var p=cc.pRotateByAngle(cc.p(x,y),cc.p(0,0),cc.degreesToRadians(angle));this._target.setPosition(p)}});var FloatButtomComponent=cc.Node.extend({ctor:function(gameId){this._super();this.gameId=gameId;var img=new cc.Sprite("#floatBt-game-"+gameId+".png");this.addChild(img);this.rectTouch=cc.rect(-img.getContentSize().width/2,-img.getContentSize().height/2,img.getContentSize().width,img.getContentSize().height);if(gameId==GameType.MiniGame_ChanLe){var newCountLayer=new MiniTaiXiuNotification;newCountLayer.setPosition(cc.p(30,30));this.addChild(newCountLayer)}},show:function(duration){this.visible=true;
this.setPosition(cc.p(0,0));var rotateAngle=72;var moveAction=new FloatButtonShowAnimation(duration);moveAction.targetPosition=this.targetPosition;moveAction.rotateAngle=rotateAngle;this.setRotation(-rotateAngle);var rotateAction=new cc.RotateTo(duration,0);var action=new cc.Spawn(moveAction,rotateAction);this.stopAllActions();this.runAction(new cc.EaseSineOut(action))},hide:function(duration){var rotateAngle=72;var moveAction=new FloatButtonHideAnimation(duration);moveAction.targetPosition=cc.p(0,
0);moveAction.rotateAngle=rotateAngle;var rotateAction=new cc.RotateTo(duration,-rotateAngle);var action=new cc.EaseSineIn(new cc.Spawn(moveAction,rotateAction));var thiz=this;var finishedAction=new cc.CallFunc(function(){thiz.visible=false});this.stopAllActions();this.runAction(new cc.Sequence(action,finishedAction))},onEnter:function(){this._super();this.isTouch=false;var thiz=this;cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:true,onTouchBegan:function(touch,
event){if(thiz.isTouch)return false;var b=thiz.onTouchBegan(touch,event);if(b)thiz.isTouch=true;return b},onTouchEnded:function(touch,event){thiz.isTouch=false;thiz.onTouchEnded(touch,event)}},this)},onExit:function(){this._super();cc.eventManager.removeListeners(this)},onTouchBegan:function(touch,event){if(!cc.Global.NodeIsVisible(this))return false;var p=this.convertToNodeSpace(touch.getLocation());if(cc.rectContainsPoint(this.rectTouch,p))return true;return false},onTouchEnded:function(touch,event){var p=
this.convertToNodeSpace(touch.getLocation());if(cc.rectContainsPoint(this.rectTouch,p)){var homeScene=cc.director.getRunningScene();homeScene.onTouchGame(this.gameId)}}});var MiniGameChip=ChipButton.extend({ctor:function(index){this._super();var normalSprite=new cc.Sprite("#minigame-chip-"+index+".png");var selectedSprite=new cc.Sprite("#minigame-chipSelected-"+index+".png");this.addChild(normalSprite);this.addChild(selectedSprite);this.normalSprite=normalSprite;this.selectedSprite=selectedSprite;this.chipIndex=index;var s=normalSprite.getContentSize();this.rectTouch=cc.rect(-s.width/2,-s.height/2,s.width,s.height);selectedSprite.visible=false},select:function(isForce){this._super();
this.normalSprite.visible=false;this.selectedSprite.visible=true;if(isForce)this.setPositionY(this.originPoint.y+40);else{this.stopAllActions();var moveAction=new cc.MoveTo(.2,cc.p(this.x,this.originPoint.y+40*cc.winSize.screenScale));this.runAction(new cc.EaseSineOut(moveAction))}},unSelect:function(isForce){this._super();this.normalSprite.visible=true;this.selectedSprite.visible=false;if(isForce)this.setPositionY(this.originPoint.y);else{this.stopAllActions();var moveAction=new cc.MoveTo(.2,cc.p(this.x,
this.originPoint.y));this.runAction(new cc.EaseSineOut(moveAction))}}});var MiniGameController=cc.Class.extend({ctor:function(){},initWithView:function(view){this._view=view;SmartfoxClient.getInstance().addListener(socket.SmartfoxClient.SocketStatus,this.onSmartfoxSocketStatus,this);SmartfoxClient.getInstance().addListener(socket.SmartfoxClient.CallExtension,this.onSFSExtension,this);SmartfoxClient.getInstance().addExtensionListener("___err___",this.onSFSError,this);SmartfoxClient.getInstance().addExtensionListener("0",this.onSFSChangeAssets,this);LobbyClient.getInstance().addListener("getLastSessionInfo",
this.onGetLastSessionInfo,this)},releaseController:function(){this._view=null;SmartfoxClient.getInstance().removeListener(this);LobbyClient.getInstance().removeListener(this);this.requestQuitRoom()},onSFSError:function(messageType,content){this._view.onError(content.p)},onSFSChangeAssets:function(messageType,content){},onSmartfoxSocketStatus:function(type,eventName){if(eventName==="LostConnection")this._view.backToHomeScene()},onSFSExtension:function(messageType,content){switch(content.c){case "100000":this._view.performChangeRewardFund(content.p.data["1"]);
break;case "260":this._view.performChangeRewardFund(content.p.data["pbs"]);cc.log(content);break;case "262":this.onReconnect(content.p);break}},onReconnect:function(param){},onChangeAssets:function(gold,changeAmount){if(changeAmount<0)return;this._view.onChangeAssets(gold,changeAmount)},onGetLastSessionInfo:function(command,eventData){},requestQuitRoom:function(){},sendJoinGame:function(){},sendGetTopRequest:function(){},sendGetExplosionHistory:function(){},sendGetUserHistory:function(){}});var CaoThapController=MiniGameController.extend({ctor:function(view){this._super();this.initWithView(view);this.turnState=0;this.result=-1;this.rolling=false;this.timeRemaining=0;this.gameGroup="mini.caothap"},onSFSExtension:function(messageType,content){if(content.p.group!=this.gameGroup)return;this._super(messageType,content);var thiz=this;switch(content.c){case "407":setTimeout(function(){thiz.onInitGame(content.p.data)},1E3);break;case "408":setTimeout(function(){thiz.onPredictResult(content.p.data)},
1E3);break;case "22":this.onChangeAssets(content.p.data["1"],content.p.data["2"]);break}},onReconnect:function(param){var data=param["data"];var gameId=data["2"]["1"];var resultCard=data["2"]["2"];var lowReward=data["2"]["5"];var highReward=data["2"]["4"];this.timeRemaining=Math.floor(data["2"]["6"]/1E3);var gameEnded=data["2"]["7"]!=1;var oldCards=data["3"];var kingCount=data["4"];var betId=data["5"];var bankString=data["6"];this._view.setBettingSelectEnable(false);this._view.setBankValue(parseInt(bankString));
this._view.showResultCard(resultCard);this._view.setGameId(gameId);this.result=resultCard;this._view.setTimeRemaining(this.timeRemaining);this._view.setTipString(gameEnded?"B\u1ea1n ch\u1ecdn sai, ch\u00fac b\u1ea1n may m\u1eafn l\u1ea7n sau!":"Qu\u00e2n ti\u1ebfp theo cao h\u01a1n hay th\u1ea5p h\u01a1n?");this._view.setHighLowBtEnable(!gameEnded);this.turnState=gameEnded?2:1;this.result=gameEnded?-1:resultCard;this._view.setReward(lowReward,highReward);this._view.setLuotMoiBtEnable(oldCards.length>
1);this._view.setLuotMoiBtVisible(oldCards.length>1);for(var i=0;i<oldCards.length-1;i++)this._view.addHistory(oldCards[i],true);for(var i=0;i<kingCount;i++)this._view.pushKing(true)},onSFSChangeAssets:function(messageType,content){this.onChangeAssets(content.p["2"],content.p["1"])},processData:function(data){var gameId=data["1"];var bankValue=data["3"];var highReward=data["4"];var lowReward=data["5"];var timeRemaining=data["6"];this._view.setReward(lowReward,highReward);this._view.setGameId(gameId);
this._view.setBankValue(bankValue);this.timeRemaining=Math.floor(timeRemaining/1E3);this._view.setTimeRemaining(this.timeRemaining)},onPredictResult:function(data){var winType=data["9"];switch(winType){case 0:case 1:this._view.setTipString("Qu\u00e2n ti\u1ebfp theo cao h\u01a1n hay th\u1ea5p h\u01a1n?");this.turnState=1;break;case 2:this._view.setTipString("B\u1ea1n ch\u1ecdn sai, ch\u00fac b\u1ea1n may m\u1eafn l\u1ea7n sau!");this._view.playSoundLost();this.turnState=2;break;case 3:this._view.showJackpot();
this.turnState=1;break}var resultCard=data["8"];this._view.showResultCard(resultCard);if(this.result!=-1)this._view.addHistory(this.result);this._view.pushKing(resultCard%13==10);this.result=resultCard;if(data["7"]==1){this.turnState=1;this.result=data["8"];this._view.setHighLowBtEnable(true)}else{this.turnState=2;this.result=-1;this.timeRemaining=0;this._view.setTimeRemaining(0);this._view.setHighLowBtEnable(false)}this.processData(data);this._view.setLuotMoiBtVisible(true);this._view.setLuotMoiBtEnable(true)},
onInitGame:function(data){this._view.setLuotMoiBtEnable(false);this._view.setHighLowBtEnable(true);this.processData(data);var resultCard=data["2"];this._view.showResultCard(resultCard);this._view.pushKing(resultCard%13==10);this.result=resultCard;this.turnState=1;this._view.setTipString("Qu\u00e2n ti\u1ebfp theo cao h\u01a1n hay th\u1ea5p h\u01a1n?")},sendInitGame:function(betType){if(this.turnState!=0)return;SmartfoxClient.getInstance().sendExtensionRequest(-1,"407",{1:betType});this._view.setLuotMoiBtEnable(false);
this._view.setHighLowBtEnable(false)},sendHighPredict:function(){if(this.turnState!=1)return;SmartfoxClient.getInstance().sendExtensionRequest(-1,"408",{1:1});this._view.setLuotMoiBtEnable(false);this._view.setHighLowBtEnable(false);this._view.addHistory(this.result);this.result=-1},sendLowPredict:function(){if(this.turnState!=1)return;SmartfoxClient.getInstance().sendExtensionRequest(-1,"408",{1:2});this._view.setLuotMoiBtEnable(false);this._view.setHighLowBtEnable(false);this._view.addHistory(this.result);
this.result=-1},getTurnState:function(){return this.turnState},sendLuotMoiRequest:function(){SmartfoxClient.getInstance().sendExtensionRequest(-1,"409",null);this._view.setTipString("");this.turnState=0;this._view.clearTurn();this._view.pushKing(false)},sendJoinGame:function(){SmartfoxClient.getInstance().joinMiniGame(PlayerMe.miniGameInfo,"404")},requestQuitRoom:function(){SmartfoxClient.getInstance().sendExtensionRequest(-1,"405",null)},sendGetTopRequest:function(){SmartfoxClient.getInstance().sendExtensionRequest(-1,
"402",null)},sendGetExplosionHistory:function(){SmartfoxClient.getInstance().sendExtensionRequest(-1,"403",null)},sendGetUserHistory:function(){SmartfoxClient.getInstance().sendExtensionRequest(-1,"401",null)}});var MiniPokerController=MiniGameController.extend({ctor:function(view){this._super();this.initWithView(view);this.rolling=false;this.lastBetType=1;this.gameGroup="mini.poker"},onSFSExtension:function(messageType,content){if(content.p.group!=this.gameGroup)return;this._super(messageType,content);var thiz=this;switch(content.c){case "351":setTimeout(function(){thiz.onRollResult(content.p.data)},1E3);break}},onChangeAssets:function(gold,changeAmount){},onRollResult:function(data){var gameId=data["1"];
var cardArray=data["2"];var result=data["3"];var rewardIndexes=data["4"];var rewardCardRank=data["5"];var changeAmount=data["6"];var rewardIndexesArray=[];for(var i=0;i<5;i++)rewardIndexesArray[i]=rewardIndexes>>i&1;this._view.setCardArray(cardArray);var thiz=this;var index=0;this._view.activateReward(result,rewardCardRank);if(result==0)this._view.showJackpot();this._view.setRewardCards(rewardIndexesArray);if(this.changeAmount){this._view.onChangeAssets(this.goldAfter,this.changeAmount);this.goldAfter=
this.changeAmount=null}this._view.onChangeAssets(null,changeAmount)},sendJoinGame:function(){cc.log("lelelelele");SmartfoxClient.getInstance().joinMiniGame(PlayerMe.miniGameInfo,"355")},sendRollRequest:function(betType){SmartfoxClient.getInstance().sendExtensionRequest(-1,"351",{1:betType});this._view.setQuayBtEnable(false);this.lastBetType=betType},setRolling:function(isRolling){this.rolling=isRolling;this._view.setFlashing(isRolling);this._view.setRolling(isRolling);if(isRolling){this._view.setRewardCards([0,
0,0,0,0]);for(var i=0;i<5;i++)this._view.setRollCard(i,true)}},requestQuitRoom:function(){SmartfoxClient.getInstance().sendExtensionRequest(-1,"356",null)},sendGetTopRequest:function(){SmartfoxClient.getInstance().sendExtensionRequest(-1,"353",null)},sendGetExplosionHistory:function(){SmartfoxClient.getInstance().sendExtensionRequest(-1,"354",null)},sendGetUserHistory:function(){SmartfoxClient.getInstance().sendExtensionRequest(-1,"352",null)}});var VideoPokerController=MiniGameController.extend({ctor:function(view){this._super();this.initWithView(view);this.turnState=0;this.holdingList=[0,0,0,0,0];this.gameGroup="mini.videopoker"},onSFSExtension:function(messageType,content){if(content.p.group!=this.gameGroup)return;this._super(messageType,content);var thiz=this;cc.log(content);switch(content.c){case "251":this._view.setBankValue(parseInt(content.p["data"]["2"]));break;case "252":setTimeout(function(){thiz.onFirstRollResult(content.p.data)},
1E3);break;case "253":this._view.lblHD.setString("");setTimeout(function(){thiz.onNextRollResult(content.p.data)},1E3);break;case "254":this.onRequestDoubleResult(content.p.data);break;case "256":this._view.lblHD.setString("");this.onDoubleResult(content.p.data);break;case "22":this.onChangeAssets(content.p.data["1"],content.p.data["2"]);break;case "255":this._view.lblHD.setString("");break}},onFirstRollResult:function(param){var gameId=param["1"];var cardArray=param["2"];var holdValue=param["3"]["1"];
var resultId=param["3"]["2"];var holdArray=[];this.setTurnState(1);for(var i=0;i<5;i++)holdArray.push(holdValue>>i&1);this._view.setHoldArray(holdArray);this._view.setCardArray(cardArray);this._view.setFlashing(false,false);this._view.setQuayBtEnable(true);this._view.setNhanThuongBtEnable(false);this._view.lblHD.setString("Ch\u1ecdn qu\u00e2n b\u00e0i mu\u1ed1n gi\u1eef l\u1ea1i")},onNextRollResult:function(param){var cardArray=param["4"];var resultId=param["5"]["2"];var bankValue=param["6"];var rewardIndexes=
param["5"]["1"];var rewardArray=[];this.setTurnState(resultId<9?2:0);this._view.setNhanThuongBtEnable(resultId<9);for(var i=0;i<5;i++)rewardArray.push(rewardIndexes>>i&1);var thiz=this;var index=0;this._view.activateReward(resultId);if(resultId==0)this._view.showJackpot();this._view.setRewardCards(rewardArray);this._view.setHoldArray([0,0,0,0,0]);this._view.setCardArray(cardArray);this._view.setBankValue(bankValue);this._view.setFlashing(resultId<9,resultId<9);this._view.setQuayBtEnable(true)},onRequestDoubleResult:function(param){this._view.lblHD.setString("Ch\u1ecdn 1 l\u00e1 b\u00e0i to h\u01a1n");
var firstCardId=param["1"];this.setTurnState(3);this._view.showDoubleTurn(firstCardId);this._view.activateReward(11);this._view.setFlashing(true,false);this._view.setRewardCards([0,0,0,0,0]);this._view.setQuayBtEnable(false);this._view.setNhanThuongBtEnable(false)},onDoubleResult:function(param){var cardArray=[];cardArray.push(param["1"]);cardArray=cardArray.concat(param["4"]);var bankValue=param["6"];var choosenPos=param["3"];var resuft=param["5"];if(resuft==1||resuft==0)this._view.lblHD.setString("Nh\u00e2n \u0111\u00f4i "+
cc.Global.NumberFormat1(parseInt(bankValue))+" th\u00e0nh "+cc.Global.NumberFormat1(2*parseInt(bankValue)));this._view.setBankValue(bankValue);console.log(cardArray);if(param["5"]!=2){this.setTurnState(2);this._view.setFlashing(true,true);this._view.setNhanThuongBtEnable(true)}else{this.setTurnState(0);this._view.setFlashing(false,false);this._view.setNhanThuongBtEnable(false)}this._view.revealDoubleResult(cardArray,choosenPos);this._view.setQuayBtEnable(true)},sendRollRequest:function(betType){if(!this.checkRequestRolling())return;
this._view.setHoldArray([0,0,0,0,0]);this._view.setFlashing(false,true);this._view.setQuayBtEnable(false);SmartfoxClient.getInstance().sendExtensionRequest(-1,"251",{1:betType})},sendNextRollRequest:function(holdIndexes){if(!this.checkRequestRolling())return;var holdValue=0;if(holdIndexes.length==5){this.holdingList=holdIndexes;for(var i=0;i<5;i++)holdValue=holdValue|holdIndexes[i]<<i;this._view.setFlashing(false,true);this._view.setQuayBtEnable(false);SmartfoxClient.getInstance().sendExtensionRequest(-1,
"253",{1:holdValue})}},sendDoubleRequest:function(){SmartfoxClient.getInstance().sendExtensionRequest(-1,"254",null)},sendDoubleChoice:function(choice){SmartfoxClient.getInstance().sendExtensionRequest(-1,"256",{1:choice})},checkRequestRolling:function(){if(this.turnState<=1)this._view.setNhanThuongBtEnable(false);return this.turnState<=1},sendGetRewardRequest:function(){if(this.turnState==2){SmartfoxClient.getInstance().sendExtensionRequest(-1,"255",null);this._view.setRewardCards([0,0,0,0,0])}if(this.turnState==
2||this.turnState==4){this.holdingList=[0,0,0,0,0];this.setTurnState(0);this._view.resetBoard()}},getTurnState:function(){return this.turnState},sendJoinGame:function(){SmartfoxClient.getInstance().joinMiniGame(PlayerMe.miniGameInfo,"260")},onReconnect:function(param){var data=param["data"]["10"];var gameId=data["1"];var status=data["2"];if(status==2||status==3)this._view.lblHD.setString("");var bankString=data["3"];this._view.setBankValue(parseInt(bankString));if(data["5"]){this.setTurnState(1);
this._view.setCardArray(data["5"]);var holdIndexes=data["6"]["1"];for(var i=0;i<5;i++)this.holdingList[i]=holdIndexes>>i&1;this._view.setHoldArray(this.holdingList);return}if(data["8"]){this.setTurnState(2);this._view.setCardArray(data["8"]);var rewardIndexes=data["9"]["1"];var rewardArray=[];for(var i=0;i<5;i++)rewardArray.push(rewardIndexes>>i&1);this._view.setRewardCards(rewardArray);var rewardId=data["9"]["2"];this._view.activateReward(rewardId);this._view.setFlashing(rewardId<9,rewardId<9);return}if(data["10"])switch(data["10"]["2"]){case 1:this.setTurnState(3);
this._view.showDoubleTurn(data["10"]["1"]);this._view.setFlashing(true,false);break;case 2:this.onDoubleResult(data["10"]);break}},requestQuitRoom:function(){SmartfoxClient.getInstance().sendExtensionRequest(-1,"261",null)},sendGetTopRequest:function(){SmartfoxClient.getInstance().sendExtensionRequest(-1,"258",null)},sendGetExplosionHistory:function(){SmartfoxClient.getInstance().sendExtensionRequest(-1,"259",null)},sendGetUserHistory:function(){SmartfoxClient.getInstance().sendExtensionRequest(-1,
"257",null)},setTurnState:function(state){this.turnState=state;this._view.turnState=state}});TX_CUA_TAI=1,TX_CUA_XIU=2;
var ChanLeController=MiniGameController.extend({ctor:function(view){this._super();this.initWithView(view);this.turnState=0;this.holdingList=[0,0,0,0,0];this.gameGroup="mini.taixiu"},onSFSExtension:function(messageType,content){if(content.p.group!=this.gameGroup)return;this._super(messageType,content);var thiz=this;switch(content.c){case "701":this.onBetSucess(content.p);break;case "708":this.onStateGame(content.p);break;case "260":this.onJoinGame(content.p.data);break;case "709":this.onOtherBet(content.p);break;
case "711":this.onHistory(content.p);break;case "706":this.onResuft(content.p);break;case "713":this._view.gameIdLabel.setString("ID: "+content.p[1]);break;case "705":this.onShowMoneyExchange(content.p);break;case "22":this.onChangeAssets(content.p.data["1"],content.p.data["2"]);break}},onShowMoneyExchange:function(param){this._view.onChangeAssets("",parseInt(param[1])>0?parseInt(param[1]):0)},onJoinGame:function(param){var state=param[1];var timeState=param[2]/1E3;var timeRemain=param[8]/1E3;var data=
param[3];if(state==3){MessageNode.getInstance().show("B\u1ea1n vui l\u00f2ng \u0111\u1ee3i v\u00e1n m\u1edbi!");return}this.handleStateGame(state,timeRemain,false);var moneyMeTai=parseInt(param["9"]);var moneyMeXiu=parseInt(param[10]);this._view.lblTai.setString(moneyMeTai>0?"\u0110\u00e3 c\u01b0\u1ee3c: "+cc.Global.NumberFormat1(moneyMeTai):"");this._view.lblXiu.setString(moneyMeXiu>0?"\u0110\u00e3 c\u01b0\u1ee3c: "+cc.Global.NumberFormat1(moneyMeXiu):"");for(var i=0;i<data.length;i++){var idCua=
data[i]["3"];var moneyTotal=data[i]["2"];var total=parseInt(moneyTotal);var userCount=data[i]["1"];if(idCua==TX_CUA_TAI){this._view.lblTotalTai.setString(total>0?cc.Global.NumberFormat1(total):"");this._view.lblNumTai.setString(userCount>0?userCount:"")}else{this._view.lblTotalXiu.setString(total>0?cc.Global.NumberFormat1(total):"");this._view.lblNumXiu.setString(userCount>0?userCount:"")}}},onBetSucess:function(param){var idCua=param[4][3];PlayerMe.gold=parseInt(param[3]);if(idCua==1){this._view.lblTotalTai.setString(cc.Global.NumberFormat1(parseInt(param[4][2])));
this._view.lblTai.setString("\u0110\u00e3 c\u01b0\u1ee3c: "+cc.Global.NumberFormat1(parseInt(param[5])))}else{this._view.lblTotalXiu.setString(cc.Global.NumberFormat1(parseInt(param[4][2])));this._view.lblXiu.setString("\u0110\u00e3 c\u01b0\u1ee3c: "+cc.Global.NumberFormat1(parseInt(param[5])))}},onOtherBet:function(param){var moneyTaiTong=parseInt(param[1][2]);this._view.lblTotalTai.setString(moneyTaiTong==0?"":cc.Global.NumberFormat1(moneyTaiTong));var numTai=param[1][1];this._view.lblNumTai.setString(numTai>
0?numTai:"");var moneyXiuTong=parseInt(param[2][2]);this._view.lblTotalXiu.setString(moneyXiuTong==0?"":cc.Global.NumberFormat1(moneyXiuTong));var numXiu=param[2][1];this._view.lblNumXiu.setString(numXiu>0?numXiu:"")},onResuft:function(param){var thiz=this;var typeCua=param["data"][1];var nameCua=typeCua==TX_CUA_TAI?"#mntx_effect_tai.png":"#mntx_effect_xiu.png";var number=param["data"][2];var idVan=param["data"][3];var itemXucXac=param["data"][4];this._view.runAction(new cc.Sequence(new cc.DelayTime(1),
new cc.CallFunc(function(){cc.log("\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d");thiz._view._addResultSprite(itemXucXac);if(typeCua==TX_CUA_TAI){thiz._view.effTai.setVisible(true);thiz._view.effXiu.setVisible(false)}else{thiz._view.effXiu.setVisible(true);thiz._view.effTai.setVisible(false)}}),new cc.DelayTime(2),new cc.CallFunc(function(){thiz._view.setTextTaiXiu(nameCua)})))},onHistory:function(param){var thiz=this;var arr_his=param["data"];if(arr_his){var len=arr_his.length>
11?11:arr_his.length;this._view.wgResuft.removeAllChildren();var z=0;for(var i=arr_his.length-len;i<arr_his.length;i++)(function(){var iNew=i;var dataItemTx={type:arr_his[iNew][1],number:arr_his[iNew][2],idVan:arr_his[iNew][3]};thiz._view.pushItemHistory(arr_his.length>11?z:iNew,dataItemTx);z++})()}if(this._view.gameState==1)this._view.showEffectNumber()},onStateGame:function(param){var state=param[1];var timeState=param[2]/1E3;this.handleStateGame(state,timeState,true)},handleStateGame:function(state,
timeState,isEffect){this._view.gameState=state;switch(state){case -1:cc.log("\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3dchuan bi xoc lo");this._view.resetGame();break;case 0:cc.log("\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3dxoc lo");this._view.closeDisk(false);this._view.shakeDisk();break;case 1:cc.log("\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3dbat dau dat cuoc");this._view.setActiveBt(this._view.btnTai,true);this._view.setActiveBt(this._view.btnXiu,
true);this._view.isCountDownSound=true;this._view.startTime(timeState);this._view.showEffectNumber();break;case 2:cc.log("\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3dthua thieu");this._view.isCountDownSound=false;this._view.setActiveBt(this._view.btnTai,false);this._view.setActiveBt(this._view.btnXiu,false);break;case 3:cc.log("\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3dmo bat");this._view.openDisk(isEffect);this._view.hiddenEffectNumber();break}},sendJoinGame:function(){SmartfoxClient.getInstance().joinMiniGame(PlayerMe.miniGameInfo,
"702")},onReconnect:function(param){var data=param["data"]["10"];var gameId=data["1"];var status=data["2"];var bankString=data["3"];this._view.setBankValue(parseInt(bankString))},requestQuitRoom:function(){SmartfoxClient.getInstance().sendExtensionRequest(-1,"710",null)},sendBetTaiXiu:function(idCua,money){SmartfoxClient.getInstance().sendExtensionRequest(-1,"701",{1:idCua,2:money})},sendGetExplosionHistory:function(){SmartfoxClient.getInstance().sendExtensionRequest(-1,"259",null)},sendGetUserHistory:function(){SmartfoxClient.getInstance().sendExtensionRequest(-1,
"257",null)}});var MiniGameScene=IScene.extend({ctor:function(){this._super();var bg=new cc.Sprite("res/game-bg.jpg");bg.x=cc.winSize.width/2;bg.y=cc.winSize.height/2;this.sceneLayer.addChild(bg);this.initController()},initAvatarMe:function(){var playerMe=new GamePlayerMe;playerMe.setPosition(150,50);playerMe.setUsername(PlayerMe.username);this.sceneLayer.addChild(playerMe,1);this.playerMe=playerMe;this.playerMe.setGold(PlayerMe.gold)},onChangeAssets:function(gold,changeAmount){if(changeAmount==0)return;var changeSprite=
cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_30,"");var changeText=(changeAmount>=0?"+":"")+cc.Global.NumberFormat1(changeAmount);changeSprite.setString(changeText);changeSprite.setColor(cc.color(changeAmount>=0?"#ffde00":"#ff0000"));changeSprite.setPosition(this.playerMe.avt.getPosition());this.addChild(changeSprite,420);changeSprite.runAction(new cc.Sequence(new cc.MoveTo(1,changeSprite.x,changeSprite.y+50),new cc.CallFunc(function(){changeSprite.removeFromParent(true)})))},initController:function(){this._controller=
new MiniGameController(this)},setGameId:function(){},setupMucCuoc:function(){},performChangeRewardFund:function(data){this.rewardFund=data},initButton:function(){var gameTopbar=new GameTopBar;this.sceneLayer.addChild(gameTopbar);var tutorialBt=new ccui.Button("ingame-tutorialBt.png","","",ccui.Widget.PLIST_TEXTURE);tutorialBt.setPosition(1110,gameTopbar.backBt.y);gameTopbar.addChild(tutorialBt);var rankBt=new ccui.Button("ingame-rankBt.png","","",ccui.Widget.PLIST_TEXTURE);rankBt.setPosition(1003,
tutorialBt.y);gameTopbar.addChild(rankBt);var thiz=this;gameTopbar.backBt.addClickEventListener(function(){thiz.backButtonHandler()});tutorialBt.addClickEventListener(function(){thiz.tutorialButtonHandler()});rankBt.addClickEventListener(function(){thiz.rankButtonHandler()})},initChip:function(centerPosition){var chipGroup=new ChipGroup;this.sceneLayer.addChild(chipGroup);this.chipGroup=chipGroup;var thiz=this;var chip1=new MiniGameChip(1);chip1.setPosition(centerPosition-170*cc.winSize.screenScale,
30*cc.winSize.screenScale);chip1.setScale(cc.winSize.screenScale);chip1.originPoint=chip1.getPosition();chip1.onSelect=function(){thiz.onSelectChip(1)};chipGroup.addChip(chip1);var chip2=new MiniGameChip(2);chip2.setPosition(centerPosition,chip1.y);chip2.setScale(cc.winSize.screenScale);chip2.originPoint=chip2.getPosition();chip2.onSelect=function(){thiz.onSelectChip(2)};chipGroup.addChip(chip2);var chip3=new MiniGameChip(3);chip3.setPosition(centerPosition+170*cc.winSize.screenScale,chip1.y);chip3.setScale(cc.winSize.screenScale);
chip3.originPoint=chip3.getPosition();chip3.onSelect=function(){thiz.onSelectChip(3)};chipGroup.addChip(chip3)},onSelectChip:function(chipIndex){},onEnter:function(){this._super();this.chipGroup.selectChipAtIndex(0,true);if(this.isReconnect)return;this._controller.sendJoinGame()},onExit:function(){this._super();this._controller.releaseController()},tutorialButtonHandler:function(){},backButtonHandler:function(){var homeScene=new HomeScene;homeScene.startGame();cc.director.replaceScene(homeScene)},
rankButtonHandler:function(){this.stat_board.showWithAnimationScale()},backToHomeScene:function(){this.backButtonHandler()},onError:function(param){MessageNode.getInstance().show(param.msg)}});var CaoThapScene=MiniGameScene.extend({ctor:function(){this._super();this.initAvatarMe();this.initButton();this.initChip(cc.winSize.width/2);this.stat_board=new StatisticBoard(GameType.MiniGame_CaoThap);this.initScene();this.delta=0;this.result=0;this.rewardFund=[];this.onCooldown=false;this.turnstate=0;this.rolling=false;var thiz=this;cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:true,onTouchBegan:function(touch,event){if(!thiz.card)return false;var p=thiz.card.convertToNodeSpace(touch.getLocation());
if(cc.rectContainsPoint(cc.rect(0,0,thiz.card._getWidth(),thiz.card._getHeight()),p)){thiz.onCardClick();return true}return false}},this)},initController:function(){this._controller=new CaoThapController(this)},onSelectChip:function(chipIndex){if(this.rewardFund.length<3)return;this.huThuongValueLabel.setString(""+this.rewardFund[chipIndex-1]["2"])},initScene:function(){var hiloLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_30,"Hi - Lo",cc.TEXT_ALIGNMENT_LEFT);hiloLabel.setAnchorPoint(cc.p(0,
.5));hiloLabel.setPosition(15+105*cc.winSize.screenScale,720-48*cc.winSize.screenScale);this.sceneLayer.addChild(hiloLabel);var hiloLabel_vn=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_25,"Cao - Th\u1ea5p",cc.TEXT_ALIGNMENT_LEFT);hiloLabel_vn.setAnchorPoint(cc.p(0,.5));hiloLabel_vn.setPosition(15+105*cc.winSize.screenScale,720-15-70*cc.winSize.screenScale);this.sceneLayer.addChild(hiloLabel_vn);var huThuongLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_25,"H\u0169 Th\u01b0\u1edfng",
cc.TEXT_ALIGNMENT_CENTER);huThuongLabel.setPosition(100,565);this.sceneLayer.addChild(huThuongLabel);var huThuongValueLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_25,"1.000.000.000",cc.TEXT_ALIGNMENT_CENTER);huThuongValueLabel.setPosition(100,525);huThuongValueLabel.setColor(cc.color("#ffde00"));this.huThuongValueLabel=huThuongValueLabel;this.sceneLayer.addChild(huThuongValueLabel);var huThuongValueIcon=new cc.Sprite("#ingame-goldIcon.png");huThuongValueIcon.setPosition(100,460);
huThuongValueIcon.setScale(1.4);this.sceneLayer.addChild(huThuongValueIcon);var bankValueIcon=new cc.Sprite("#ingame-goldIcon.png");bankValueIcon.setPosition(cc.winSize.width/2,670);bankValueIcon.setScale(1.4);this.sceneLayer.addChild(bankValueIcon);var bankValueLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_25,"0",cc.TEXT_ALIGNMENT_CENTER);bankValueLabel.setPosition(cc.winSize.width/2,630);bankValueLabel.setColor(cc.color("ffde00"));this.sceneLayer.addChild(bankValueLabel);this.bankValueLabel=
bankValueLabel;var tipLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_30,"",cc.TEXT_ALIGNMENT_CENTER);tipLabel.setPosition(cc.winSize.width/2,huThuongLabel.getPositionY());this.sceneLayer.addChild(tipLabel);this.tipLabel=tipLabel;var timeLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_40,"",cc.TEXT_ALIGNMENT_CENTER);timeLabel.setPosition(cc.winSize.width/2,tipLabel.getPositionY()-50);timeLabel.setColor(cc.color("#ffde00"));this.sceneLayer.addChild(timeLabel);this.timeLabel=
timeLabel;var highBt=new ccui.Button("minigame-highBt.png","","",ccui.Widget.PLIST_TEXTURE);highBt.setScale(cc.winSize.screenScale);highBt.setZoomScale(.05);highBt.setPosition(cc.winSize.width/2-240*cc.winSize.screenScale,344);this.sceneLayer.addChild(highBt);this.highBt=highBt;var highValueLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_30,"0",cc.TEXT_ALIGNMENT_CENTER);highValueLabel.setPosition(highBt.getPositionX(),highBt.getPositionY()-105*cc.winSize.screenScale);highValueLabel.setColor(cc.color("#ffde00"));
this.highValueLabel=highValueLabel;this.sceneLayer.addChild(highValueLabel);var highTip=new cc.Sprite("#klacaonhat.png");highTip.setPosition(highValueLabel.getPositionX(),highValueLabel.getPositionY()-40);this.sceneLayer.addChild(highTip);var lowBt=new ccui.Button("minigame-lowBt.png","","",ccui.Widget.PLIST_TEXTURE);lowBt.setScale(cc.winSize.screenScale);lowBt.setZoomScale(.05);lowBt.setPosition(cc.winSize.width/2+240*cc.winSize.screenScale,highBt.y);this.sceneLayer.addChild(lowBt);this.lowBt=lowBt;
var lowValueLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_30,"0",cc.TEXT_ALIGNMENT_CENTER);lowValueLabel.setPosition(lowBt.getPositionX(),highValueLabel.getPositionY());lowValueLabel.setColor(cc.color("#ffde00"));this.lowValueLabel=lowValueLabel;this.sceneLayer.addChild(lowValueLabel);var lowTip=new cc.Sprite("#alathapnhat.png");lowTip.setPosition(lowValueLabel.getPositionX(),highTip.getPositionY());this.sceneLayer.addChild(lowTip);var luotMoiBt=new ccui.Button("luotmoi.png","","",
ccui.Widget.PLIST_TEXTURE);luotMoiBt.setScale(cc.winSize.screenScale);luotMoiBt.setPosition(cc.winSize.width-150*cc.winSize.screenScale,60);luotMoiBt.visible=false;this.sceneLayer.addChild(luotMoiBt);this.luotMoiBt=luotMoiBt;var questionIcon=new cc.Sprite("#question.png");questionIcon.setPosition(cc.winSize.width-100,525);this.sceneLayer.addChild(questionIcon);var card=new cc.Sprite("#gp_card_up.png");card.setScale(2*cc.winSize.screenScale);card.setPosition(cc.winSize.width/2,highBt.y);this.sceneLayer.addChild(card);
this.card=card;var bg1=new ccui.Scale9Sprite("minigame-bg1.png",cc.rect(20,20,4,4));bg1.setPosition(cc.winSize.width/2,655);bg1.setPreferredSize(cc.size(350,94));this.sceneLayer.addChild(bg1);var bg2=new ccui.Scale9Sprite("minigame-bg1.png",cc.rect(20,20,4,4));bg2.setPreferredSize(cc.size(94,350));bg2.setPosition(100,323);this.sceneLayer.addChild(bg2);var bg3=new ccui.Scale9Sprite("minigame-bg1.png",cc.rect(20,20,4,4));bg3.setPreferredSize(bg2.getPreferredSize());bg3.setPosition(cc.winSize.width-
100,bg2.y);this.sceneLayer.addChild(bg3);this.kingCards=[];for(var i=0;i<3;i++){var kingCard=new cc.Sprite("#minigame-kingCard1.png");kingCard.setPosition(bg2.x,230+80*i);kingCard.activated=false;this.kingCards.push(kingCard);this.sceneLayer.addChild(kingCard)}var size=cc.size(bg3.getContentSize().width-4,bg3.getContentSize().height-4);var clippingNode=new ccui.Layout;clippingNode.setContentSize(size);clippingNode.setClippingEnabled(true);clippingNode.setClippingType(ccui.Layout.CLIPPING_SCISSOR);
clippingNode.setPosition(bg3.x-size.width/2,bg3.y-size.height/2);this.sceneLayer.addChild(clippingNode);var margin=20;var padding=10;var cardHeight=123;this.cardScale=.7;this.historyMove=cc.p(bg3.x,bg3.y+size.height/2-margin-cardHeight*this.cardScale/2);this.historyListMoveTo=cc.p(0,-(cardHeight*this.cardScale+padding));var historyList=new newui.TableView(size,1);historyList.setMargin(margin,margin,0,0);historyList.setPadding(padding);historyList.setScrollBarEnabled(false);clippingNode.addChild(historyList);
this.historyList=historyList;var thiz=this;luotMoiBt.addClickEventListener(function(){thiz.onLuotMoiBtClick()});highBt.addClickEventListener(function(){thiz.onHighBtClick()});lowBt.addClickEventListener(function(){thiz.onLowBtClick()})},addHistory:function(data,force){var list=this.historyList;var thiz=this;var duration=.5;data=CardList.prototype.getCardWithId(data);var cardImg="#"+data.rank+s_card_suit[data.suit]+".png";if(force){list.stopAllActions();list.jumpToTop();list.setPosition(this.historyListMoveTo.x,
this.historyListMoveTo.y);list.y=0;var card=new cc.Sprite(cardImg);card.setScale(thiz.cardScale);list.insertItem(card,0);return}var cardMove=new cc.Sprite(cardImg);cardMove.setPosition(this.card.getPosition());cardMove.setScale(this.card.getScale());var moveAction=new cc.Spawn(new cc.MoveTo(duration,this.historyMove),new cc.ScaleTo(duration,this.cardScale));var finishAction=new cc.CallFunc(function(){cardMove.removeFromParent(true)});this.sceneLayer.addChild(cardMove);cardMove.runAction(new cc.Sequence(moveAction,
finishAction));list.stopAllActions();list.jumpToTop();var move2=new cc.MoveTo(duration,this.historyListMoveTo);var finished2=new cc.CallFunc(function(){list.y=0;var card=new cc.Sprite(cardImg);card.setScale(thiz.cardScale);list.insertItem(card,0)});list.runAction(new cc.Sequence(move2,finished2))},onEnter:function(){this._super();this.scheduleUpdate()},onExit:function(){this._super();this.unscheduleUpdate()},update:function(dt){if(this.rolling){this.delta+=dt;var randNum=Math.floor(Math.random()*
51+4);var thiz=this;thiz.setCard(randNum);this.delta=0}},onCardClick:function(){if(this._controller.turnState==0)this._controller.sendInitGame(this.chipGroup.chipSelected.chipIndex)},onLuotMoiBtClick:function(){this._controller.sendLuotMoiRequest()},clearTurn:function(){this.bankValueLabel.setString("0");this.luotMoiBt.visible=false;this.historyList.removeAllItems();this.card.setSpriteFrame("gp_card_up.png");this.timeLabel.setString("")},onHighBtClick:function(){if(this._controller.turnState!=1||
this.rolling)return;this._controller.sendHighPredict()},onLowBtClick:function(){if(this._controller.turnState!=1||this.rolling)return;this._controller.sendLowPredict()},setCard:function(cardNum){this.card.setSpriteFrame(""+Math.floor(cardNum/4)+s_card_suit[cardNum%4]+".png")},setRolling:function(isRolling){this.rolling=isRolling},setTimeRemaining:function(seconds){if(seconds>0)this.timeLabel.setString(""+Math.floor(seconds/60)+":"+seconds%60);else this.timeLabel.setString("")},setGameId:function(gameId){},
performChangeRewardFund:function(data){this._super(data);var betAmountID=this.chipGroup.chipSelected.chipIndex;if(!this.rewardFund||this.rewardFund.length<3)return;this.huThuongValueLabel.setString(this.rewardFund[betAmountID-1]["2"])},pushKing:function(isK){if(!isK)for(var i=0;i<3;i++){this.kingCards[i].setSpriteFrame("minigame-kingCard1.png");this.kingCards[i].activated=false}else{var i=0;while(this.kingCards[i].activated&&i<2)i++;this.kingCards[i].setSpriteFrame("minigame-kingCard2.png");this.kingCards[i].activated=
true}},setBankValue:function(value){this.bankValueLabel.setString(cc.Global.NumberFormat1(value))},setReward:function(lowValue,highValue){this.lowValueLabel.setString(cc.Global.NumberFormat1(lowValue));this.highValueLabel.setString(cc.Global.NumberFormat1(highValue))},showResultCard:function(cardId){var card=CardList.prototype.getCardWithId(cardId);this.card.setSpriteFrame(card.rank+s_card_suit[card.suit]+".png")},setLuotMoiBtVisible:function(visible){this.luotMoiBt.visible=visible},setTipString:function(str){this.tipLabel.setString(str)}});var MiniPokerScene=MiniGameScene.extend({ctor:function(){this._super();this.autoRoll=false;this.delta=0;this.baseCardHeight=0;this.cardHeight=0;this.rollHeight=0;this.rolling=false;this.rewardFund=[];this.cardLayoutMargin=(870*cc.winSize.screenScale-590)/6+115-80*cc.winSize.screenScale;this.activeReward={};this.rewardGroup=[];this.rewardCardSprites=[];this.stat_board=new StatisticBoard(GameType.MiniGame_Poker);this.initAvatarMe();this.initButton();this.initChip(cc.winSize.width/2+100);this.cards=
[];for(var i=0;i<5;i++)this.cards.push({rolling:false});this.initScene();this.initRewards();var thiz=this;cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:true,onTouchBegan:function(touch,event){if(!thiz.quaytudong)return false;var p=thiz.quaytudong.convertToNodeSpace(touch.getLocation());if(cc.rectContainsPoint(cc.rect(0,0,thiz.quaytudong._getWidth(),thiz.quaytudong._getHeight()),p)){thiz.quaytudongClick();return true}return false}},this)},initController:function(){this._controller=
new MiniPokerController(this)},initScene:function(){var thiz=this;var miniPokerLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_30,"Mini Poker",cc.TEXT_ALIGNMENT_LEFT);miniPokerLabel.setAnchorPoint(cc.p(0,.5));miniPokerLabel.setPosition(15+105*cc.winSize.screenScale,720-48*cc.winSize.screenScale);this.sceneLayer.addChild(miniPokerLabel);var classicLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_25,"Classic",cc.TEXT_ALIGNMENT_LEFT);classicLabel.setAnchorPoint(cc.p(0,.5));
classicLabel.setPosition(15+105*cc.winSize.screenScale,720-15-70*cc.winSize.screenScale);this.sceneLayer.addChild(classicLabel);var rollLayer=new cc.Sprite("#roll_bg.png");rollLayer.setPosition(cc.winSize.width/2+167*cc.winSize.screenScale,cc.winSize.height/2);rollLayer.setScale(cc.winSize.screenScale,.9);this.sceneLayer.addChild(rollLayer);var cards_border=new ccui.Scale9Sprite("poker_cards_border.png",cc.rect(97,97,5,3));cards_border.setPreferredSize(cc.size(870*cc.winSize.screenScale,275));cards_border.setPosition(cc.winSize.width/
2+167*cc.winSize.screenScale,cc.winSize.height/2+20);this.sceneLayer.addChild(cards_border);var resultLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_30,"",cc.TEXT_ALIGNMENT_CENTER);resultLabel.setPosition(cc.winSize.width/2+167*cc.winSize.screenScale,cc.winSize.height/2+155);resultLabel.setColor(cc.color("#ffde00"));this.resultLabel=resultLabel;this.sceneLayer.addChild(resultLabel);var huthuongLabel=new cc.Sprite("#minipoker_huthuong.png");huthuongLabel.setPosition(cc.winSize.width/
2-105*cc.winSize.screenScale,cc.winSize.height/2-115);this.sceneLayer.addChild(huthuongLabel);var huthuongValueLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_BoldCondensed_36_Glow,"1",cc.TEXT_ALIGNMENT_CENTER);huthuongValueLabel.setPosition(huthuongLabel.x,huthuongLabel.y-40);this.huThuongValueLabel=huthuongValueLabel;this.sceneLayer.addChild(huthuongValueLabel);var quayBt=new ccui.Button("videoQuayBtn.png","","",ccui.Widget.PLIST_TEXTURE);quayBt.setPosition(cc.winSize.width/2+167*cc.winSize.screenScale,
cc.winSize.height/2-139);quayBt.setZoomScale(0);quayBt.setScale(4/5);this.quayBt=quayBt;this.sceneLayer.addChild(quayBt);this.initFlashing();quayBt.addClickEventListener(function(){thiz.onQuayBtClick()});var quaytudong=new cc.Sprite("#quaytudong.png");quaytudong.setPosition(cc.winSize.width/2+434*cc.winSize.screenScale,cc.winSize.height/2-140);this.quaytudong=quaytudong;quaytudong.setScale(cc.winSize.screenScale);this.sceneLayer.addChild(quaytudong);var clippingcards_layout=new ccui.Layout;clippingcards_layout.setContentSize(cards_border._getWidth()-
140*cc.winSize.screenScale,cards_border._getHeight()-125);clippingcards_layout.setClippingEnabled(true);clippingcards_layout.setClippingType(ccui.Layout.CLIPPING_SCISSOR);clippingcards_layout.setPosition(cc.winSize.width/2+240*cc.winSize.screenScale-cards_border.width/2,cc.winSize.height/2-50);this.sceneLayer.addChild(clippingcards_layout);this.cardSprites=[];this.cardRollingSprites=[];this.baseCardHeight=clippingcards_layout.height/2;for(i=0;i<5;i++){var cardSprite=new cc.Sprite("#"+Math.floor(Math.random()*
13+1)+s_card_suit[Math.floor(Math.random()*4)]+".png");cardSprite.setPosition(i*(120+20*cc.winSize.screenScale)*cc.winSize.screenScale+this.cardLayoutMargin,clippingcards_layout.height/2);clippingcards_layout.addChild(cardSprite);var rewardSprite=new cc.Sprite("#card_selected.png");rewardSprite.setPosition(cardSprite.getPosition());clippingcards_layout.addChild(rewardSprite);rewardSprite.setScale(1.05/1.5);var fadeIn=new cc.FadeIn(.5);var fadeOut=new cc.FadeOut(.5);rewardSprite.runAction(new cc.RepeatForever(new cc.Sequence(fadeIn,
fadeOut)));rewardSprite.visible=false;this.cardSprites.push(cardSprite);this.rewardCardSprites.push(rewardSprite)}this.cardHeight=clippingcards_layout.height;for(i=0;i<15;i++){var cardSprite=new cc.Sprite("#card-motion"+(i%3+1)+".png");cardSprite.setPosition(i%5*(120+20*cc.winSize.screenScale)*cc.winSize.screenScale+this.cardLayoutMargin,clippingcards_layout.height/2+(i%3-1)*clippingcards_layout.height);clippingcards_layout.addChild(cardSprite);cardSprite.setOpacity(128);cardSprite.visible=false;
this.cardRollingSprites.push(cardSprite)}this.stat_board=new StatisticBoard},onSelectChip:function(chipIndex){if(this.rewardFund.length<3)return;this.huThuongValueLabel.setString(""+cc.Global.NumberFormat1(this.rewardFund[chipIndex-1]["2"]))},onEnter:function(){this._super();this.scheduleUpdate()},onExit:function(){this._super();this.unscheduleUpdate()},update:function(dt){if(!this.baseCardHeight||!this.cardHeight||this.cards.length<5||!this.rolling)return;this.rollHeight-=40;this.rollHeight=this.rollHeight>
0?this.rollHeight:this.rollHeight+this.cardHeight*3;for(i=0;i<15;i++){if(!this.cards[i%5].rolling)continue;this.cardRollingSprites[i].visible=true;var newY=this.baseCardHeight+(i%3-1)*this.cardHeight+this.rollHeight;newY=newY>this.baseCardHeight+this.cardHeight?newY-2*this.cardHeight:newY;this.cardRollingSprites[i].setPosition(i%5*(120+20*cc.winSize.screenScale)*cc.winSize.screenScale+this.cardLayoutMargin,newY)}},initRewards:function(){var margin_left=35+140*cc.winSize.screenScale;var item_height=
50;var huthuong=new rewardItem("H\u0168 TH\u01af\u1edeNG");huthuong.setAnchorPoint(cc.p(0,.5));huthuong.setPosition(margin_left,550);this.sceneLayer.addChild(huthuong);this.rewardGroup.push(huthuong);var thungphasanh=new rewardItem("TH\u00d9NG PH\u00c1 S\u1ea2NH",1E3);thungphasanh.setAnchorPoint(cc.p(0,.5));thungphasanh.setPosition(margin_left,huthuong.getPositionY()-item_height);this.sceneLayer.addChild(thungphasanh);this.rewardGroup.push(thungphasanh);var tuquy=new rewardItem("T\u1ee8 QU\u00dd",
150);tuquy.setAnchorPoint(cc.p(0,.5));tuquy.setPosition(margin_left,thungphasanh.getPositionY()-item_height);this.sceneLayer.addChild(tuquy);this.rewardGroup.push(tuquy);var culu=new rewardItem("C\u1ee6 L\u0168",50);culu.setAnchorPoint(cc.p(0,.5));culu.setPosition(margin_left,tuquy.getPositionY()-item_height);this.sceneLayer.addChild(culu);this.rewardGroup.push(culu);var thung=new rewardItem("TH\u00d9NG",20);thung.setPosition(margin_left,culu.getPositionY()-item_height);this.sceneLayer.addChild(thung);
this.rewardGroup.push(thung);var sanh=new rewardItem("S\u1ea2NH",13);sanh.setPosition(margin_left,thung.getPositionY()-item_height);this.sceneLayer.addChild(sanh);this.rewardGroup.push(sanh);var bala=new rewardItem("S\u00c2M",8);bala.setPosition(margin_left,sanh.getPositionY()-item_height);this.sceneLayer.addChild(bala);this.rewardGroup.push(bala);var haidoi=new rewardItem("HAI \u0110\u00d4I",5);haidoi.setPosition(margin_left,bala.getPositionY()-item_height);this.sceneLayer.addChild(haidoi);this.rewardGroup.push(haidoi);
var doijhoachon=new rewardItem("\u0110\u00d4I J HO\u1eb6C H\u01a0N",2.5);doijhoachon.setPosition(margin_left,haidoi.getPositionY()-item_height);this.sceneLayer.addChild(doijhoachon);this.rewardGroup.push(doijhoachon)},activateReward:function(id,rank){if(this.activeReward instanceof rewardItem)this.activeReward.setActive(false);if(id<9){this.activeReward=this.rewardGroup[id];this.activeReward.setActive(true);if(id==2||id==6||id==8){var result="";switch(id){case 2:result+="T\u1ee8 QU\u00dd ";break;
case 6:result+="BA L\u00c1 ";break;case 8:result+="\u0110\u00d4I ";break}switch(rank){case 12:result+="\u00c1T";break;case 0:result+="HAI";break;case 1:result+="BA";break;case 2:result+="B\u1ed0N";break;case 3:result+="N\u0102M";break;case 4:result+="S\u00c1U";break;case 5:result+="B\u1ea2Y";break;case 6:result+="T\u00c1M";break;case 7:result+="CH\u00cdN";break;case 8:result+="M\u01af\u1edcI";break;case 9:result+="J";break;case 10:result+="Q";break;case 11:result+="K";break}this.resultLabel.setString(result)}else this.resultLabel.setString(this.activeReward.rewardNameLabel.getString())}else{this.activeReward=
{};this.resultLabel.setString("Kh\u00f4ng \u0103n")}},quaytudongClick:function(){this.autoRoll=!this.autoRoll;this.quaytudong.setSpriteFrame(this.autoRoll?"quaytudong_active.png":"quaytudong.png");this._controller.setAutoRoll(this.autoRoll);if(!this.rolling&&this.autoRoll)this.onQuayBtClick()},onQuayBtClick:function(){if(this.rolling)return;this._controller.sendRollRequest(this.chipGroup.chipSelected.chipIndex);this.setRolling(true)},initFlashing:function(){var quayTopParticle=new cc.Sprite("#quayTopParticle1.png");
quayTopParticle.setPosition(cc.winSize.width/2+167*cc.winSize.screenScale,cc.winSize.height/2-111);quayTopParticle.setScale(4/5);this.quayTopParticle=quayTopParticle;this.sceneLayer.addChild(quayTopParticle);var quayBtmParticle=new cc.Sprite("#quayBtmParticle1.png");quayBtmParticle.setPosition(cc.winSize.width/2+167*cc.winSize.screenScale,cc.winSize.height/2-175);quayBtmParticle.setScale(4/5);this.quayBtmParticle=quayBtmParticle;this.sceneLayer.addChild(quayBtmParticle)},setFlashing:function(isFlashing){this.quayTopParticle.stopAllActions();
this.quayBtmParticle.stopAllActions();if(isFlashing){var quayTopFrames=[];for(var i=1;i<=2;i++){var str="quayTopParticle"+i+".png";var spriteFrame=cc.spriteFrameCache.getSpriteFrame(str);var animFrame=new cc.AnimationFrame;animFrame.initWithSpriteFrame(spriteFrame,1,null);quayTopFrames.push(animFrame)}var quayTopAnimation=cc.Animation.create(quayTopFrames,.2,2);var qtAction=cc.Animate.create(quayTopAnimation);var quayTopAction=new cc.RepeatForever(qtAction);var quayBtmFrames=[];for(var i=1;i<=2;i++){var str=
"quayBtmParticle"+i+".png";var spriteFrame=cc.spriteFrameCache.getSpriteFrame(str);var animFrame=new cc.AnimationFrame;animFrame.initWithSpriteFrame(spriteFrame,1,null);quayBtmFrames.push(animFrame)}var quayBtmAnimation=cc.Animation.create(quayBtmFrames,.2,2);var qbAction=cc.Animate.create(quayBtmAnimation);var quayBtmAction=new cc.RepeatForever(qbAction);this.quayTopParticle.runAction(quayTopAction);this.quayBtmParticle.runAction(quayBtmAction)}},performChangeRewardFund:function(data){this._super(data);
var betAmountID=this.chipGroup.chipSelected.chipIndex;if(!this.rewardFund||this.rewardFund.length<3)return;this.huThuongValueLabel.setString(this.rewardFund[betAmountID-1]["2"])},setCardArray:function(cardArray){for(var i=0;i<cardArray.length;i++){var card=CardList.prototype.getCardWithId(cardArray[i]);this.cardSprites[i].setSpriteFrame(""+card.rank+s_card_suit[card.suit]+".png")}this.setRolling(false)},setRewardCards:function(indexArray){for(var i=0;i<indexArray.length;i++)this.rewardCardSprites[i].visible=
indexArray[i]},setRollCard:function(index,isRolling){for(var i=0;i<3;i++)this.cardRollingSprites[i*5+index].visible=isRolling;this.cardSprites[index].visible=!isRolling;this.cards[index].rolling=isRolling;if(!isRolling){var duration=.1;var basex=this.cardSprites[index].getPositionX();var basey=this.cardSprites[index].getPositionY();cc.log("basey : "+basey);var move1=new cc.MoveTo(duration,cc.p(basex,basey-20));var move2=new cc.MoveTo(duration,cc.p(basex,basey));this.cardSprites[index].runAction(new cc.Sequence(move1,
move2))}},setRolling:function(isRolling){this.rolling=isRolling;for(var i=0;i<5;i++)this.setRollCard(i,isRolling)}});var rewardItem=cc.Node.extend({widthInPixel:240,ctor:function(){this._super();this.widthInPixel=320*cc.winSize.screenScale;this.initItem.apply(this,arguments)},initItem:function(){var bg=new ccui.Scale9Sprite("reward_bg.png",cc.rect(12,12,1,1));bg.setPreferredSize(cc.size(this.widthInPixel,40));this.bg=bg;this.addChild(bg);var bg_active=new ccui.Scale9Sprite("reward_bg_active.png",cc.rect(28,28,1,1));bg_active.setPreferredSize(cc.size(this.widthInPixel+15,40+15));var fadeIn=new cc.FadeIn(.5,cc.p(0,
0));var faceOut=new cc.FadeOut(.5,cc.p(300,300));bg_active.runAction(new cc.RepeatForever(new cc.Sequence(fadeIn,faceOut)));this.bg_active=bg_active;bg_active.visible=false;this.addChild(bg_active);var rewardNameLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_25,"",cc.TEXT_ALIGNMENT_LEFT);rewardNameLabel.setAnchorPoint(cc.p(0,.5));rewardNameLabel.setPosition(-this.widthInPixel/2+40,this.height/2);rewardNameLabel.setString(arguments[0]||"");rewardNameLabel.setColor(cc.color("#ffffab"));
this.addChild(rewardNameLabel);this.rewardNameLabel=rewardNameLabel;var rewardXLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_25,"",cc.TEXT_ALIGNMENT_RIGHT);rewardXLabel.setAnchorPoint(cc.p(1,.5));rewardXLabel.setPosition(this.widthInPixel/2-10,this.height/2);rewardXLabel.setColor(cc.color("#1a8cbc"));if(arguments[1])rewardXLabel.setString("X"+arguments[1]);this.addChild(rewardXLabel);this.rewardXLabel=rewardXLabel;var rewardIcon=new cc.Sprite("#rewardIcon.png");rewardIcon.setPosition(-this.widthInPixel/
2+20,0);this.addChild(rewardIcon)},setRewardName:function(str){if(this.rewardNameLabel)this.rewardNameLabel.setString(str)},setRewardX:function(str){if(this.rewardXLabel)this.rewardXLabel.setString(str)},setActive:function(isActive){this.bg.visible=!isActive;this.bg_active.visible=isActive;this.rewardXLabel.setColor(cc.color(isActive?"#ffff00":"#1a8cbc"))}});
var VideoPockerScene=MiniGameScene.extend({ctor:function(){this._super();this.baseCardHeight=0;this.cardHeight=0;this.rollHeight=0;this.rolling=false;this.rewardFund=[];this.cardLayoutMargin=(870*cc.winSize.screenScale-590)/6+115-80*cc.winSize.screenScale;this.turnState=0;this.rewardGroup=[];this.activeReward={};this.rewardCardSprites=[];this.cards=[];this.stat_board=new StatisticBoard(GameType.MiniGame_VideoPoker);for(var i=0;i<5;i++)this.cards.push({rolling:false});this.initAvatarMe();this.initButton();
this.initChip(cc.winSize.width/2+167*cc.winSize.screenScale);this.holdLayers=[];this.holdingList=[false,false,false,false,false];this.initScene();this.initRewards();var thiz=this;cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:true,onTouchBegan:function(touch,event){for(i=0;i<thiz.cardSprites.length;i++){var p=thiz.cardSprites[i].convertToNodeSpace(touch.getLocation());if(cc.rectContainsPoint(cc.rect(0,0,thiz.cardSprites[i]._getWidth(),thiz.cardSprites[i]._getHeight()),
p)){thiz.holdClick(i);return true}}return false}},this)},initController:function(){this._controller=new VideoPokerController(this)},initScene:function(){var thiz=this;var miniPokerLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_30,"Video Poker",cc.TEXT_ALIGNMENT_LEFT);miniPokerLabel.setAnchorPoint(cc.p(0,.5));miniPokerLabel.setPosition(15+105*cc.winSize.screenScale,720-48*cc.winSize.screenScale);this.sceneLayer.addChild(miniPokerLabel);var classicLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_25,
"Classic",cc.TEXT_ALIGNMENT_LEFT);classicLabel.setAnchorPoint(cc.p(0,.5));classicLabel.setPosition(15+105*cc.winSize.screenScale,720-15-70*cc.winSize.screenScale);this.sceneLayer.addChild(classicLabel);var rollLayer=new cc.Sprite("#roll_bg.png");rollLayer.setPosition(cc.winSize.width/2+167*cc.winSize.screenScale,cc.winSize.height/2);rollLayer.setScale(cc.winSize.screenScale,1);this.sceneLayer.addChild(rollLayer);var cards_border=new ccui.Scale9Sprite("poker_cards_border.png",cc.rect(97,97,5,3));cards_border.setPreferredSize(cc.size(870*
cc.winSize.screenScale,325));cards_border.setPosition(cc.winSize.width/2+167*cc.winSize.screenScale,cc.winSize.height/2+25);this.sceneLayer.addChild(cards_border);var resultLabel=cc.Label.createWithBMFont(cc.res.font.videoPokerRewardFont,"0",cc.TEXT_ALIGNMENT_CENTER);resultLabel.setPosition(cc.winSize.width/2+167*cc.winSize.screenScale,cc.winSize.height/2+175);this.resultLabel=resultLabel;this.sceneLayer.addChild(resultLabel);var resultIcon=new cc.Sprite("#rewardIcon.png");resultIcon.setPosition(cc.winSize.width/
2+100*cc.winSize.screenScale,resultLabel.getPositionY());resultIcon.setScale(1.2);this.sceneLayer.addChild(resultIcon);var huthuongLabel=new cc.Sprite("#minipoker_huthuong.png");huthuongLabel.setPosition(cc.winSize.width/2-105*cc.winSize.screenScale,cc.winSize.height/2-130);this.sceneLayer.addChild(huthuongLabel);var huthuongValueLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_BoldCondensed_36_Glow,"1.000.000",cc.TEXT_ALIGNMENT_CENTER);huthuongValueLabel.setPosition(huthuongLabel.x,huthuongLabel.y-
40);this.huThuongValueLabel=huthuongValueLabel;this.sceneLayer.addChild(huthuongValueLabel);var quayBt=new ccui.Button("videoQuayBtn.png","","",ccui.Widget.PLIST_TEXTURE);quayBt.setPosition(cc.winSize.width/2+167*cc.winSize.screenScale,cc.winSize.height/2-159);quayBt.setZoomScale(0);quayBt.setScale(4/5);this.quayBt=quayBt;this.sceneLayer.addChild(quayBt);this.initFlashing();quayBt.addClickEventListener(function(){thiz.onQuayBtClick()});var nhanthuongBt=new ccui.Button("btnNhanthuong.png","","",ccui.Widget.PLIST_TEXTURE);
nhanthuongBt.setPosition(cc.winSize.width/2+434*cc.winSize.screenScale,cc.winSize.height/2-160);this.nhanthuongBt=nhanthuongBt;nhanthuongBt.addClickEventListener(function(){thiz.nhanthuongClick()});nhanthuongBt.setScale(cc.winSize.screenScale);this.sceneLayer.addChild(nhanthuongBt);var clippingcards_layout=new ccui.Layout;this.clippingcards_layout=clippingcards_layout;clippingcards_layout.setContentSize(cards_border._getWidth()-140*cc.winSize.screenScale,cards_border._getHeight()-100);clippingcards_layout.setClippingEnabled(true);
clippingcards_layout.setClippingType(ccui.Layout.CLIPPING_SCISSOR);clippingcards_layout.setPosition(cc.winSize.width/2+240*cc.winSize.screenScale-cards_border.width/2,cc.winSize.height/2-88);this.sceneLayer.addChild(clippingcards_layout);this.cardSprites=[];this.cardRollingSprites=[];this.baseCardHeight=clippingcards_layout.height/2;for(i=0;i<5;i++){var cardSprite=new cc.Sprite("#gp_card_up.png");cardSprite.setPosition(i*(122+20*cc.winSize.screenScale)*cc.winSize.screenScale+this.cardLayoutMargin,
clippingcards_layout.height/2-3);clippingcards_layout.addChild(cardSprite);cardSprite.setScale(1.5*cc.winSize.screenScale);var rewardSprite=new cc.Sprite("#card_selected.png");rewardSprite.setPosition(cardSprite.getPosition());clippingcards_layout.addChild(rewardSprite);rewardSprite.setScale(1.05*cc.winSize.screenScale);var fadeIn=new cc.FadeIn(.5);var fadeOut=new cc.FadeOut(.5);rewardSprite.runAction(new cc.RepeatForever(new cc.Sequence(fadeIn,fadeOut)));rewardSprite.visible=false;this.cardSprites.push(cardSprite);
this.rewardCardSprites.push(rewardSprite)}this.cardHeight=clippingcards_layout.height;for(i=0;i<15;i++){var cardSprite=new cc.Sprite("#card-motion"+(i%3+1)+".png");cardSprite.setPosition(i%5*(122+20*cc.winSize.screenScale)*cc.winSize.screenScale+this.cardLayoutMargin,clippingcards_layout.height/2+(i%3-1)*clippingcards_layout.height);clippingcards_layout.addChild(cardSprite);cardSprite.setScale(1.5*cc.winSize.screenScale);cardSprite.setOpacity(128);cardSprite.visible=false;this.cardRollingSprites.push(cardSprite)}for(i=
0;i<5;i++){var cardHold=new cc.Sprite("#videopoker_hold.png");cardHold.setPosition(i*(122+20*cc.winSize.screenScale)*cc.winSize.screenScale+this.cardLayoutMargin,clippingcards_layout.height/2-10*cc.winSize.screenScale);cardHold.setScale(182/265*1.5*cc.winSize.screenScale);clippingcards_layout.addChild(cardHold);cardHold.visible=this.holdingList[i];this.holdLayers.push(cardHold)}this.stat_board=new StatisticBoard},onEnter:function(){this._super();this.scheduleUpdate()},onExit:function(){this._super();
this.unscheduleUpdate()},update:function(dt){if(!this.baseCardHeight||!this.cardHeight||!this.rolling)return;this.rollHeight-=40;this.rollHeight=this.rollHeight>0?this.rollHeight:this.rollHeight+this.cardHeight*3;for(i=0;i<15;i++){if(!this.cards[i%5].rolling||this.holdingList[i%5])continue;this.cardRollingSprites[i].visible=true;var newY=this.baseCardHeight+(i%3-1)*this.cardHeight+this.rollHeight;newY=newY>this.baseCardHeight+this.cardHeight?newY-2*this.cardHeight:newY;this.cardRollingSprites[i].setPosition(i%
5*(122+20*cc.winSize.screenScale)*cc.winSize.screenScale+this.cardLayoutMargin,newY)}},initRewards:function(){var margin_left=35+140*cc.winSize.screenScale;var item_height=50;var huthuong=new rewardItem("h\u0169 th\u01b0\u1edfng");huthuong.setAnchorPoint(cc.p(0,.5));huthuong.setPosition(margin_left,550);this.sceneLayer.addChild(huthuong);this.rewardGroup.push(huthuong);var thungphasanh=new rewardItem("th\u00f9ng ph\u00e1 s\u1ea3nh",50);thungphasanh.setAnchorPoint(cc.p(0,.5));thungphasanh.setPosition(margin_left,
huthuong.getPositionY()-item_height);this.sceneLayer.addChild(thungphasanh);this.rewardGroup.push(thungphasanh);var tuquy=new rewardItem("t\u1ee9 qu\u00fd",25);tuquy.setAnchorPoint(cc.p(0,.5));tuquy.setPosition(margin_left,thungphasanh.getPositionY()-item_height);this.sceneLayer.addChild(tuquy);this.rewardGroup.push(tuquy);var culu=new rewardItem("c\u1ee7 l\u0169",9);culu.setAnchorPoint(cc.p(0,.5));culu.setPosition(margin_left,tuquy.getPositionY()-item_height);this.sceneLayer.addChild(culu);this.rewardGroup.push(culu);
var thung=new rewardItem("th\u00f9ng",6);thung.setPosition(margin_left,culu.getPositionY()-item_height);this.sceneLayer.addChild(thung);this.rewardGroup.push(thung);var sanh=new rewardItem("s\u1ea3nh",4);sanh.setPosition(margin_left,thung.getPositionY()-item_height);this.sceneLayer.addChild(sanh);this.rewardGroup.push(sanh);var bala=new rewardItem("ba l\u00e1",3);bala.setPosition(margin_left,sanh.getPositionY()-item_height);this.sceneLayer.addChild(bala);this.rewardGroup.push(bala);var haidoi=new rewardItem("hai \u0111\u00f4i",
2);haidoi.setPosition(margin_left,bala.getPositionY()-item_height);this.sceneLayer.addChild(haidoi);this.rewardGroup.push(haidoi);var doijhoachon=new rewardItem("\u0111\u00f4i j ho\u1eb7c h\u01a1n",1);doijhoachon.setPosition(margin_left,haidoi.getPositionY()-item_height);this.sceneLayer.addChild(doijhoachon);this.rewardGroup.push(doijhoachon)},onQuayBtClick:function(){if(this.rolling)return;var betType=this.chipGroup.chipSelected.chipIndex;switch(this.turnState){case 0:case 4:this._controller.sendRollRequest(betType);
this.setRolling(true);break;case 1:this._controller.sendNextRollRequest(this.holdingList);this.setRolling(true);break;case 2:this._controller.sendDoubleRequest();break}},performChangeRewardFund:function(data){this._super(data);var betAmountID=this.chipGroup.chipSelected.chipIndex;if(!this.rewardFund||this.rewardFund.length<3)return;this.huThuongValueLabel.setString(this.rewardFund[betAmountID-1]["2"])},nhanthuongClick:function(){this._controller.sendGetRewardRequest()},holdClick:function(holdIndex){if(this.turnState==
1)this.setHoldCard(holdIndex,!this.holdingList[holdIndex]);else if(this.turnState==3){if(holdIndex==0)return;this._controller.sendDoubleChoice(holdIndex)}},setHoldCard:function(index,isHold){this.holdingList[index]=isHold;this.holdLayers[index].visible=isHold},initFlashing:function(){var quayTopParticle=new cc.Sprite("#quayTopParticle1.png");quayTopParticle.setPosition(cc.winSize.width/2+167*cc.winSize.screenScale,cc.winSize.height/2-131);quayTopParticle.setScale(4/5);this.quayTopParticle=quayTopParticle;
this.sceneLayer.addChild(quayTopParticle);var quayBtmParticle=new cc.Sprite("#quayBtmParticle1.png");quayBtmParticle.setPosition(cc.winSize.width/2+167*cc.winSize.screenScale,cc.winSize.height/2-195);quayBtmParticle.setScale(4/5);this.quayBtmParticle=quayBtmParticle;this.sceneLayer.addChild(quayBtmParticle)},setFlashing:function(isX2Enabled,isFlashing){this.quayBt.loadTextureNormal(isX2Enabled?"videoX2Btn.png":"videoQuayBtn.png",ccui.Widget.PLIST_TEXTURE);this.quayTopParticle.stopAllActions();this.quayBtmParticle.stopAllActions();
if(isFlashing)if(isX2Enabled){var x2TopFrames=[];for(var i=1;i<=2;i++){var str="x2TopParticle"+i+".png";var spriteFrame=cc.spriteFrameCache.getSpriteFrame(str);var animFrame=new cc.AnimationFrame;animFrame.initWithSpriteFrame(spriteFrame,1,null);x2TopFrames.push(animFrame)}var x2TopAnimation=cc.Animation.create(x2TopFrames,.2,2);var xtAction=cc.Animate.create(x2TopAnimation);var x2TopAction=new cc.RepeatForever(xtAction);var x2BtmFrames=[];for(var i=1;i<=2;i++){var str="x2BtmParticle"+i+".png";var spriteFrame=
cc.spriteFrameCache.getSpriteFrame(str);var animFrame=new cc.AnimationFrame;animFrame.initWithSpriteFrame(spriteFrame,1,null);x2BtmFrames.push(animFrame)}var x2BtmAnimation=cc.Animation.create(x2BtmFrames,.2,2);var xbAction=cc.Animate.create(x2BtmAnimation);var x2BtmAction=new cc.RepeatForever(xbAction);this.quayTopParticle.runAction(x2TopAction);this.quayBtmParticle.runAction(x2BtmAction)}else{var quayTopFrames=[];for(i=1;i<=2;i++){var str="quayTopParticle"+i+".png";var spriteFrame=cc.spriteFrameCache.getSpriteFrame(str);
var animFrame=new cc.AnimationFrame;animFrame.initWithSpriteFrame(spriteFrame,1,null);quayTopFrames.push(animFrame)}var quayTopAnimation=cc.Animation.create(quayTopFrames,.2,2);var qtAction=cc.Animate.create(quayTopAnimation);var quayTopAction=new cc.RepeatForever(qtAction);var quayBtmFrames=[];for(var i=1;i<=2;i++){var str="quayBtmParticle"+i+".png";var spriteFrame=cc.spriteFrameCache.getSpriteFrame(str);var animFrame=new cc.AnimationFrame;animFrame.initWithSpriteFrame(spriteFrame,1,null);quayBtmFrames.push(animFrame)}var quayBtmAnimation=
cc.Animation.create(quayBtmFrames,.2,2);var qbAction=cc.Animate.create(quayBtmAnimation);var quayBtmAction=new cc.RepeatForever(qbAction);this.quayTopParticle.runAction(quayTopAction);this.quayBtmParticle.runAction(quayBtmAction)}},updateRewardFund:function(){var betAmountID=this.chipGroup.chipSelected.chipIndex;if(!this.rewardFund||this.rewardFund.length<3)return;this.huThuongValueLabel.setString(""+cc.Global.NumberFormat1(this.rewardFund[betAmountID-1]["2"]))},onSelectChip:function(chipIndex){if(this.rewardFund.length<
3)return;this.huThuongValueLabel.setString(""+cc.Global.NumberFormat1(this.rewardFund[chipIndex-1]["2"]))},activateReward:function(id){if(this.activeReward instanceof rewardItem)this.activeReward.setActive(false);if(id<9){this.activeReward=this.rewardGroup[id];this.activeReward.setActive(true)}else this.activeReward={}},resetBoard:function(){this.turnState=0;this.setFlashing(false,false);this.activateReward(11);this.resultLabel.setString("0");for(var i=0;i<5;i++){this.holdingList[i]=false;this.holdLayers[i].visible=
false;this.cardSprites[i].setSpriteFrame("gp_card_up.png")}},setRolling:function(isRolling){this.rolling=isRolling;for(var i=0;i<5;i++)this.setRollCard(i,isRolling)},setHoldArray:function(holdArray){this.holdingList=holdArray;for(var i=0;i<5;i++)this.setHoldCard(i,holdArray[i])},setCardArray:function(cardArray){for(var i=0;i<cardArray.length;i++){var card=CardList.prototype.getCardWithId(cardArray[i]);this.cardSprites[i].setSpriteFrame(""+card.rank+s_card_suit[card.suit]+".png")}this.setRolling(false)},
showDoubleTurn:function(firstCardId){var card=CardList.prototype.getCardWithId(firstCardId);this.cardSprites[0].setSpriteFrame(""+card.rank+s_card_suit[card.suit]+".png");for(var i=1;i<5;i++){this.cardSprites[i].setSpriteFrame("gp_card_up.png");this.holdLayers[i].setVisible(false)}},setRewardCards:function(indexArray){for(var i=0;i<indexArray.length;i++)this.rewardCardSprites[i].visible=indexArray[i]},setBankValue:function(value){this.resultLabel.setString(cc.Global.NumberFormat1(value))},setRollCard:function(index,
isRolling){if(this.holdingList[index]&&isRolling)return;for(var i=0;i<3;i++)this.cardRollingSprites[i*5+index].visible=isRolling;this.cardSprites[index].visible=!isRolling;if(isRolling==false&&this.cards[index].rolling){var duration=.1;var basex=this.cardSprites[index].getPositionX();var basey=this.cardSprites[index].getPositionY();var move1=new cc.MoveTo(duration,cc.p(basex,basey-20));var move2=new cc.MoveTo(duration,cc.p(basex,basey));this.cardSprites[index].runAction(new cc.Sequence(move1,move2));
cc.log("stop roll")}this.cards[index].rolling=isRolling}});var MiniLayerChip=ChipButton.extend({ctor:function(index){this._super();var normalSprite=new cc.Sprite("#minilayer-chip-"+index+".png");var selectedSprite=new cc.Sprite("#minilayer-chipSelected-"+index+".png");this.addChild(normalSprite);this.addChild(selectedSprite);this.normalSprite=normalSprite;this.selectedSprite=selectedSprite;this.chipIndex=index;var s=normalSprite.getContentSize();this.rectTouch=cc.rect(-s.width/3,-s.height/4,s.width,s.height/2);selectedSprite.visible=false},select:function(isForce){this._super();
this.normalSprite.visible=false;this.selectedSprite.visible=true},unSelect:function(isForce){this._super();this.normalSprite.visible=true;this.selectedSprite.visible=false}});var MiniGamePopup=cc.Node.extend({ctor:function(){this._super();if(!cc.sys.isNative)this.setScale((1+Math.sqrt(5))/2-1);else this.setScale(.7);this.setPosition(cc.winSize.width/2,cc.winSize.height/2);this.initController();this.rewardFund=[];var closeButton=new ccui.Button("caothap_closeBt.png","","",ccui.Widget.PLIST_TEXTURE);closeButton.setPosition(895,407);this.addChild(closeButton,5);var tutorialButton=new ccui.Button("caothap_tutorialBt.png","","",ccui.Widget.PLIST_TEXTURE);tutorialButton.setPosition(769,
426);this.addChild(tutorialButton,5);this.tutorialButton=tutorialButton;var historyButton=new ccui.Button("caothap_historyBt.png","","",ccui.Widget.PLIST_TEXTURE);historyButton.setPosition(694,430);this.addChild(historyButton,5);this.historyButton=historyButton;var jackpotLabel=new cc.LabelBMFont("100.000",cc.res.font.Roboto_CondensedBold_30);jackpotLabel.setColor(cc.color("#ffea00"));jackpotLabel.setPosition(500,462);this.jackpotLabel=jackpotLabel;this.addChild(jackpotLabel,1);this.initChip(cc.p(91,
260));var thiz=this;closeButton.addClickEventListener(function(){thiz.closeButtonHandler();SoundPlayer.playSound("mini_clickButton")});historyButton.addClickEventListener(function(){var stat_board=new StatisticBoard(thiz.gameType);stat_board.showWithAnimationScale();SoundPlayer.playSound("mini_clickButton")});tutorialButton.addClickEventListener(function(){if(thiz.gameType){var tutorialDialog=TutorialDialog.getTutorial(thiz.gameType);tutorialDialog.showWithAnimationScale()}SoundPlayer.playSound("mini_clickButton")});
this._controller.sendJoinGame()},onEnter:function(){this._super();var thiz=this;cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:true,onTouchBegan:function(touch,event){return thiz.onTouchBegan(touch,event)},onTouchMoved:function(touch,event){thiz.onTouchMoved(touch,event)},onTouchEnded:function(touch,event){thiz.onTouchEnded(touch,event)}},this)},initController:function(){},onError:function(param){MessageNode.getInstance().show(LobbyClient.Error[param.code]["message"]);
if(this._rollingSound){SoundPlayer.stopSoundLoop(this._rollingSound);this._rollingSound=null}this.setBettingSelectEnable(true)},performChangeRewardFund:function(data){this.rewardFund=data;if(this.chipGroup==undefined)return;var betAmountID=this.chipGroup.chipSelected.chipIndex;if(!this.rewardFund||this.rewardFund.length<3)return;this.jackpotLabel.setString(cc.Global.NumberFormat1(this.rewardFund[betAmountID-1]["2"]))},onChangeAssets:function(gold,changeAmount){if(changeAmount==0)return;var parent=
this.getParent();var changeSprite=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_25,"");var changeText=(changeAmount>=0?"+":"")+cc.Global.NumberFormat1(changeAmount);changeSprite.setString(changeText);changeSprite.setColor(cc.color(changeAmount>=0?"#ffde00":"#ff0000"));changeSprite.setPosition(50,70);parent.addChild(changeSprite,420);changeSprite.runAction(new cc.Sequence(new cc.MoveTo(1,changeSprite.x,changeSprite.y+50),new cc.CallFunc(function(){changeSprite.removeFromParent(true)})))},
initChip:function(centerPosition){var chipGroup=new ChipGroup;this.addChild(chipGroup,5);this.chipGroup=chipGroup;var thiz=this;var chip1=new MiniLayerChip(1);chip1.setPosition(centerPosition.x+21,centerPosition.y+105);chip1.setScale(cc.winSize.screenScale);chip1.originPoint=chip1.getPosition();chip1.onSelect=function(){thiz.onSelectChip(1)};chipGroup.addChip(chip1);var chip2=new MiniLayerChip(2);chip2.setPosition(centerPosition.x,centerPosition.y);chip2.setScale(cc.winSize.screenScale);chip2.originPoint=
chip2.getPosition();chip2.onSelect=function(){thiz.onSelectChip(2)};chipGroup.addChip(chip2);var chip3=new MiniLayerChip(3);chip3.setPosition(centerPosition.x+19,centerPosition.y-105);chip3.setScale(cc.winSize.screenScale);chip3.originPoint=chip3.getPosition();chip3.onSelect=function(){thiz.onSelectChip(3)};chipGroup.addChip(chip3);chipGroup.selectChipAtIndex(0)},onSelectChip:function(chipIndex){if(this.rewardFund.length<3)return;this.jackpotLabel.setString(""+cc.Global.NumberFormat1(this.rewardFund[chipIndex-
1]["2"]))},onExit:function(){this._super();this._controller.releaseController()},onTouchBegan:function(touch,event){if(this._touchStartPoint)return false;this._touchStartPoint=touch.getLocation();var p=this.convertToNodeSpace(this._touchStartPoint);if(cc.rectContainsPoint(this._boudingRect,p))return true;this._touchStartPoint=null;return false},onTouchMoved:function(touch,event){if(!this._touchStartPoint)return;var p=touch.getLocation();this.moveNode(cc.p(p.x-this._touchStartPoint.x,p.y-this._touchStartPoint.y));
this._touchStartPoint=p},onTouchEnded:function(touch,event){this._touchStartPoint=null},moveNode:function(ds){this.x+=ds.x;this.y+=ds.y;var lb=this.convertToWorldSpace(cc.p(this._boudingRect.x,this._boudingRect.y));var rt=this.convertToWorldSpace(cc.p(this._boudingRect.x+this._boudingRect.width,this._boudingRect.y+this._boudingRect.height));if(lb.x<0)this.x-=lb.x;if(rt.x>cc.winSize.width)this.x-=rt.x-cc.winSize.width;if(lb.y<0)this.y-=lb.y;if(rt.y>cc.winSize.height)this.y-=rt.y-cc.winSize.height},
show:function(){var parent=this.getParent();if(parent){this.removeFromParent(true);parent.removeFromParent(true)}var bg=new cc.LayerColor(cc.color(0,0,0,0));bg.addChild(this);var runningScene=cc.director.getRunningScene();if(runningScene)if(runningScene.miniGameLayer)runningScene.miniGameLayer.addChild(bg);else runningScene.addChild(bg)},backToHomeScene:function(){MiniGameNavigator.hideGame(this.gameType)},hide:function(){this.getParent().removeFromParent(true);SoundPlayer.stopAllSound()},setBettingSelectEnable:function(enable){this.chipGroup.setTouchEnable(enable)},
closeButtonHandler:function(){MiniGameNavigator.hideGame(this.gameType)}});var MiniGameNavigator=MiniGameNavigator||{};MiniGameNavigator.allGame={};MiniGameNavigator.createGameLayer=function(gameId){if(gameId===GameType.MiniGame_CaoThap)return new CaoThapLayer;else if(gameId===GameType.MiniGame_Poker)return new MiniPokerLayer;else if(gameId===GameType.MiniGame_VideoPoker)return new VideoPokerLayer;else if(gameId===GameType.MiniGame_ChanLe)return new ChanLeLayer};
MiniGameNavigator.showAll=function(){for(var key in MiniGameNavigator.allGame){if(!MiniGameNavigator.allGame.hasOwnProperty(key))continue;MiniGameNavigator.allGame[key].show()}};MiniGameNavigator.hideAll=function(){for(var key in MiniGameNavigator.allGame){if(!MiniGameNavigator.allGame.hasOwnProperty(key))continue;MiniGameNavigator.allGame[key].hide()}MiniGameNavigator.allGame={}};
MiniGameNavigator.showGame=function(gameId){if(MiniGameNavigator.allGame[gameId])if(MiniGameNavigator.allGame[gameId].isRunning())cc.log("MiniGame "+gameId+" is running !!!");else MiniGameNavigator.allGame[gameId].show();else{MiniGameNavigator.allGame[gameId]=MiniGameNavigator.createGameLayer(gameId);MiniGameNavigator.allGame[gameId].show()}};MiniGameNavigator.hideGame=function(gameId){if(MiniGameNavigator.allGame[gameId]){MiniGameNavigator.allGame[gameId].hide();delete MiniGameNavigator.allGame[gameId]}};var CaoThapLayer=MiniGamePopup.extend({ctor:function(){this._super();this._boudingRect=cc.rect(30,47,930,510);this.rolling=false;this.gameType=GameType.MiniGame_CaoThap;var bg=new cc.Sprite("#caothap_bg.png");bg.setAnchorPoint(cc.p(0,0));this.setContentSize(bg.getContentSize());this.setAnchorPoint(cc.p(.5,.5));this.addChild(bg);var highButton=new ccui.Button("caothap_up.png","","",ccui.Widget.PLIST_TEXTURE);highButton.setPosition(270,292);highButton.setScale9Enabled(true);this.addChild(highButton);
this.highButton=highButton;var lowButton=new ccui.Button("caothap_down.png","","",ccui.Widget.PLIST_TEXTURE);lowButton.setPosition(730,292);lowButton.setScale9Enabled(true);this.addChild(lowButton);this.lowButton=lowButton;var startButton=new ccui.Button("caothap_startButton.png","","",ccui.Widget.PLIST_TEXTURE);startButton.setZoomScale(0);startButton.setScale9Enabled(true);startButton.setPosition(871.5,114);this.addChild(startButton);this.startButton=startButton;var nextButton=new ccui.Button("caothap_nextButton.png",
"","",ccui.Widget.PLIST_TEXTURE);nextButton.setZoomScale(0);nextButton.setScale9Enabled(true);nextButton.setPosition(startButton.getPosition());nextButton.setVisible(false);this.addChild(nextButton);this.nextButton=nextButton;var coinIcon=new cc.Sprite("#caothap_coinIcon.png");coinIcon.setPosition(749,90);this.addChild(coinIcon);var bankLabel=new cc.LabelBMFont("0",cc.res.font.Roboto_CondensedBold_30);bankLabel.setColor(cc.color("#ffea00"));bankLabel.setAnchorPoint(cc.p(1,.5));bankLabel.setPosition(725,
90);this.bankLabel=bankLabel;this.addChild(bankLabel,1);var highLabel=new cc.LabelBMFont("CAO",cc.res.font.Roboto_CondensedBold_30);highLabel.setColor(cc.color("#c9ceff"));highLabel.setPosition(highButton.x,192);this.addChild(highLabel,1);var lowLabel=new cc.LabelBMFont("TH\u1ea4P",cc.res.font.Roboto_CondensedBold_30);lowLabel.setColor(cc.color("#c9ceff"));lowLabel.setPosition(lowButton.x,highLabel.y);this.addChild(lowLabel,1);var highValueLabel=new cc.LabelBMFont("0",cc.res.font.Roboto_Condensed_25);
highValueLabel.setColor(cc.color("#ffea00"));highValueLabel.setPosition(highButton.x,160);this.highValueLabel=highValueLabel;this.addChild(highValueLabel,2);var lowValueLabel=new cc.LabelBMFont("0",cc.res.font.Roboto_Condensed_25);lowValueLabel.setColor(cc.color("#ffea00"));lowValueLabel.setPosition(lowButton.x,highValueLabel.y);this.lowValueLabel=lowValueLabel;this.addChild(lowValueLabel,2);var card=new cc.Sprite("#gp_card_up.png");card.setScale(2*cc.winSize.screenScale);card.setPosition(500,260);
this.addChild(card);this.card=card;var gameIdLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_25,"",cc.TEXT_ALIGNMENT_LEFT);gameIdLabel.setColor(cc.color("#5366cb"));gameIdLabel.setScale(.8);gameIdLabel.setPosition(lowButton.x,lowValueLabel.y-25);this.addChild(gameIdLabel);this.gameIdLabel=gameIdLabel;this.initNoHu();this.initHistory();var thiz=this;lowButton.addClickEventListener(function(){thiz.onLowPredictClick()});highButton.addClickEventListener(function(){thiz.onHighPredictClick()});
startButton.addClickEventListener(function(){thiz.onStartClick()});nextButton.addClickEventListener(function(){thiz.onLuotMoiBtClick()});this.setHighLowBtEnable(false)},onLuotMoiBtClick:function(){this._controller.sendLuotMoiRequest();SoundPlayer.playSound("mini_clickButton");this.setBettingSelectEnable(true);this.setReward(0,0)},onLowPredictClick:function(){if(this._controller.getTurnState()!=1)return;this.setRolling(true);this._controller.sendLowPredict();SoundPlayer.playSound("mini_clickButton")},
onHighPredictClick:function(){if(this._controller.getTurnState()!=1)return;this.setRolling(true);this._controller.sendHighPredict();SoundPlayer.playSound("mini_clickButton")},onStartClick:function(){if(this._controller.getTurnState()!=0)return;this.setRolling(true);this._controller.sendInitGame(this.chipGroup.chipSelected.chipIndex);SoundPlayer.playSound("mini_clickButton");this.setBettingSelectEnable(false)},initNoHu:function(){this._kingCards=[];for(var i=0;i<3;i++){var kingCard=new cc.Sprite("#caothap_kingCard_1.png");
kingCard.setPosition(227+i*45,429);this.addChild(kingCard,1);this._kingCards.push(kingCard)}},setBankValue:function(value){this.bankLabel.setString(cc.Global.NumberFormat1(value))},showResultCard:function(cardId){if(cardId>0){this.setRolling(false);var card=CardList.prototype.getCardWithId(cardId);this.card.setSpriteFrame(card.rank+s_card_suit[card.suit]+".png")}else this.card.setSpriteFrame("gp_card_up.png")},playSoundLost:function(){SoundPlayer.playSound("thuaroi")},initHistory:function(){var historyList=
new newui.TableView(cc.size(355,48),1);historyList.setDirection(ccui.ScrollView.DIR_HORIZONTAL);historyList.setReverse(true);historyList.setPosition(205,65);historyList.setScrollBarEnabled(false);this.addChild(historyList,3);this.historyList=historyList},initController:function(){this._controller=new CaoThapController(this)},pushKing:function(isK){if(!isK)for(var i=0;i<3;i++){this._kingCards[i].setSpriteFrame("caothap_kingCard_1.png");this._kingCards[i].activated=false}else{var i=0;while(this._kingCards[i].activated&&
i<2)i++;this._kingCards[i].setSpriteFrame("caothap_kingCard_2.png");this._kingCards[i].activated=true}},setRolling:function(isRolling){this.rolling=isRolling;if(isRolling)this._rollingSound=SoundPlayer.playSoundLoop("lucky_wheel");else{SoundPlayer.stopSoundLoop(this._rollingSound);this._rollingSound=null}},update:function(dt){if(this.rolling){this.delta+=dt;var randNum=Math.floor(Math.random()*51+4);var thiz=this;var texture=""+Math.floor(randNum/4)+s_card_suit[randNum%4]+".png";this.card.setSpriteFrame(texture);
this.delta=0}},addHistory:function(cardValue,enforce){var card=CardList.prototype.getCardWithId(cardValue);var cardIndex=card.rank;if(this.historyList.size()>0){var item=this.historyList.getItem(0);item.label.setColor(cc.color("#8d9de6"));item.lastCardSprite.setVisible(false)}var container=new ccui.Widget;container.setContentSize(39,48);var cardString="";if(cardIndex==1)cardString="A";else if(cardIndex==11)cardString="J";else if(cardIndex==12)cardString="Q";else if(cardIndex==13)cardString="K";else cardString=
cardIndex.toString();var label=new cc.LabelBMFont(cardString,cc.res.font.Roboto_CondensedBold_30);label.setColor(cc.color("#7adfff"));label.setPosition(container.getContentSize().width/2,container.getContentSize().height/2);container.addChild(label);container.label=label;var lastCardSprite=new cc.Sprite("#caothap_history_lastCard.png");lastCardSprite.setPosition(label.getPosition());container.addChild(lastCardSprite);container.lastCardSprite=lastCardSprite;this.historyList.insertItem(container,0);
this.historyList.forceRefreshView();this.historyList.jumpToRight()},setReward:function(lowReward,highReward){this.lowValueLabel.setString(cc.Global.NumberFormat1(lowReward));this.highValueLabel.setString(cc.Global.NumberFormat1(highReward))},setGameId:function(gameId){this.gameIdLabel.setString("ID: "+gameId)},setTimeRemaining:function(timeRemaining){},formatTime:function(timeRemaining){var minute=Math.floor(timeRemaining/60);if(minute<10)minute="0"+minute;var second=timeRemaining%60;if(second<10)second=
"0"+second;return minute+" : "+second},setTipString:function(str){},setLuotMoiBtVisible:function(visible){this.startButton.visible=!visible;this.nextButton.visible=visible},setLuotMoiBtEnable:function(enabled){this.nextButton.enabled=enabled;this.startButton.enabled=enabled;this.nextButton.setBright(enabled);this.startButton.setBright(enabled)},setHighLowBtEnable:function(enabled){this.highButton.enabled=enabled;this.lowButton.enabled=enabled;this.highButton.setBright(enabled);this.lowButton.setBright(enabled)},
showJackpot:function(){var layer=new JackpotLayer;layer.show()},clearTurn:function(){this.bankLabel.setString("0");this.nextButton.visible=false;this.startButton.visible=true;this.historyList.removeAllItems();this.card.setSpriteFrame("gp_card_up.png");this.setHighLowBtEnable(false);this.setLuotMoiBtEnable(true)},onEnter:function(){this._super();this.scheduleUpdate()},onExit:function(){this._super();this.unscheduleUpdate()},onError:function(param){this._super(param);this.setRolling(false);this.clearTurn()}});var MiniPokerLayer=MiniGamePopup.extend({ctor:function(){this._super();this.cardSprites=[];this.autoRoll=false;this.rolling=false;this.baseCardHeight=0;this.cardHeight=0;this.rollHeight=0;this.rewards=[];this.rewardLayer=[];this.cardRollingSprites=[];this.gameType=GameType.MiniGame_Poker;this.initRewards();var bg=new cc.Sprite("#minipoker_bg.png");bg.setAnchorPoint(cc.p(0,0));this.setContentSize(bg.getContentSize());this.setAnchorPoint(cc.p(.5,.5));this.addChild(bg);this._boudingRect=cc.rect(30,47,
930,510);var resultLabel=new cc.LabelBMFont("",cc.res.font.Roboto_CondensedBold_30);resultLabel.setColor(cc.color("#c9ceff"));resultLabel.setPosition(500,370);this.resultLabel=resultLabel;this.addChild(resultLabel,1);var gameIdLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_25,"ID : 1231231233",cc.TEXT_ALIGNMENT_LEFT);gameIdLabel.setColor(cc.color("#5366cb"));gameIdLabel.setScale(.8);gameIdLabel.setPosition(730,135);this.addChild(gameIdLabel);this.gameIdLabel=gameIdLabel;var rollButton=
new ccui.Button("minipoker_rollButton.png","","",ccui.Widget.PLIST_TEXTURE);rollButton.setZoomScale(0);rollButton.setScale9Enabled(true);rollButton.setPosition(870,114);this.addChild(rollButton);this.rollButton=rollButton;var autoRollButton=new ccui.Button("minipoker_quaytudong.png","","",ccui.Widget.PLIST_TEXTURE);autoRollButton.setZoomScale(0);autoRollButton.setPosition(650,90);this.autoRollButton=autoRollButton;this.addChild(autoRollButton);var clippingCardLayout=new ccui.Layout;clippingCardLayout.setContentSize(750,
170);clippingCardLayout.setClippingEnabled(true);clippingCardLayout.setClippingType(ccui.Layout.CLIPPING_SCISSOR);clippingCardLayout.setPosition(180,170);this.addChild(clippingCardLayout);this.cardHeight=clippingCardLayout.height;this.baseCardHeight=clippingCardLayout.height/2;for(var i=0;i<5;i++){var sprite=new cc.Sprite("#gp_card_up.png");sprite.setScale(1.4);sprite.setPosition(60+135*i,clippingCardLayout.height/2);clippingCardLayout.addChild(sprite);this.cardSprites.push(sprite);var rewardSprite=
new cc.Sprite("#videopoker_rewardLayer.png");rewardSprite.setPosition(sprite.getPosition());rewardSprite.setScale(1.4);rewardSprite.setVisible(false);clippingCardLayout.addChild(rewardSprite);this.rewardLayer.push(rewardSprite)}for(var i=0;i<15;i++){var rollingSprite=new cc.Sprite("#card-motion"+(i%3+1)+".png");rollingSprite.setPosition(this.cardSprites[i%5].x,clippingCardLayout.height/2+(i%3-1)*clippingCardLayout.height);clippingCardLayout.addChild(rollingSprite,4);rollingSprite.setOpacity(128);
rollingSprite.setVisible(false);rollingSprite.setScale(1.4);this.cardRollingSprites.push(rollingSprite)}var thiz=this;autoRollButton.addClickEventListener(function(){thiz.onAutoRollClick()});rollButton.addClickEventListener(function(){thiz.onRollClick()})},initRewards:function(){this.rewards.push("H\u0169 th\u01b0\u1edfng");this.rewards.push("Th\u00f9ng ph\u00e1 s\u1ea3nh");this.rewards.push("T\u1ee9 qu\u00fd");this.rewards.push("C\u00f9 l\u0169");this.rewards.push("Th\u00f9ng");this.rewards.push("S\u1ea3nh");
this.rewards.push("X\u00e1m c\u00f4");this.rewards.push("Hai \u0111\u00f4i");this.rewards.push("\u0110\u00f4i")},update:function(dt){if(!this.baseCardHeight||!this.cardHeight||!this.rolling)return;this.rollHeight-=40;this.rollHeight=this.rollHeight>0?this.rollHeight:this.rollHeight+this.cardHeight*3;for(i=0;i<15;i++){this.cardRollingSprites[i].visible=true;var newY=this.baseCardHeight+(i%3-1)*this.cardHeight+this.rollHeight;newY=newY>this.baseCardHeight+this.cardHeight?newY-2*this.cardHeight:newY;
this.cardRollingSprites[i].setPositionY(newY)}},onEnter:function(){this._super();this.scheduleUpdate()},onExit:function(){this._super();this.unscheduleUpdate()},onAutoRollClick:function(){this.autoRoll=!this.autoRoll;this.autoRollButton.loadTextureNormal(this.autoRoll?"minipoker_quaytudong_active.png":"minipoker_quaytudong.png",ccui.Widget.PLIST_TEXTURE);var thiz=this;if(!this.rolling&&this.autoRoll)thiz.onRollClick();SoundPlayer.playSound("mini_clickButton");if(this.autoRoll);else;},activateReward:function(id,
rank){var str="";str=this.rewards[id]?this.rewards[id]:"KH\u00d4NG \u0102N";if(rank)switch(rank){case 12:str+=" \u00c1T";break;case 0:str+=" HAI";break;case 1:str+=" BA";break;case 2:str+=" B\u1ed0N";break;case 3:str+=" N\u0102M";break;case 4:str+=" S\u00c1U";break;case 5:str+=" B\u1ea2Y";break;case 6:str+=" T\u00c1M";break;case 7:str+=" CH\u00cdN";break;case 8:str+=" M\u01af\u1edcI";break;case 9:str+=" J";break;case 10:str+=" Q";break;case 11:str+=" K";break}this.resultLabel.setString(str);SoundPlayer.playSound(this.rewards[id]?
"NormalWin":"mini_slotLost")},setRewardCards:function(rewardArrayIndex){for(var i=0;i<rewardArrayIndex.length;i++)this.rewardLayer[i].setVisible(rewardArrayIndex[i])},onRollClick:function(){this.setRolling(true);this.setBettingSelectEnable(false);this.resultLabel.setString("");this._controller.sendRollRequest(this.chipGroup.chipSelected.chipIndex);SoundPlayer.playSound("mini_clickButton")},initController:function(){this._controller=new MiniPokerController(this)},setCardArray:function(cardArray){for(var i=
0;i<cardArray.length;i++){var card=CardList.prototype.getCardWithId(cardArray[i]);this.cardSprites[i].setSpriteFrame(""+card.rank+s_card_suit[card.suit]+".png")}this.setRolling(false);var thiz=this;if(this.autoRoll)setTimeout(function(){thiz.onRollClick()},500);else{this.setQuayBtEnable(true);this.setBettingSelectEnable(true)}},setRolling:function(isRolling){this.rolling=isRolling;if(isRolling)for(var i=0;i<5;i++)this.rewardLayer[i].visible=false;for(var i=0;i<15;i++){this.cardSprites[i%5].visible=
!isRolling;this.cardRollingSprites[i].visible=isRolling}if(isRolling)this._rollingSound=SoundPlayer.playSoundLoop("mini_flyCard");else{SoundPlayer.stopSoundLoop(this._rollingSound);this._rollingSound=null}},onError:function(param){this._super(param);this.setRolling(false);this.setQuayBtEnable(true)},setQuayBtEnable:function(enabled){this.rollButton.enabled=enabled;this.rollButton.setBright(enabled)},showJackpot:function(){var layer=new JackpotLayer;layer.show()}});var VideoPokerLayer=MiniGamePopup.extend({ctor:function(){this._super();this.cardSprites=[];this.rolling=false;this.baseCardHeight=0;this.cardHeight=0;this.rollHeight=0;this.rewards=[];this.rewardLayer=[];this.cardRollingSprites=[];this.holdingList=[0,0,0,0,0];this.holdLayers=[];this.gameType=GameType.MiniGame_VideoPoker;var thiz=this;var bg=new cc.Sprite("#videopoker_bg.png");bg.setAnchorPoint(cc.p(0,0));this.setContentSize(bg.getContentSize());this.setAnchorPoint(cc.p(.5,.5));this.addChild(bg);
this.initRewards();var resultLabel=new cc.LabelBMFont("",cc.res.font.Roboto_CondensedBold_30);resultLabel.setColor(cc.color("#c9ceff"));resultLabel.setPosition(500,370);this.resultLabel=resultLabel;this.addChild(resultLabel,1);var gameIdLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_25,"ID : 1231231233",cc.TEXT_ALIGNMENT_LEFT);gameIdLabel.setColor(cc.color("#5366cb"));gameIdLabel.setScale(.8);gameIdLabel.setPosition(730,135);this.addChild(gameIdLabel);this.gameIdLabel=gameIdLabel;var rollButton=
new ccui.Button("minipoker_rollButton.png","","",ccui.Widget.PLIST_TEXTURE);rollButton.setZoomScale(0);rollButton.setScale9Enabled(true);rollButton.setPosition(870,114);this.addChild(rollButton);this.rollButton=rollButton;var clippingCardLayout=new ccui.Layout;clippingCardLayout.setContentSize(750,170);clippingCardLayout.setClippingEnabled(true);clippingCardLayout.setClippingType(ccui.Layout.CLIPPING_SCISSOR);clippingCardLayout.setPosition(180,170);this.addChild(clippingCardLayout);this.cardHeight=
clippingCardLayout.height;this.baseCardHeight=clippingCardLayout.height/2;for(var i=0;i<5;i++){var sprite=new cc.Sprite("#gp_card_up.png");sprite.setScale(1.4);sprite.setPosition(60+135*i,clippingCardLayout.height/2);clippingCardLayout.addChild(sprite);this.cardSprites.push(sprite);var rewardSprite=new cc.Sprite("#videopoker_rewardLayer.png");rewardSprite.setPosition(sprite.getPosition());rewardSprite.setScale(1.4);rewardSprite.setVisible(false);clippingCardLayout.addChild(rewardSprite);this.rewardLayer.push(rewardSprite);
var holdSprite=new cc.Sprite("#videopoker_holdLayer.png");holdSprite.setPosition(sprite.getPosition());holdSprite.setScale(1.4);holdSprite.setVisible(false);var holdLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_CondensedBold_25,"HOLD");holdLabel.setColor(cc.color("#ffd509"));holdLabel.setPosition(holdSprite.width/2,holdSprite.height/2);holdSprite.addChild(holdLabel);clippingCardLayout.addChild(holdSprite);this.holdLayers.push(holdSprite)}for(var i=0;i<15;i++){var rollingSprite=new cc.Sprite("#card-motion"+
(i%3+1)+".png");rollingSprite.setPosition(this.cardSprites[i%5].x,clippingCardLayout.height/2+(i%3-1)*clippingCardLayout.height);clippingCardLayout.addChild(rollingSprite,4);rollingSprite.setOpacity(128);rollingSprite.setVisible(false);rollingSprite.setScale(1.4);this.cardRollingSprites.push(rollingSprite)}var coinIcon=new cc.Sprite("#caothap_coinIcon.png");coinIcon.setPosition(549,90);this.addChild(coinIcon);var bankLabel=new cc.LabelBMFont("",cc.res.font.Roboto_CondensedBold_30);bankLabel.setColor(cc.color("#ffea00"));
bankLabel.setAnchorPoint(cc.p(1,.5));bankLabel.setPosition(520,90);this.bankLabel=bankLabel;this.addChild(bankLabel,1);var nhanThuongBt=new ccui.Button("videopoker_nhanthuongBt.png","","",ccui.Widget.PLIST_TEXTURE);nhanThuongBt.setPosition(685,90);nhanThuongBt.setScale9Enabled(true);this.nhanThuongBt=nhanThuongBt;this.addChild(nhanThuongBt,1);this.setNhanThuongBtEnable(false);this._boudingRect=cc.rect(30,47,930,510);this.rollButton.addClickEventListener(function(){thiz.onRollButtonClick()});nhanThuongBt.addClickEventListener(function(){thiz.onGetRewardButtonClick()});
var lblHD=new cc.LabelTTF("",cc.res.font.Roboto_CondensedBold,25);lblHD.setColor(cc.color(190,240,253));lblHD.setPosition(bg.getContentSize().width/2,370);bg.addChild(lblHD);this.lblHD=lblHD},onGetRewardButtonClick:function(){this._controller.sendGetRewardRequest()},onRollButtonClick:function(){if(this.rolling)return;var betType=this.chipGroup.chipSelected.chipIndex;switch(this._controller.getTurnState()){case 0:case 4:this.setHoldArray([0,0,0,0,0]);this.setRolling(true);this._controller.sendRollRequest(betType);
break;case 1:this.setRolling(true);this._controller.sendNextRollRequest(this.holdingList);break;case 2:this._controller.sendDoubleRequest();break}},resetBoard:function(){this.setFlashing(false,false);this.resultLabel.setString("");this.bankLabel.setString("0");this.setNhanThuongBtEnable(false);for(var i=0;i<5;i++){this.holdingList[i]=false;this.holdLayers[i].visible=false;this.cardSprites[i].setSpriteFrame("gp_card_up.png")}},setHoldArray:function(holdArray){for(var i=0;i<5;i++)this.holdLayers[i].visible=
holdArray[i];this.holdingList=holdArray},setBankValue:function(value){this.bankLabel.setString(cc.Global.NumberFormat1(value))},update:function(dt){if(!this.baseCardHeight||!this.cardHeight||!this.rolling)return;this.rollHeight-=40;this.rollHeight=this.rollHeight>0?this.rollHeight:this.rollHeight+this.cardHeight*3;for(i=0;i<15;i++){var newY=this.baseCardHeight+(i%3-1)*this.cardHeight+this.rollHeight;newY=newY>this.baseCardHeight+this.cardHeight?newY-2*this.cardHeight:newY;this.cardRollingSprites[i].setPositionY(newY)}},
activateReward:function(id,rank){if(this._controller.getTurnState()!=2){this.resultLabel.setString("");return}var str="";str=this.rewards[id]?this.rewards[id]:"KH\u00d4NG \u0102N";this.resultLabel.setString(str)},holdClick:function(holdIndex){if(this._controller.getTurnState()==1)this.setHoldCard(holdIndex,!this.holdingList[holdIndex]);else if(this._controller.getTurnState()==3){if(holdIndex==0)return;this._controller.sendDoubleChoice(holdIndex)}},showDoubleTurn:function(firstCardId){var card=CardList.prototype.getCardWithId(firstCardId);
this.cardSprites[0].setSpriteFrame(""+card.rank+s_card_suit[card.suit]+".png");for(var i=1;i<5;i++){this.cardSprites[i].setSpriteFrame("gp_card_up.png");this.holdLayers[i].setVisible(false)}},setHoldCard:function(index,isHold){this.holdingList[index]=isHold;this.holdLayers[index].visible=isHold},revealDoubleResult:function(cardArray,choosenPos){this.setCardArray(cardArray);this.setHoldCard(choosenPos,true);SoundPlayer.playSound("open_card")},setFlashing:function(isX2enabled){this.rollButton.loadTextureNormal(isX2enabled?
"videopoker_x2Button.png":"minipoker_rollButton.png",ccui.Widget.PLIST_TEXTURE)},setRewardCards:function(rewardArrayIndex){for(var i=0;i<rewardArrayIndex.length;i++)this.rewardLayer[i].setVisible(rewardArrayIndex[i])},setCardArray:function(cardArray){for(var i=0;i<cardArray.length;i++){var card=CardList.prototype.getCardWithId(cardArray[i]);this.cardSprites[i].setSpriteFrame(""+card.rank+s_card_suit[card.suit]+".png")}this.setRolling(false)},setRolling:function(isRolling){this.rolling=isRolling;if(isRolling)for(var i=
0;i<5;i++)this.rewardLayer[i].visible=false;for(var i=0;i<15;i++){this.cardSprites[i%5].visible=!isRolling||this.holdingList[i%5];this.cardRollingSprites[i].visible=isRolling&&!this.holdingList[i%5]}if(isRolling)this._rollingSound=SoundPlayer.playSoundLoop("mini_flyCard");else{SoundPlayer.stopSoundLoop(this._rollingSound);this._rollingSound=null}},onEnter:function(){this._super();this.scheduleUpdate()},onTouchBegan:function(touch,event){for(i=0;i<this.cardSprites.length;i++){var p=this.cardSprites[i].convertToNodeSpace(touch.getLocation());
if(cc.rectContainsPoint(cc.rect(0,0,this.cardSprites[i]._getWidth(),this.cardSprites[i]._getHeight()),p)){this.holdClick(i);return true}}return this._super(touch,event)},onExit:function(){this._super();this.unscheduleUpdate()},initController:function(){this._controller=new VideoPokerController(this)},initRewards:function(){this.rewards.push("H\u0169 th\u01b0\u1edfng");this.rewards.push("Th\u00f9ng ph\u00e1 s\u1ea3nh");this.rewards.push("T\u1ee9 qu\u00fd");this.rewards.push("C\u00f9 l\u0169");this.rewards.push("Th\u00f9ng");
this.rewards.push("S\u1ea3nh");this.rewards.push("X\u00e1m c\u00f4");this.rewards.push("Hai \u0111\u00f4i");this.rewards.push("\u0110\u00f4i")},onError:function(param){this._super(param);this.setRolling(false);this.setQuayBtEnable(true)},setQuayBtEnable:function(enabled){this.rollButton.enabled=enabled;this.rollButton.setBright(enabled)},setNhanThuongBtEnable:function(enabled){this.nhanThuongBt.setBright(enabled);this.nhanThuongBt.setEnabled(enabled)},showJackpot:function(){var layer=new JackpotLayer;
layer.show()}});var s_miniGame_chip_position=s_miniGame_chip_position||[{x:112,y:365},{x:91,y:262},{x:115,y:154},{x:192,y:108},{x:302,y:100}];var s_money_betEx=s_money_betEx||[1E3,1E4,1E5,1E6,1E7];
var ChanLeLayer=MiniGamePopup.extend({ctor:function(){this._super();this.jackpotLabel.setVisible(false);this.baseCardHeight=0;this.gameType=GameType.MiniGame_ChanLe;var thiz=this;this.moneyBet=0;var bg=new cc.Sprite("#mm_bg_taixiu.png");bg.setAnchorPoint(cc.p(0,0));this.setContentSize(bg.getContentSize());this.setAnchorPoint(cc.p(.5,.5));this.addChild(bg);this.bg=bg;this.historyButton.removeFromParent(true);this.historyButton.setPosition(cc.p(918,232));bg.addChild(this.historyButton);this.historyButton.addClickEventListener(function(){var rank=
new HistoryChanLe;rank.showWithAnimationScale()});this.tutorialButton.removeFromParent(true);this.tutorialButton.setPosition(cc.p(918,152));bg.addChild(this.tutorialButton);var bg_title=new cc.Sprite("#mntx_title.png");bg_title.setPosition(cc.p(bg_title.getContentSize().width/2+30,bg.getContentSize().height-10));bg.addChild(bg_title,-1);var btnRank=new ccui.Button("mntx_btn_bxh.png","","",ccui.Widget.PLIST_TEXTURE);btnRank.setPosition(cc.p(909,309));btnRank.addClickEventListener(function(){var rank=
new ThongKeChanLe;rank.showWithAnimationScale()});bg.addChild(btnRank);var gameIdLabel=cc.Label.createWithBMFont(cc.res.font.Roboto_Condensed_25,"ID : 1231231233",cc.TEXT_ALIGNMENT_LEFT);gameIdLabel.setColor(cc.color(191,242,255,255));gameIdLabel.setPosition(745,150);this.addChild(gameIdLabel);this.gameIdLabel=gameIdLabel;var phoneBg=new ccui.Scale9Sprite("home-text-bg.png",cc.rect(12,12,4,4));phoneBg.setPreferredSize(cc.size(247,55));phoneBg.setPosition(cc.p(513,90));bg.addChild(phoneBg);this.moneyTF=
new newui.TextField(cc.size(240,55),cc.res.font.Roboto_Condensed_30);this.moneyTF.setPlaceHolder("Ch\u1ecdn m\u1ee9c c\u01b0\u1ee3c");this.moneyTF.setTextColor(cc.color(255,255,255));this.moneyTF.setPlaceHolderColor(cc.color(190,240,253,255));this.moneyTF.setPosition(cc.p(513,90));bg.addChild(this.moneyTF,1);this.moneyTF.setTextChangeListener(function(type,newText){if(newText==="")return false;var numberText=newText.replace(/[.,]/g,"");if(cc.Global.IsNumber(numberText)){if(parseInt(numberText)>PlayerMe.gold)numberText=
PlayerMe.gold.toString();thiz.moneyTF.setText(cc.Global.NumberFormat1(parseInt(numberText)));thiz.moneyBet=parseInt(numberText)}return true});this._boudingRect=cc.rect(30,47,930,510);var btnXoa=new ccui.Button("mntx_btn_xoa.png","","",ccui.Widget.PLIST_TEXTURE);btnXoa.setPosition(cc.p(766,89));btnXoa.addClickEventListener(function(){thiz.setMoneyBet(0);thiz.moneyTF.setText("")});bg.addChild(btnXoa);this.gameState=-2;var btnTai=new ccui.Button("mntx_btn_tai.png","","",ccui.Widget.PLIST_TEXTURE);btnTai.setPosition(cc.p(734,
274));btnTai.addClickEventListener(function(){if(thiz.moneyBet<=0)MessageNode.getInstance().show("B\u1ea1n ch\u01b0a ch\u1ecdn m\u1ee9c c\u01b0\u1ee3c");else if(thiz.moneyBet<1E3)MessageNode.getInstance().show("M\u1ee9c c\u01b0\u1ee3c t\u1ed1i thi\u1ec3u l\u00e0 1,000 v\u00e0ng");else if(thiz.gameState==1)thiz._controller.sendBetTaiXiu(1,thiz.moneyBet)});this.setActiveBt(btnTai,false);this.btnTai=btnTai;bg.addChild(btnTai);var btnXiu=new ccui.Button("mntx_btn_xiu.png","","",ccui.Widget.PLIST_TEXTURE);
btnXiu.setPosition(cc.p(288,274));btnXiu.addClickEventListener(function(){if(thiz.moneyBet<=0)MessageNode.getInstance().show("B\u1ea1n ch\u01b0a ch\u1ecdn m\u1ee9c c\u01b0\u1ee3c");else if(thiz.moneyBet<1E3)MessageNode.getInstance().show("M\u1ee9c c\u01b0\u1ee3c t\u1ed1i thi\u1ec3u l\u00e0 1,000 v\u00e0ng");else if(thiz.gameState==1)thiz._controller.sendBetTaiXiu(2,thiz.moneyBet)});bg.addChild(btnXiu);this.btnXiu=btnXiu;this.setActiveBt(btnXiu,false);var lblNumTai=new cc.LabelTTF("",cc.res.font.Roboto_Condensed,
20);lblNumTai.setPosition(105,29);lblNumTai.setAnchorPoint(1,.5);lblNumTai.setColor(cc.color(1,79,174,255));btnTai.addChild(lblNumTai);var lblNumXiu=new cc.LabelTTF("",cc.res.font.Roboto_Condensed,20);lblNumXiu.setPosition(105,29);lblNumXiu.setAnchorPoint(1,.5);lblNumXiu.setColor(cc.color(180,47,53,255));btnXiu.addChild(lblNumXiu);this.lblNumXiu=lblNumXiu;this.lblNumTai=lblNumTai;var lblTotalTai=new cc.LabelTTF("",cc.res.font.Roboto_Condensed,20);lblTotalTai.setColor(cc.color(191,242,255,255));lblTotalTai.setPosition(btnTai.getPositionX(),
368);bg.addChild(lblTotalTai);this.lblTotalTai=lblTotalTai;var lblTotalXiu=new cc.LabelTTF("",cc.res.font.Roboto_Condensed,20);lblTotalXiu.setColor(cc.color(191,242,255,255));lblTotalXiu.setPosition(btnXiu.getPositionX(),368);bg.addChild(lblTotalXiu);this.lblTotalXiu=lblTotalXiu;var lblTai=new cc.LabelTTF("",cc.res.font.Roboto_Condensed,20);lblTai.setColor(cc.color(191,242,255,255));lblTai.setPosition(btnTai.getPositionX(),180);bg.addChild(lblTai);this.lblTai=lblTai;var lblXiu=new cc.LabelTTF("",
cc.res.font.Roboto_Condensed,20);lblXiu.setColor(cc.color(191,242,255,255));lblXiu.setPosition(btnXiu.getPositionX(),180);bg.addChild(lblXiu);this.lblXiu=lblXiu;var wgResuft=new ccui.Widget;this.wgResuft=wgResuft;wgResuft.setContentSize(568,64);wgResuft.setPosition(510,432);bg.addChild(wgResuft);this.createAnimationNumber();this.initDisk();var lblTime=new cc.LabelTTF("",cc.res.font.Roboto_CondensedBold,40);lblTime.setPosition(this.diskSprite.getPosition());lblTime.enableStroke(cc.color(25,74,135,
255),4);lblTime.setColor(cc.color(255,222,0,255));this.bg.addChild(lblTime);this.lblTime=lblTime;this.effTai=new cc.Sprite("#mntx_effect_btntai.png");this.effTai.setPosition(btnTai.getPosition());this.effTai.setVisible(false);this.effTai.runAction(new cc.RepeatForever(new cc.Sequence(new cc.FadeTo(.3,0),new cc.FadeTo(.3,255))));bg.addChild(this.effTai);this.effXiu=new cc.Sprite("#mntx_effect_btnxiu.png");this.effXiu.setPosition(btnXiu.getPosition());this.effXiu.setVisible(false);this.effXiu.runAction(new cc.RepeatForever(new cc.Sequence(new cc.FadeTo(.3,
0),new cc.FadeTo(.3,255))));bg.addChild(this.effXiu)},_addResultSprite:function(result){var arr=_get_random_array(3,s_xocdia_result_position.length);for(var i=0;i<arr.length;i++){var sprite=new cc.Sprite("#taixiu_dice_"+result[i]+".png");sprite.setScale(1.3);sprite.setPosition(s_xocdia_result_position[arr[i]]);this.diskNode.addChild(sprite)}},setTextTaiXiu:function(name){var sprite=new cc.Sprite(name);sprite.setPosition(this.bg.getContentSize().width/2,this.bg.getContentSize().height/2);this.bg.addChild(sprite);
sprite.runAction(new cc.Sequence(new cc.DelayTime(2),new cc.CallFunc(function(){sprite.removeFromParent(true)})))},setMoneyBet:function(money){this.moneyBet=money;this.moneyTF.setText(cc.Global.NumberFormat1(this.moneyBet))},initDisk:function(){var diskSprite=new cc.Sprite("#xocdia_dia.png");diskSprite.setPosition(this.bg.getContentSize().width/2+10,this.bg.getContentSize().height/2+10);this.bg.addChild(diskSprite);this.diskSprite=diskSprite;diskSprite.setScale(.34);var diskNode=new cc.Node;diskSprite.addChild(diskNode);
this.diskNode=diskNode;var batSprite=new cc.Sprite("#xocdia_bat.png");this.batSpritePosition=cc.p(diskSprite.getContentSize().width/2,diskSprite.getContentSize().height/2);batSprite.setPosition(this.batSpritePosition);diskSprite.addChild(batSprite);this.batSprite=batSprite},shakeDisk:function(){this.diskNode.removeAllChildren(true);this.diskSprite.stopAllActions();this.batSprite.stopAllActions();var thiz=this;this.diskSprite.runAction(new cc.Sequence(new cc.DelayTime(.2),new quyetnd.ActionShake2D(3,
cc.p(10,10))))},openDisk:function(isEffect){var thiz=this;if(isEffect){SoundPlayer.playSound(["bellopen","mobat"]);this.diskSprite.stopAllActions();this.batSprite.stopAllActions();this.diskSprite.runAction(new cc.EaseSineOut(new cc.ScaleTo(.7,.5,.5)));this.batSpritePosition=this.batSprite.getPosition();this.batSprite.runAction(new cc.Sequence(new cc.DelayTime(.9),new cc.EaseSineIn(new cc.MoveBy(1,cc.p(0,450))),new cc.DelayTime(2.5),new cc.CallFunc(function(){thiz.closeDisk(true)})))}else{this.diskSprite.stopAllActions();
this.batSprite.stopAllActions();this.diskSprite.setScale(.5);this.batSprite.setPosition(cc.p(0,450))}},closeDisk:function(isEffect){var thiz=this;this.diskSprite.stopAllActions();this.batSprite.stopAllActions();if(isEffect){this.batSprite.runAction(new cc.EaseSineOut(new cc.MoveTo(1,thiz.batSpritePosition)));this.diskSprite.runAction(new cc.Sequence(new cc.DelayTime(1.2),new cc.CallFunc(function(){thiz.diskSprite.runAction(new cc.EaseSineOut(new cc.ScaleTo(.7,.34,.34)))})))}else{thiz.diskSprite.setScale(.34);
this.batSprite.setPosition(thiz.batSpritePosition)}},resetGame:function(){this.lblTai.setString("");this.lblXiu.setString("");this.lblTotalTai.setString("");this.lblTotalXiu.setString("");this.effTai.setVisible(false);this.effXiu.setVisible(false);this.spriteAni.setVisible(false);this.stopTime()},showEffectNumber:function(){this.spriteAni.setVisible(true);cc.log("\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d"+this.wgResuft.getChildrenCount());this.spriteAni.setPosition(this.wgResuft.getPositionX()/
2+20+(this.wgResuft.getChildrenCount()-1)*50,this.wgResuft.getPositionY())},hiddenEffectNumber:function(){this.spriteAni.setVisible(false)},createAnimationNumber:function(){var spriteAni=new cc.Sprite("#mntx_bg_itemselect.png");spriteAni.setPosition(this.wgResuft.getPositionX()/2+(this.wgResuft.getChildrenCount()-1)*50,this.wgResuft.getPositionY());this.bg.addChild(spriteAni);spriteAni.setVisible(false);this.spriteAni=spriteAni;var lbl=new cc.LabelTTF("10",cc.res.font.Roboto_CondensedBold,20);lbl.setPosition(spriteAni.getContentSize().width/
2,spriteAni.getContentSize().height/2);lbl.runAction(new cc.RepeatForever(new cc.Sequence(new cc.DelayTime(.2),new cc.CallFunc(function(){var number=Math.floor(3+Math.random()*18);if(number>10)lbl.setColor(cc.color(0,204,255,255));else lbl.setColor(cc.color(255,222,0,255));lbl.setString(number)}))));spriteAni.addChild(lbl)},drawResuft:function(arrNumer){var thiz=this},pushItemHistory:function(index,data){var thiz=this;var lbl=new cc.LabelTTF(data.number,cc.res.font.Roboto_CondensedBold,20);var bgText=
new ccui.Button("mntx_bg_hisItem.png","","",ccui.Widget.PLIST_TEXTURE);bgText.addClickEventListener(function(){thiz.handleHistoryPhien(data)});if(data.number>10){lbl.setColor(cc.color(0,204,255,255));bgText.setColor(cc.color(0,204,255,255))}else{lbl.setColor(cc.color(255,222,0,255));bgText.setColor(cc.color(255,222,0,255))}bgText.addChild(lbl);lbl.setPosition(bgText.getContentSize().width/2,bgText.getContentSize().height/2);bgText.setPosition(cc.p(index*50,this.wgResuft.getContentSize().height/2));
this.wgResuft.addChild(bgText)},handleHistoryPhien:function(data){var aa=new HistoryPhien(data);aa.showWithAnimationScale()},setActiveBt:function(btn,enabled){btn.setBright(enabled);btn.setEnabled(enabled)},initChip:function(centerPosition){var thiz=this;for(var i=1;i<6;i++)(function(){var iNew=i;var chip1=new ccui.Button("mm_btn"+iNew+"_2.png","mm_btn"+iNew+"_1.png","",ccui.Widget.PLIST_TEXTURE);chip1.setTitleText("+"+cc.Global.NumberFormat2(s_money_betEx[iNew-1]));chip1.setTitleFontName(cc.res.font.Roboto_CondensedBold);
chip1.setTitleFontSize(30);chip1.setPosition(s_miniGame_chip_position[iNew-1]);chip1.addClickEventListener(function(){thiz.handleChip(iNew-1)});thiz.addChild(chip1,1)})()},handleChip:function(index){cc.log(index);this.moneyBet+=s_money_betEx[index];if(this.moneyBet>PlayerMe.gold)this.moneyBet=PlayerMe.gold;this.setMoneyBet(this.moneyBet)},update:function(dt){this.timer-=dt;if(this.timer>0)this.setTimeFomat();else this.stopTime()},startTime:function(time){this.lblTime.setOpacity(255);this.scheduleUpdate();
this.timer=time},stopTime:function(){this.lblTime.setColor(cc.color(255,222,0,255));this.unscheduleUpdate();this.timer=0;this.lblTime.stopAllActions();this.lblTime.setString("");this.isCountDownSound=false},setTimeFomat:function(){var number=Math.floor(this.timer);var minute=Math.floor(number/60);var second=number-minute*60;var stringSecon=second>9?second:"0"+second;var stringTime="0"+minute+":"+stringSecon;this.lblTime.setString(stringTime);if(this.isCountDownSound&&number<=5){this.lblTime.setColor(cc.color(255,
0,0));this.lblTime.runAction(new cc.RepeatForever(new cc.Sequence(new cc.FadeTo(.2,50),new cc.FadeTo(.2,255))));this.isCountDownSound=false;this.playSoundBip()}},playSoundBip:function(){this.lblTime.runAction(new cc.RepeatForever(new cc.Sequence(new cc.CallFunc(function(){SoundPlayer.playSound("countDownS")}),new cc.DelayTime(1))))},onEnter:function(){this._super();var thiz=this},onTouchBegan:function(touch,event){return this._super(touch,event)},onExit:function(){this._super();this.unscheduleUpdate()},
initController:function(){this._controller=new ChanLeController(this)},onError:function(param){this._super(param)}});var SceneNavigator=SceneNavigator||{};
SceneNavigator.toHome=function(message){setTimeout(function(){LobbyClient.getInstance().close();SmartfoxClient.getInstance().close()},1);if(!cc.sys.isNative&&window.parent.user_logout)window.parent.user_logout();var homeScene=cc.director.getRunningScene();if(homeScene.type=="HomeScene")homeScene.startHome();else{homeScene=new HomeScene;homeScene.startHome();cc.director.replaceScene(homeScene)}if(message)MessageNode.getInstance().showWithParent(message,homeScene.messageLayer);MiniGameNavigator.hideAll()};
SceneNavigator.toAccountActiveView=function(){var dialog=new UserinfoDialog;dialog.selectTab=2;dialog.show()};SceneNavigator.toLobby=function(message){SmartfoxClient.getInstance().close();var homeScene=cc.director.getRunningScene();if(homeScene.type=="HomeScene")homeScene.startGame();else{homeScene=new HomeScene;homeScene.startGame();cc.director.replaceScene(homeScene)}if(message)MessageNode.getInstance().showWithParent(message,homeScene.messageLayer);MiniGameNavigator.hideAll()};
SceneNavigator.toGame=function(message){};SceneNavigator.toGame=function(gameId,message){};SceneNavigator.toMiniGame=function(gameId,isReconnect){MiniGameNavigator.showGame(gameId);if(isReconnect)LobbyClient.getInstance().postEvent("miniGameReconnect",null)};SceneNavigator.showLoginNormal=function(){if(!cc.sys.isNative&&window.parent.show_popup_login)window.parent.show_popup_login();else{var dialog=new LoginDialog;dialog.show()}};
SceneNavigator.showLoginFacebook=function(){if(!cc.sys.isNative&&window.parent.login_facebook)window.parent.login_facebook();else FacebookPlugin.getInstance().showLogin()};SceneNavigator.showSignup=function(){if(!cc.sys.isNative&&window.parent.show_popup_login)window.parent.show_popup_login();else{var dialog=new SignupDialog;dialog.show()}};